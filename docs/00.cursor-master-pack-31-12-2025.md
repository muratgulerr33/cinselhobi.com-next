# Cursor Master Knowledge Pack (DOC-01 … DOC-14)
> Generated on: 2025-12-30T23:51:48.430Z
> Single source of truth. Do not invent routesndpoints/fields. Use Unknown/Assumption when needed.

**Priority Order:** 02 > 04 > 05 > 08 > 03 > 09 > 06 > 07 > 10 > 11 > 12 > 01 > 13 > 14

## Table of Contents
- DOC-01: 01.project-brief.md
- DOC-02: 02.architecture-lock.md
- DOC-03: 03.routes-and-navigation-map.md
- DOC-04: 04.design-system.md
- DOC-05: 05.native-ux-rules.md
- DOC-06: 06.frontend-standards-2026.md
- DOC-07: 07.component-inventory.md
- DOC-08: 08.api-contracts-frontend.md
- DOC-09: 09.data-fetching-cache-rules.md
- DOC-10: 10.tasks-playbook.md
- DOC-11: 11.qa-test-matrix.md
- DOC-12: 12.release-prod-checklist.md
- DOC-13: 13.security-and-deps.md
- DOC-14: 14.Cursor-bridge-instructions.md

---

# DOC-01: 01.project-brief.md

---
# 01.project-brief.md

## 1. Overview

Cinselhobi.com Next, WooCommerce tabanlı mevcut e-ticaret sitesinden veri çekerek PostgreSQL veritabanına aktaran ve Next.js App Router ile modern bir frontend arayüzü sunan full-stack e-ticaret uygulamasıdır. Proje, native mobile app hissi veren dokunsal ve akıcı bir kullanıcı deneyimi hedefler.

**Evidence:** `README.md` (lines 1-5), `package.json` (name: "cinselhobi-com-next"), `docs/01-frontend-project-doc-v1.md` (lines 1-16)

---

## 2. Goals

- WooCommerce REST API'den ürün ve kategori verilerini tek seferlik import ederek PostgreSQL'e aktarmak
- Next.js App Router ile modern, performanslı bir e-ticaret storefront oluşturmak
- Native mobile app hissi veren responsive UI/UX tasarımı
- Kamatera VPS üzerinde self-hosted deployment
- Drizzle ORM ile type-safe veritabanı sorguları
- NextAuth.js (Auth.js v5) ile kullanıcı kimlik doğrulama
- Sepet, favoriler, sipariş yönetimi gibi temel e-ticaret özellikleri

**Evidence:** `docs/01-frontend-project-doc-v1.md` (lines 1-35), `README.md` (lines 109-181), `package.json` (scripts: woo:import)

---

## 3. Non-Goals

- Prisma ORM kullanımı (Drizzle tercih ediliyor)
- VPS dışı yönetilen platform kullanımı (self-hosted yaklaşım)
- "Her şeyi bir anda" özellik ekleme (önce iskelet + veri + temel UI)
- Test framework kurulumu (şu an test dosyası yok)

**Evidence:** `docs/01-frontend-project-doc-v1.md` (lines 29-34), `package.json` (devDependencies: test framework yok)

---

## 4. Primary User Flows

### 4.1 Ürün Keşfi
- Ana sayfa: Kategoriler grid'i + Yeni ürünler listesi
- Kategori sayfası: Filtreleme (fiyat, stok durumu, alt kategoriler) + Sıralama + Cursor-based pagination
- Ürün detay: Galeri, açıklama, fiyat, sepete ekleme
- Arama: Gerçek zamanlı arama overlay, ürün ve kategori sonuçları

**Evidence:** `src/app/page.tsx`, `src/app/categories/page.tsx`, `src/app/urun/[slug]/page.tsx`, `src/app/search/page.tsx`, `src/components/search/search-overlay.tsx`

### 4.2 Kullanıcı İşlemleri
- Kayıt/Giriş: Email + şifre ile credentials authentication
- Hesap yönetimi: Adresler, siparişler, kuponlar, ayarlar, favoriler
- Sepet: Ürün ekleme, miktar güncelleme, checkout akışı
- Sipariş: Sipariş oluşturma, durum takibi, başarı sayfası

**Evidence:** `src/app/login/page.tsx`, `src/app/signup/page.tsx`, `src/app/account/`, `src/app/cart/page.tsx`, `src/app/checkout/page.tsx`, `src/app/order-success/[id]/page.tsx`

### 4.3 Admin İşlemleri
- Sipariş yönetimi: Sipariş listesi, detay görüntüleme, durum güncelleme

**Evidence:** `src/app/admin/orders/`, `src/components/admin/order-status-form.tsx`

---

## 5. Tech Stack

### 5.1 Framework & Runtime
- **Next.js:** 16.1.1 (App Router)
- **React:** 19.2.3
- **TypeScript:** 5.x
- **Node.js:** LTS 18+ (assumption)

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3), `tsconfig.json`

### 5.2 UI & Styling
- **Tailwind CSS:** v4 (PostCSS plugin ile)
- **shadcn/ui:** New York style, Radix UI primitives
- **Framer Motion:** 12.23.26 (animasyonlar)
- **Lucide React:** 0.562.0 (ikonlar)
- **next-themes:** 0.4.6 (dark mode)
- **Sonner:** 2.0.7 (toast notifications)

**Evidence:** `package.json` (dependencies), `components.json`, `tailwind.config.ts`, `postcss.config.mjs`, `src/app/globals.css`

### 5.3 State & Data
- **Drizzle ORM:** 0.45.1 (PostgreSQL)
- **PostgreSQL:** 16 (Docker)
- **pg:** 8.16.3 (PostgreSQL driver)
- **React Context API:** Cart, Favorites, Search, Auth, Theme providers

**Evidence:** `package.json` (dependencies: drizzle-orm, pg), `docker-compose.yml`, `src/db/schema.ts`, `src/components/cart/cart-provider.tsx`

### 5.4 Forms & Validation
- **React Hook Form:** 7.69.0
- **Zod:** 4.2.1
- **@hookform/resolvers:** 5.2.2

**Evidence:** `package.json` (dependencies), `src/components/auth/login-form.tsx`

### 5.5 Authentication
- **NextAuth.js (Auth.js v5):** 5.0.0-beta.25
- **@auth/drizzle-adapter:** 1.11.1
- **Argon2:** 0.44.0 (şifre hash)

**Evidence:** `package.json` (dependencies), `src/auth.ts`, `src/auth.config.ts`

### 5.6 Build & Dev Tools
- **ESLint:** 9 (Next.js config)
- **tsx:** 4.21.0 (script execution)
- **drizzle-kit:** 0.31.8 (migration tooling)
- **dotenv:** 17.2.3 (env management)

**Evidence:** `package.json` (devDependencies), `eslint.config.mjs`

---

## 6. Project Structure

```
/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── [slug]/             # Dynamic category/page route
│   │   ├── account/            # User account pages
│   │   ├── admin/              # Admin pages
│   │   ├── api/                # Route handlers
│   │   │   ├── auth/           # NextAuth endpoints
│   │   │   ├── products/       # Product API
│   │   │   └── search/        # Search API
│   │   ├── cart/               # Cart page
│   │   ├── categories/         # Category listing
│   │   ├── checkout/           # Checkout flow
│   │   ├── login/              # Login page
│   │   ├── signup/             # Signup page
│   │   ├── search/             # Search results
│   │   ├── urun/[slug]/        # Product detail
│   │   └── ...                 # Legal/content pages
│   ├── components/
│   │   ├── account/            # Account components
│   │   ├── admin/              # Admin components
│   │   ├── app/                # App-level (Footer, mobile nav)
│   │   ├── auth/               # Auth forms
│   │   ├── cart/               # Cart components
│   │   ├── catalog/            # Product catalog
│   │   ├── favorites/          # Wishlist
│   │   ├── layout/             # Header, navigation
│   │   ├── product/            # Product detail
│   │   ├── search/             # Search UI
│   │   ├── theme/              # Theme toggle
│   │   └── ui/                 # shadcn/ui components
│   ├── db/
│   │   ├── connection.ts       # Drizzle DB instance
│   │   ├── queries/           # Query functions
│   │   └── schema.ts          # Drizzle schema
│   ├── lib/
│   │   ├── format.ts          # Price/image formatting
│   │   ├── search/            # Search utilities
│   │   └── utils.ts           # cn() helper
│   ├── actions/                # Server actions
│   ├── config/                 # App config
│   ├── hooks/                  # React hooks
│   └── types/                  # TypeScript types
├── scripts/
│   └── woo-import.ts           # WooCommerce import script
├── drizzle/                    # Migration files
├── data/snapshots/             # Import snapshots
├── docs/                       # Documentation
└── docker-compose.yml          # PostgreSQL container
```

**Evidence:** `src/app/` (directory structure), `src/components/` (directory structure), `src/db/schema.ts`, `scripts/woo-import.ts`

---

## 7. Environments & Scripts

### 7.1 Package Manager
- **npm** (package-lock.json mevcut)

**Evidence:** `package-lock.json` (file exists)

### 7.2 Scripts
- `dev`: Development server (TZ=Europe/Istanbul)
- `build`: Production build (TZ=Europe/Istanbul)
- `start`: Production server (TZ=Europe/Istanbul)
- `lint`: ESLint check
- `db:generate`: Drizzle migration generate
- `db:migrate`: Drizzle migration apply
- `woo:import`: WooCommerce import script (tsx)

**Evidence:** `package.json` (scripts section)

### 7.3 Environment Variables
`.env.local` veya `.env` dosyaları kullanılıyor (dotenv ile yükleniyor). Dosya isimleri:
- `.env.local` (öncelikli)
- `.env` (fallback)

**Evidence:** `drizzle.config.ts` (lines 4-5), `src/db/connection.ts` (lines 6-7), `scripts/woo-import.ts` (dotenv.config calls)

**Not:** Secret değerler dokümante edilmedi. Sadece dosya isimleri listelendi.

---

## 8. APIs & Integrations (Frontend Perspective)

### 8.1 Internal API Routes
- `/api/products`: Ürün listesi (cursor-based pagination, filtreleme, sıralama)
- `/api/products/[slug]`: Ürün detay
- `/api/products/[slug]/related`: İlgili ürünler
- `/api/search`: Arama (ürün + kategori)
- `/api/auth/[...nextauth]`: NextAuth.js endpoints
- `/api/auth/signup`: Kullanıcı kayıt

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts`, `src/app/api/auth/[...nextauth]/route.ts`

### 8.2 External Integrations
- **WooCommerce REST API:** Import script tarafından kullanılıyor (frontend'den direkt kullanılmıyor)
  - Base URL: `WOO_BASE_URL` env
  - Auth: `WOO_CONSUMER_KEY`, `WOO_CONSUMER_SECRET` env
  - Mode: `WOO_AUTH_MODE` (basic/query)

**Evidence:** `scripts/woo-import.ts` (lines 14-16, 88-138), `README.md` (lines 127-168)

### 8.3 Environment Keys (Frontend)
- `DATABASE_URL`: PostgreSQL connection string
- `AUTH_SECRET`: NextAuth.js secret
- `AUTH_URL`: NextAuth.js base URL (production)
- `WOO_BASE_URL`: WooCommerce site URL (import script)
- `WOO_CONSUMER_KEY`: WooCommerce API key (import script)
- `WOO_CONSUMER_SECRET`: WooCommerce API secret (import script)
- `WOO_IMPORT_MODE`: Import mode (full/sample)
- `WOO_IMPORT_LIMIT`: Sample mode limit
- `WOO_AUTH_MODE`: WooCommerce auth mode (basic/query)
- `WOO_PRODUCT_STATUS`: Product status filter (default: publish)

**Evidence:** `drizzle.config.ts`, `src/auth.ts` (line 17), `scripts/woo-import.ts` (lines 14-20), `README.md` (lines 72-84)

### 8.4 Data Fetching
- Server Components: Direct DB queries (Drizzle)
- Client Components: Fetch API ile `/api/*` routes
- Server Actions: `src/actions/` klasöründe (checkout, favorites, address, admin)

**Evidence:** `src/app/page.tsx` (Server Component), `src/components/catalog/load-more-grid.tsx` (fetch usage), `src/actions/`

---

## 9. Quality & Standards

### 9.1 Code Quality
- **ESLint:** Next.js core-web-vitals + TypeScript config
- **TypeScript:** Strict mode enabled
- **Linting:** `npm run lint` script mevcut

**Evidence:** `eslint.config.mjs`, `tsconfig.json` (strict: true), `package.json` (lint script)

### 9.2 Testing
- Test framework kurulu değil
- Test dosyası yok (`**/*test*`, `**/*spec*` araması sonuçsuz)

**Evidence:** No test files found in codebase search

### 9.3 Accessibility
- Radix UI primitives kullanımı (a11y built-in)
- Semantic HTML yapısı (assumption, layout.tsx'te görülebilir)

**Evidence:** `package.json` (@radix-ui/* packages), `src/app/layout.tsx` (semantic HTML structure)

### 9.4 Performance
- Cursor-based pagination (infinite scroll)
- Image optimization: Next.js Image component (remotePatterns config)
- Server Components: Default rendering strategy

**Evidence:** `next.config.ts` (images.remotePatterns), `src/app/api/products/route.ts` (cursor pagination), `src/app/page.tsx` (Server Component)

### 9.5 Error Handling
- Route handlers'da try-catch blokları
- Error boundaries: `not-found.tsx` mevcut

**Evidence:** `src/app/api/search/route.ts` (try-catch), `src/app/not-found.tsx`

---

## 10. Current Status

### 10.1 Local Development
- ✅ Development server çalışıyor (`npm run dev`)
- ✅ PostgreSQL Docker container ile local setup
- ✅ Drizzle migrations çalışıyor
- ✅ WooCommerce import script çalışıyor (sample/full mode)

**Evidence:** `README.md` (lines 9-60), `docker-compose.yml`, `package.json` (scripts)

### 10.2 Architecture
- ✅ App Router yapısı kurulu
- ✅ Component katmanı organize edilmiş
- ✅ Database schema tanımlı (Drizzle)
- ✅ Auth sistemi kurulu (NextAuth.js v5)
- ✅ Theme sistemi (dark/light mode)
- ✅ Mobile-first responsive design

**Evidence:** `src/app/` (route structure), `src/components/` (component organization), `src/db/schema.ts`, `src/auth.ts`, `src/components/theme/`

### 10.3 Component Maturity
- **Assumption:** Component library (shadcn/ui) kullanılıyor, temel UI bileşenleri mevcut
- Component sayısı: ~50+ (ui/, catalog/, product/, cart/, vb.)
- Storybook yok

**Evidence:** `src/components/ui/` (15 files), `components.json` (shadcn config), No storybook config found

---

## 11. Known Gaps / Risks

### 11.1 Testing
- Test framework kurulu değil
- Unit test yok
- E2E test yok
- Integration test yok

**Evidence:** No test files found

### 11.2 Environment Configuration
- `.env*` dosyaları gitignore'da (secret management belirsiz)
- Production environment variables dokümante edilmemiş

**Evidence:** `.env*` files not found in repo (expected, gitignored)

### 11.3 Error Handling
- Global error boundary yok (sadece not-found.tsx var)
- API error responses standardize edilmemiş (assumption)

**Evidence:** `src/app/not-found.tsx` exists, no `error.tsx` found in root app/

### 11.4 Performance Monitoring
- Analytics entegrasyonu yok (assumption)
- Performance monitoring yok (assumption)

**Evidence:** No analytics/performance monitoring code found

### 11.5 Documentation
- API endpoint'leri dokümante edilmemiş
- Component API'leri dokümante edilmemiş
- Deployment process dokümante edilmiş (`docs/04-deploy-kamatera-pm2.md`)

**Evidence:** `docs/` directory exists, API docs not found

---

## 12. Open Questions

1. Production deployment süreci tam olarak nasıl? (PM2 config, build optimizations)
2. CDN kullanılıyor mu? (Image optimization için)
3. Payment gateway entegrasyonu hangi aşamada? (Checkout sayfası var ama payment processing belirsiz)
4. Email service entegrasyonu var mı? (Order confirmations, password reset)
5. SEO stratejisi nedir? (Metadata, sitemap, robots.txt)
6. Analytics tool entegrasyonu planlanıyor mu? (Google Analytics, vb.)
7. Error logging/monitoring service kullanılıyor mu? (Sentry, LogRocket, vb.)
8. Backup stratejisi nedir? (Database backups, snapshot management)
9. Multi-language support planlanıyor mu? (i18n)
10. Admin panel'de başka özellikler planlanıyor mu? (Product management, user management)

---

## 13. Evidence Index

1. **Package.json:** `package.json` - Dependencies, scripts, project name
2. **README:** `README.md` - Setup instructions, WooCommerce import guide
3. **Next.js Config:** `next.config.ts` - Image optimization, timezone
4. **TypeScript Config:** `tsconfig.json` - Compiler options, paths
5. **Drizzle Config:** `drizzle.config.ts` - Database connection, schema path
6. **Database Schema:** `src/db/schema.ts` - Tables: products, categories, users, orders, etc.
7. **Auth Setup:** `src/auth.ts` - NextAuth.js configuration, credentials provider
8. **App Router Structure:** `src/app/` - Route organization, page components
9. **Component Library:** `components.json` - shadcn/ui configuration
10. **Tailwind Config:** `tailwind.config.ts` - Content paths, theme extensions
11. **PostCSS Config:** `postcss.config.mjs` - Tailwind v4 plugin
12. **Docker Compose:** `docker-compose.yml` - PostgreSQL 16 container
13. **WooCommerce Import:** `scripts/woo-import.ts` - Import script implementation
14. **API Routes:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts` - Internal APIs
15. **Global Styles:** `src/app/globals.css` - CSS variables, theme tokens
16. **Root Layout:** `src/app/layout.tsx` - Providers, theme, structure
17. **Home Page:** `src/app/page.tsx` - Server Component, data fetching
18. **ESLint Config:** `eslint.config.mjs` - Linting rules
19. **Project Docs:** `docs/01-frontend-project-doc-v1.md` - Project goals, tech stack
20. **WooCommerce Docs:** `docs/03-woo-import-guide.md` - Import process documentation
---

# DOC-02: 02.architecture-lock.md

---
# 02. Architecture Lock

Bu doküman, Cinselhobi.com Next projesinin mimari kararlarını, değişmez kuralları ve yasakları tanımlar. Amaç: AI asistanların (Cursor/Cursor) yanlış değişiklik yapmasını önlemek ve tutarlı geliştirme sağlamak.

**Son Güncelleme:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

---

## 1. Architecture Snapshot

1. **Next.js App Router kullanılıyor** - `pages/` klasörü yok, tüm route'lar `src/app/` altında (kanıt: `src/app/` yapısı, `package.json` next@16.1.1)
2. **Server Components varsayılan** - Client Component'ler sadece `"use client"` direktifi ile işaretlenmiş dosyalarda (kanıt: `src/app/page.tsx` Server Component, `src/components/cart/cart-provider.tsx` Client Component)
3. **Drizzle ORM + PostgreSQL** - Prisma kullanılmıyor (kanıt: `package.json` drizzle-orm@0.45.1, `src/db/schema.ts`, `README.md` line 185)
4. **NextAuth.js v5 (Auth.js)** - Credentials provider, Drizzle adapter (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)
5. **Tailwind CSS v4** - PostCSS plugin ile, shadcn/ui (New York style) entegrasyonu (kanıt: `package.json` tailwindcss@4, `components.json`, `postcss.config.mjs`)
6. **Context API state management** - Cart, Favorites, Search, Auth, Theme provider'ları (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`)
7. **Server Actions** - `src/actions/` klasöründe, Zod validation ile (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)
8. **Cursor-based pagination** - Infinite scroll pattern, `/api/products` endpoint'i (kanıt: `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`)
9. **Sonner toast sistemi** - Feedback için (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
10. **Archive klasörü build/typecheck dışı** - `tsconfig.json` ve `eslint.config.mjs` exclude ediyor (kanıt: `tsconfig.json` line 34, `eslint.config.mjs` line 16)

**Evidence:** `package.json`, `src/app/`, `src/components/`, `tsconfig.json`, `eslint.config.mjs`, `README.md`

---

## 2. Non-Negotiables (Hard Constraints)

### 2.1 Framework & Routing
- **App Router zorunlu** - `pages/` klasörü oluşturulmamalı, tüm route'lar `src/app/` altında olmalı (kanıt: `src/app/` yapısı, `package.json` next@16.1.1)
- **Route path'leri değiştirilemez** - Mevcut route path'leri (örn: `/urun/[slug]`, `/account/*`, `/checkout`) değiştirilemez (kanıt: `src/app/urun/[slug]/page.tsx`, `src/app/account/`, `src/app/checkout/page.tsx`)
- **Dynamic routes pattern korunmalı** - `[slug]`, `[id]` gibi dynamic segment pattern'leri değiştirilemez (kanıt: `src/app/urun/[slug]/page.tsx`, `src/app/order-success/[id]/page.tsx`)

**Evidence:** `src/app/` directory structure, `package.json` (next version)

### 2.2 Rendering Model
- **Server Components varsayılan** - Client Component'e geçiş sadece `"use client"` direktifi ile, gereksiz yere Client Component oluşturulmamalı (kanıt: `src/app/page.tsx` Server Component, `src/components/cart/cart-provider.tsx` Client Component)
- **Provider'lar sadece `layout.tsx`'te** - Theme, Auth, Cart, Favorites, Search provider'ları `src/app/layout.tsx` içinde, başka yerde provider açılmamalı (kanıt: `src/app/layout.tsx` lines 59-87)
- **Server/Client boundary korunmalı** - Server Component'ten Client Component'e prop geçişi serializable olmalı, function/Date/class instance geçirilemez (kanıt: `src/app/page.tsx` → `LoadMoreGrid` prop geçişi)

**Evidence:** `src/app/layout.tsx`, `src/app/page.tsx`, `src/components/cart/cart-provider.tsx`

### 2.3 Database & ORM
- **Drizzle ORM zorunlu** - Prisma veya başka ORM kullanılamaz (kanıt: `package.json` drizzle-orm@0.45.1, `README.md` line 185)
- **Schema değişikliği migration ile** - `src/db/schema.ts` değişiklikleri `npm run db:generate` ve `npm run db:migrate` ile yapılmalı (kanıt: `package.json` scripts, `drizzle/` migration files)
- **Connection singleton** - `src/db/connection.ts` export edilen `db` instance kullanılmalı, yeni connection pool oluşturulmamalı (kanıt: `src/db/connection.ts`)

**Evidence:** `package.json`, `src/db/schema.ts`, `src/db/connection.ts`, `README.md`

### 2.4 Authentication
- **NextAuth.js v5 zorunlu** - Auth.js v5 API'si kullanılmalı, eski v4 pattern'leri kullanılamaz (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)
- **Credentials provider pattern** - Email + password authentication, Argon2 hash (kanıt: `src/auth.ts` lines 31-68)
- **Auth adapter Drizzle** - `@auth/drizzle-adapter` kullanılmalı (kanıt: `package.json` @auth/drizzle-adapter@1.11.1, `src/auth.ts` lines 24-29)

**Evidence:** `package.json`, `src/auth.ts`, `src/auth.config.ts`

### 2.5 Styling & Design System
- **Tailwind CSS v4 zorunlu** - PostCSS plugin ile, `@tailwindcss/postcss` (kanıt: `package.json` tailwindcss@4, `postcss.config.mjs`)
- **shadcn/ui New York style** - `components.json` config değiştirilemez (kanıt: `components.json` style: "new-york")
- **Design tokens değiştirilemez** - `src/app/globals.css` içindeki CSS custom properties (`--primary`, `--background`, vb.) değiştirilemez (kanıt: `src/app/globals.css` lines 12-79)
- **Theme provider pattern** - `next-themes` kullanılmalı, `src/components/theme/theme-provider.tsx` wrapper'ı değiştirilemez (kanıt: `package.json` next-themes@0.4.6, `src/components/theme/theme-provider.tsx`)

**Evidence:** `package.json`, `components.json`, `src/app/globals.css`, `src/components/theme/theme-provider.tsx`, `postcss.config.mjs`

### 2.6 State Management
- **Context API zorunlu** - Redux, Zustand, Jotai gibi external state library'leri kullanılamaz (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`)
- **Provider hiyerarşisi sabit** - `layout.tsx` içindeki provider sırası değiştirilemez: ThemeProvider → AuthProvider → FavoritesProvider → CartProvider → HeaderProvider → SearchProvider (kanıt: `src/app/layout.tsx` lines 59-87)

**Evidence:** `src/app/layout.tsx`, `src/components/cart/cart-provider.tsx`

### 2.7 Forms & Validation
- **React Hook Form + Zod zorunlu** - Form validation için (kanıt: `package.json` react-hook-form@7.69.0, zod@4.2.1, `src/components/auth/login-form.tsx`)
- **Server Actions pattern** - Form submit'ler `src/actions/` içinde Server Action olmalı, Zod schema ile validate edilmeli (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `package.json`, `src/actions/checkout.ts`, `src/components/auth/login-form.tsx`

### 2.8 API & Data Fetching
- **Cursor-based pagination zorunlu** - `/api/products` endpoint'i cursor pattern kullanır, offset-based pagination kullanılamaz (kanıt: `src/app/api/products/route.ts` lines 37-44, 140-141)
- **API route handlers pattern** - `src/app/api/*/route.ts` pattern'i korunmalı, eski `pages/api/*` kullanılamaz (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Force-dynamic default** - API route'lar `export const dynamic = "force-dynamic"` kullanır (kanıt: `src/app/api/products/route.ts` line 9, `src/app/api/search/route.ts`)

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts`

### 2.9 Build & Environment
- **Archive klasörü exclude** - `archive/**` klasörü TypeScript ve ESLint tarafından ignore edilir, build'e dahil edilmez (kanıt: `tsconfig.json` line 34, `eslint.config.mjs` line 16)
- **Timezone Europe/Istanbul** - Tüm script'ler `TZ=Europe/Istanbul` ile çalışır (kanıt: `package.json` scripts, `next.config.ts` line 3)
- **Environment variable loading** - `.env.local` öncelikli, sonra `.env` (kanıt: `src/db/connection.ts` lines 6-7, `scripts/woo-import.ts`)

**Evidence:** `tsconfig.json`, `eslint.config.mjs`, `package.json`, `next.config.ts`, `src/db/connection.ts`

### 2.10 Toast & Feedback
- **Sonner zorunlu** - Toast notification'lar için, `Toaster` component'i `layout.tsx` içinde (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
- **Toast position top-center** - `position="top-center"` sabit (kanıt: `src/app/layout.tsx` line 82)

**Evidence:** `package.json`, `src/app/layout.tsx`

---

## 3. Allowed Changes

### 3.1 Routing
- **Yeni route eklemek serbest** - `src/app/` altında yeni route klasörleri oluşturulabilir, App Router pattern'i takip edilmeli (örn: `src/app/yeni-sayfa/page.tsx`)
- **Route groups kullanılabilir** - `(group)` pattern'i ile route organizasyonu yapılabilir
- **Loading/error/not-found.tsx eklemek serbest** - Route segment'lerine `loading.tsx`, `error.tsx`, `not-found.tsx` eklenebilir (kanıt: `src/app/urun/[slug]/loading.tsx`, `src/app/[slug]/loading.tsx`)

**Evidence:** `src/app/` structure, `src/app/urun/[slug]/loading.tsx`

### 3.2 Components
- **Yeni component eklemek serbest** - `src/components/` altında yeni component'ler oluşturulabilir, klasör organizasyonu korunmalı (örn: `src/components/product/`, `src/components/catalog/`)
- **Client Component oluşturmak serbest** - Gerekli durumlarda `"use client"` direktifi ile Client Component oluşturulabilir (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/catalog/load-more-grid.tsx`)
- **shadcn/ui component eklemek serbest** - `npx shadcn@latest add [component]` ile yeni UI component'leri eklenebilir, `components.json` config'e uygun olmalı

**Evidence:** `src/components/` structure, `components.json`

### 3.3 Database
- **Schema genişletmek serbest** - `src/db/schema.ts` içine yeni tablolar/kolonlar eklenebilir, migration ile (kanıt: `src/db/schema.ts`, `drizzle/` migrations)
- **Query fonksiyonları eklemek serbest** - `src/db/queries/` altında yeni query fonksiyonları eklenebilir (kanıt: `src/db/queries/` directory)

**Evidence:** `src/db/schema.ts`, `src/db/queries/`

### 3.4 API
- **Yeni API route eklemek serbest** - `src/app/api/` altında yeni route handler'lar oluşturulabilir, `route.ts` pattern'i ile (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Server Action eklemek serbest** - `src/actions/` altında yeni Server Action'lar eklenebilir, Zod validation ile (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/app/api/`, `src/actions/`

### 3.5 Styling
- **Tailwind utility class'ları kullanmak serbest** - Component'lerde Tailwind class'ları kullanılabilir, design token'lar (`--primary`, `--background`, vb.) kullanılmalı
- **Custom CSS utility eklemek serbest** - `src/app/globals.css` içinde `@layer utilities` altında yeni utility class'lar eklenebilir (kanıt: `src/app/globals.css` lines 134-144)

**Evidence:** `src/app/globals.css`, `tailwind.config.ts`

### 3.6 Features
- **Yeni feature eklemek serbest** - Yeni e-ticaret özellikleri eklenebilir (örn: yeni payment method, yeni filter option), mevcut pattern'lere uygun olmalı
- **Client-side state eklemek serbest** - `useState`, `useEffect` gibi React hook'ları Client Component'lerde kullanılabilir (kanıt: `src/components/catalog/load-more-grid.tsx`)

**Evidence:** `src/components/catalog/load-more-grid.tsx`

---

## 4. Forbidden Changes

### 4.1 Framework & Routing
- **Pages Router'a geçiş yasak** - `pages/` klasörü oluşturulmamalı, App Router dışına çıkılmamalı
- **Mevcut route path'lerini değiştirmek yasak** - `/urun/[slug]`, `/account/*`, `/checkout`, `/cart` gibi mevcut route'lar değiştirilemez
- **Route handler pattern'ini değiştirmek yasak** - `route.ts` pattern'i değiştirilemez, eski `pages/api/*` pattern'i kullanılamaz

**Evidence:** `src/app/` structure, `src/app/api/` structure

### 4.2 Rendering Model
- **Server/Client boundary'yi bozmak yasak** - Server Component'lerden function/Date/class instance prop geçirilemez, serializable olmayan veri geçirilemez
- **Gereksiz Client Component oluşturmak yasak** - Server Component yeterliyse Client Component oluşturulmamalı, `"use client"` sadece gerekli durumlarda
- **Provider'ları başka yere taşımak yasak** - `layout.tsx` dışında provider açılmamalı, provider hiyerarşisi değiştirilemez

**Evidence:** `src/app/layout.tsx`, `src/app/page.tsx`

### 4.3 Database & ORM
- **Prisma veya başka ORM eklemek yasak** - Drizzle ORM dışında ORM kullanılamaz
- **Direct SQL query yazmak yasak** - `pg` driver'ı direkt kullanılmamalı, Drizzle ORM üzerinden query yazılmalı (exception: migration script'leri)
- **Connection pool oluşturmak yasak** - `src/db/connection.ts` dışında yeni connection pool oluşturulmamalı

**Evidence:** `package.json`, `src/db/connection.ts`, `README.md`

### 4.4 Authentication
- **NextAuth.js v4 pattern'leri kullanmak yasak** - Eski v4 API'si kullanılamaz, sadece v5 (Auth.js) pattern'leri
- **Başka auth library eklemek yasak** - NextAuth.js dışında auth library kullanılamaz (örn: Clerk, Supabase Auth)

**Evidence:** `package.json`, `src/auth.ts`

### 4.5 Styling & Design System
- **Design token'ları değiştirmek yasak** - `src/app/globals.css` içindeki CSS custom properties (`--primary`, `--background`, vb.) değiştirilemez
- **shadcn/ui style'ı değiştirmek yasak** - `components.json` içindeki `style: "new-york"` değiştirilemez
- **Tailwind config'i köklü değiştirmek yasak** - `tailwind.config.ts` içindeki `content` path'leri ve `theme.extend` değiştirilemez (küçük extension'lar serbest)
- **CSS-in-JS library eklemek yasak** - styled-components, emotion gibi CSS-in-JS library'leri eklenemez, Tailwind CSS kullanılmalı

**Evidence:** `src/app/globals.css`, `components.json`, `tailwind.config.ts`, `package.json`

### 4.6 State Management
- **External state library eklemek yasak** - Redux, Zustand, Jotai, Recoil gibi state library'leri eklenemez, Context API kullanılmalı
- **Provider hiyerarşisini değiştirmek yasak** - `layout.tsx` içindeki provider sırası değiştirilemez

**Evidence:** `src/app/layout.tsx`, `package.json`

### 4.7 Forms & Validation
- **Zod dışında validation library kullanmak yasak** - Yup, Joi gibi validation library'leri kullanılamaz, Zod zorunlu
- **React Hook Form dışında form library kullanmak yasak** - Formik, React Final Form gibi form library'leri kullanılamaz

**Evidence:** `package.json`, `src/actions/checkout.ts`

### 4.8 API & Data Fetching
- **Offset-based pagination kullanmak yasak** - `/api/products` endpoint'i cursor-based pagination kullanır, offset pattern'i kullanılamaz
- **API contract'ı bozmak yasak** - Mevcut API endpoint'lerinin response format'ı değiştirilemez (geriye dönük uyumluluk)
- **Fetch wrapper oluşturmak yasak** - Native `fetch` API kullanılmalı, axios/got gibi HTTP client library'leri eklenemez (exception: 3rd party API entegrasyonları)

**Evidence:** `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`

### 4.9 Build & Environment
- **Archive klasörünü build'e dahil etmek yasak** - `archive/**` klasörü TypeScript ve ESLint tarafından ignore edilir, bu ignore kaldırılamaz
- **Timezone'i değiştirmek yasak** - `TZ=Europe/Istanbul` sabit, script'lerde değiştirilemez

**Evidence:** `tsconfig.json`, `eslint.config.mjs`, `package.json`

### 4.10 Toast & Feedback
- **Sonner dışında toast library kullanmak yasak** - react-hot-toast, react-toastify gibi toast library'leri kullanılamaz
- **Toast position'ı değiştirmek yasak** - `position="top-center"` sabit

**Evidence:** `package.json`, `src/app/layout.tsx`

---

## 5. App Router & Rendering Model

### 5.1 Server Components (Default)
- **Varsayılan rendering strategy** - Tüm `page.tsx`, `layout.tsx` dosyaları Server Component (kanıt: `src/app/page.tsx`, `src/app/layout.tsx`)
- **Direct database queries** - Server Component'lerde Drizzle ORM ile direkt veritabanı sorguları yapılabilir (kanıt: `src/app/page.tsx` lines 11-15)
- **Async component'ler** - Server Component'ler `async` olabilir, `await` kullanılabilir (kanıt: `src/app/page.tsx` line 7)

**Evidence:** `src/app/page.tsx`, `src/app/layout.tsx`

### 5.2 Client Components (Explicit)
- **"use client" direktifi zorunlu** - Client Component'ler `"use client"` ile işaretlenmeli (kanıt: `src/components/cart/cart-provider.tsx` line 1, `src/components/catalog/load-more-grid.tsx` line 1)
- **Kullanım alanları:**
  - State management (useState, useReducer)
  - Event handlers (onClick, onChange)
  - Browser API'leri (localStorage, window)
  - React Context Provider'lar
  - Framer Motion animasyonları
- **Provider'lar Client Component** - Theme, Cart, Favorites, Search provider'ları Client Component (kanıt: `src/components/theme/theme-provider.tsx`, `src/components/cart/cart-provider.tsx`)

**Evidence:** `src/components/cart/cart-provider.tsx`, `src/components/catalog/load-more-grid.tsx`, `src/components/theme/theme-provider.tsx`

### 5.3 Suspense & Loading States
- **Loading.tsx pattern** - Route segment'lerde `loading.tsx` dosyası ile loading state gösterilebilir (kanıt: `src/app/urun/[slug]/loading.tsx`, `src/app/[slug]/loading.tsx`)
- **Suspense boundaries** - `not-found.tsx` içinde Suspense kullanılabilir (kanıt: `src/app/not-found.tsx` lines 24-28)
- **Search page Suspense** - `src/app/search/page.tsx` içinde Suspense ile async component wrap edilmiş (kanıt: `src/app/search/page.tsx` lines 154-162)

**Evidence:** `src/app/urun/[slug]/loading.tsx`, `src/app/not-found.tsx`, `src/app/search/page.tsx`

### 5.4 Error Handling
- **not-found.tsx mevcut** - Root level `not-found.tsx` var (kanıt: `src/app/not-found.tsx`)
- **Error boundary yok** - Root level `error.tsx` yok (Unknown: error boundary pattern'i kullanılmıyor)
- **API route error handling** - Try-catch blokları ile error handling yapılıyor (kanıt: `src/app/api/search/route.ts` lines 98-106)

**Evidence:** `src/app/not-found.tsx`, `src/app/api/search/route.ts`

---

## 6. Data Layer & API Boundaries (Frontend Perspective)

### 6.1 Data Fetching Patterns
- **Server Components: Direct DB queries** - Server Component'lerde Drizzle ORM ile direkt veritabanı sorguları (kanıt: `src/app/page.tsx` lines 11-15)
- **Client Components: Fetch API** - Client Component'lerde `/api/*` route'larına fetch ile istek atılıyor (kanıt: `src/components/catalog/load-more-grid.tsx` lines 54-78)
- **Server Actions** - Form submit'ler ve mutation'lar `src/actions/` içinde Server Action olarak (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/app/page.tsx`, `src/components/catalog/load-more-grid.tsx`, `src/actions/checkout.ts`

### 6.2 API Routes
- **Route handler pattern** - `src/app/api/*/route.ts` pattern'i (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Dynamic routes** - `src/app/api/products/[slug]/route.ts` gibi dynamic segment'ler (kanıt: `src/app/api/products/[slug]/route.ts`)
- **Force-dynamic default** - API route'lar `export const dynamic = "force-dynamic"` kullanır (kanıt: `src/app/api/products/route.ts` line 9, `src/app/api/search/route.ts`)

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts`, `src/app/api/products/[slug]/route.ts`

### 6.3 Environment Variables
- **DATABASE_URL** - PostgreSQL connection string (kanıt: `src/db/connection.ts` line 10, `README.md` lines 73-75)
- **AUTH_SECRET** - NextAuth.js secret (kanıt: `src/auth.ts` line 17, `README.md` line 76)
- **AUTH_URL** - NextAuth.js base URL (production) (kanıt: `README.md` line 78)
- **WOO_BASE_URL, WOO_CONSUMER_KEY, WOO_CONSUMER_SECRET** - WooCommerce import script için (kanıt: `README.md` lines 80-82, `scripts/woo-import.ts`)
- **WOO_IMPORT_MODE, WOO_IMPORT_LIMIT** - Import mode ve limit (kanıt: `README.md` lines 144-156)
- **WOO_AUTH_MODE** - WooCommerce auth mode (basic/query) (kanıt: `README.md` line 168)
- **WOO_PRODUCT_STATUS** - Product status filter (default: publish) (kanıt: `README.md` line 164)

**Evidence:** `src/db/connection.ts`, `src/auth.ts`, `README.md`, `scripts/woo-import.ts`

### 6.4 Fetch Wrapper
- **Native fetch kullanılıyor** - Custom fetch wrapper yok, native `fetch` API kullanılıyor (kanıt: `src/components/catalog/load-more-grid.tsx` line 78)
- **Base URL yok** - Relative URL'ler kullanılıyor (`/api/products`), base URL env variable'ı yok

**Evidence:** `src/components/catalog/load-more-grid.tsx`

---

## 7. State, Forms, Validation

### 7.1 State Management
- **Context API zorunlu** - Redux, Zustand gibi external state library'leri yok (kanıt: `package.json` - state library yok, `src/components/cart/cart-provider.tsx`)
- **Provider'lar:**
  - `CartProvider` - Sepet state'i, localStorage persistence (kanıt: `src/components/cart/cart-provider.tsx`)
  - `FavoritesProvider` - Favoriler state'i (kanıt: `src/components/favorites/favorites-provider.tsx`)
  - `SearchProvider` - Arama state'i (kanıt: `src/components/search/search-provider.tsx`)
  - `AuthProvider` - Auth state wrapper (kanıt: `src/components/auth/auth-provider.tsx`)
  - `ThemeProvider` - Theme state (next-themes) (kanıt: `src/components/theme/theme-provider.tsx`)
  - `HeaderProvider` - Header state (kanıt: `src/components/layout/header-context.tsx`)

**Evidence:** `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`, `package.json`

### 7.2 Forms
- **React Hook Form zorunlu** - Form library olarak (kanıt: `package.json` react-hook-form@7.69.0, `src/components/auth/login-form.tsx`)
- **Form pattern:** Client Component'te form, Server Action'a submit (kanıt: `src/components/auth/login-form.tsx`, `src/actions/checkout.ts`)

**Evidence:** `package.json`, `src/components/auth/login-form.tsx`, `src/actions/checkout.ts`

### 7.3 Validation
- **Zod zorunlu** - Validation library olarak (kanıt: `package.json` zod@4.2.1, `src/actions/checkout.ts` lines 7-18)
- **Server Action validation** - Server Action'larda Zod schema ile validate ediliyor (kanıt: `src/actions/checkout.ts` lines 27-28, `src/actions/address.ts` lines 33-34)
- **@hookform/resolvers** - React Hook Form + Zod entegrasyonu (kanıt: `package.json` @hookform/resolvers@5.2.2)

**Evidence:** `package.json`, `src/actions/checkout.ts`, `src/actions/address.ts`

---

## 8. Styling & Design System Integration

### 8.1 Tailwind CSS
- **Tailwind CSS v4** - PostCSS plugin ile (kanıt: `package.json` tailwindcss@4, `postcss.config.mjs`)
- **Content paths** - `tailwind.config.ts` içinde `src/pages/**`, `src/components/**`, `src/app/**` (kanıt: `tailwind.config.ts` lines 4-8)
- **Theme extension** - Font family extension var (Geist Sans, Geist Mono) (kanıt: `tailwind.config.ts` lines 11-14)

**Evidence:** `package.json`, `tailwind.config.ts`, `postcss.config.mjs`

### 8.2 shadcn/ui
- **New York style** - `components.json` içinde `style: "new-york"` (kanıt: `components.json` line 3)
- **RSC enabled** - `rsc: true` (kanıt: `components.json` line 4)
- **CSS variables** - `cssVariables: true` (kanıt: `components.json` line 10)
- **Icon library: Lucide** - `iconLibrary: "lucide"` (kanıt: `components.json` line 13)
- **Path aliases** - `@/components`, `@/lib/utils`, `@/components/ui` (kanıt: `components.json` lines 15-19)

**Evidence:** `components.json`, `package.json` (lucide-react@0.562.0)

### 8.3 Design Tokens
- **CSS custom properties** - `src/app/globals.css` içinde `:root` ve `.dark` class'ları altında token'lar (kanıt: `src/app/globals.css` lines 12-79)
- **Primary color: #ff2357** - Sabit hex değer (kanıt: `src/app/globals.css` lines 20, 54)
- **OKLCH color space** - Çoğu renk OKLCH formatında (kanıt: `src/app/globals.css` lines 14-78)
- **Radius: 0.65rem** - Border radius token (kanıt: `src/app/globals.css` line 13)
- **@theme directive** - Tailwind v4 `@theme` directive ile token mapping (kanıt: `src/app/globals.css` lines 95-132)

**Evidence:** `src/app/globals.css`

### 8.4 Toast System
- **Sonner zorunlu** - Toast notification library (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
- **Position: top-center** - `position="top-center"` sabit (kanıt: `src/app/layout.tsx` line 82)
- **Rich colors** - `richColors` prop aktif (kanıt: `src/app/layout.tsx` line 82)

**Evidence:** `package.json`, `src/app/layout.tsx`

### 8.5 Animations
- **Framer Motion** - Animation library (kanıt: `package.json` framer-motion@12.23.26)
- **tw-animate-css** - Tailwind animation utilities (kanıt: `package.json` tw-animate-css@1.4.0, `src/app/globals.css` line 2)

**Evidence:** `package.json`, `src/app/globals.css`

---

## 9. Performance & Caching Rules

### 9.1 Rendering Strategy
- **Server Components default** - Performans için Server Component tercih ediliyor (kanıt: `src/app/page.tsx` Server Component)
- **Force-dynamic API routes** - API route'lar `export const dynamic = "force-dynamic"` kullanır, cache yok (kanıt: `src/app/api/products/route.ts` lines 9-10)

**Evidence:** `src/app/page.tsx`, `src/app/api/products/route.ts`

### 9.2 Caching
- **API route cache: no-store** - `/api/products` response header'ında `Cache-Control: no-store` (kanıt: `src/app/api/products/route.ts` line 148)
- **Revalidate: 0** - `/api/products` route'unda `export const revalidate = 0` (kanıt: `src/app/api/products/route.ts` line 10)
- **Image optimization** - Next.js Image component, `next.config.ts` içinde remotePatterns (kanıt: `next.config.ts` lines 6-22)

**Evidence:** `src/app/api/products/route.ts`, `next.config.ts`

### 9.3 Pagination
- **Cursor-based pagination** - Infinite scroll pattern, cursor ile pagination (kanıt: `src/app/api/products/route.ts` lines 37-44, `src/components/catalog/load-more-grid.tsx`)
- **Limit clamping** - API route'unda limit 1-50 arası clamp ediliyor (kanıt: `src/app/api/products/route.ts` lines 29-35)

**Evidence:** `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`

### 9.4 Code Splitting
- **Unknown** - Dynamic import pattern'i kullanılıyor mu bilinmiyor (codebase search sonuçsuz)

**Evidence:** Unknown

---

## 10. Error Handling & Observability

### 10.1 Error Boundaries
- **not-found.tsx mevcut** - Root level `not-found.tsx` var, Suspense ile wrap edilmiş (kanıt: `src/app/not-found.tsx`)
- **error.tsx yok** - Root level `error.tsx` yok, error boundary pattern'i kullanılmıyor

**Evidence:** `src/app/not-found.tsx`, codebase search (error.tsx bulunamadı)

### 10.2 API Error Handling
- **Try-catch pattern** - API route'larında try-catch blokları ile error handling (kanıt: `src/app/api/search/route.ts` lines 98-106, `src/app/api/auth/signup/route.ts` lines 51-57)
- **Error response format** - JSON error response, status code ile (kanıt: `src/app/api/products/[slug]/route.ts` lines 46, 52)

**Evidence:** `src/app/api/search/route.ts`, `src/app/api/auth/signup/route.ts`, `src/app/api/products/[slug]/route.ts`

### 10.3 Client Error Handling
- **Error state management** - Client Component'lerde `useState` ile error state yönetiliyor (kanıt: `src/components/catalog/load-more-grid.tsx` lines 44, 107, `src/components/auth/login-form.tsx` lines 13, 28)
- **AbortController** - Fetch request'lerinde AbortController ile cancel edilebiliyor (kanıt: `src/components/product/product-detail-page.tsx` lines 61, 76-120)

**Evidence:** `src/components/catalog/load-more-grid.tsx`, `src/components/auth/login-form.tsx`, `src/components/product/product-detail-page.tsx`

### 10.4 Logging & Monitoring
- **Console.error** - API route'larında `console.error` ile logging (kanıt: `src/app/api/search/route.ts` line 99, `src/app/api/auth/signup/route.ts` line 52)
- **Monitoring service yok** - Sentry, LogRocket gibi monitoring service'leri yok (Unknown: codebase search sonuçsuz)

**Evidence:** `src/app/api/search/route.ts`, `src/app/api/auth/signup/route.ts`, codebase search (monitoring service bulunamadı)

---

## 11. Security & Dependency Policy

### 11.1 Authentication
- **Argon2 password hashing** - Şifre hash'leme için Argon2id kullanılıyor (kanıt: `package.json` argon2@0.44.0, `src/app/api/auth/signup/route.ts` line 36)
- **NextAuth.js v5** - Auth.js v5 API'si, credentials provider (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)

**Evidence:** `package.json`, `src/auth.ts`, `src/app/api/auth/signup/route.ts`

### 11.2 Dependency Updates
- **Patch-level upgrade policy** - Assumption: Patch-level (x.x.PATCH) güncellemeler güvenlik yamaları için yapılmalı
- **Minor/Major upgrade SOP** - Assumption: Test edilmeli, breaking change kontrolü yapılmalı
- **Next.js version lock** - Next.js 16.1.1 kullanılıyor, major version upgrade dikkatli yapılmalı (kanıt: `package.json` next@16.1.1)

**Evidence:** `package.json`, Assumption

### 11.3 Environment Variables
- **Secret management** - `.env.local` ve `.env` dosyaları gitignore'da (assumption: `.gitignore` dosyası kontrol edilmedi)
- **AUTH_SECRET zorunlu** - Production için AUTH_SECRET gerekli (kanıt: `src/auth.ts` line 17)

**Evidence:** `src/auth.ts`, `src/db/connection.ts`, Assumption

### 11.4 Input Validation
- **Zod schema validation** - Server Action'larda ve API route'larında Zod ile input validation (kanıt: `src/actions/checkout.ts` lines 7-18, `src/actions/address.ts` lines 13-24)

**Evidence:** `src/actions/checkout.ts`, `src/actions/address.ts`

---

## 12. Repo Structure Conventions

### 12.1 Directory Structure
```
src/
├── app/                    # Next.js App Router routes
│   ├── [slug]/             # Dynamic routes
│   ├── api/                # API route handlers
│   └── ...                 # Other routes
├── components/             # React components
│   ├── ui/                 # shadcn/ui components
│   ├── cart/               # Cart-related components
│   ├── catalog/            # Product catalog components
│   └── ...                 # Other component categories
├── db/                     # Database layer
│   ├── connection.ts       # Drizzle DB instance
│   ├── queries/            # Query functions
│   └── schema.ts           # Drizzle schema
├── actions/                # Server Actions
├── lib/                    # Utility functions
├── hooks/                  # React hooks
├── types/                  # TypeScript types
└── config/                 # App configuration
```

**Evidence:** `src/` directory structure

### 12.2 Naming Conventions
- **Component files: PascalCase** - `ProductCard.tsx`, `CartProvider.tsx` (kanıt: `src/components/catalog/product-card.tsx`, `src/components/cart/cart-provider.tsx`)
- **Route files: lowercase** - `page.tsx`, `layout.tsx`, `loading.tsx`, `route.ts` (kanıt: `src/app/page.tsx`, `src/app/layout.tsx`)
- **Utility files: kebab-case veya camelCase** - `format.ts`, `utils.ts`, `cart-store.ts` (kanıt: `src/lib/format.ts`, `src/lib/utils.ts`, `src/components/cart/cart-store.ts`)

**Evidence:** `src/components/`, `src/app/`, `src/lib/`

### 12.3 Import Patterns
- **Path aliases** - `@/components`, `@/lib`, `@/hooks` (kanıt: `tsconfig.json` lines 22-24, `src/app/layout.tsx` imports)
- **Relative imports yok** - Path alias kullanılıyor, relative import (`../../`) kullanılmıyor (assumption: codebase'de relative import pattern'i görülmedi)

**Evidence:** `tsconfig.json`, `src/app/layout.tsx`, Assumption

### 12.4 Barrel Exports
- **Unknown** - Barrel export (`index.ts`) pattern'i kullanılıyor mu bilinmiyor (codebase search sonuçsuz)

**Evidence:** Unknown

---

## 13. Definition of Done (DoD)

### 13.1 Code Quality
- **Lint check** - `npm run lint` hatasız geçmeli (kanıt: `package.json` lint script)
- **TypeScript check** - `tsc --noEmit` hatasız geçmeli (assumption: TypeScript strict mode aktif)
- **Build success** - `npm run build` başarılı olmalı (kanıt: `package.json` build script)

**Evidence:** `package.json`, `tsconfig.json` (strict: true)

### 13.2 Functionality
- **Server Component pattern** - Yeni sayfalar Server Component olmalı (gerekliyse Client Component)
- **Error handling** - API route'lar ve Server Action'larda try-catch ile error handling
- **Validation** - Form submit'ler ve API input'ları Zod ile validate edilmeli

**Evidence:** `src/app/page.tsx`, `src/app/api/search/route.ts`, `src/actions/checkout.ts`

### 13.3 Styling
- **Design tokens kullanımı** - Tailwind class'ları design token'ları kullanmalı (`bg-primary`, `text-foreground`, vb.)
- **Responsive design** - Mobile-first yaklaşım, breakpoint'ler doğru kullanılmalı

**Evidence:** `src/app/globals.css`, Assumption (mobile-first pattern görüldü)

### 13.4 Testing
- **Unknown** - Test framework kurulu değil, test dosyası yok (kanıt: `package.json` - test dependency yok, codebase search - test file bulunamadı)

**Evidence:** `package.json`, codebase search

---

## 14. Open Risks / Gaps

### 14.1 Testing
- **Test framework yok** - Unit test, integration test, E2E test yok (kanıt: `package.json` - test dependency yok)
- **Test coverage yok** - Test coverage metriği yok

**Evidence:** `package.json`, codebase search

### 14.2 Error Handling
- **Global error boundary yok** - Root level `error.tsx` yok, error boundary pattern'i kullanılmıyor
- **Error logging standardize edilmemiş** - `console.error` kullanılıyor, structured logging yok

**Evidence:** `src/app/` (error.tsx bulunamadı), `src/app/api/search/route.ts`

### 14.3 Monitoring & Observability
- **Analytics yok** - Google Analytics, Plausible gibi analytics tool'ları yok (Unknown: codebase search sonuçsuz)
- **Performance monitoring yok** - Web Vitals tracking, performance monitoring service yok (Unknown)
- **Error tracking yok** - Sentry, LogRocket gibi error tracking service'leri yok (Unknown)

**Evidence:** Unknown (codebase search sonuçsuz)

### 14.4 Environment Configuration
- **Secret management belirsiz** - `.env*` dosyaları gitignore'da (assumption), production secret management stratejisi belirsiz
- **Environment variable dokümantasyonu eksik** - Tüm env variable'lar `README.md`'de dokümante edilmemiş (kanıt: `README.md` sadece bazı env variable'ları listeliyor)

**Evidence:** `README.md`, Assumption

### 14.5 Performance
- **Caching strategy belirsiz** - API route'lar force-dynamic, ISR/SSG pattern'i kullanılmıyor (kanıt: `src/app/api/products/route.ts` lines 9-10)
- **Image optimization** - Next.js Image component kullanılıyor, CDN kullanımı belirsiz (Unknown)

**Evidence:** `src/app/api/products/route.ts`, `next.config.ts`, Unknown

### 14.6 Documentation
- **API endpoint dokümantasyonu yok** - API endpoint'leri OpenAPI/Swagger ile dokümante edilmemiş
- **Component API dokümantasyonu yok** - Component prop'ları ve kullanım örnekleri dokümante edilmemiş

**Evidence:** Unknown (API/component docs bulunamadı)

---

## 15. Evidence Index

1. **package.json** - Dependencies, scripts, project name (`package.json`)
2. **next.config.ts** - Next.js config, image optimization, timezone (`next.config.ts`)
3. **tsconfig.json** - TypeScript config, paths, exclude (`tsconfig.json` line 34 - archive exclude)
4. **eslint.config.mjs** - ESLint config, archive ignore (`eslint.config.mjs` line 16)
5. **tailwind.config.ts** - Tailwind config, content paths (`tailwind.config.ts`)
6. **postcss.config.mjs** - PostCSS config, Tailwind v4 plugin (`postcss.config.mjs`)
7. **components.json** - shadcn/ui config, New York style (`components.json`)
8. **src/app/layout.tsx** - Root layout, provider hierarchy (`src/app/layout.tsx` lines 59-87)
9. **src/app/page.tsx** - Home page, Server Component pattern (`src/app/page.tsx`)
10. **src/app/globals.css** - Design tokens, CSS custom properties (`src/app/globals.css` lines 12-79)
11. **src/db/schema.ts** - Drizzle schema, table definitions (`src/db/schema.ts`)
12. **src/db/connection.ts** - DB connection, env loading (`src/db/connection.ts`)
13. **src/auth.ts** - NextAuth.js v5 config, credentials provider (`src/auth.ts`)
14. **src/components/cart/cart-provider.tsx** - Context API pattern, Client Component (`src/components/cart/cart-provider.tsx`)
15. **src/components/theme/theme-provider.tsx** - Theme provider, next-themes wrapper (`src/components/theme/theme-provider.tsx`)
16. **src/app/api/products/route.ts** - API route pattern, cursor pagination (`src/app/api/products/route.ts`)
17. **src/components/catalog/load-more-grid.tsx** - Client Component, fetch pattern (`src/components/catalog/load-more-grid.tsx`)
18. **src/actions/checkout.ts** - Server Action pattern, Zod validation (`src/actions/checkout.ts`)
19. **src/app/not-found.tsx** - Error handling, Suspense (`src/app/not-found.tsx`)
20. **src/app/urun/[slug]/loading.tsx** - Loading state pattern (`src/app/urun/[slug]/loading.tsx`)
21. **README.md** - Setup instructions, env variables (`README.md` lines 72-84, 185)
22. **src/components/auth/login-form.tsx** - Form pattern, React Hook Form (`src/components/auth/login-form.tsx`)
23. **src/app/api/search/route.ts** - API error handling (`src/app/api/search/route.ts` lines 98-106)
24. **src/components/product/product-detail-page.tsx** - AbortController pattern (`src/components/product/product-detail-page.tsx` lines 61, 76-120)

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni değişiklikler yapıldığında bu doküman güncellenmelidir.
---

# DOC-03: 03.routes-and-navigation-map.md

---
# 03. Routes and Navigation Map

Bu doküman, Cinselhobi.com Next projesinin route yapısını, navigasyon haritasını ve sayfa organizasyonunu tanımlar. Amaç: AI asistanların (Cursor/Cursor) route kırmasını, yanlış link vermesini ve flow kaçırmasını engellemek.

**Son Güncelleme:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1

---

## 1. Routing Overview

Next.js App Router kullanılıyor. Tüm route'lar `src/app/` altında tanımlı. `pages/` klasörü yok.

**Route Kategorileri:**
- **Public Routes:** Ana sayfa, ürünler, kategoriler, arama, içerik sayfaları, sepet
- **Protected Routes:** Hesap yönetimi (`/account/*`), Admin panel (`/admin/*`)
- **Conditional/Session-dependent Routes:** Checkout (`/checkout`), Sipariş başarı (`/order-success/[id]`) - sayfa seviyesinde auth kontrolü yok ama işlevsellik için session gerekli
- **API Routes:** `/api/*` altında route handler'lar

**Dynamic Routes:**
- `[slug]` - Kategori sayfaları için (`/[slug]/page.tsx`)
- `[slug]` - Ürün detay sayfaları için (`/urun/[slug]/page.tsx`)
- `[id]` - Sipariş detay sayfaları için (`/order-success/[id]/page.tsx`, `/account/orders/[id]/page.tsx`, `/admin/orders/[id]/page.tsx`)

**Route Groups:** Kullanılmıyor (kanıt: `src/app/` yapısında `(group)` pattern'i yok)

**Evidence:** `src/app/` directory structure, `package.json` (next@16.1.1)

---

## 2. Route Table (Pages)

| Route | File Path | Type | Dynamic? | Rendering | Data Source | Auth | Notes |
|-------|-----------|------|----------|-----------|-------------|------|-------|
| `/` | `src/app/page.tsx` | Page | - | Server Component | Direct DB (Drizzle: `getTopCategories`, `getLatestProductsCursor`) | Public | Ana sayfa, kategori grid + yeni ürünler (kanıt: lines 1, 11, 14) |
| `/[slug]` | `src/app/[slug]/page.tsx` | Page | `slug` (category) | Server Component | Direct DB (Drizzle: `getCategoryBySlug`, `getProductsCursor`, `db`, `categories`, `drizzle-orm`) | Public | Kategori sayfası, RESERVED_SLUGS kontrolü var (kanıt: lines 2-8, 13-15, 22-36, 47) |
| `/urun/[slug]` | `src/app/urun/[slug]/page.tsx` | Page | `slug` (product) | Server Component | Direct DB (Drizzle: `getProductBySlug`) | Public | Ürün detay sayfası, `generateMetadata` var, `notFound()` kullanıyor (kanıt: line 3) |
| `/search` | `src/app/search/page.tsx` | Page | - | Server Component | Direct DB (Drizzle: `db`, `products`, `categories`, `productCategories`, `drizzle-orm`) | Public | Arama sonuçları, `searchParams.q` kullanıyor, Suspense var (kanıt: lines 3-5, 17-36) |
| `/categories` | `src/app/categories/page.tsx` | Page | - | Unknown | Unknown | Public | Kategori listesi sayfası |
| `/cart` | `src/app/cart/page.tsx` | Page | - | Server Component | Unknown | Public | Sepet sayfası |
| `/checkout` | `src/app/checkout/page.tsx` | Page | - | Client Component | Server Action (`getAddressesAction`) | Conditional | Checkout sayfası, boş sepet kontrolü var, `getAddressesAction` auth gerektirir (kanıt: `src/actions/address.ts` lines 51-54), `router.push` kullanıyor |
| `/order-success/[id]` | `src/app/order-success/[id]/page.tsx` | Page | `id` (order) | Server Component | Direct DB (`getOrderById`) | Conditional | Sipariş başarı sayfası, `auth()` kontrolü var, session yoksa `/login` redirect (kanıt: lines 14-18) |
| `/login` | `src/app/login/page.tsx` | Page | - | Unknown | Unknown | Public | Giriş sayfası |
| `/signup` | `src/app/signup/page.tsx` | Page | - | Unknown | Unknown | Public | Kayıt sayfası |
| `/account` | `src/app/account/page.tsx` | Page | - | Unknown | Unknown | Protected | Hesap ana sayfası, layout'ta auth kontrolü var |
| `/account/orders` | `src/app/account/orders/page.tsx` | Page | - | Unknown | Unknown | Protected | Sipariş listesi |
| `/account/orders/[id]` | `src/app/account/orders/[id]/page.tsx` | Page | `id` (order) | Unknown | Unknown | Protected | Sipariş detay |
| `/account/wishlist` | `src/app/account/wishlist/page.tsx` | Page | - | Unknown | Unknown | Protected | Favoriler sayfası |
| `/account/coupons` | `src/app/account/coupons/page.tsx` | Page | - | Unknown | Unknown | Protected | Kuponlar sayfası |
| `/account/addresses` | `src/app/account/addresses/page.tsx` | Page | - | Unknown | Unknown | Protected | Adresler sayfası |
| `/account/settings` | `src/app/account/settings/page.tsx` | Page | - | Unknown | Unknown | Protected | Hesap ayarları |
| `/admin` | `src/app/admin/page.tsx` | Page | - | Unknown | Unknown | Protected (admin role) | Admin dashboard |
| `/admin/orders` | `src/app/admin/orders/page.tsx` | Page | - | Unknown | Unknown | Protected (admin role) | Admin sipariş listesi |
| `/admin/orders/[id]` | `src/app/admin/orders/[id]/page.tsx` | Page | `id` (order) | Unknown | Unknown | Protected (admin role) | Admin sipariş detay |
| `/about` | `src/app/about/page.tsx` | Page | - | Unknown | Unknown | Public | Hakkımızda |
| `/support` | `src/app/support/page.tsx` | Page | - | Unknown | Unknown | Public | Destek sayfası |
| `/gizlilik-ve-guvenlik` | `src/app/gizlilik-ve-guvenlik/page.tsx` | Page | - | Unknown | Unknown | Public | Gizlilik politikası |
| `/odeme-ve-teslimat` | `src/app/odeme-ve-teslimat/page.tsx` | Page | - | Unknown | Unknown | Public | Ödeme ve teslimat bilgileri |
| `/cayma-ve-iade-kosullari` | `src/app/cayma-ve-iade-kosullari/page.tsx` | Page | - | Unknown | Unknown | Public | Cayma ve iade koşulları |
| `/mesafeli-satis-sozlesmesi` | `src/app/mesafeli-satis-sozlesmesi/page.tsx` | Page | - | Unknown | Unknown | Public | Mesafeli satış sözleşmesi |
| `/styleguide` | `src/app/styleguide/page.tsx` | Page | - | Client Component | Static | Public | Style guide (dev-only route, production'da kapatılmalı/korunmalı riski var) |

**Evidence:** `src/app/` directory structure, `src/app/page.tsx` (lines 1, 11, 14: `getTopCategories`, `getLatestProductsCursor`), `src/app/[slug]/page.tsx` (lines 2-8, 13-15: `getCategoryBySlug`, `getProductsCursor`, `db`, `drizzle-orm`), `src/app/urun/[slug]/page.tsx` (line 3: `getProductBySlug`), `src/app/search/page.tsx` (lines 3-5, 17-36: `db`, `products`, `categories`, `drizzle-orm`), `src/app/checkout/page.tsx`, `src/app/order-success/[id]/page.tsx` (lines 14-18: auth kontrolü), `src/app/account/layout.tsx`, `src/app/admin/layout.tsx`

---

## 3. Route Table (API / Route Handlers)

| Endpoint | File Path | Methods | Dynamic? | Caching/Dynamic | Notes |
|----------|-----------|---------|----------|----------------|-------|
| `/api/products` | `src/app/api/products/route.ts` | GET | - | `dynamic = "force-dynamic"`, `revalidate = 0`, `Cache-Control: no-store` | Cursor-based pagination, filtreleme (categorySlug, sort, min, max, inStock, sub), limit 1-50 clamp |
| `/api/products/[slug]` | `src/app/api/products/[slug]/route.ts` | GET | `slug` (product) | `dynamic = "force-dynamic"` | Ürün detay API, 404 döner ürün yoksa |
| `/api/products/[slug]/related` | `src/app/api/products/[slug]/related/route.ts` | GET | `slug` (product) | `dynamic = "force-dynamic"` | İlgili ürünler API, 10 ürün döner |
| `/api/search` | `src/app/api/search/route.ts` | GET | - | Unknown | Arama API, `q` query param, limit max 20, try-catch error handling |
| `/api/auth/[...nextauth]` | `src/app/api/auth/[...nextauth]/route.ts` | GET, POST | `...nextauth` (catch-all) | `runtime = "nodejs"` | NextAuth.js v5 endpoints |
| `/api/auth/signup` | `src/app/api/auth/signup/route.ts` | POST | - | `runtime = "nodejs"` | Kullanıcı kayıt API, Argon2 hash, try-catch error handling |

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/products/[slug]/route.ts`, `src/app/api/products/[slug]/related/route.ts`, `src/app/api/search/route.ts`, `src/app/api/auth/[...nextauth]/route.ts`, `src/app/api/auth/signup/route.ts`

---

## 4. Layouts & Route Groups Map

### 4.1 Root Layout
- **File:** `src/app/layout.tsx`
- **Type:** Server Component (default)
- **Provider Hierarchy:** (sıra önemli)
  1. `ThemeProvider` (next-themes)
  2. `AuthProvider`
  3. `FavoritesProvider`
  4. `CartProvider`
  5. `HeaderProvider`
  6. `SearchProvider`
- **Components:** `Header`, `DesktopHeader`, `SearchOverlay`, `Footer` (xl+), `MobileBottomNav`, `Toaster` (Sonner)
- **Metadata:** `title: "Cinselhobi"`, `description: "Cinselhobi - Hobi ve El Sanatları"`

**Evidence:** `src/app/layout.tsx` (lines 59-87)

### 4.2 Account Layout
- **File:** `src/app/account/layout.tsx`
- **Type:** Server Component (async)
- **Auth Protection:** `auth()` kontrolü, session yoksa `/login?callbackUrl=/account` redirect
- **Components:** `AccountSidebar` (xl+), `AccountMobileNav` (xl-)
- **Structure:** Grid layout (xl: `[280px_1fr]`)

**Evidence:** `src/app/account/layout.tsx` (lines 11-12)

### 4.3 Admin Layout
- **File:** `src/app/admin/layout.tsx`
- **Type:** Server Component (async)
- **Auth Protection:** `auth()` kontrolü, session yoksa `/login?callbackUrl=/admin` redirect, `role !== "admin"` ise `/account` redirect
- **Components:** `AdminSidebar`
- **Structure:** Flex layout (sidebar + main)

**Evidence:** `src/app/admin/layout.tsx` (lines 7-11)

### 4.4 Route Groups
Route groups (`(group)`) kullanılmıyor. Tüm route'lar doğrudan `src/app/` altında.

**Evidence:** `src/app/` directory structure

---

## 5. Navigation Entry Points

### 5.1 Desktop Navigation
- **Component:** `src/components/layout/DesktopNavigation.tsx`
- **Type:** Client Component
- **Links:**
  - Kategoriler (mega menu dropdown): `/kadinlara-ozel`, `/erkeklere-ozel`, `/sex-oyuncaklari`, `/kozmetik`, `/geciktiriciler`, `/kayganlastirici-jeller`, `/anal-oyuncaklar`, `/realistik-mankenler` + alt kategoriler
  - Düz linkler: `/kadinlara-ozel`, `/erkeklere-ozel`, `/geciktiriciler`
- **Category Tree:** Hardcoded `categoryTree` array (lines 19-64)

**Evidence:** `src/components/layout/DesktopNavigation.tsx` (lines 19-64, 94, 118, 129, 146, 155, 164)

### 5.2 Footer Navigation
- **Component:** `src/components/app/Footer.tsx`
- **Type:** Client Component
- **Link Groups:**
  - **Kurumsal:** `/about`, `/support`, `/gizlilik-ve-guvenlik`, `/mesafeli-satis-sozlesmesi`
  - **Müşteri Hizmetleri:** `/support`, `/odeme-ve-teslimat`, `/cayma-ve-iade-kosullari`, `/sss` (route yok, link var)
  - **Kategoriler:** `/kadinlara-ozel`, `/erkeklere-ozel`, `/vibratorler`, `/kayganlastiricilar`, `/geciktiriciler`
- **Bottom Bar:** `/gizlilik-ve-guvenlik`, `/mesafeli-satis-sozlesmesi`, `/`

**Evidence:** `src/components/app/Footer.tsx` (lines 45-74, 322-341)

### 5.3 Mobile Bottom Navigation
- **Component:** `src/components/app/mobile-bottom-nav.tsx`
- **Type:** Client Component
- **Tabs:** (orderIndex sırasıyla)
  1. **home** (`/`) - Anasayfa
  2. **categories** (`/categories`) - Kategoriler (match: category route, `/urun/*`, `/search`, `/categories`)
  3. **cart** (null) - Sepet (drawer açılır, route push yok)
  4. **wishlist** (`/account/wishlist`) - Favoriler
  5. **profile** (`/account`) - Hesabım (match: `/account/*` except `/account/wishlist`)
- **Special:** `/urun/[slug]` sayfalarında bottom nav gizlenir (line 48)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (lines 48-50), `src/components/app/mobile-tabs.ts` (lines 39-82)

### 5.4 Account Sidebar Navigation
- **Component:** `src/components/account/AccountSidebar.tsx`
- **Type:** Client Component
- **Links:**
  - `/account/orders` - Siparişlerim
  - `/account/wishlist` - Favorilerim
  - `/account/coupons` - Kuponlarım
  - `/account/addresses` - Adreslerim
  - `/account/settings` - Hesap Ayarları

**Evidence:** `src/components/account/AccountSidebar.tsx` (lines 6-12)

### 5.5 Admin Sidebar Navigation
- **Component:** `src/components/admin/admin-sidebar.tsx`
- **Type:** Client Component
- **Links:**
  - `/admin` - Dashboard
  - `/admin/orders` - Siparişler
  - `/admin/products` - Ürünler (disabled)
  - `/` - Mağazaya Dön

**Evidence:** `src/components/admin/admin-sidebar.tsx` (lines 8-30)

### 5.6 Header Navigation
- **Component:** `src/components/layout/header.tsx`
- **Type:** Client Component
- **Features:** Search overlay trigger, cart icon, theme toggle, user menu
- **Reserved Slugs:** `RESERVED_SLUGS` array (lines 13-35) - bu slug'lar kategori route'u olarak işlenmez

**Evidence:** `src/components/layout/header.tsx` (lines 13-35)

---

## 6. Primary User Flows (Route-backed)

### 6.1 Home → Category → Product → Cart → Checkout → Success
**Route Flow:**
1. `/` - Ana sayfa (kategori grid + yeni ürünler)
2. `/[slug]` - Kategori sayfası (filtreleme, sıralama, pagination)
3. `/urun/[slug]` - Ürün detay sayfası
4. `/cart` - Sepet sayfası (veya mobile drawer)
5. `/checkout` - Checkout sayfası (adres seçimi, ödeme yöntemi)
6. `/order-success/[id]` - Sipariş başarı sayfası

**Critical UI States:**
- `/urun/[slug]`: `loading.tsx` var, `notFound()` kullanıyor
- `/[slug]`: `loading.tsx` var, `notFound()` kullanıyor
- `/checkout`: Boş sepet kontrolü var, `/cart` redirect
- `/cart`: Sepet boşsa gösterim (assumption)

**Evidence:** `src/app/page.tsx`, `src/app/[slug]/page.tsx`, `src/app/urun/[slug]/page.tsx`, `src/app/cart/page.tsx`, `src/app/checkout/page.tsx` (lines 100-111), `src/app/order-success/[id]/page.tsx`

### 6.2 Search Flow
**Route Flow:**
1. Header search trigger → Search overlay açılır
2. `/search?q=...` - Arama sonuçları sayfası

**Critical UI States:**
- `/search`: Suspense var, `searchParams.q` kontrolü var, boş query durumu handle ediliyor

**Evidence:** `src/app/search/page.tsx` (lines 142-166), `src/components/search/search-overlay.tsx`

### 6.3 Account Management Flow
**Route Flow:**
1. `/login` veya `/signup` - Giriş/Kayıt
2. `/account` - Hesap ana sayfası (auth redirect: `/login?callbackUrl=/account`)
3. `/account/orders` - Sipariş listesi
4. `/account/orders/[id]` - Sipariş detay
5. `/account/wishlist` - Favoriler
6. `/account/addresses` - Adresler
7. `/account/settings` - Ayarlar

**Critical UI States:**
- `/account/*`: Layout'ta auth kontrolü var, session yoksa redirect

**Evidence:** `src/app/account/layout.tsx` (lines 11-12), `src/app/login/page.tsx`, `src/app/signup/page.tsx`

### 6.4 Admin Flow
**Route Flow:**
1. `/admin` - Admin dashboard (auth + role kontrolü: `/login?callbackUrl=/admin`, role !== "admin" → `/account`)
2. `/admin/orders` - Sipariş listesi
3. `/admin/orders/[id]` - Sipariş detay

**Critical UI States:**
- `/admin/*`: Layout'ta auth + role kontrolü var

**Evidence:** `src/app/admin/layout.tsx` (lines 7-11)

---

## 7. Auth & Access Rules

### 7.1 Protected Routes
- **`/account/*`**: `src/app/account/layout.tsx` içinde `auth()` kontrolü, session yoksa `/login?callbackUrl=/account` redirect
- **`/admin/*`**: `src/app/admin/layout.tsx` içinde `auth()` kontrolü, session yoksa `/login?callbackUrl=/admin` redirect, `role !== "admin"` ise `/account` redirect

**Evidence:** `src/app/account/layout.tsx` (lines 11-12), `src/app/admin/layout.tsx` (lines 7-11)

### 7.2 Public Routes
- Tüm diğer route'lar public (kanıt: layout'larda auth kontrolü yok)

**Evidence:** `src/app/layout.tsx` (auth kontrolü yok)

### 7.3 Conditional/Session-dependent Routes
- **`/checkout`**: Sayfa seviyesinde auth kontrolü yok, ancak `getAddressesAction` Server Action'ı auth gerektirir. Session yoksa adresler yüklenemez ama sayfa render edilir.
- **`/order-success/[id]`**: Sayfa seviyesinde `auth()` kontrolü var, session yoksa `/login` redirect. Sipariş kullanıcıya ait değilse `/account` redirect.

**Evidence:** `src/app/checkout/page.tsx` (line 39: `getAddressesAction`), `src/actions/address.ts` (lines 51-54: auth kontrolü), `src/app/order-success/[id]/page.tsx` (lines 14-18, 21-25)

### 7.4 Login/Account Areas
- `/login` - Giriş sayfası
- `/signup` - Kayıt sayfası
- `/account/*` - Hesap yönetimi (protected)

**Evidence:** `src/app/login/page.tsx`, `src/app/signup/page.tsx`, `src/app/account/`

### 7.5 Redirect Behavior
- Checkout'ta sepet boşsa: `/cart` redirect (kanıt: `src/app/checkout/page.tsx` line 66)
- Account'a giriş yapmadan erişim: `/login?callbackUrl=/account` redirect
- Admin'e giriş yapmadan erişim: `/login?callbackUrl=/admin` redirect
- Admin'e admin olmayan kullanıcı erişimi: `/account` redirect

**Evidence:** `src/app/checkout/page.tsx` (line 66), `src/app/account/layout.tsx` (line 12), `src/app/admin/layout.tsx` (lines 8, 11)

---

## 8. Search Params & Dynamic Params

### 8.1 Dynamic Route Params

**`[slug]` (Category Route):**
- **Route:** `/[slug]/page.tsx`
- **Type:** `string`
- **Usage:** Kategori slug'ı, `getCategoryBySlug(slug)` ile kategori çekiliyor
- **Validation:** `RESERVED_SLUGS` kontrolü var, reserved ise `notFound()`, kategori yoksa `notFound()`
- **Rule:** Yeni top-level sayfa açılırsa slug `RESERVED_SLUGS` array'ine eklenmeli (kanıt: `src/app/[slug]/page.tsx` lines 22-36, `src/components/layout/header.tsx` lines 13-35, `src/components/app/mobile-tabs.ts` lines 2-17)

**Evidence:** `src/app/[slug]/page.tsx` (lines 22-36, 38-51), `src/components/layout/header.tsx` (lines 13-35), `src/components/app/mobile-tabs.ts` (lines 2-17)

**`[slug]` (Product Route):**
- **Route:** `/urun/[slug]/page.tsx`
- **Type:** `string`
- **Usage:** Ürün slug'ı, `getProductBySlug(slug)` ile ürün çekiliyor
- **Validation:** Ürün yoksa `notFound()`

**Evidence:** `src/app/urun/[slug]/page.tsx` (lines 72-79)

**`[id]` (Order Routes):**
- **Routes:** `/order-success/[id]/page.tsx`, `/account/orders/[id]/page.tsx`, `/admin/orders/[id]/page.tsx`
- **Type:** `string` (assumption)
- **Usage:** Sipariş ID'si

**Evidence:** `src/app/order-success/[id]/page.tsx`, `src/app/account/orders/[id]/page.tsx`, `src/app/admin/orders/[id]/page.tsx`

### 8.2 Search Params

**`/search?q=...`:**
- **Param:** `q` (string)
- **Usage:** Arama sorgusu, `searchParams.q` ile alınıyor
- **Validation:** Boş/trim edilmiş query kontrolü var

**Evidence:** `src/app/search/page.tsx` (lines 12, 143-144)

**`/[slug]?sort=...&min=...&max=...&inStock=...&sub=...`:**
- **Params:**
  - `sort`: `"newest" | "price_asc" | "price_desc" | "name_asc"` (default: "newest")
  - `min`: Fiyat minimum (TL, kuruşa çevriliyor)
  - `max`: Fiyat maksimum (TL, kuruşa çevriliyor)
  - `inStock`: `"1" | "true"` (boolean)
  - `sub`: Alt kategori wcId'leri (virgülle ayrılmış string)
  - `subCategoryIds`: Eski parametre (geriye dönük uyumluluk, internal ID'ler)
- **Usage:** Kategori sayfasında filtreleme ve sıralama

**Evidence:** `src/app/[slug]/page.tsx` (lines 19, 54-122)

**`/api/products?limit=...&cursor=...&categorySlug=...&sort=...&min=...&max=...&inStock=...&sub=...`:**
- **Params:**
  - `limit`: 1-50 arası (clamp ediliyor, default: `PRODUCTS_PER_PAGE`)
  - `cursor`: Cursor-based pagination cursor (number)
  - `categorySlug`: Kategori slug'ı
  - `sort`: `"newest" | "price_asc" | "price_desc" | "name_asc"` (default: "newest")
  - `min`: Fiyat minimum (TL, kuruşa çevriliyor)
  - `max`: Fiyat maksimum (TL, kuruşa çevriliyor)
  - `inStock`: `"1" | "true"` (boolean)
  - `sub`: Alt kategori wcId'leri (virgülle ayrılmış string)
  - `subCategoryIds`: Eski parametre (geriye dönük uyumluluk)
- **Usage:** API endpoint'inde filtreleme ve pagination

**Evidence:** `src/app/api/products/route.ts` (lines 16-103)

**`/api/search?q=...&limit=...`:**
- **Params:**
  - `q`: Arama sorgusu (required, boşsa boş array döner)
  - `limit`: Max 20 (default: 8)
- **Usage:** Arama API endpoint'i

**Evidence:** `src/app/api/search/route.ts` (lines 9-11, 22)

### 8.3 Param Contract
- **Category slug pattern:** Kebab-case, Türkçe karakterler destekleniyor (assumption: DB'de slug'lar var)
- **Product slug pattern:** Kebab-case, Türkçe karakterler destekleniyor (assumption: DB'de slug'lar var)
- **Order ID pattern:** Unknown (nanoid kullanılıyor mu? assumption: string)

**Evidence:** `src/app/[slug]/page.tsx`, `src/app/urun/[slug]/page.tsx`, `src/app/api/auth/signup/route.ts` (line 39: nanoid kullanılıyor)

---

## 9. Error/Loading/Not-Found Coverage

### 9.1 Loading States
- **`/[slug]/loading.tsx`** - Kategori sayfası için loading state
- **`/urun/[slug]/loading.tsx`** - Ürün detay sayfası için loading state
- **`/search`** - Suspense kullanılıyor (fallback: "Aranıyor...")

**Evidence:** `src/app/[slug]/loading.tsx`, `src/app/urun/[slug]/loading.tsx`, `src/app/search/page.tsx` (lines 154-162)

### 9.2 Error States
- **Root `error.tsx`:** Yok (kanıt: codebase search sonuçsuz)
- **Segment-level `error.tsx`:** Yok (kanıt: codebase search sonuçsuz)
- **API Error Handling:** Try-catch blokları kullanılıyor (`/api/search/route.ts`, `/api/auth/signup/route.ts`)

**Evidence:** Codebase search (error.tsx bulunamadı), `src/app/api/search/route.ts` (lines 98-106), `src/app/api/auth/signup/route.ts` (lines 51-57)

### 9.3 Not-Found States
- **Root `not-found.tsx`:** Var (`src/app/not-found.tsx`), Suspense ile wrap edilmiş
- **Segment-level `not-found.tsx`:** Yok (kanıt: codebase search sonuçsuz)
- **`notFound()` calls:**
  - `/[slug]/page.tsx`: Reserved slug veya kategori yoksa (lines 43-45, 49-51)
  - `/urun/[slug]/page.tsx`: Ürün yoksa (line 78)

**Evidence:** `src/app/not-found.tsx`, `src/app/[slug]/page.tsx` (lines 43-45, 49-51), `src/app/urun/[slug]/page.tsx` (line 78)

### 9.4 Gaps
- Root `error.tsx` yok (global error boundary yok)
- Segment-level `error.tsx` yok
- Segment-level `not-found.tsx` yok (sadece root var)
- **Broken Navigation Link:** Footer'da `/sss` linki var ama route yok (`src/components/app/Footer.tsx` line 61) - 404 riski

**Evidence:** Codebase search (error.tsx, segment-level not-found.tsx bulunamadı), `src/components/app/Footer.tsx` (line 61: `/sss` linki), `src/app/` (sss route yok)

---

## 10. SEO & Metadata Notes

### 10.1 Metadata Exports
- **Root Layout:** `metadata` export var (`title: "Cinselhobi"`, `description: "Cinselhobi - Hobi ve El Sanatları"`)
- **Product Detail:** `generateMetadata` export var (`/urun/[slug]/page.tsx`), dynamic metadata (title, description, openGraph images)

**Evidence:** `src/app/layout.tsx` (lines 32-35), `src/app/urun/[slug]/page.tsx` (lines 44-69)

### 10.2 SEO Features
- **Open Graph:** Product detail sayfasında `openGraph` metadata var
- **Canonical URLs:** Unknown (kanıt: codebase search sonuçsuz)
- **Robots:** Unknown (kanıt: `robots.txt` dosyası yok)
- **Sitemap:** Unknown (kanıt: `sitemap.xml` dosyası yok)

**Evidence:** `src/app/urun/[slug]/page.tsx` (lines 63-67), Codebase search (canonical, robots.txt, sitemap.xml bulunamadı)

---

## 11. Open Questions

1. `/categories` sayfası ne gösteriyor? (component içeriği unknown)
2. `/cart` sayfası rendering type nedir? (Client/Server Component unknown)
3. `/order-success/[id]` sayfası ne gösteriyor? (component içeriği unknown)
4. `/login` ve `/signup` sayfaları rendering type nedir? (Client/Server Component unknown)
5. Account sayfaları (`/account/*`) rendering type nedir? (Client/Server Component unknown)
6. Admin sayfaları (`/admin/*`) rendering type nedir? (Client/Server Component unknown)
7. İçerik sayfaları (`/about`, `/support`, vb.) rendering type nedir? (Client/Server Component unknown)
8. Canonical URL'ler kullanılıyor mu?
9. Robots.txt ve sitemap.xml var mı?
10. Middleware kullanılıyor mu? (kanıt: `middleware.ts` dosyası yok)

---

## 12. Evidence Index

1. **src/app/** - App Router directory structure (`src/app/`)
2. **src/app/page.tsx** - Ana sayfa, Server Component, direct DB queries: `getTopCategories`, `getLatestProductsCursor` (lines 1, 11, 14)
3. **src/app/[slug]/page.tsx** - Kategori sayfası, Server Component, RESERVED_SLUGS kontrolü, direct DB: `getCategoryBySlug`, `getProductsCursor`, `db`, `drizzle-orm` (lines 2-8, 13-15, 22-36, 38-51)
4. **src/app/urun/[slug]/page.tsx** - Ürün detay, Server Component, generateMetadata, notFound(), direct DB: `getProductBySlug` (lines 3, 44-69, 72-79)
5. **src/app/search/page.tsx** - Arama sayfası, Server Component, Suspense, searchParams.q, direct DB: `db`, `products`, `categories`, `drizzle-orm` (lines 3-5, 12, 17-36, 142-166)
6. **src/app/checkout/page.tsx** - Checkout, Client Component, router.push, boş sepet kontrolü, `getAddressesAction` (auth gerektirir) (lines 25, 39, 66, 84)
7. **src/app/order-success/[id]/page.tsx** - Sipariş başarı, Server Component, auth kontrolü, direct DB: `getOrderById` (lines 4-6, 14-18, 21-25)
8. **src/app/cart/page.tsx** - Sepet sayfası, Server Component (line 1-5)
9. **src/app/styleguide/page.tsx** - Styleguide, Client Component, dev-only route (line 1, 37)
10. **src/app/layout.tsx** - Root layout, provider hierarchy, metadata (lines 32-35, 59-87)
11. **src/app/account/layout.tsx** - Account layout, auth protection, redirect (lines 11-12)
12. **src/app/admin/layout.tsx** - Admin layout, auth + role protection, redirect (lines 7-11)
13. **src/app/not-found.tsx** - Root not-found, Suspense (lines 24-28)
14. **src/app/[slug]/loading.tsx** - Kategori loading state
15. **src/app/urun/[slug]/loading.tsx** - Ürün loading state
16. **src/actions/address.ts** - `getAddressesAction` auth kontrolü (lines 51-54)
13. **src/app/api/products/route.ts** - Products API, cursor pagination, filtreleme (lines 9-10, 16-103, 148)
14. **src/app/api/products/[slug]/route.ts** - Product detail API, dynamic route (lines 4, 39-73)
15. **src/app/api/products/[slug]/related/route.ts** - Related products API (lines 4, 39-67)
16. **src/app/api/search/route.ts** - Search API, query param, error handling (lines 8-11, 98-106)
17. **src/app/api/auth/[...nextauth]/route.ts** - NextAuth endpoints (lines 3, 5)
18. **src/app/api/auth/signup/route.ts** - Signup API, error handling (lines 8, 51-57)
19. **src/components/layout/DesktopNavigation.tsx** - Desktop nav, category tree, links (lines 19-64, 94, 118, 129, 146, 155, 164)
20. **src/components/app/Footer.tsx** - Footer nav, link groups (lines 45-74, 322-341)
21. **src/components/app/mobile-bottom-nav.tsx** - Mobile bottom nav, tabs, cart drawer (lines 48-50)
22. **src/components/app/mobile-tabs.ts** - Mobile tabs config, match functions (lines 39-82)
23. **src/components/account/AccountSidebar.tsx** - Account sidebar nav, menu items (lines 6-12)
24. **src/components/admin/admin-sidebar.tsx** - Admin sidebar nav, menu items (lines 8-30)
25. **src/components/layout/header.tsx** - Header, RESERVED_SLUGS array (lines 13-35)
26. **src/components/app/mobile-tabs.ts** - Mobile tabs, RESERVED_SLUGS array (lines 2-17)
27. **src/components/app/Footer.tsx** - Footer nav, broken link `/sss` (line 61)
28. **package.json** - Next.js version, dependencies (next@16.1.1)

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni route'lar eklendiğinde veya mevcut route'lar değiştirildiğinde bu doküman güncellenmelidir.
---

# DOC-04: 04.design-system.md

---
# 04.design-system.md

Bu doküman, Cinselhobi.com Next projesinin design system'ini, UI bileşenlerini, stil rehberini ve tasarım kararlarını tanımlar. Amaç: AI asistanların (Cursor/Cursor) tutarlı UI/UX tasarımı yapmasını sağlamak ve tasarım kararlarını merkezi bir yerde toplamak.

**Son Güncelleme:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

---

## 1. Design System Overview

Proje, shadcn/ui (New York style) tabanlı bir design system kullanıyor. Tailwind CSS v4 ile CSS variables (oklch formatında) üzerinden dark/light theme desteği sağlanıyor. Radix UI primitives ile erişilebilir bileşenler, class-variance-authority (cva) ile variant yönetimi, framer-motion ile animasyonlar kullanılıyor. Mobile-first yaklaşım benimsenmiş, native app hissi veren dokunsal etkileşimler ön planda.

**Evidence:** `package.json` (tailwindcss@4, class-variance-authority@0.7.1, framer-motion@12.23.26, @radix-ui/*, sonner@2.0.7), `src/app/globals.css` (CSS variables, oklch colors), `components.json` (shadcn/ui config)

---

## 2. Design Tokens

### 2.1 Colors

Renk sistemi CSS variables üzerinden yönetiliyor. OKLCH formatı kullanılıyor (lightness, chroma, hue). Primary renk: `#ff2357` (pembe/kırmızı ton). Dark ve light theme için ayrı değişkenler tanımlı.

**Light Theme Variables:**
- `--background`: `oklch(0.985 0 0)` (kırık beyaz)
- `--foreground`: `oklch(0.141 0.005 285.823)` (koyu gri)
- `--primary`: `#ff2357` (sabit hex)
- `--primary-foreground`: `oklch(0.985 0 0)` (beyaz yazı)
- `--secondary`: `oklch(0.967 0.001 286.375)` (açık gri)
- `--muted`: `oklch(0.967 0.001 286.375)`
- `--destructive`: `oklch(0.577 0.245 27.325)` (kırmızı)
- `--border`: `oklch(0.92 0.004 286.32)`
- `--ring`: `oklch(0.712 0.194 13.428)` (focus ring)

**Dark Theme Variables:**
- `--background`: `oklch(0.17 0.005 285.85)` (açık koyu)
- `--foreground`: `oklch(0.985 0 0)` (açık)
- `--primary`: `#ff2357` (aynı)
- `--destructive`: `oklch(0.704 0.191 22.216)` (daha açık kırmızı)
- `--border`: `oklch(1 0 0 / 10%)` (şeffaf beyaz)

**Semantic Mapping:**
- Primary: `#ff2357` (CTA butonlar, linkler, vurgular)
- Destructive: Error/silme işlemleri
- Muted: İkincil metin, disabled durumlar
- Secondary: İkincil butonlar, arka planlar
- Accent: Hover states, vurgular

**Background Softening Note:**
Background token değerleri native/eye comfort (göz yormayan) amacıyla yumuşatıldı. Light mode `--background` kırık beyaza (`oklch(0.985 0 0)`), dark mode `--background` daha açık tona (`oklch(0.17 0.005 285.85)`) çekildi. Card/surface token'larına dokunulmadı; yalnızca global background değişti.

**Evidence:** `src/app/globals.css` (lines 14, 48: `:root --background` ve `.dark --background`), `tailwind.config.ts` (theme extend yok, CSS variables kullanılıyor)

---

### 2.2 Typography

Geist font ailesi (Google Fonts) kullanılıyor. Next.js `next/font/google` ile optimize edilmiş yükleme. Sans-serif için Geist, monospace için Geist Mono.

**Font Families:**
- `--font-geist-sans`: Geist (sans-serif, varsayılan)
- `--font-geist-mono`: Geist Mono (kod, monospace)

**Font Loading:**
- `display: "swap"` ile performans optimizasyonu
- CSS variable'lar üzerinden erişim: `var(--font-geist-sans)`

**Base Typography:**
- Body: `font-sans` (Geist), default text size (Tailwind base)
- Headings: Font weight ve size Tailwind utilities ile (`text-lg`, `font-semibold`, etc.)
- Monospace: `font-mono` (Geist Mono)

**Evidence:** `src/app/layout.tsx` (lines 20-30, Geist import), `src/app/globals.css` (lines 7-9, font variables), `tailwind.config.ts` (lines 11-14, fontFamily extend)

---

### 2.3 Spacing

Tailwind CSS default spacing scale kullanılıyor (0.25rem increment: 0, 0.25, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 72, 80, 96). Custom spacing tanımı yok.

**Common Patterns:**
- Container padding: `px-4 sm:px-5 md:px-6 lg:px-8 2xl:px-12`
- Component gaps: `gap-2`, `gap-3`, `gap-4`
- Section spacing: `py-4`, `py-6`, `py-8`

**Evidence:** `src/components/app/page-transition.tsx` (line 72, container padding), `src/components/layout/DesktopHeader.tsx` (line 13, container padding), `tailwind.config.ts` (spacing extend yok)

---

### 2.4 Border Radius

Base radius: `--radius: 0.65rem` (10.4px). Türetilmiş değerler:
- `--radius-lg`: `var(--radius)` (0.65rem)
- `--radius-md`: `calc(var(--radius) - 2px)` (8.4px)
- `--radius-sm`: `calc(var(--radius) - 4px)` (6.4px)

**Usage Patterns:**
- Buttons: `rounded-md` (default), `rounded-xl` (theme toggle), `rounded-2xl` (mobile actions)
- Cards: `rounded-xl`
- Inputs: `rounded-md`
- Drawer: `rounded-t-2xl` (top corners)

**Evidence:** `src/app/globals.css` (lines 13, 127-129, radius variables), `src/components/ui/button.tsx` (line 7, rounded-md), `src/components/ui/theme-toggle.tsx` (line 25, rounded-xl), `src/components/ui/drawer.tsx` (line 36, rounded-t-2xl)

---

### 2.5 Shadows

Tailwind CSS default shadow scale kullanılıyor. Custom shadow tanımı yok. En yaygın kullanımlar:
- `shadow-sm`: Küçük elevation (cards, buttons)
- `shadow-lg`: Dialog, modal overlay
- `shadow-[custom]`: Custom shadow (örn: `shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]`)

**Evidence:** `src/components/ui/dialog.tsx` (line 42, shadow-lg), `src/components/product/product-view.tsx` (line 268, custom shadow), `tailwind.config.ts` (shadow extend yok)

---

### 2.6 Breakpoints

Tailwind CSS default breakpoints kullanılıyor:
- `sm`: 640px
- `md`: 768px
- `lg`: 1024px
- `xl`: 1280px (desktop/mobile ayrımı için kritik)
- `2xl`: 1536px

**Mobile/Desktop Pattern:**
- Mobile: `< xl` (1280px altı)
- Desktop: `xl:` ve üzeri
- Mobile bottom nav: `xl:hidden`
- Desktop header: `hidden xl:flex`

**Evidence:** `tailwind.config.ts` (breakpoints extend yok, default), `src/components/app/mobile-bottom-nav.tsx` (line 84, xl:hidden), `src/components/layout/DesktopHeader.tsx` (line 12, hidden xl:flex), `src/app/layout.tsx` (line 77, hidden xl:block)

---

## 3. UI Components

### 3.1 Base Components

shadcn/ui tabanlı bileşenler `src/components/ui/` altında. Radix UI primitives + CVA (class-variance-authority) ile variant yönetimi.

#### Button (`src/components/ui/button.tsx`)

**Variants (CVA):**
- `default`: `bg-primary text-primary-foreground hover:bg-primary/90`
- `destructive`: `bg-destructive text-destructive-foreground`
- `outline`: `border border-input bg-background hover:bg-accent`
- `secondary`: `bg-secondary text-secondary-foreground`
- `ghost`: `hover:bg-accent hover:text-accent-foreground`
- `link`: `text-primary underline-offset-4 hover:underline`

**Sizes:**
- `default`: `h-10 px-4 py-2`
- `sm`: `h-9 rounded-md px-3`
- `lg`: `h-11 rounded-md px-8`
- `icon`: `h-10 w-10`

**States:**
- Default: Normal görünüm
- Hover: `hover:bg-primary/90` (opacity değişimi)
- Active: `active:scale-95` (pressable prop ile)
- Disabled: `disabled:pointer-events-none disabled:opacity-50`
- Focus: `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`

**A11y:**
- Keyboard navigation: Native button element
- Focus ring: `focus-visible:ring-2 focus-visible:ring-ring`
- ARIA: `aria-label` prop desteği

**Do/Don't:**
- ✅ `asChild` prop ile Radix Slot kullan (composition)
- ✅ `pressable` prop ile dokunsal feedback ekle
- ❌ Link görünümü için `variant="link"` kullan, `<a>` tag'i kullanma
- ❌ Disabled state'te `pointer-events-none` zaten var, ekstra wrapper gerekmez

**Evidence:** `src/components/ui/button.tsx` (lines 6-64)

#### Input (`src/components/ui/input.tsx`)

**Base Styles:**
- `h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm`
- `focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`
- `disabled:cursor-not-allowed disabled:opacity-50`
- `placeholder:text-muted-foreground`

**States:**
- Default: Border, background, padding
- Focus: Ring 2px, ring-offset
- Disabled: Cursor not-allowed, opacity 50%
- Placeholder: Muted foreground color

**A11y:**
- Native input element (forwardRef)
- Focus ring: `focus-visible:ring-2`
- Placeholder: Semantic color

**Do/Don't:**
- ✅ `forwardRef` kullan (form library entegrasyonu için)
- ✅ `type` prop'u geç (email, password, etc.)
- ❌ Custom wrapper div ekleme, direkt Input kullan
- ❌ Inline styles kullanma, className ile extend et

**Evidence:** `src/components/ui/input.tsx` (lines 4-25)

#### Badge (`src/components/ui/badge.tsx`)

**Variants (CVA):**
- `default`: `bg-primary text-primary-foreground`
- `secondary`: `bg-secondary text-secondary-foreground`
- `destructive`: `bg-destructive text-destructive-foreground`
- `outline`: `text-foreground` (border only)
- `success`: `bg-green-500/15 text-green-700 dark:text-green-400 border-green-500/20` *(Geçici istisna: Status colors şu an Tailwind palette ile, ileride tokenlaştırılacak)*
- `warning`: `bg-yellow-500/15 text-yellow-700 dark:text-yellow-400 border-yellow-500/20` *(Geçici istisna: Status colors şu an Tailwind palette ile, ileride tokenlaştırılacak)*
- `info`: `bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-500/20` *(Geçici istisna: Status colors şu an Tailwind palette ile, ileride tokenlaştırılacak)*
- `dot`: `h-2 w-2 rounded-full p-0` (notification dot)

**Base:**
- `inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold`
- `focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`

**Usage:**
- Cart count: `variant="default"` (primary background)
- Notification dot: `variant="dot"`
- Status indicators: `success`, `warning`, `info`

**Evidence:** `src/components/ui/badge.tsx` (lines 4-41), `src/components/app/mobile-bottom-nav.tsx` (lines 123-128, cart badge)

#### Dialog (`src/components/ui/dialog.tsx`)

**Base:** Radix UI Dialog primitive. Overlay: `bg-black/80`, fade animasyon. Content: `max-w-lg`, center, zoom + slide animasyon.

**Components:**
- `Dialog`: Root (controlled state)
- `DialogTrigger`: Açma butonu
- `DialogContent`: Ana içerik (overlay + content)
- `DialogHeader`: Başlık alanı
- `DialogTitle`: Başlık (ARIA required)
- `DialogDescription`: Açıklama (ARIA required)
- `DialogFooter`: Alt buton alanı
- `DialogClose`: Kapatma butonu (X icon)

**Animations:**
- Overlay: `fade-in-0` / `fade-out-0`
- Content: `zoom-in-95` / `zoom-out-95` + `slide-in-from-left-1/2`

**A11y:**
- Radix UI accessibility built-in
- `DialogTitle` ve `DialogDescription` zorunlu (ARIA)
- Focus trap, escape key, outside click

**Evidence:** `src/components/ui/dialog.tsx` (lines 1-127)

#### Drawer (`src/components/ui/drawer.tsx`)

**Base:** Vaul library (mobile drawer). Bottom-up slide animasyon. `max-h-[85dvh]`, rounded top corners.

**Components:**
- `Drawer`: Root
- `DrawerTrigger`: Açma butonu
- `DrawerContent`: Ana içerik (overlay + content)
- `DrawerHeader`: Başlık alanı
- `DrawerTitle`: Başlık (ARIA)
- `DrawerDescription`: Açıklama (ARIA)
- `DrawerFooter`: Alt alan

**Pattern:**
- Mobile cart: Drawer kullanılıyor
- Handle bar: `mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted`
- Backdrop blur: `bg-background/95 supports-[backdrop-filter]:bg-background/80 backdrop-blur-xl`

**Evidence:** `src/components/ui/drawer.tsx` (lines 1-108), `src/components/app/mobile-bottom-nav.tsx` (lines 82-238, cart drawer)

#### Accordion (`src/components/ui/accordion.tsx`)

**Base:** Radix UI Accordion. ChevronDown icon ile expand/collapse. Animasyon: `animate-accordion-up` / `animate-accordion-down`.

**Components:**
- `Accordion`: Root (type: "single" | "multiple")
- `AccordionItem`: Item wrapper
- `AccordionTrigger`: Tıklanabilir başlık
- `AccordionContent`: İçerik (collapsible)

**Evidence:** `src/components/ui/accordion.tsx` (lines 1-56)

#### Avatar (`src/components/ui/avatar.tsx`)

**Components:**
- `Avatar`: Container (`rounded-full`, `h-10 w-10`)
- `AvatarImage`: `<img>` (aspect-square)
- `AvatarFallback`: Fallback (initials, `bg-muted`)

**Usage:**
- Profile picture: Mobile bottom nav
- User initials: Fallback text

**Evidence:** `src/components/ui/avatar.tsx` (lines 1-54), `src/components/app/mobile-bottom-nav.tsx` (lines 179-192, profile avatar)

#### Skeleton (`src/components/ui/skeleton.tsx`)

**Base:** `animate-pulse rounded-md bg-muted`. Loading state placeholder.

**Evidence:** `src/components/ui/skeleton.tsx` (lines 1-16)

**Evidence:** `src/components/ui/` directory, `package.json` (@radix-ui/*, class-variance-authority, tailwind-merge)

---

### 3.2 Layout Components

#### Header (`src/components/layout/header.tsx`)

Mobile header. Sticky top, `h-14`, border-bottom. Sol: Back button (ChevronLeft) veya boş. Orta: Title veya brand link ("CİNSELHOBİ"). Sağ: Search, cart, menu actions. Scroll state'e göre görünüm değişir.

**States:**
- Home: Back button yok
- Scrolled: Shadow, border değişimi
- Category page: Catalog controls gösterilir

**Evidence:** `src/components/layout/header.tsx` (lines 1-238)

#### DesktopHeader (`src/components/layout/DesktopHeader.tsx`)

Desktop header. `h-16`, border-bottom. Sol: Brand link. Orta: DesktopNavigation (kategori menüsü). Sağ: Search input, user, favorites, cart, theme toggle.

**Evidence:** `src/components/layout/DesktopHeader.tsx` (lines 1-65)

#### MobileBottomNav (`src/components/app/mobile-bottom-nav.tsx`)

Fixed bottom navigation. `xl:hidden` (sadece mobile). 5 tab: Home, Categories, Cart (drawer), Wishlist, Profile. Active state: Dot indicator üstte. Cart: Badge ile count gösterimi. Profile: Avatar veya icon. Drawer pattern ile cart açılır.

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (lines 1-241)

#### Footer (`src/components/app/Footer.tsx`)

Desktop footer. `hidden xl:block`. Legal links, copyright.

**Evidence:** `src/app/layout.tsx` (line 78, Footer import)

**Evidence:** `src/components/layout/` directory, `src/components/app/Footer.tsx`, `src/app/layout.tsx` (lines 71-80)

---

### 3.3 Feature Components

#### ProductCard (`src/components/product/product-card.tsx`)

Ürün kartı. Aspect ratio `4/5`, rounded-xl. Image: Hover'da gallery rotation (1s interval). Press-preview: Mobilde 150ms long-press ile 2. resim gösterimi. Quick add: Sağ alt köşe, Plus icon. Favorite: Sağ üst, FavoriteButton. Title: ALL CAPS ise lowercase + capitalize. Price: Bold, formatPrice.

**Interactions:**
- Desktop hover: Gallery rotation
- Mobile press: Preview (150ms delay)
- Quick add: Sepete ekleme (onQuickAdd callback veya default addItem)

**Evidence:** `src/components/product/product-card.tsx` (lines 1-272)

#### CartView (`src/components/cart/cart-view.tsx`)

Sepet görünümü. Drawer variant (mobile) veya page variant. Item list, quantity controls, remove, subtotal.

**Evidence:** `src/components/cart/cart-view.tsx` (usage in mobile-bottom-nav.tsx line 235)

#### SearchOverlay (`src/components/search/search-overlay.tsx`)

Arama overlay. Full-screen, keyboard shortcut (Cmd/Ctrl+K), real-time search results.

**Evidence:** `src/components/search/search-overlay.tsx` (usage in layout.tsx line 73)

**Evidence:** `src/components/product/` directory, `src/components/cart/` directory, `src/components/search/` directory

---

## 4. Design Patterns

### 4.1 Navigation Patterns

**Mobile Navigation:**
- Fixed bottom nav (`xl:hidden`): 5 tab, active dot indicator, cart drawer
- Sticky top header: Back button, title, actions
- Tab scroll preservation: `tab-scroll.ts` ile scroll position kaydedilir

**Desktop Navigation:**
- Fixed top header (`hidden xl:flex`): Brand, category menu, search, actions
- Horizontal menu: DesktopNavigation component

**Pattern Rules:**
- Mobile: Bottom nav + top header
- Desktop: Top header only
- Cart: Mobile'de drawer, desktop'ta page
- Active state: Visual indicator (dot, color change)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (lines 38-241), `src/components/layout/header.tsx` (lines 46-238), `src/components/layout/DesktopHeader.tsx` (lines 10-65), `src/components/app/tab-scroll.ts` (scroll preservation)

---

### 4.2 Product Display Patterns

**Product Card:**
- Grid layout: Responsive columns (mobile: 2, tablet: 3, desktop: 4-5)
- Aspect ratio: 4/5 (portrait)
- Image gallery: Hover rotation (desktop), press preview (mobile)
- Quick actions: Favorite (sağ üst), Quick add (sağ alt)
- Title normalization: ALL CAPS → lowercase + capitalize

**Product Detail Page:**
- Sticky action bar: Bottom fixed, price + "Sepete Ekle" button
- Image gallery: Horizontal scroll, thumbnails
- Description: Expandable (read more/less)
- Related products: Grid below

**Grid Patterns:**
- Cursor-based pagination: Infinite scroll, "Load More" button
- Filtering: Price range, stock status, subcategories
- Sorting: Newest, price asc/desc, name asc

**Evidence:** `src/components/product/product-card.tsx` (lines 17-272), `src/components/product/product-view.tsx` (lines 50-321), `src/components/catalog/load-more-grid.tsx` (pagination)

---

### 4.3 Form Patterns

**Input Pattern:**
- Base: Input component (`src/components/ui/input.tsx`)
- Validation: react-hook-form + Zod (Server Actions'da)
- Error display: Unknown (form component'lerde görülmedi)

**Form Components:**
- Address form: `src/components/account/address-form.tsx`
- Login/Signup: `src/components/auth/login-form.tsx`, `signup-form.tsx`

**Evidence:** `src/components/ui/input.tsx`, `src/components/account/address-form.tsx`, `package.json` (react-hook-form@7.69.0, @hookform/resolvers@5.2.2, zod@4.2.1)

---

### 4.4 Feedback Patterns

**Toast Notifications:**
- Library: Sonner (`sonner@2.0.7`)
- Mount: `src/app/layout.tsx` line 82: `<Toaster position="top-center" richColors />`
- Usage: `toast.success("Ürün sepete eklendi")` (product-view.tsx line 81)

**Sepete Ekleme Pattern:**
1. Button click → `addItem()` çağrılır
2. Local state: `setIsAdded(true)` (button text: "Eklendi ✓", green background)
3. Toast: `toast.success("Ürün sepete eklendi")`
4. Timeout: 2s sonra state reset (`setIsAdded(false)`)

**Loading States:**
- Skeleton component: `src/components/ui/skeleton.tsx`
- Button loading: Unknown (loading prop görülmedi)

**Error States:**
- Unknown (error handling pattern görülmedi)

**Empty States:**
- Unknown (empty state component görülmedi)

**Evidence:** `src/app/layout.tsx` (line 82, Toaster), `src/components/product/product-view.tsx` (lines 62-83, add to cart + toast), `package.json` (sonner@2.0.7), `src/components/ui/skeleton.tsx`

---

## 5. Theme System

**Library:** next-themes (`next-themes@0.4.6`)

**Provider:** `src/components/theme/theme-provider.tsx`
- Wrapper: NextThemesProvider
- Config: `attribute="class"`, `defaultTheme="system"`, `enableSystem`, `disableTransitionOnChange`

**Toggle:** `src/components/theme/theme-toggle.tsx`
- Button: `h-11 w-11`, rounded-xl, border
- Icon: Emoji (🌙 dark, 🌞 light)
- State: `resolvedTheme` (dark/light)
- A11y: `aria-label="Toggle theme"`

**CSS Variables:**
- Light theme: `:root` (globals.css lines 12-45)
- Dark theme: `.dark` (globals.css lines 47-79)
- Transition: `disableTransitionOnChange` ile anlık geçiş (göz yormayı engeller)

**Theme Colors:**
- Primary: `#ff2357` (her iki theme'de aynı)
- Background/Foreground: Ters (light: beyaz/koyu, dark: koyu/açık)
- Border: Light'da solid, dark'ta şeffaf (`oklch(1 0 0 / 10%)`)

**Evidence:** `src/components/theme/theme-provider.tsx` (lines 1-11), `src/components/theme/theme-toggle.tsx` (lines 1-34), `src/app/globals.css` (lines 12-79, theme variables), `src/app/layout.tsx` (lines 59-64, ThemeProvider config), `package.json` (next-themes@0.4.6)

---

## 6. Mobile-First Design

**Breakpoint Strategy:**
- Mobile: `< xl` (1280px altı)
- Desktop: `xl:` ve üzeri
- Pattern: `xl:hidden` (mobile only), `hidden xl:flex` (desktop only)

**Touch Interactions:**
- Press preview: ProductCard'ta 150ms long-press ile 2. resim gösterimi
- Active scale: `active:scale-[0.98]` veya `active:scale-95` (button feedback)
- Touch callout disable: `[-webkit-touch-callout:none]` (image area)
- Safe area: `env(safe-area-inset-bottom)` (notch support)

**Mobile Patterns:**
- Bottom navigation: Fixed, 5 tab, drawer pattern (cart)
- Sticky header: Back button, title, actions
- Full-screen overlays: Search, cart drawer
- Page transitions: Horizontal slide (framer-motion)

**Responsive Container:**
- Max width: `max-w-screen-2xl`
- Padding: `px-4 sm:px-5 md:px-6 lg:px-8 2xl:px-12`

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (xl:hidden), `src/components/product/product-card.tsx` (lines 121-170, press preview), `src/components/app/page-transition.tsx` (line 72, container padding), `tailwind.config.ts` (breakpoints)

---

## 7. Animation & Transitions

**Library:** framer-motion (`framer-motion@12.23.26`)

**Page Transitions:**
- Component: `src/components/app/page-transition.tsx`
- Pattern: Horizontal slide (left/right based on tab index)
- Animation: Spring (`stiffness: 300, damping: 35, bounce: 0`)
- Reduced motion: `useReducedMotion()` hook ile disable
- Frozen router: Exit animasyonu sırasında state freeze (FrozenRouter)

**Component Animations:**
- Accordion: `animate-accordion-up` / `animate-accordion-down` (tw-animate-css)
- Dialog: Fade + zoom + slide (Radix UI data attributes)
- Drawer: Bottom-up slide (Vaul)
- Button press: `active:scale-95` (transform)

**Animation Utilities:**
- `tw-animate-css`: `package.json` (tw-animate-css@1.4.0)
- Import: `src/app/globals.css` line 2: `@import "tw-animate-css";`

**Evidence:** `src/components/app/page-transition.tsx` (lines 1-162, framer-motion), `package.json` (framer-motion@12.23.26, tw-animate-css@1.4.0), `src/app/globals.css` (line 2, tw-animate-css import), `src/components/ui/accordion.tsx` (line 46, animate-accordion)

---

## 8. Accessibility Guidelines

**ARIA Usage:**
- Dialog/Drawer: `DialogTitle`, `DialogDescription` zorunlu (Radix UI)
- Navigation: `aria-label`, `aria-current="page"` (active tab)
- Buttons: `aria-label` (icon-only buttons)
- Theme toggle: `aria-label="Toggle theme"`

**Keyboard Navigation:**
- Focus ring: `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2` (tüm interactive elements)
- Tab order: Native HTML semantics
- Escape key: Dialog/Drawer kapatma (Radix UI built-in)

**Screen Reader:**
- Radix UI: Built-in accessibility (Dialog, Accordion, etc.)
- Visually hidden: `@radix-ui/react-visually-hidden` (package.json line 23)
- Semantic HTML: Native elements (button, input, etc.)

**Touch Targets:**
- Minimum size: `h-10` (40px) veya `min-h-11` (44px)
- Spacing: Adequate gap between interactive elements

**Evidence:** `src/components/ui/dialog.tsx` (DialogTitle, DialogDescription), `src/components/app/mobile-bottom-nav.tsx` (aria-label, aria-current), `src/components/theme/theme-toggle.tsx` (aria-label), `package.json` (@radix-ui/react-visually-hidden), `src/components/ui/button.tsx` (focus-visible:ring)

---

## 9. Design System Constraints

### 9.1 Non-Negotiables

**Color System:**
- **Core UI colors** (background/foreground/border/ring/primary/secondary/accent/muted vb.) **CSS variables / design tokens** üzerinden yönetilmelidir.
  - Component içinde rastgele `#hex`, `rgb(...)` veya keyfi Tailwind palette class'ları ile core UI rengi verilmemelidir.
- **Brand Primary** mevcut token değerine bağlıdır (örn. `--primary: #ff2357`). Bu değer değişecekse **karar kaydı** ile yapılmalıdır.
- **Exception (Status Colors):** `success / warning / info` gibi **durum renkleri** şu an bazı komponentlerde (örn. Badge variants) **Tailwind palette** ile uygulanıyor olabilir (örn. `bg-green-500/15`).
  - Bu kullanım **izinli geçici istisnadır** ve ileride tokenlaştırılacaktır. (Not olarak "Future Considerations" bölümüne eklenmiştir.)
- Dark/Light theme her iki modda da desteklenmeli

**Component Library:**
- shadcn/ui pattern korunmalı (Radix UI + CVA + Tailwind)
- Yeni UI component'ler `src/components/ui/` altında olmalı
- Variant yönetimi CVA ile yapılmalı

**Theme System:**
- next-themes kullanılmalı, başka theme library kullanılamaz
- `attribute="class"` pattern korunmalı (`.dark` class)
- Theme toggle sadece `src/components/theme/theme-toggle.tsx` kullanılmalı

**Mobile/Desktop Pattern:**
- Mobile: Bottom nav + top header (`xl:hidden` / `hidden xl:flex`)
- Desktop: Top header only
- Breakpoint: `xl` (1280px) mobile/desktop ayrımı

**Evidence:** `src/app/globals.css` (primary #ff2357), `src/components/ui/button.tsx` (CVA pattern), `src/components/theme/theme-provider.tsx` (next-themes), `src/components/app/mobile-bottom-nav.tsx` (xl:hidden)

---

### 9.2 Best Practices

**Component Composition:**
- `asChild` pattern kullan (Radix Slot ile composition)
- `forwardRef` kullan (form library entegrasyonu için)
- `cn()` utility kullan (tailwind-merge ile class birleştirme)

**State Management:**
- Context API: Cart, Favorites, Search, Auth, Theme
- Provider'lar sadece `src/app/layout.tsx` içinde

**Performance:**
- Image optimization: Next.js Image component
- Font optimization: `next/font/google` (display: swap)
- Code splitting: Next.js App Router automatic

**Touch Interactions:**
- Active scale: `active:scale-[0.98]` veya `active:scale-95`
- Press feedback: Visual state change (örn: "Eklendi ✓")
- Safe area: `env(safe-area-inset-*)` kullan

**Evidence:** `src/components/ui/button.tsx` (asChild, forwardRef), `src/lib/utils.ts` (cn function), `src/app/layout.tsx` (providers), `src/components/product/product-card.tsx` (Image component, active:scale)

---

## 10. Component Usage Examples

**Button with Icon:**
```tsx
import { Button } from "@/components/ui/button";
import { Icons } from "@/components/ui/icons";

<Button variant="ghost" size="icon" aria-label="Sepet">
  <Icons.cart className="h-5 w-5" />
</Button>
```

**Product Card:**
```tsx
import { ProductCard } from "@/components/product/product-card";

<ProductCard
  productId={1}
  slug="urun-slug"
  title="Ürün Adı"
  price={10000} // kuruş
  images={["/image.jpg"]}
  isNew={true}
  isFavorite={false}
/>
```

**Toast Notification:**
```tsx
import { toast } from "sonner";

toast.success("Ürün sepete eklendi");
```

**Dialog:**
```tsx
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";

<Dialog open={open} onOpenChange={setOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Başlık</DialogTitle>
    </DialogHeader>
    {/* Content */}
  </DialogContent>
</Dialog>
```

**Evidence:** `src/components/layout/DesktopHeader.tsx` (Button usage), `src/components/product/product-card.tsx` (ProductCard export), `src/components/product/product-view.tsx` (toast.success), `src/components/ui/dialog.tsx` (Dialog components)

---

## 11. Future Considerations

**Color System:**
- Primary renk kontrast kontrolü: `primary` + `primary-foreground` kontrast ratio kontrolü (WCAG AA/AAA)
- Semantic color expansion: Success, warning, info renkleri için daha tutarlı palette

**Component Library:**
- Form components: Textarea, Select, Checkbox, Radio, Switch (şu an sadece Input var)
- Loading states: Button loading spinner pattern
- Error states: Form validation error display pattern
- Empty states: Empty state component (ürün yok, sepet boş, etc.)

**Accessibility:**
- Skip links: Ana içeriğe atlama linki
- Focus management: Modal açıldığında focus trap
- Screen reader announcements: Dynamic content değişikliklerinde live region

**Animation:**
- Micro-interactions: Hover, click feedback iyileştirmeleri
- Skeleton loading: Daha detaylı skeleton patterns

**Mobile:**
- Pull-to-refresh: Liste sayfalarında
- Swipe gestures: Ürün kartlarında swipe actions

**Color System:**
- TODO: Status colors (success/warning/info) for badges/alerts should be tokenized (e.g., `--success`, `--warning`, `--info`) and mapped consistently across components.

**Evidence:** `src/components/ui/input.tsx` (sadece Input var, diğer form components yok), `src/components/product/product-view.tsx` (loading state yok), `src/app/globals.css` (primary kontrast kontrolü yok), `src/components/ui/badge.tsx` (status colors Tailwind palette ile)

---

## Evidence Index

1. `package.json` - Dependencies (tailwindcss@4, class-variance-authority, framer-motion, sonner, next-themes, @radix-ui/*)
2. `tailwind.config.ts` - Theme config (fontFamily extend, breakpoints default)
3. `src/app/globals.css` - CSS variables (oklch colors, radius, theme variables)
4. `src/app/layout.tsx` - Root layout (ThemeProvider, Toaster, font loading)
5. `src/components/ui/button.tsx` - Button component (CVA variants, sizes, states)
6. `src/components/ui/input.tsx` - Input component (base styles, focus ring)
7. `src/components/ui/badge.tsx` - Badge component (variants including success/warning/info)
8. `src/components/ui/dialog.tsx` - Dialog component (Radix UI, animations)
9. `src/components/ui/drawer.tsx` - Drawer component (Vaul, mobile pattern)
10. `src/components/ui/accordion.tsx` - Accordion component (Radix UI)
11. `src/components/ui/avatar.tsx` - Avatar component (image + fallback)
12. `src/components/ui/skeleton.tsx` - Skeleton component (loading state)
13. `src/components/theme/theme-provider.tsx` - Theme provider (next-themes)
14. `src/components/theme/theme-toggle.tsx` - Theme toggle button
15. `src/components/layout/header.tsx` - Mobile header
16. `src/components/layout/DesktopHeader.tsx` - Desktop header
17. `src/components/app/mobile-bottom-nav.tsx` - Mobile bottom navigation
18. `src/components/app/page-transition.tsx` - Page transition animations (framer-motion)
19. `src/components/product/product-card.tsx` - Product card component
20. `src/components/product/product-view.tsx` - Product detail view (toast usage)
21. `src/components/cart/cart-provider.tsx` - Cart context (addItem function)
22. `src/components/cart/add-to-cart-bar.tsx` - Add to cart bar component
23. `src/lib/utils.ts` - Utility functions (cn helper)
---

# DOC-05: 05.native-ux-rules.md

---
# 05. Native UX Rules

Bu doküman, Cinselhobi.com Next projesinin "native app hissi" veren UX kurallarını, dokunsal etkileşim standartlarını ve kullanıcı geri bildirimi pattern'lerini tanımlar. Amaç: AI asistanların (Cursor/Cursor) tutarlı, native-feel UX tasarımı yapmasını sağlamak ve UI/UX çizgisini korumak.

**Last verified from package.json:** 2025-12-31  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

1. **Native App Hissi:** Web uygulaması native mobile app gibi davranmalı - dokunsal feedback, smooth transitions, instant feedback
2. **AI Asistan Rehberi:** Cursor/Cursor'un "fazla tasarım uydurmasını" engellemek, mevcut UX pattern'lerini korumak
3. **Tutarlılık:** Kritik aksiyonlarda (sepete ekleme, checkout, vb.) standart feedback pattern'leri
4. **Mobile-First:** Tek elle kullanım, thumb-zone optimizasyonu, safe area desteği
5. **Accessibility:** Klavye navigasyonu, screen reader desteği, reduced motion uyumu

**Evidence:** `src/components/product/product-view.tsx` (toast + button state), `src/components/app/mobile-bottom-nav.tsx` (thumb-zone), `src/components/app/page-transition.tsx` (reduced motion)

---

## 2. Native UX Principles (Hard Rules)

### 2.1 Critical CTA Visibility
- **Sticky Action Bars:** Ürün detay sayfalarında (`/urun/[slug]`) kritik CTA (Sepete Ekle) her zaman görünür olmalı - `fixed bottom-0` pattern (kanıt: `src/components/product/product-view.tsx` lines 268-308, `src/components/product/product-detail-page.tsx` lines 361-393)
- **Safe Area Support:** iOS home indicator alanına uyum zorunlu - `pb-[max(1rem,env(safe-area-inset-bottom))]` veya `pb-[env(safe-area-inset-bottom)]` (kanıt: `src/components/product/product-view.tsx` line 268, `src/components/app/mobile-bottom-nav.tsx` line 84)

**Evidence:** `src/components/product/product-view.tsx` (lines 268-308, sticky bar), `src/components/product/product-detail-page.tsx` (lines 361-393), `src/components/app/mobile-bottom-nav.tsx` (line 84, safe area)

### 2.2 Touch Target Sizes
- **Minimum Size:** Yeni/yenilenen interactive elementler minimum `h-11` (44px) veya `min-h-11` (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 103, 164, `src/components/ui/button.tsx` line 24)
- **Button Heights:** Kritik butonlar `h-12` (48px) - Sepete Ekle, Checkout (kanıt: `src/components/product/product-view.tsx` line 288, `src/app/checkout/page.tsx` line 298)
- **Icon Buttons:** `h-11 w-11` (44x44px) standard (kanıt: `src/components/theme/theme-toggle.tsx` line 25, `src/components/layout/header.tsx` lines 186, 226)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (min-h-11), `src/components/product/product-view.tsx` (h-12), `src/components/ui/button.tsx` (h-11 default), `src/components/theme/theme-toggle.tsx` (h-11 w-11)

### 2.3 Single-Hand Usage (Thumb Zone)
- **Bottom Navigation:** Mobile bottom nav fixed bottom, 5 tab (Home, Categories, Cart, Wishlist, Profile) - tek elle erişilebilir (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 84-225)
- **Sticky Actions:** Kritik aksiyonlar ekranın altında, thumb-zone içinde (kanıt: `src/components/product/product-view.tsx` line 268)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (fixed bottom, 5 tabs), `src/components/product/product-view.tsx` (sticky bottom)

### 2.4 Visual Hierarchy
- **One Primary CTA:** Her ekranda sadece 1 ana CTA (örn: Ürün detayda "Sepete Ekle", Checkout'ta "Siparişi Tamamla")
- **Secondary Actions:** Favori butonu, theme toggle gibi ikincil aksiyonlar daha küçük, daha az vurgulu (kanıt: `src/components/product/product-view.tsx` lines 277-283, FavoriteButton secondary)

**Evidence:** `src/components/product/product-view.tsx` (primary: Sepete Ekle, secondary: FavoriteButton), `src/app/checkout/page.tsx` (primary: Siparişi Tamamla)

---

## 3. Interaction & Feedback Rules

### 3.1 Critical Action Feedback Pattern
**Sepete Ekleme Pattern (Hard Rule):**
1. Button click → `addItem()` çağrılır
2. **Local state:** `setIsAdded(true)` - button text: "Eklendi ✓" veya "Eklendi", success state uses status-success styling (currently green palette, e.g. `bg-green-600`)
3. **Toast:** `toast.success("Ürün sepete eklendi")` - kısa, eylem odaklı mesaj
4. **Timeout:** 2s sonra state reset (`setIsAdded(false)`) - button normal haline döner

**Implementation:**
- Product View: `setIsAdded(true)` + `toast.success()` + `setTimeout(() => setIsAdded(false), 2000)` (kanıt: `src/components/product/product-view.tsx` lines 79-83)
- AddToCartBar: `setAdded(true)` + `setTimeout(() => setAdded(false), 400)` - daha kısa timeout (kanıt: `src/components/cart/add-to-cart-bar.tsx` lines 36-37)

**Evidence:** `src/components/product/product-view.tsx` (lines 62-83, add to cart pattern), `src/components/cart/add-to-cart-bar.tsx` (lines 24-38), `src/app/layout.tsx` (line 82, Toaster mount)

### 3.2 Toast Usage Rules
- **Library:** Sonner (`sonner@2.0.7`) zorunlu, başka toast library kullanılamaz (kanıt: `package.json`, `src/app/layout.tsx` line 82)
- **Position:** `position="top-center"` sabit, değiştirilemez (kanıt: `src/app/layout.tsx` line 82)
- **Rich Colors:** `richColors` prop aktif (kanıt: `src/app/layout.tsx` line 82)
- **Kullanım Kuralı:** Sadece kritik aksiyonlarda toast (sepete ekleme, sipariş oluşturma), her tıkta toast yok

**Evidence:** `src/app/layout.tsx` (line 82, Toaster config), `src/components/product/product-view.tsx` (line 81, toast.success), `package.json` (sonner@2.0.7)

### 3.3 Button State Feedback
- **Active Scale:** Tüm butonlarda `active:scale-[0.98]` veya `active:scale-95` - dokunsal feedback (kanıt: `src/components/product/product-view.tsx` line 288, `src/components/ui/button.tsx` line 7)
- **Loading State:** Checkout gibi kritik form submit'lerde `isLoading` state + "İşleniyor..." text (kanıt: `src/app/checkout/page.tsx` lines 31, 300)
- **Disabled State:** `disabled:opacity-50` veya `disabled:opacity-60` (kanıt: `src/components/cart/add-to-cart-bar.tsx` line 46, `src/app/checkout/page.tsx` line 297)

**Evidence:** `src/components/product/product-view.tsx` (active:scale-[0.98]), `src/app/checkout/page.tsx` (isLoading + "İşleniyor..."), `src/components/cart/add-to-cart-bar.tsx` (disabled:opacity-60)

### 3.4 Error Feedback
- **Form Errors:** Inline error display - `setError()` + error div (kanıt: `src/app/checkout/page.tsx` lines 32, 117-121)
- **Validation Errors:** Server Action'dan dönen Zod validation errors inline gösterilir (kanıt: `src/app/checkout/page.tsx` lines 86-88)
- **Critical Errors:** Toast + inline açıklama kombinasyonu (assumption: kritik hatalar için, kanıt yok)

**Evidence:** `src/app/checkout/page.tsx` (lines 32, 117-121, error display), `src/actions/checkout.ts` (Zod validation)

### 3.5 Voice Search Feedback
- **No-Speech Handling:** Kullanıcı mikrofona konuşmazsa (timeout), konsola kırmızı hata basmak yerine nazik bir Toast mesajı gösterilir ("Ses algılanamadı, lütfen tekrar deneyin.").
- **Permission Feedback:** Mikrofon izni verilmezse veya HTTPS hatası varsa Toast ile açıklayıcı uyarı verilir.
- **Implementation:** `recognition.onerror` içinde `event.error === 'no-speech'` kontrolü ile yapılır.
- **Evidence:** `src/hooks/use-voice-search.ts` (lines 120-130)

### 3.6 Favorites Sync & Auth Gate (LOCKED)
- **Single Source of Truth:** UI'da hiçbir favori ikonu `toggleFavoriteAction` gibi server action'ı **doğrudan** çağırmaz. Tüm toggling yalnızca `FavoritesProvider.toggle(productId)` üzerinden yapılır.
- **Optimistic UX:** Favori toggle anında UI güncellenir (optimistic). Hata olursa rollback + toast/hata mesajı gösterilir.
- **Cross-page Consistency:** Favoriye ekleme/çıkarma işlemi sonrası `/account/wishlist` listesi refresh gerektirmeden doğru görünmelidir.
  - Server invalidation: `revalidatePath("/account/wishlist")` (+ gerektiğinde `revalidatePath("/account", "layout")`).
  - Client listesi server'dan initial render alıyorsa, state değişimi sonrası `router.refresh()` ile server snapshot güncellenebilir.
- **Guest Gate:** Misafir kullanıcı favoriye basarsa auth'a yönlendirilir (login/signup entrypoint'leri dead-end olmayacak).
- **Forbidden Pattern:** "Wishlist sayfası hydrate olduktan sonra Provider `isFavorite()` ile filtreliyorsa" Provider state'in güncel kalması şarttır; aksi takdirde "refresh ile düzeliyor" sınıfı bug'lar oluşur.

**LOCK RULE:** Client UI layer `@/actions/favorites` import edemez; yalnızca `FavoritesProvider` server action çağırır.

**Evidence:**
- `src/components/favorites/favorite-button.tsx` (UI tek kapı)
- `src/components/favorites/favorites-provider.tsx` (toggle + optimistic + state)
- `src/actions/favorites.ts` (`revalidatePath` stratejisi)
- `src/app/account/wishlist/page.tsx` (`dynamic = "force-dynamic"`)
- `src/components/favorites/wishlist-client.tsx` (hydrate/filter mantığı varsa)

---

## 4. Mobile-First Patterns

### 4.1 Mobile Bottom Navigation Rules
- **Visibility:** `xl:hidden` - sadece mobile'da görünür (kanıt: `src/components/app/mobile-bottom-nav.tsx` line 84)
- **Hidden on Product Detail:** `/urun/[slug]` sayfalarında bottom nav gizlenir - bilinçli istisna (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 47-50)
- **5 Tabs:** Home, Categories, Cart (drawer), Wishlist, Profile - `orderIndex` sırasıyla (kanıt: `src/components/app/mobile-tabs.ts`, `src/components/app/mobile-bottom-nav.tsx` lines 71-79)
- **Cart Drawer Pattern:** Cart tab'ı tıklandığında drawer açılır, route push yok (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 93-138)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (lines 47-50, 84, 93-138), `src/components/app/mobile-tabs.ts` (tab config)

### 4.2 Bottom Sheet / Drawer Usage
- **Cart Drawer:** Mobile'da sepet drawer pattern ile açılır (Vaul library) (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 82, 227-237)
- **Address Form Drawer:** Checkout'ta adres ekleme drawer ile (kanıt: `src/app/checkout/page.tsx` line 306, `src/components/account/address-form.tsx` line 89)
- **Pattern:** Bottom-up slide animasyon, `rounded-t-2xl` top corners, backdrop blur (kanıt: `src/components/ui/drawer.tsx`, `src/components/app/mobile-bottom-nav.tsx` line 227)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (cart drawer), `src/components/ui/drawer.tsx` (drawer component), `src/components/account/address-form.tsx` (address form drawer)

### 4.3 Touch Interactions
- **Press Preview:** ProductCard'ta 150ms long-press ile 2. resim gösterimi (kanıt: `src/components/product/product-card.tsx` lines 121-170, `PRESS_PREVIEW_DELAY_MS = 150`)
- **Active Scale:** `active:scale-[0.98]` veya `active:scale-95` - dokunsal feedback (kanıt: `src/components/product/product-card.tsx` line 202, `src/components/product/product-view.tsx` line 288)
- **Touch Callout Disable:** Image area'da `[-webkit-touch-callout:none]` (kanıt: `src/components/product/product-card.tsx` line 209)

**Evidence:** `src/components/product/product-card.tsx` (lines 12-15, 121-170, press preview), `src/components/product/product-view.tsx` (active:scale)

---

## 5. Navigation & Scroll Behavior

### 5.1 Scroll Restoration
- **Tab Scroll Preservation:** Mobile tab'lar arası geçişte scroll pozisyonu korunur - `tab-scroll.ts` ile sessionStorage (kanıt: `src/components/app/tab-scroll.ts`, `src/components/app/page-transition.tsx` lines 46-63)
- **Scroll Intent:** Tab navigasyon intent'i kaydedilir, scroll restore paint'ten önce uygulanır (kanıt: `src/components/app/page-transition.tsx` lines 46-63, `useLayoutEffect`)

**Evidence:** `src/components/app/tab-scroll.ts` (scroll save/read functions), `src/components/app/page-transition.tsx` (lines 46-63, scroll restore), `src/components/app/mobile-bottom-nav.tsx` (lines 149-161, scroll save on click)

### 5.2 Link Navigation
- **Scroll Disable:** Tab navigation'da `scroll={false}` - Next.js Link default scroll davranışı devre dışı (kanıt: `src/components/app/mobile-bottom-nav.tsx` line 148)
- **Prefetch:** Unknown (Next.js Link default prefetch davranışı)

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (line 148, scroll={false})

### 5.3 Page Transitions
- **Horizontal Slide:** Tab'lar arası geçişte horizontal slide animasyon (framer-motion) (kanıt: `src/components/app/page-transition.tsx` lines 115-125)
- **Direction:** Tab index'e göre sağdan/soldan geliş (kanıt: `src/components/app/page-transition.tsx` lines 98-109)
- **Reduced Motion:** `useReducedMotion()` hook ile animasyon disable (kanıt: `src/components/app/page-transition.tsx` lines 85, 112)

**Evidence:** `src/components/app/page-transition.tsx` (lines 82-160, page transition logic), `package.json` (framer-motion@12.23.26)

---

## 6. Forms & Checkout UX

### 6.1 Form Validation Pattern
- **Validation Library:** React Hook Form + Zod zorunlu (kanıt: `package.json` react-hook-form@7.69.0, zod@4.2.1, `src/app/checkout/page.tsx`)
- **Validation Timing:** Server Action'da Zod validation - submit sonrası (kanıt: `src/actions/checkout.ts` lines 7-18, 28)
- **Error Display:** Inline error - `setError()` + error div (kanıt: `src/app/checkout/page.tsx` lines 32, 117-121)

**Evidence:** `src/app/checkout/page.tsx` (form validation), `src/actions/checkout.ts` (Zod schema), `src/components/account/address-form.tsx` (React Hook Form)

### 6.2 Input Patterns
- **Input Type:** Standard Input component (`src/components/ui/input.tsx`) (kanıt: `src/components/ui/input.tsx`)
- **Autocomplete:** Unknown (autocomplete attribute kullanımı görülmedi)
- **Focus Ring:** `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2` (kanıt: `src/components/ui/input.tsx` line 6)

**Evidence:** `src/components/ui/input.tsx` (input component), `src/app/checkout/page.tsx` (form inputs)

### 6.3 Checkout Flow UX
- **Empty Cart Handling:** Sepet boşsa `/cart` redirect (kanıt: `src/app/checkout/page.tsx` lines 100-111, 64-67)
- **Loading State:** Submit sırasında `isLoading` + "İşleniyor..." text, button disabled (kanıt: `src/app/checkout/page.tsx` lines 31, 297, 300)
- **Error Recovery:** Validation error'lar inline gösterilir, kullanıcı düzeltebilir (kanıt: `src/app/checkout/page.tsx` lines 86-88, 117-121)
- **Success Redirect:** Sipariş başarılı → `/order-success/[id]` redirect (kanıt: `src/app/checkout/page.tsx` lines 82-84)

**Evidence:** `src/app/checkout/page.tsx` (checkout flow), `src/actions/checkout.ts` (order creation)

---

## 7. Loading / Empty / Error States

### 7.1 Loading States
- **Skeleton Component:** `src/components/ui/skeleton.tsx` - `animate-pulse rounded-md bg-muted` (kanıt: `src/components/ui/skeleton.tsx`)
- **Loading.tsx Pattern:** Route segment'lerde `loading.tsx` dosyası (kanıt: `src/app/[slug]/loading.tsx`, `src/app/urun/[slug]/loading.tsx`)
- **Suspense Fallback:** Search sayfasında Suspense + "Aranıyor..." fallback (kanıt: `src/app/search/page.tsx` lines 154-162)
- **Button Loading:** Checkout'ta `isLoading` state + "İşleniyor..." text (kanıt: `src/app/checkout/page.tsx` line 300)

**Evidence:** `src/components/ui/skeleton.tsx` (skeleton component), `src/app/[slug]/loading.tsx` (category loading), `src/app/urun/[slug]/loading.tsx` (product loading), `src/app/search/page.tsx` (Suspense), `src/app/checkout/page.tsx` (button loading)

### 7.2 Empty States
- **Empty Cart:** Checkout'ta boş sepet state - "Sepetiniz boş" + "Alışverişe Devam Et" button (kanıt: `src/app/checkout/page.tsx` lines 100-111)
- **Empty Search:** Search sayfasında "Sonuç bulunamadı" + kategori linki (kanıt: `src/app/search/page.tsx` lines 77-88)
- **Empty Addresses:** Checkout'ta adres yoksa "Henüz adres eklenmemiş" + "İlk Adresini Ekle" button (kanıt: `src/app/checkout/page.tsx` lines 146-157)
- **Other Empty States:** Unknown (ürün listesi boş, favoriler boş, vb. empty state component'leri görülmedi)

**Evidence:** `src/app/checkout/page.tsx` (empty cart, empty addresses), `src/app/search/page.tsx` (empty search)

### 7.3 Error States
- **Error Boundary:** Root level `error.tsx` yok (kanıt: codebase search sonuçsuz)
- **API Error Handling:** Try-catch blokları ile error handling (kanıt: `src/app/api/search/route.ts`, `src/app/api/auth/signup/route.ts`)
- **Form Error Display:** Inline error div - `text-destructive bg-destructive/10` (kanıt: `src/app/checkout/page.tsx` lines 117-121)

**Evidence:** `src/app/checkout/page.tsx` (error display), `src/app/api/search/route.ts` (try-catch), codebase search (error.tsx bulunamadı)

---

## 8. Motion & Reduced Motion

### 8.1 Animation Library
- **Framer Motion:** `framer-motion@12.23.26` zorunlu (kanıt: `package.json`, `src/components/app/page-transition.tsx`)
- **Animation Purpose:** Yönlendirme (page transitions), geri bildirim (button press, drawer slide)

**Evidence:** `package.json` (framer-motion@12.23.26), `src/components/app/page-transition.tsx` (page transitions)

### 8.2 Reduced Motion Support
- **Hook:** `useReducedMotion()` hook kullanılıyor (framer-motion) (kanıt: `src/components/app/page-transition.tsx` line 85)
- **Implementation:** `shouldAnimate = !reducedMotion && direction !== 0` - reduced motion aktifse animasyon disable (kanıt: `src/components/app/page-transition.tsx` lines 112, 127-136)
- **CSS Media Query:** Unknown (CSS `@media (prefers-reduced-motion)` kullanımı görülmedi, sadece framer-motion hook)

**Evidence:** `src/components/app/page-transition.tsx` (lines 85, 112, 127-136, reduced motion support)

### 8.3 Animation Duration & Easing
- **Page Transitions:** Spring animation - `stiffness: 300, damping: 35, bounce: 0` (kanıt: `src/components/app/page-transition.tsx` lines 129-133)
- **Button Press:** `active:scale-[0.98]` - instant feedback, no delay
- **Drawer:** Bottom-up slide (Vaul library default timing)

**Evidence:** `src/components/app/page-transition.tsx` (spring config), `src/components/product/product-view.tsx` (active:scale)

### 8.4 Motion Rules
- **Aşırı Animasyon Yok:** Sadece gerekli animasyonlar (page transitions, button feedback, drawer slide)
- **Performance:** `will-change:transform` kullanılıyor (kanıt: `src/components/app/page-transition.tsx` line 150)

**Evidence:** `src/components/app/page-transition.tsx` (will-change), `src/components/product/product-view.tsx` (minimal animations)

---

## 9. Accessibility UX Rules (Behavioral)

### 9.1 Keyboard Navigation
- **Focus Ring:** Tüm interactive elementlerde `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2` (kanıt: `src/components/ui/button.tsx` line 7, `src/components/app/mobile-bottom-nav.tsx` lines 104, 165)
- **Tab Order:** Native HTML semantics - button, link, input sırasıyla (assumption)
- **Escape Key:** Dialog/Drawer kapatma (Radix UI built-in) (kanıt: `src/components/ui/dialog.tsx`, `src/components/ui/drawer.tsx`)

**Evidence:** `src/components/ui/button.tsx` (focus-visible:ring), `src/components/app/mobile-bottom-nav.tsx` (focus ring), `src/components/ui/dialog.tsx` (Radix UI)

### 9.2 Focus Management
- **Dialog Focus Trap:** Radix UI Dialog built-in focus trap (kanıt: `src/components/ui/dialog.tsx`)
- **Focus Visible:** `focus-visible:` pseudo-class kullanılıyor (mouse ile tıklamada focus ring yok, klavye ile var)

**Evidence:** `src/components/ui/dialog.tsx` (Radix UI focus trap), `src/components/ui/button.tsx` (focus-visible)

### 9.3 Screen Reader Support
- **ARIA Labels:** Icon-only butonlarda `aria-label` (kanıt: `src/components/app/mobile-bottom-nav.tsx` line 108, `src/components/cart/add-to-cart-bar.tsx` line 47)
- **ARIA Current:** Active tab için `aria-current="page"` (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 109, 169)
- **Semantic HTML:** Native elements (button, nav, form) kullanılıyor

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (aria-label, aria-current), `src/components/cart/add-to-cart-bar.tsx` (aria-label)

### 9.4 Error Message Readability
- **Error Display:** Inline error div - `text-destructive bg-destructive/10` - yeterli kontrast (kanıt: `src/app/checkout/page.tsx` lines 117-121)
- **Screen Reader Announcements:** Unknown (live region kullanımı görülmedi)

**Evidence:** `src/app/checkout/page.tsx` (error display), Unknown (live regions)

---

## 10. Copy & Microcopy Rules

### 10.1 Toast Messages
- **Format:** Kısa, eylem odaklı - "Ürün sepete eklendi" (kanıt: `src/components/product/product-view.tsx` line 81)
- **Language:** Türkçe (kanıt: `src/components/product/product-view.tsx` line 81, `src/app/checkout/page.tsx` error messages)

**Evidence:** `src/components/product/product-view.tsx` (line 81, toast message), `src/app/checkout/page.tsx` (Turkish error messages)

### 10.2 Button Labels
- **Action-Oriented:** "Sepete Ekle", "Siparişi Tamamla", "İşleniyor..." (kanıt: `src/components/product/product-view.tsx` line 302, `src/app/checkout/page.tsx` line 300)
- **State Labels:** "Eklendi ✓" veya "Eklendi" - başarı durumu (kanıt: `src/components/product/product-view.tsx` line 297, `src/components/cart/add-to-cart-bar.tsx` line 49)

**Evidence:** `src/components/product/product-view.tsx` (button labels), `src/app/checkout/page.tsx` (button labels), `src/components/cart/add-to-cart-bar.tsx` (button labels)

### 10.3 Error Messages
- **User-Friendly:** "Lütfen bir adres seçiniz", "Sepetiniz boş" - açıklayıcı, eylem odaklı (kanıt: `src/app/checkout/page.tsx` lines 60, 65)
- **Validation Errors:** Zod error messages - "Geçerli bir adres seçiniz" (kanıt: `src/actions/checkout.ts` line 8)

**Evidence:** `src/app/checkout/page.tsx` (error messages), `src/actions/checkout.ts` (Zod error messages)

---

## 11. Do / Don't

### DO
1. ✅ **Kritik aksiyonlarda loading + toast:** Sepete ekleme, sipariş oluşturma gibi kritik aksiyonlarda button loading state + toast feedback
2. ✅ **Sticky CTA sadece kritik yerlerde:** Ürün detay, checkout gibi kritik sayfalarda sticky action bar
3. ✅ **Touch target min 44px:** Yeni/yenilenen interactive elementler `h-11` (44px) veya daha büyük
4. ✅ **Safe area support:** iOS home indicator alanına uyum - `env(safe-area-inset-bottom)`
5. ✅ **Reduced motion support:** `useReducedMotion()` hook ile animasyon disable
6. ✅ **Tab scroll preservation:** Mobile tab'lar arası geçişte scroll pozisyonu korunur
7. ✅ **Inline error display:** Form validation error'lar inline gösterilir
8. ✅ **Active scale feedback:** Tüm butonlarda `active:scale-[0.98]` dokunsal feedback

### DON'T
1. ❌ **Her tıkta toast:** Sadece kritik aksiyonlarda toast, her tıkta değil
2. ❌ **PDP'de bottom nav göster:** `/urun/[slug]` sayfalarında bottom nav gizlenir (evidence: `src/components/app/mobile-bottom-nav.tsx` lines 47-50)
3. ❌ **Küçük touch target:** 44px'den küçük interactive element yok
4. ❌ **Aşırı animasyon:** Sadece gerekli animasyonlar (page transitions, button feedback)
5. ❌ **Scroll restore yok:** Tab navigation'da scroll pozisyonu kaybolmamalı
6. ❌ **Error toast-only:** Form error'lar sadece toast ile gösterilmez, inline da gösterilir
7. ❌ **No loading state:** Kritik form submit'lerde loading state olmadan button disabled değil

**Evidence:** `src/components/product/product-view.tsx` (DO examples), `src/app/checkout/page.tsx` (DO examples), `src/components/app/mobile-bottom-nav.tsx` (DON'T: PDP bottom nav hide, lines 47-50)

---

## 12. Exceptions (Allowed Deviations)

### 12.1 Product Detail Page - Bottom Nav Hidden
- **Exception:** `/urun/[slug]` sayfalarında mobile bottom nav gizlenir (kanıt: `src/components/app/mobile-bottom-nav.tsx` lines 47-50)
- **Reasoning:** Sticky action bar (Sepete Ekle) ile çakışmayı önlemek, ekran alanını optimize etmek
- **Pattern:** `if (pathname?.startsWith("/urun/")) return null;`

**Evidence:** `src/components/app/mobile-bottom-nav.tsx` (lines 47-50, product detail hide)

### 12.2 AddToCartBar - Shorter Timeout
- **Exception:** `AddToCartBar` component'inde `setTimeout(() => setAdded(false), 400)` - daha kısa timeout (kanıt: `src/components/cart/add-to-cart-bar.tsx` line 37)
- **Reasoning:** Product View'da 2s, AddToCartBar'da 400ms - farklı context'lerde farklı timing

**Evidence:** `src/components/cart/add-to-cart-bar.tsx` (line 37, 400ms timeout), `src/components/product/product-view.tsx` (line 82, 2000ms timeout)

### 12.3 Checkout - No Toast on Error
- **Exception:** Checkout'ta validation error'lar sadece inline gösterilir, toast yok (kanıt: `src/app/checkout/page.tsx` lines 117-121)
- **Reasoning:** Form error'lar inline daha uygun, toast kullanıcıyı bölebilir

**Evidence:** `src/app/checkout/page.tsx` (inline error, no toast)

---

## 13. Open Gaps

### 13.1 Error Handling
- **Global Error Boundary:** Root level `error.tsx` yok - global error boundary pattern'i kullanılmıyor (kanıt: codebase search sonuçsuz)
- **Error Logging:** `console.error` kullanılıyor, structured logging yok (kanıt: `src/app/api/search/route.ts` line 99)

**Evidence:** Codebase search (error.tsx bulunamadı), `src/app/api/search/route.ts` (console.error)

### 13.2 Empty States
- **Product List Empty:** Kategori/arama sayfalarında ürün yoksa empty state component'i görülmedi
- **Favorites Empty:** Favoriler boşsa empty state görülmedi
- **Orders Empty:** Sipariş listesi boşsa empty state görülmedi

**Evidence:** Unknown (empty state components görülmedi)

### 13.3 Accessibility
- **Skip Links:** Ana içeriğe atlama linki yok
- **Live Regions:** Dynamic content değişikliklerinde `aria-live` kullanımı görülmedi
- **Focus Visible Enhancement:** Focus ring görünürlüğü yeterli ama bazı durumlarda iyileştirilebilir

**Evidence:** Unknown (skip links, live regions görülmedi)

### 13.4 Motion
- **CSS Reduced Motion:** Framer Motion `useReducedMotion()` hook var ama CSS `@media (prefers-reduced-motion)` kullanımı görülmedi
- **Animation Performance:** Bazı animasyonlarda `will-change` kullanılıyor ama tüm animasyonlarda değil

**Evidence:** `src/components/app/page-transition.tsx` (will-change var), Unknown (CSS reduced motion)

### 13.5 Form UX
- **Input Autocomplete:** Form input'larında `autocomplete` attribute kullanımı görülmedi
- **Form Field Error Display:** React Hook Form error display pattern'i görülmedi (sadece Server Action error'lar inline)

**Evidence:** Unknown (autocomplete, React Hook Form error display)

---

## 14. Evidence Index

1. **src/components/product/product-view.tsx** - Sepete ekleme pattern, toast, button state, sticky action bar (lines 62-83, 268-308)
2. **src/components/app/mobile-bottom-nav.tsx** - Bottom nav, PDP bottom nav hide (lines 47-50), safe area, touch targets (lines 84, 103, 164)
3. **src/app/layout.tsx** - Toaster mount, position config (line 82)
4. **src/components/cart/add-to-cart-bar.tsx** - Add to cart bar, shorter timeout (lines 24-38, 46-49)
5. **src/app/checkout/page.tsx** - Checkout flow, form validation, error display, loading state (lines 25-309)
6. **src/components/app/page-transition.tsx** - Page transitions, reduced motion, scroll restore (lines 82-160)
7. **src/components/app/tab-scroll.ts** - Tab scroll preservation (scroll save/read functions)
8. **src/components/product/product-card.tsx** - Press preview, touch interactions (lines 12-15, 121-170)
9. **src/components/ui/skeleton.tsx** - Skeleton loading component
10. **src/app/[slug]/loading.tsx** - Category loading state
11. **src/app/urun/[slug]/loading.tsx** - Product loading state
12. **src/app/search/page.tsx** - Search page, Suspense, empty state (lines 77-88, 154-162)
13. **src/components/ui/button.tsx** - Button component, focus ring, active scale (line 7)
14. **src/components/ui/input.tsx** - Input component, focus ring
15. **src/components/ui/drawer.tsx** - Drawer component, bottom sheet pattern
16. **src/components/ui/dialog.tsx** - Dialog component, focus trap
17. **src/actions/checkout.ts** - Checkout Server Action, Zod validation (lines 7-18, 28)
18. **src/components/account/address-form.tsx** - Address form, React Hook Form
19. **src/components/theme/theme-toggle.tsx** - Theme toggle, touch target (line 25)
20. **src/components/layout/header.tsx** - Header, touch targets (lines 186, 226)
21. **package.json** - Dependencies (next@16.1.1, react@19.2.3, react-dom@19.2.3, sonner@2.0.7, framer-motion@12.23.26, react-hook-form@7.69.0, zod@4.2.1)
22. **src/components/app/mobile-tabs.ts** - Mobile tabs config, tab matching
23. **src/app/not-found.tsx** - Not found page (error handling reference)

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni UX pattern'leri eklendiğinde veya mevcut pattern'ler değiştirildiğinde bu doküman güncellenmelidir.
---

# DOC-06: 06.frontend-standards-2026.md

---
# 06. Frontend Standards 2026

Bu doküman, Cinselhobi.com Next projesinin frontend kodlama standartlarını, best practice'lerini ve geliştirme kurallarını tanımlar. Amaç: AI asistanların (Cursor/Cursor) tutarlı, kaliteli ve bakımı kolay kod yazmasını sağlamak ve frontend geliştirme standartlarını merkezi bir yerde toplamak.

**Last verified from package.json:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose & Scope

Bu doküman şunları kapsar:

1. **AI Asistan Rehberi:** Cursor/Cursor'un geliştirme yaparken UX/UI, erişilebilirlik, performans ve kalite kapılarından sapmasını engeller
2. **Kod Kalitesi:** Tutarlı kod stili, component yapısı ve best practice'ler
3. **Type Safety:** TypeScript kullanım kuralları ve type definitions
4. **Performance:** Client component optimizasyonu, bundle size kontrolü
5. **Accessibility:** Minimum erişilebilirlik standartları
6. **Error Handling:** Hata yönetimi pattern'leri ve fallback stratejileri
7. **Forms & Validation:** Form yapısı ve validation kuralları
8. **Testing & QA:** Test yazma standartları ve kalite kontrol süreçleri

Bu doküman şunları kapsamaz:

- Backend/API standartları (02.architecture-lock.md'de tanımlı)
- Design system detayları (04.design-system.md'de tanımlı)
- UX kuralları (05.native-ux-rules.md'de tanımlı)
- Route yapısı (03.routes-and-navigation-map.md'de tanımlı)

**Evidence:** `02.architecture-lock.md`, `04.design-system.md`, `05.native-ux-rules.md`, `03.routes-and-navigation-map.md`

---

## 2. Coding Standards

### 2.1 TypeScript Configuration

- **Strict Mode:** TypeScript strict mode açık (kanıt: `tsconfig.json` line 7: `"strict": true`)
- **Target:** ES2017 (kanıt: `tsconfig.json` line 3: `"target": "ES2017"`)
- **Module Resolution:** bundler (kanıt: `tsconfig.json` line 11: `"moduleResolution": "bundler"`)
- **Path Aliases:** `@/*` → `./src/*` (kanıt: `tsconfig.json` lines 22-24)
- **Archive Exclusion:** `archive/**` klasörü TypeScript tarafından exclude edilir (kanıt: `tsconfig.json` line 34)

**Evidence:** `tsconfig.json` (lines 3, 7, 11, 22-24, 34)

### 2.2 File & Folder Naming

- **Component Files:** Ağırlıklı olarak kebab-case (örn: `product-card.tsx`, `cart-provider.tsx`, `address-form.tsx`) (kanıt: `src/components/catalog/product-card.tsx`, `src/components/cart/cart-provider.tsx`, `src/components/account/address-form.tsx`)
- **PascalCase (Rare/Legacy):** Bazı büyük component'lerde PascalCase kullanılıyor (örn: `ProductDetailClient.tsx`, `AccountSidebar.tsx`, `DesktopHeader.tsx`) (kanıt: `src/components/product/detail/ProductDetailClient.tsx`, `src/components/account/AccountSidebar.tsx`, `src/components/layout/DesktopHeader.tsx`)
- **Utility Files:** kebab-case (örn: `cart-store.ts`, `format.ts`) (kanıt: `src/components/cart/cart-store.ts`, `src/lib/format.ts`)
- **Route Files:** Next.js App Router convention (kebab-case: `page.tsx`, `layout.tsx`, `loading.tsx`, `not-found.tsx`) (kanıt: `src/app/page.tsx`, `src/app/layout.tsx`)
- **API Routes:** `route.ts` (kanıt: `src/app/api/products/route.ts`)
- **Server Actions:** `*.ts` dosyaları `src/actions/` klasöründe (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/components/catalog/product-card.tsx`, `src/components/cart/cart-provider.tsx`, `src/components/product/detail/ProductDetailClient.tsx`, `src/components/cart/cart-store.ts`, `src/app/page.tsx`, `src/app/api/products/route.ts`, `src/actions/checkout.ts`

### 2.3 Import Organization

- **Path Aliases:** `@/` prefix kullanılmalı, relative path'ler tercih edilmemeli (kanıt: `src/components/product/detail/ProductDetailClient.tsx` lines 8-13: `@/components/cart/cart-provider`, `@/lib/format`)
- **Import Order:** External packages → Internal aliases → Relative imports (kanıt: `src/components/product/detail/ProductDetailClient.tsx` lines 1-14)
- **Type Imports:** Type-only imports `import type` kullanılmalı (kanıt: `src/components/product/detail/ProductDetailClient.tsx` line 14: `import type { Product, RelatedProduct }`)

**Evidence:** `src/components/product/detail/ProductDetailClient.tsx` (lines 1-14), `src/components/cart/cart-provider.tsx` (lines 1-5)

### 2.4 Small PR Rule

- **AI-Friendly PR Size:** Her PR maksimum 5-7 dosya değişikliği içermeli
- **Single Responsibility:** Her PR tek bir feature/fix içermeli
- **Incremental Changes:** Büyük refactor'lar küçük PR'lara bölünmeli

**Evidence:** Best practice (AI asistanlar için optimize edilmiş)

---

## 3. Component Standards

### 3.1 RSC vs Client Component Decision Tree

**Default: Server Component**

- Tüm `page.tsx`, `layout.tsx` dosyaları varsayılan olarak Server Component (kanıt: `src/app/page.tsx` - "use client" yok, async function)
- Server Component'lerde direkt veritabanı sorguları yapılabilir (kanıt: `src/app/page.tsx` lines 11-14: `getTopCategories`, `getLatestProductsCursor`)

**"use client" Zorunlu Durumlar:**

1. **State Management:** `useState`, `useReducer` kullanımı (kanıt: `src/components/catalog/load-more-grid.tsx` line 1, lines 40-44)
2. **Event Handlers:** `onClick`, `onChange` gibi event handler'lar (kanıt: `src/components/product/detail/ProductDetailClient.tsx` line 1, line 119: `handleAddToCart`)
3. **Browser APIs:** `localStorage`, `window`, `document` kullanımı (kanıt: `src/components/cart/cart-provider.tsx` line 1, lines 27-35: localStorage)
4. **React Context:** Provider component'ler (kanıt: `src/components/cart/cart-provider.tsx` line 1, `src/components/theme/theme-provider.tsx`)
5. **Framer Motion:** Animasyon kütüphanesi (kanıt: `src/components/product/detail/ProductDetailClient.tsx` line 1, line 6: `framer-motion`)
6. **React Hooks:** `useEffect`, `useMemo`, `useCallback` (kanıt: `src/components/cart/cart-provider.tsx` lines 27-43)

**Evidence:** `src/app/page.tsx` (Server Component), `src/components/catalog/load-more-grid.tsx` (Client Component), `src/components/cart/cart-provider.tsx` (Client Component), `src/components/product/detail/ProductDetailClient.tsx` (Client Component)

### 3.2 Component Structure

**Props Interface:**

- Props interface component dosyasının üstünde tanımlanmalı (kanıt: `src/components/product/detail/ProductDetailClient.tsx` lines 16-20)
- Props interface'ler `Props` suffix ile bitmeli (kanıt: `src/components/product/detail/ProductDetailClient.tsx` line 16: `ProductDetailClientProps`)

**Variants:**

- `class-variance-authority` (cva) kullanılmalı (kanıt: `src/components/ui/button.tsx` lines 2, 6-33: `buttonVariants`)
- Variant props `VariantProps` type ile tip güvenliği sağlanmalı (kanıt: `src/components/ui/button.tsx` lines 35-37)

**Default States:**

- Loading state zorunlu (async işlemler için) (kanıt: `src/components/catalog/load-more-grid.tsx` line 42: `loading` state)
- Disabled state zorunlu (form submit, button click gibi durumlarda) (kanıt: `src/app/checkout/page.tsx` line 31: `isLoading` state)

**Evidence:** `src/components/product/detail/ProductDetailClient.tsx` (lines 16-20), `src/components/ui/button.tsx` (lines 6-37), `src/components/catalog/load-more-grid.tsx` (line 42), `src/app/checkout/page.tsx` (line 31)

### 3.3 Reusability

- **Component Inventory:** Yeni component yazmadan önce mevcut component'ler kontrol edilmeli
- **Composition over Inheritance:** Küçük, tek sorumluluklu component'ler tercih edilmeli
- **Shared UI Components:** `src/components/ui/` klasöründeki component'ler kullanılmalı (kanıt: `src/components/ui/button.tsx`, `src/components/ui/input.tsx`)

**Evidence:** `src/components/ui/` (shadcn/ui components), `src/components/catalog/product-card.tsx` (reusable component)

---

## 4. Accessibility Standards

### 4.1 Focus Visibility & Order

- **Focus Ring:** Focus görünürlüğü zorunlu - `focus-visible:ring-2` pattern (kanıt: `src/components/ui/button.tsx` line 7: `focus-visible:outline-none focus-visible:ring-2`)
- **Focus Order:** Logical tab order - DOM sırasına uygun (kanıt: `src/components/ui/button.tsx` - standard HTML button)

**Evidence:** `src/components/ui/button.tsx` (line 7), `src/components/ui/input.tsx`

### 4.2 Keyboard Navigation

- **Menu Navigation:** Radix UI primitives kullanıldığı için keyboard navigation otomatik (kanıt: `package.json` - `@radix-ui/react-dropdown-menu`, `@radix-ui/react-navigation-menu`)
- **Dialog/Drawer:** Radix UI AlertDialog, Vaul drawer keyboard navigation destekliyor (kanıt: `package.json` - `@radix-ui/react-alert-dialog`, `vaul`)

**Evidence:** `package.json` (Radix UI packages), `src/components/ui/dialog.tsx`, `src/components/ui/drawer.tsx`

### 4.3 Form Error Messages

- **Field-Level Errors:** Form field'larında inline error gösterimi (kanıt: `src/components/account/address-form.tsx` - React Hook Form error handling)
- **ARIA Connection:** `aria-describedby` veya `aria-invalid` kullanımı (kanıt: `src/components/ui/input.tsx` - shadcn/ui pattern)

**Evidence:** `src/components/account/address-form.tsx`, `src/components/ui/input.tsx`

### 4.4 Color Contrast

- **Design Tokens:** CSS variables üzerinden renk yönetimi (kanıt: `src/app/globals.css` - oklch color tokens)
- **Contrast Measurement:** Unknown (ölçüm yapılmamış, hedef: WCAG AA minimum)

**Evidence:** `src/app/globals.css` (color tokens), `04.design-system.md` (color system)

---

## 5. Performance Standards

### 5.1 Client Component Optimization

- **Gereksiz "use client" Yasak:** Sadece gerekli durumlarda Client Component kullanılmalı
- **Server Component Default:** Varsayılan olarak Server Component tercih edilmeli (kanıt: `src/app/page.tsx` - Server Component)

**Evidence:** `src/app/page.tsx` (Server Component), `src/components/catalog/load-more-grid.tsx` (Client Component - state management gerekli)

### 5.2 Image Optimization

- **next/image Zorunlu:** Tüm görseller `next/image` component'i ile yüklenmeli (kanıt: `src/components/product/product-view.tsx` line 4: `import Image from "next/image"`)
- **Remote Patterns:** `next.config.ts` içinde `remotePatterns` tanımlı (kanıt: `next.config.ts` lines 6-22)

**Evidence:** `src/components/product/product-view.tsx` (line 4), `next.config.ts` (lines 6-22)

### 5.3 Bundle Size & Code Splitting

- **Dynamic Import:** Unknown (büyük bundle'larda dynamic import pattern'i kullanılıyor mu bilinmiyor)
- **Route-Based Splitting:** Next.js App Router otomatik code splitting yapıyor

**Evidence:** Unknown (dynamic import pattern'i codebase'de görülmedi)

### 5.4 Cache Strategy

- **API Routes:** `export const dynamic = "force-dynamic"` default (kanıt: `src/app/api/products/route.ts` line 9)
- **Revalidate:** API route'larında `export const revalidate = 0` (kanıt: `src/app/api/products/route.ts` line 10)
- **Server Components:** Unknown (revalidate/dynamic ipuçları yok)

**Evidence:** `src/app/api/products/route.ts` (lines 9-10), `src/app/api/search/route.ts`

---

## 6. Data Fetching & State Standards

### 6.1 Data Fetching Patterns

**Server Components:**

- Direct database queries - Drizzle ORM ile direkt veritabanı sorguları (kanıt: `src/app/page.tsx` lines 11-14: `getTopCategories`, `getLatestProductsCursor`)

**Client Components:**

- Fetch API - `/api/*` route'larına fetch ile istek (kanıt: `src/components/catalog/load-more-grid.tsx` lines 54-78: `/api/products` fetch)

**Server Actions:**

- Form submit'ler ve mutation'lar `src/actions/` içinde (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/app/page.tsx` (lines 11-14), `src/components/catalog/load-more-grid.tsx` (lines 54-78), `src/actions/checkout.ts`

### 6.2 State Management

- **Current Approach:** Context API providers + localStorage pattern kullanılıyor (kanıt: `src/components/cart/cart-provider.tsx` - Context + localStorage, `src/components/favorites/favorites-provider.tsx`)
- **No External State Library:** `package.json` içinde Redux, Zustand, Jotai gibi external state library'leri yok (kanıt: `package.json` - state management library dependencies yok)
- **Provider Hiyerarşisi:** `layout.tsx` içindeki provider sırası sabit - ThemeProvider → AuthProvider → FavoritesProvider → CartProvider → HeaderProvider → SearchProvider (kanıt: `src/app/layout.tsx` lines 59-87)
- **Policy:** External state library eklenmesi durumunda, 02.architecture-lock.md'de açıkça "yasak" olarak belirtilmiş (kanıt: `02.architecture-lock.md` line 181: "External state library eklemek yasak"). Yeni state library eklenmesi için 02.architecture-lock.md'deki policy'nin değiştirilmesi ve 15.changelog-and-decisions.md'de kayıt altına alınması gerekir.

**Evidence:** `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`, `src/app/layout.tsx` (lines 59-87), `package.json` (state management library yok), `02.architecture-lock.md` (line 181)

### 6.3 URL State / SearchParams

- **SearchParams:** Next.js `searchParams` prop'u kullanılmalı (kanıt: `src/app/api/products/route.ts` lines 16-24: `request.nextUrl.searchParams`)
- **Client-Side URL State:** Unknown (URL state yönetimi için özel pattern yok)

**Evidence:** `src/app/api/products/route.ts` (lines 16-24)

---

## 7. Error Handling Standards

### 7.1 Error Boundaries

- **not-found.tsx:** Root level `not-found.tsx` mevcut, Suspense ile wrap edilmiş (kanıt: `src/app/not-found.tsx` lines 24-28)
- **error.tsx:** Root level `error.tsx` yok - error boundary pattern'i kullanılmıyor

**Evidence:** `src/app/not-found.tsx` (lines 24-28), codebase search (error.tsx bulunamadı)

### 7.2 API Error Handling

- **Try-Catch Pattern:** API route'larında try-catch blokları ile error handling (kanıt: `src/app/api/auth/signup/route.ts` lines 51-57)
- **Error Response Format:** JSON error response, status code ile (kanıt: `src/app/api/products/[slug]/route.ts` - error response pattern)

**Evidence:** `src/app/api/auth/signup/route.ts` (lines 51-57), `src/app/api/search/route.ts`

### 7.3 Server Action Error Handling

- **Return Pattern:** `{ ok: boolean, error?: string, errors?: ZodError[] }` pattern (kanıt: `src/actions/checkout.ts` lines 24, 40-44)
- **Zod Validation Errors:** Zod error'ları `errors` field'ında döndürülüyor (kanıt: `src/actions/checkout.ts` lines 39-44)

**Evidence:** `src/actions/checkout.ts` (lines 24, 39-44), `src/actions/address.ts` (lines 30, 38-43)

### 7.4 Client Error Handling

- **Error State:** Client Component'lerde `useState` ile error state yönetimi (kanıt: `src/components/catalog/load-more-grid.tsx` line 44: `error` state)
- **Toast vs Inline:** Toast kritik feedback için (Sonner), inline error form validation için (kanıt: `src/app/layout.tsx` line 82: `<Toaster>`, `src/app/checkout/page.tsx` line 32: `error` state)

**Evidence:** `src/components/catalog/load-more-grid.tsx` (line 44), `src/app/layout.tsx` (line 82), `src/app/checkout/page.tsx` (line 32)

---

## 8. Forms & Validation Standards

### 8.1 Form Library

- **React Hook Form Zorunlu:** Form library olarak (kanıt: `package.json` react-hook-form@7.69.0, `src/components/account/address-form.tsx` line 3)

**Evidence:** `package.json` (react-hook-form@7.69.0), `src/components/account/address-form.tsx` (line 3)

### 8.2 Validation Library

- **Zod Zorunlu:** Validation library olarak (kanıt: `package.json` zod@4.2.1, `src/actions/checkout.ts` lines 7-18)
- **@hookform/resolvers:** React Hook Form + Zod entegrasyonu (kanıt: `package.json` @hookform/resolvers@5.2.2, `src/components/account/address-form.tsx` line 4)

**Evidence:** `package.json` (zod@4.2.1, @hookform/resolvers@5.2.2), `src/actions/checkout.ts` (lines 7-18), `src/components/account/address-form.tsx` (lines 4, 21-32)

### 8.3 Form Submit Pattern

- **Client Component Form:** Form Client Component'te, submit Server Action'a (kanıt: `src/components/account/address-form.tsx` - Client Component, `src/actions/address.ts` - Server Action)
- **Loading State:** Submit sırasında loading state zorunlu (kanıt: `src/app/checkout/page.tsx` line 31: `isLoading` state)
- **Optimistic vs Pessimistic:** Unknown (optimistic update pattern'i kullanılmıyor)

**Evidence:** `src/components/account/address-form.tsx`, `src/actions/address.ts`, `src/app/checkout/page.tsx` (line 31)

### 8.4 Checkout Form Error Recovery

- **Error Display:** Inline error - `setError()` + error div (kanıt: `src/app/checkout/page.tsx` lines 32, 86-91)
- **Validation Error Handling:** Zod validation error'ları `errors` field'ından parse ediliyor (kanıt: `src/app/checkout/page.tsx` lines 86-88)

**Evidence:** `src/app/checkout/page.tsx` (lines 32, 86-91)

---

## 9. Styling Standards

### 9.1 CSS Framework

- **Tailwind CSS v4:** PostCSS plugin ile (kanıt: `package.json` tailwindcss@4, `postcss.config.mjs`)
- **CSS Modules:** Kullanılmıyor
- **Styled Components:** Yasak (02.architecture-lock.md'de tanımlı)

**Evidence:** `package.json` (tailwindcss@4), `postcss.config.mjs`, `02.architecture-lock.md` (line 176)

### 9.2 Design Tokens

- **CSS Variables:** `src/app/globals.css` içinde `:root` ve `.dark` class'ları altında token'lar (kanıt: `src/app/globals.css` - oklch color tokens)
- **Token Kullanımı:** Core UI colors token, status colors exception (04.design-system.md'de tanımlı)

**Evidence:** `src/app/globals.css` (color tokens), `04.design-system.md` (design tokens section)

### 9.3 Utility Functions

- **cn() Function:** `clsx` + `tailwind-merge` kombinasyonu (kanıt: `src/lib/utils.ts` lines 1-6)
- **Class Merging:** `cn()` function tüm className birleştirmelerinde kullanılmalı (kanıt: `src/components/ui/button.tsx` line 58: `cn(buttonVariants(...), ...)`)

**Evidence:** `src/lib/utils.ts` (lines 1-6), `src/components/ui/button.tsx` (line 58)

---

## 10. Testing & QA Standards

### 10.1 Test Framework

- **Test Framework:** Unknown (test dosyası yok, test framework package.json'da yok)
- **E2E Framework:** Unknown (Playwright/Cypress yok)

**Evidence:** `package.json` (test framework yok), codebase search (test dosyası bulunamadı)

### 10.2 Minimum QA Checklist

**Smoke Checklist (Manuel Test):**

1. Ana sayfa yükleniyor mu?
2. Kategori sayfası çalışıyor mu?
3. Ürün detay sayfası açılıyor mu?
4. Sepete ekleme çalışıyor mu?
5. Checkout akışı tamamlanıyor mu?
6. Login/logout çalışıyor mu?

**Evidence:** Best practice (manuel test checklist)

### 10.3 Lint & Build Commands

- **Lint:** `npm run lint` (kanıt: `package.json` line 9: `"lint": "eslint"`)
- **Build:** `npm run build` (kanıt: `package.json` line 7: `"build": "TZ=Europe/Istanbul next build"`)
- **TypeCheck:** Script yok - `npm run build` ile TypeScript kontrol ediliyor (kanıt: `package.json` - typecheck script yok)

**Evidence:** `package.json` (lines 7, 9)

---

## 11. PR / Review Standards

### 11.1 PR Size

- **Small PR:** Her PR maksimum 5-7 dosya değişikliği içermeli
- **Single Responsibility:** Her PR tek bir feature/fix içermeli

**Evidence:** Best practice (AI asistanlar için optimize edilmiş)

### 11.2 PR Description

- **Dosya Bazlı Açıklama:** Değişen dosyalar ve sebepleri açıklanmalı
- **Risk & Rollback:** Riskli değişikliklerde rollback planı belirtilmeli

**Evidence:** Best practice

### 11.3 Screenshots / Video

- **UI Değişimleri:** UI değişikliklerinde screenshot veya kısa video zorunlu
- **Mobile & Desktop:** Hem mobile hem desktop görünümü gösterilmeli

**Evidence:** Best practice

---

## 12. Definition of Done (DoD)

Bir feature/fix'in "done" sayılması için:

1. **Lint:** `npm run lint` hatasız geçmeli (kanıt: `package.json` line 9)
2. **Build:** `npm run build` başarılı olmalı (kanıt: `package.json` line 7)
3. **TypeScript:** Build sırasında TypeScript kontrol ediliyor, hata olmamalı (kanıt: `tsconfig.json` - strict mode)
4. **Manuel Test:** Kritik akışlar manuel test edilmeli:
   - PLP (Product List Page) - kategori sayfası
   - PDP (Product Detail Page) - ürün detay sayfası
   - Cart - sepet işlemleri
   - Checkout - sipariş akışı
5. **Mobile Test:** Mobile görünüm test edilmeli
6. **Dark Mode Test:** Dark mode görünüm test edilmeli

**Evidence:** `package.json` (lines 7, 9), `tsconfig.json` (line 7), best practice (manuel test checklist)

---

## 13. Known Gaps

Repo'da eksik olan kalite kapıları:

1. **TypeCheck Script:** `npm run typecheck` script'i yok - build ile kontrol ediliyor
2. **Test Framework:** Test framework kurulu değil (Jest/Vitest/Playwright)
3. **E2E Tests:** E2E test altyapısı yok
4. **A11y Tests:** Erişilebilirlik test altyapısı yok (axe-core, jest-axe)
5. **Performance Budget:** Bundle size ve performance budget tanımlı değil
6. **Error Boundary:** Root level `error.tsx` yok
7. **Code Coverage:** Test coverage metriği yok

**Evidence:** `package.json` (test framework yok), codebase search (error.tsx bulunamadı), codebase search (test dosyası bulunamadı)

---

## 14. Evidence Index

En önemli kanıtlar:

1. `package.json` - Dependencies (next@16.1.1, react@19.2.3, react-dom@19.2.3), scripts, tooling, state management library absence
2. `tsconfig.json` - TypeScript configuration, strict mode, path aliases
3. `eslint.config.mjs` - ESLint configuration, archive exclusion
4. `next.config.ts` - Next.js configuration, image remotePatterns
5. `src/app/layout.tsx` - Provider hiyerarşisi, Server Component default
6. `src/app/page.tsx` - Server Component pattern, direct DB queries
7. `src/components/cart/cart-provider.tsx` - Context API state management, Client Component
8. `src/components/catalog/load-more-grid.tsx` - Client Component, fetch API pattern
9. `src/components/product/detail/ProductDetailClient.tsx` - Client Component, "use client" usage
10. `src/components/ui/button.tsx` - CVA pattern, variant props
11. `src/lib/utils.ts` - cn() utility function
12. `src/actions/checkout.ts` - Server Action, Zod validation
13. `src/actions/address.ts` - Server Action, error handling pattern
14. `src/app/api/products/route.ts` - API route, force-dynamic, cursor pagination
15. `src/app/checkout/page.tsx` - Form pattern, error handling
16. `src/components/account/address-form.tsx` - React Hook Form + Zod pattern
17. `src/app/not-found.tsx` - Error handling, Suspense pattern
18. `src/app/globals.css` - CSS variables, design tokens
19. `02.architecture-lock.md` - Architecture decisions, yasaklar (line 181: state management policy)
20. `04.design-system.md` - Design tokens, styling rules
21. `05.native-ux-rules.md` - UX rules, accessibility patterns

**Evidence:** Tüm yukarıdaki dosyalar codebase'de mevcut ve kanıt olarak kullanıldı
---

# DOC-07: 07.component-inventory.md

---
# 07. Component Inventory

Bu doküman, Cinselhobi.com Next projesindeki tüm component'lerin envanterini, kullanım yerlerini ve bağımlılıklarını tanımlar. Amaç: AI asistanların (Cursor/Cursor) gereksiz component yazmasını engellemek ve mevcut component'leri doğru şekilde kullanmasını sağlamak.

**Last verified from package.json:** 2025-12-31  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose & Scope

Bu doküman şunları kapsar:

1. **Component Envanteri:** Tüm component'lerin listesi, kategorileri ve kullanım yerleri
2. **Kullanım Haritası:** Hangi component'in nerede kullanıldığı
3. **Component Sağlığı:** Eksik state'ler, a11y sorunları, refactor ihtiyaçları
4. **Reusable vs One-off:** Component'lerin yeniden kullanılabilirlik durumu
5. **Legacy/Deprecated:** Kullanılmayan veya eski component'ler

Bu doküman şunları kapsamaz:

- Backend/API standartları (02.architecture-lock.md'de tanımlı)
- Design system detayları (04.design-system.md'de tanımlı)
- UX kuralları (05.native-ux-rules.md'de tanımlı)
- Route yapısı (03.routes-and-navigation-map.md'de tanımlı)

**Evidence:** `02.architecture-lock.md`, `04.design-system.md`, `05.native-ux-rules.md`, `03.routes-and-navigation-map.md`

---

## 2. Inventory Rules

- **Yeni component yazmadan önce inventory kontrolü zorunlu** - Mevcut component'ler kullanılmalı, duplicate component açılmamalı
- **Core UI (Button/Input/Dialog/Drawer/Toast) sadece design system layer'dan kullanılmalı** - `src/components/ui/*` klasöründeki component'ler tek kaynak
- **Aynı amaç için duplicate component açmak yasak** - İstisna: A/B test (karar kaydı gerekir)
- **Deprecated component'ler kullanılmaz** - Gerekiyorsa migration notu yazılır
- **Client Component'ler sadece gerektiğinde** - Server Component varsayılan, `"use client"` sadece interaktivite gerektiğinde

**Evidence:** `04.design-system.md` (lines 1-50), `06.frontend-standards-2026.md` (lines 38-100)

---

## 3. Core UI Components (Design System Layer)

`src/components/ui/*` klasöründeki temel bileşenler. Bunlar shadcn/ui tabanlı, Radix UI primitives kullanıyor.

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| Button | `src/components/ui/button.tsx` | core-ui | Global (50+ kullanım) | No | - | focus-visible:ring, disabled states | Healthy | Global | Variants: default, destructive, outline, secondary, ghost, link. Sizes: default, sm, lg, icon. pressable prop ile active:scale-95. Shared (no directive) |
| Input | `src/components/ui/input.tsx` | core-ui | Forms (login, signup, address, checkout, admin) | No | - | focus-visible:ring, disabled states | Healthy | Global | Standard HTML input wrapper, file input desteği. Shared (no directive) |
| Badge | `src/components/ui/badge.tsx` | core-ui | Cart count, order status, category tags | No | - | focus:ring | Healthy | Global | Variants: default, secondary, destructive, outline, success, warning, info, dot. Shared (no directive) |
| Dialog | `src/components/ui/dialog.tsx` | core-ui | Search overlay, modals | Yes | open/closed | Radix Dialog (aria), sr-only close button | Healthy | Global | Radix Dialog primitive, hideCloseButton prop |
| DialogFullscreen | `src/components/ui/dialog-fullscreen.tsx` | core-ui | Search overlay | Yes | open/closed | Radix Dialog (aria) | Healthy | Search | Fullscreen dialog variant |
| Drawer | `src/components/ui/drawer.tsx` | core-ui | Cart drawer, mobile filters, address form | Yes | open/closed | Vaul drawer (aria), drag handle | Healthy | Cart, Catalog | Vaul library, bottom sheet pattern |
| AlertDialog | `src/components/ui/alert-dialog.tsx` | core-ui | Cart item removal, address deletion | Yes | open/closed | Radix AlertDialog (aria) | Healthy | Cart, Account | Confirmation dialogs |
| Accordion | `src/components/ui/accordion.tsx` | core-ui | Footer links | No | open/closed | Radix Accordion (aria) | Healthy | Footer | Collapsible sections. Shared (no directive) |
| Avatar | `src/components/ui/avatar.tsx` | core-ui | Mobile bottom nav profile, user display | No | - | alt text support | Healthy | Navigation | AvatarImage, AvatarFallback components. Shared (no directive) |
| Skeleton | `src/components/ui/skeleton.tsx` | core-ui | Loading states (kullanım yok görünüyor) | No | - | - | Healthy | Global | Loading placeholder, şu an kullanılmıyor. Shared (no directive) |
| DropdownMenu | `src/components/ui/dropdown-menu.tsx` | core-ui | Cart item actions | Yes | open/closed | Radix DropdownMenu (aria) | Healthy | Cart | Context menu pattern |
| NavigationMenu | `src/components/ui/navigation-menu.tsx` | core-ui | Desktop navigation | Yes | - | Radix NavigationMenu (aria) | Healthy | Layout | Desktop nav menu |
| Icons | `src/components/ui/icons.tsx` | core-ui | Global icon set | No | - | - | Healthy | Global | Lucide icons wrapper. Shared (no directive) |
| IconWrapper | `src/components/ui/icon-wrapper.tsx` | core-ui | Styleguide (demo) | No | - | - | Healthy | Styleguide | Icon container wrapper. Shared (no directive) |
| GlassContainer | `src/components/ui/glass-container.tsx` | core-ui | Styleguide (demo) | No | - | - | Healthy | Styleguide | Glassmorphism container. Shared (no directive) |

**Evidence:** `src/components/ui/*` (15 files), grep results (50+ Button imports, 20+ Input imports)

---

## 4. Layout Components

Header, Footer, Navigation ve layout wrapper component'leri.

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| Header | `src/components/layout/header.tsx` | layout | Root layout (mobile) | Yes | scrolled state | Back button aria-label, search button aria-label | Healthy | Layout | Mobile header, transparent on home, glass on scroll |
| DesktopHeader | `src/components/layout/DesktopHeader.tsx` | layout | Root layout (desktop) | Yes | - | Logo link, search button | Healthy | Layout | Desktop header variant |
| DesktopNavigation | `src/components/layout/DesktopNavigation.tsx` | layout | DesktopHeader | Yes | - | NavigationMenu (aria) | Healthy | Layout | Desktop nav menu |
| HeaderTitle | `src/components/layout/header-title.tsx` | layout | ProductView, CategoryHeaderSetter | Yes | - | h1 semantic | Healthy | Layout | Dynamic header title setter |
| HeaderContext | `src/components/layout/header-context.tsx` | layout | Root layout | Yes | title, categoryInfo | - | Healthy | Layout | Context provider for header state |
| Footer | `src/components/app/Footer.tsx` | layout | Root layout | Yes | - | Accordion (aria) | Healthy | Layout | Footer with accordion links, newsletter form |
| MobileBottomNav | `src/components/app/mobile-bottom-nav.tsx` | layout | Root layout | Yes | cartOpen, activeTab | aria-label, aria-current | Healthy | Navigation | Bottom navigation, cart drawer trigger |
| TopBar | `src/components/app/top-bar.tsx` | layout | Root layout | Yes | - | - | Healthy | Layout | Top bar (desktop) |
| MobileHeaderSlot | `src/components/app/mobile-header-slot.tsx` | layout | Root layout | Yes | - | - | Healthy | Layout | Mobile header slot wrapper |
| PageTransition | `src/components/app/page-transition.tsx` | layout | Root layout | Yes | - | - | Healthy | Layout | Page transition wrapper |

**Evidence:** `src/components/layout/*` (5 files), `src/components/app/*` (5 layout files), `src/app/layout.tsx` (imports)

---

## 5. Feature Components

### 5.1 Product Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| ProductView | `src/components/product/product-view.tsx` | feature | `/urun/[slug]` page | Yes | descriptionExpanded, isAdded, activeIndex | HeaderTitle, FavoriteButton, image alt | Healthy | Product | Main product detail view, gallery, sticky action bar |
| ProductCard (catalog) | `src/components/catalog/product-card.tsx` | feature | ProductGrid, LoadMoreGrid, WishlistClient | Yes | - | Link, image alt | Healthy | Catalog | Wrapper for NewProductCard, data mapping |
| ProductCard (product) | `src/components/product/product-card.tsx` | feature | Catalog ProductCard wrapper | Yes | - | Link, image alt, favorite button | Healthy | Product | Core product card, favorite integration |
| ProductDetailClient | `src/components/product/detail/ProductDetailClient.tsx` | feature | Unknown | Yes | - | - | Unknown | Product | Usage not found (no imports in src/app/** and src/components/**) |
| ProductDetailPage | `src/components/product/product-detail-page.tsx` | feature | Unknown | Yes | - | - | Unknown | Product | Usage not found (no imports in src/app/** and src/components/**) |
| ProductGallery | `src/components/product/detail/ProductGallery.tsx` | feature | Unknown | Yes | activeIndex | Image alt, slider buttons aria-label | Unknown | Product | Usage not found (no imports in src/app/** and src/components/**) |

**Evidence:** `src/components/product/*` (6 files), `src/app/urun/[slug]/page.tsx` (ProductView import), grep (ProductCard 13 matches)

### 5.2 Cart Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| CartView | `src/components/cart/cart-view.tsx` | feature | `/cart` page, MobileBottomNav drawer | Yes | variant (page/drawer) | DrawerTitle, DrawerDescription, AlertDialog | Healthy | Cart | Main cart view, variant-based rendering |
| CartIconButton | `src/components/cart/cart-icon-button.tsx` | feature | DesktopHeader | Yes | - | Button aria-label | Healthy | Cart | Cart icon with badge |
| AddToCartBar | `src/components/cart/add-to-cart-bar.tsx` | feature | Unknown | Yes | - | Button | Unknown | Cart | Usage not found (no imports in src/app/** and src/components/**) |
| CartProvider | `src/components/cart/cart-provider.tsx` | provider | Root layout | Yes | items, hydrated | - | Healthy | Cart | Context provider, localStorage sync |
| CartStore | `src/components/cart/cart-store.ts` | util | CartProvider | - | - | - | Healthy | Cart | localStorage utilities |
| CartTypes | `src/components/cart/cart-types.ts` | util | CartProvider, CartView | - | - | - | Healthy | Cart | TypeScript types |

**Evidence:** `src/components/cart/*` (6 files), `src/app/cart/page.tsx`, `src/app/layout.tsx` (CartProvider)

### 5.3 Catalog Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| CategoryGrid | `src/components/catalog/category-grid.tsx` | feature | Home page, Categories page | No | - | Link, image alt | Healthy | Catalog | Category grid display. Shared (no directive) |
| ProductGrid | `src/components/catalog/product-grid.tsx` | feature | LoadMoreGrid | No | - | ProductCard links | Healthy | Catalog | Product grid wrapper. Shared (no directive) |
| LoadMoreGrid | `src/components/catalog/load-more-grid.tsx` | feature | Home page, Category pages | Yes | loading, hasMore | Button loading state | Healthy | Catalog | Infinite scroll, cursor-based pagination |
| CatalogControls | `src/components/catalog/catalog-controls.tsx` | feature | Header (category pages) | Yes | sort, filters | Drawer, Button | Healthy | Catalog | Filter/sort controls drawer |
| ActiveFiltersBar | `src/components/catalog/active-filters-bar.tsx` | feature | Category pages | Yes | - | Button badges | Healthy | Catalog | Active filter display |
| CategoryHeaderSetter | `src/components/catalog/category-header-setter.tsx` | feature | Category pages | Yes | - | HeaderTitle | Healthy | Catalog | Sets header title from category |

**Evidence:** `src/components/catalog/*` (7 files), `src/app/page.tsx`, `src/app/[slug]/page.tsx`, `src/app/categories/page.tsx`

### 5.4 Account Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| AccountSidebar | `src/components/account/AccountSidebar.tsx` | feature | Account layout | Yes | - | Navigation links | Healthy | Account | Account sidebar navigation |
| AddressList | `src/components/account/address-list.tsx` | feature | `/account/addresses` page | Yes | - | AlertDialog, Button | Healthy | Account | Address list with delete |
| AddressForm | `src/components/account/address-form.tsx` | feature | `/account/addresses`, `/checkout` | Yes | loading, error | Drawer, Input validation | Healthy | Account | Address form in drawer |
| AddressFormButton | `src/components/account/address-form-button.tsx` | feature | `/account/addresses` page | Yes | - | Button | Healthy | Account | Opens AddressForm drawer |

**Evidence:** `src/components/account/*` (4 files), `src/app/account/*` (imports)

### 5.5 Auth Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| LoginForm | `src/components/auth/login-form.tsx` | feature | `/login` page | Yes | loading, error | Input, Button, form validation | Healthy | Auth | Login form |
| SignupForm | `src/components/auth/signup-form.tsx` | feature | `/signup` page | Yes | loading, error | Input, Button, form validation | Healthy | Auth | Signup form |
| AuthProvider | `src/components/auth/auth-provider.tsx` | provider | Root layout | Yes | - | - | Healthy | Auth | NextAuth SessionProvider wrapper |

**Evidence:** `src/components/auth/*` (3 files), `src/app/login/page.tsx`, `src/app/signup/page.tsx`

### 5.6 Search Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| SearchOverlay | `src/components/search/search-overlay.tsx` | feature | Root layout | Yes | open, query | Dialog, DialogFullscreen, Input | Healthy | Search | Fullscreen search overlay |
| SearchResultItem | `src/components/search/search-result-item.tsx` | feature | `/search` page | Yes | - | Link | Healthy | Search | Search result item display |
| SearchProvider | `src/components/search/search-provider.tsx` | provider | Root layout | Yes | open, query | - | Healthy | Search | Search state context |

**Evidence:** `src/components/search/*` (3 files), `src/app/search/page.tsx`, `src/app/layout.tsx`

### 5.7 Admin Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| AdminSidebar | `src/components/admin/admin-sidebar.tsx` | feature | Admin layout | Yes | - | Navigation links | Healthy | Admin | Admin sidebar navigation |
| OrderStatusForm | `src/components/admin/order-status-form.tsx` | feature | `/admin/orders/[id]` page | Yes | loading, error | Input, Button | Healthy | Admin | Order status update form |

**Evidence:** `src/components/admin/*` (2 files), `src/app/admin/*` (imports)

### 5.9 Content Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| StaticPage | `src/components/content/static-page.tsx` | feature | Legal pages (mesafeli-satis, cayma, gizlilik) | No | - | - | Healthy | Content | Static page wrapper. Shared (no directive) |
| Markdown | `src/components/content/markdown.tsx` | feature | StaticPage | No | - | - | Healthy | Content | Markdown renderer. Shared (no directive) |

**Evidence:** `src/components/content/*` (2 files), `src/app/mesafeli-satis-sozlesmesi/page.tsx`, etc.

### 5.10 Theme Components

| Name | Path | Layer | Used In | Directive | States | A11y Notes | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|------------|--------|---------------|-------|
| ThemeProvider | `src/components/theme/theme-provider.tsx` | provider | Root layout | Yes | theme | - | Healthy | Theme | next-themes provider |
| ThemeToggle | `src/components/theme/theme-toggle.tsx` | feature | Styleguide, TopBar | Yes | - | Button aria-label | Healthy | Theme | Dark/light mode toggle |

**Evidence:** `src/components/theme/*` (2 files), `src/app/layout.tsx`, `src/app/styleguide/page.tsx`

---

## 6. Providers & State Modules

Context API ile state yönetimi yapan provider'lar.

| Name | Path | Layer | Used In | Client/Server | States | Storage | Health | Owner Feature | Notes |
|------|------|-------|---------|---------------|--------|---------|--------|---------------|-------|
| CartProvider | `src/components/cart/cart-provider.tsx` | provider | Root layout | Yes | items, count, subtotalCents, hydrated | localStorage | Healthy | Cart | Cart state, localStorage sync, cross-tab sync |
| FavoritesProvider | `src/components/favorites/favorites-provider.tsx` | provider | Root layout | Yes | favoriteIds, hydrated | Server (DB) | Locked | Favorites | Favorites state, server sync, optimistic updates; single source for favorite mutations |
| FavoriteButton | `src/components/favorites/favorite-button.tsx` | component | ProductCard, ProductDetailSticky, Wishlist | Yes | - | - | Locked | Favorites | Must call `useFavorites().toggle`; must NOT import server actions directly |
| WishlistClient | `src/components/favorites/wishlist-client.tsx` | component | /account/wishlist | Yes | - | - | Healthy | Favorites | Renders wishlist; if filtering by `isFavorite`, depends on provider sync |
| SearchProvider | `src/components/search/search-provider.tsx` | provider | Root layout | Yes | open, query | - | Healthy | Search | Search overlay state |
| AuthProvider | `src/components/auth/auth-provider.tsx` | provider | Root layout | Yes | session | Server (NextAuth) | Healthy | Auth | NextAuth SessionProvider wrapper |
| ThemeProvider | `src/components/theme/theme-provider.tsx` | provider | Root layout | Yes | theme | localStorage | Healthy | Theme | next-themes provider |
| HeaderProvider | `src/components/layout/header-context.tsx` | provider | Root layout | Yes | title, categoryInfo | - | Healthy | Layout | Header state context |

**Evidence:** `src/app/layout.tsx` (lines 59-87, all providers), `src/components/*/provider.tsx` (6 files)

---

## 7. Hooks & Utilities (UI-facing)

UI component'lerinde kullanılan hook'lar ve utility fonksiyonları.

| Name | Path | Layer | Used In | Health | Owner Feature | Notes |
|------|------|-------|---------|--------|---------------|-------|
| useAuth | `src/hooks/use-auth.ts` | hook | Account pages | Healthy | Auth | NextAuth session wrapper |
| useCart | `src/components/cart/cart-provider.tsx` | hook | Cart, Product, Checkout | Healthy | Cart | CartProvider context hook |
| useFavorites | `src/components/favorites/favorites-provider.tsx` | hook | Product, Wishlist | Healthy | Favorites | FavoritesProvider context hook |
| useSearch | `src/components/search/search-provider.tsx` | hook | Header, SearchOverlay | Healthy | Search | SearchProvider context hook |
| useVoiceSearch | `src/hooks/use-voice-search.ts` | hook | SearchOverlay | Healthy | Search | Web Speech API wrapper, handles listening/errors & toast feedback |
| useHeaderContext | `src/components/layout/header-context.tsx` | hook | Header, CategoryHeaderSetter | Healthy | Layout | HeaderContext hook |
| cn | `src/lib/utils.ts` | util | Global (100+ kullanım) | Healthy | Global | clsx + tailwind-merge utility |
| formatPrice | `src/lib/format.ts` | util | Product, Cart, Checkout | Healthy | Global | Price formatting (TL) |
| formatPriceCents | `src/lib/format.ts` | util | Unknown | Healthy | Global | Price formatting (cents) |
| formatDate | `src/lib/format.ts` | util | Order pages | Healthy | Global | Date formatting (tr-TR) |
| getPrimaryImageUrl | `src/lib/format.ts` | util | Product cards | Healthy | Global | Image URL extractor |

**Evidence:** `src/hooks/*` (1 file), `src/lib/utils.ts`, `src/lib/format.ts`, grep (cn 100+ matches, formatPrice 20+ matches)

---

## 8. Route-to-Component Map (Critical Screens)

Kritik sayfalar ve kullandıkları component'ler.

### 8.1 Home (`/`)

- **Page:** `src/app/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `CategoryGrid` - Kategoriler grid'i
  - `LoadMoreGrid` - Yeni ürünler infinite scroll
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav`
  - `Footer`
- **Provider'lar:** Tüm provider'lar (layout.tsx'te)
- **Notlar:** Home sayfası, kategori ve ürün listesi

**Evidence:** `src/app/page.tsx`

### 8.2 Category/Listing (`/[slug]`)

- **Page:** `src/app/[slug]/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `CategoryHeaderSetter` - Header title setter
  - `ActiveFiltersBar` - Aktif filtreler
  - `LoadMoreGrid` - Ürün listesi infinite scroll
- **Layout Component'ler:**
  - `Header` (mobile) - CatalogControls ile
  - `MobileBottomNav`
- **Notlar:** Dynamic category route, filtreleme ve sıralama

**Evidence:** `src/app/[slug]/page.tsx`

### 8.3 Product Detail (`/urun/[slug]`)

- **Page:** `src/app/urun/[slug]/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `ProductView` - Ana ürün detay component'i
  - `HeaderTitle` - Dynamic header title
  - `FavoriteButton` - Favori butonu
- **Layout Component'ler:**
  - `Header` (mobile) - Back button
  - `MobileBottomNav` - Gizli (product detail'de gösterilmez)
- **Notlar:** Ürün detay sayfası, sticky action bar, galeri

**Evidence:** `src/app/urun/[slug]/page.tsx`, `src/components/product/product-view.tsx`

### 8.4 Cart (`/cart`)

- **Page:** `src/app/cart/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `CartView` (variant="page") - Sepet görünümü
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav` - Cart tab aktif
- **Notlar:** Sepet sayfası, drawer'dan farklı variant

**Evidence:** `src/app/cart/page.tsx`, `src/components/cart/cart-view.tsx`

### 8.5 Checkout (`/checkout`)

- **Page:** `src/app/checkout/page.tsx` (Client Component)
- **Ana Component'ler:**
  - `AddressForm` - Adres formu (drawer)
  - `Button`, `Input` - Form elemanları
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav`
- **Notlar:** Checkout sayfası, adres seçimi, ödeme yöntemi

**Evidence:** `src/app/checkout/page.tsx`

### 8.6 Order Success (`/order-success/[id]`)

- **Page:** `src/app/order-success/[id]/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `Button` - Devam et butonu
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav`
- **Notlar:** Sipariş başarı sayfası

**Evidence:** `src/app/order-success/[id]/page.tsx`

### 8.7 Search (`/search`)

- **Page:** `src/app/search/page.tsx` (Server Component)
- **Ana Component'ler:**
  - `SearchResultItem` - Arama sonuçları
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav`
- **Notlar:** Arama sayfası, SearchOverlay ayrı (layout'ta)

**Evidence:** `src/app/search/page.tsx`, `src/components/search/search-overlay.tsx`

### 8.8 Account Pages (`/account/*`)

- **Layout:** `src/app/account/layout.tsx`
- **Ana Component'ler:**
  - `AccountSidebar` - Hesap sidebar
  - `AddressList`, `AddressForm` - Adres yönetimi
  - `WishlistClient` - Favoriler listesi
- **Layout Component'ler:**
  - `Header` (mobile) / `DesktopHeader` (desktop)
  - `MobileBottomNav`
- **Notlar:** Hesap yönetimi sayfaları

**Evidence:** `src/app/account/*` (multiple pages)

---

## 9. Reusable vs One-off Classification

### Reusable Components (Birden çok yerde kullanılanlar)

- **Button** - 50+ kullanım (global)
- **Input** - 20+ kullanım (forms)
- **Badge** - 15+ kullanım (cart, orders, categories)
- **Dialog** - 5+ kullanım (search, modals)
- **Drawer** - 5+ kullanım (cart, filters, address)
- **ProductCard** - 10+ kullanım (catalog, wishlist, related)
- **CategoryGrid** - 2 kullanım (home, categories page)
- **LoadMoreGrid** - 2 kullanım (home, category pages)
- **AddressForm** - 2 kullanım (account, checkout)

**Evidence:** grep results (import counts)

### One-off Components (Tek route/feature'a özgü)

- **ProductView** - Sadece `/urun/[slug]` sayfasında
- **CartView** - Sadece `/cart` ve drawer'da (variant-based)
- **SearchOverlay** - Sadece layout'ta (global ama tek kullanım)
- **WishlistClient** - Sadece `/account/wishlist` sayfasında
- **OrderStatusForm** - Sadece `/admin/orders/[id]` sayfasında
- **StaticPage** - Sadece legal pages'te (multiple pages ama aynı pattern)

**Evidence:** grep results (single import locations)

---

## 10. Component Health

### 10.1 Missing Loading States

- **LoadMoreGrid** - ✅ Loading state var (button disabled)
- **CheckoutPage** - ✅ Loading state var (isLoading, button disabled)
- **AddressForm** - ✅ Loading state var (form submission)
- **LoginForm/SignupForm** - ✅ Loading state var (button disabled)
- **WishlistClient** - ✅ Loading state var (skeleton veya spinner gerekebilir, kontrol edilmeli)

**Assumption:** Çoğu component'te loading state mevcut. Eksik olanlar için kontrol gerekli.

### 10.2 Missing Empty States

- **CartView** - ✅ Empty state var (sepet boş mesajı)
- **WishlistClient** - ⚠️ Empty state kontrol edilmeli
- **AddressList** - ✅ Empty state var (adres yok mesajı)
- **ProductGrid** - ⚠️ Empty state kontrol edilmeli (ürün yoksa)
- **SearchResultItem** - ⚠️ Empty state kontrol edilmeli (sonuç yoksa)

**Assumption:** Bazı component'lerde empty state eksik olabilir. Kontrol edilmeli.

### 10.3 Missing Error States

- **LoadMoreGrid** - ⚠️ Error state kontrol edilmeli (API hata durumu)
- **ProductView** - ✅ Error state var (notFound())
- **CheckoutPage** - ✅ Error state var (error message display)
- **AddressForm** - ✅ Error state var (form validation errors)
- **LoginForm/SignupForm** - ✅ Error state var (form errors)

**Assumption:** Çoğu form component'inde error state var. API hataları için kontrol gerekli.

### 10.4 Potential A11y Gaps

- **Dialog/Drawer** - ✅ Radix primitives kullanılıyor (aria support)
- **Button** - ✅ focus-visible:ring var
- **Input** - ✅ focus-visible:ring var
- **ProductCard** - ⚠️ Image alt text kontrol edilmeli
- **CategoryGrid** - ⚠️ Image alt text kontrol edilmeli
- **MobileBottomNav** - ✅ aria-label, aria-current var
- **Header** - ✅ aria-label var (back button, search button)
- **ProductView Gallery** - ✅ aria-label var (slider buttons)

**Assumption:** Radix primitives kullanıldığı için çoğu a11y desteği mevcut. Image alt text'leri kontrol edilmeli.

---

## 11. Legacy / Deprecated / Candidates for Removal

### Unknown Usage (Kontrol Gerekli)

- **ProductDetailClient** (`src/components/product/detail/ProductDetailClient.tsx`) - Usage not found (no imports in src/app/** and src/components/**)
- **ProductDetailPage** (`src/components/product/product-detail-page.tsx`) - Usage not found (no imports in src/app/** and src/components/**)
- **ProductGallery** (`src/components/product/detail/ProductGallery.tsx`) - Usage not found (no imports in src/app/** and src/components/**)
- **AddToCartBar** (`src/components/cart/add-to-cart-bar.tsx`) - Usage not found (no imports in src/app/** and src/components/**)

**Action Required:** Bu component'lerin kullanım yerleri kontrol edilmeli. Kullanılmıyorsa kaldırılabilir veya deprecated olarak işaretlenebilir.

**Evidence:** grep results (Usage not found - no imports in src/app/** and src/components/**)

### Archive Exclusion

- `archive/**` klasörü tamamen yok sayıldı (plan gereği)
- `*.backup`, `*.bak`, `*.old` dosyaları yok sayıldı

**Evidence:** Plan requirements, `tsconfig.json` (archive exclusion)

---

## 12. Open Gaps

### 12.1 Component Gaps

- **Skeleton** - Loading placeholder component var ama kullanılmıyor. Nerede kullanılmalı?
- **Textarea** - Core UI'da yok, gerekiyorsa eklenmeli
- **Select** - Core UI'da yok, gerekiyorsa eklenmeli (şu an Input kullanılıyor)
- **Toast/Toaster** - Sonner kullanılıyor ama UI component yok (direct import)

**Assumption:** Skeleton kullanılmıyor çünkü loading state'ler farklı şekilde handle ediliyor. Textarea ve Select gerekirse eklenebilir.

### 12.2 State Management Gaps

- **Error Boundaries** - Global error boundary component yok
- **Loading States** - Global loading component yok (Skeleton var ama kullanılmıyor)
- **Empty States** - Global empty state component yok (her component kendi empty state'i var)

**Assumption:** Error boundaries ve global loading/empty state component'leri eklenebilir.

### 12.3 A11y Gaps

- **Skip to content** - Skip link yok
- **Focus management** - Dialog açıldığında focus trap kontrol edilmeli
- **Keyboard navigation** - Tüm interaktif element'lerde keyboard support kontrol edilmeli

**Assumption:** Radix primitives focus management yapıyor ama global skip link eklenebilir.

---

## 13. Evidence Index

En önemli kanıt dosyaları ve bölümleri:

1. `src/components/ui/*` - Core UI components (15 files)
2. `src/components/layout/*` - Layout components (5 files)
3. `src/components/app/*` - App-level components (5 layout files)
4. `src/components/product/*` - Product components (6 files)
5. `src/components/cart/*` - Cart components (6 files)
6. `src/components/catalog/*` - Catalog components (7 files)
7. `src/components/account/*` - Account components (4 files)
8. `src/components/auth/*` - Auth components (3 files)
9. `src/components/search/*` - Search components (3 files)
10. `src/components/favorites/*` - Favorites components (3 files)
11. `src/components/admin/*` - Admin components (2 files)
12. `src/components/content/*` - Content components (2 files)
13. `src/components/theme/*` - Theme components (2 files)
14. `src/app/layout.tsx` - Root layout, provider setup (lines 59-87)
15. `src/app/page.tsx` - Home page component usage
16. `src/app/urun/[slug]/page.tsx` - Product detail page
17. `src/app/cart/page.tsx` - Cart page
18. `src/app/checkout/page.tsx` - Checkout page
19. `src/hooks/use-auth.ts` - Auth hook
20. `src/lib/utils.ts` - cn utility
21. `src/lib/format.ts` - Format utilities
22. `package.json` - Dependencies (next@16.1.1, react@19.2.3)
23. `04.design-system.md` - Design system reference
24. `06.frontend-standards-2026.md` - Frontend standards reference
25. grep results - Component import/usage patterns

**Total Components:** ~60 component files (excluding types, stores, utilities)

---

**Last verified from package.json:** 2025-12-31  
**Hazırlayan:** AI Assistant (Cursor)  
**Doğrulama:** Manuel kontrol gerekli (özellikle Legacy/Deprecated bölümü)
---

# DOC-08: 08.api-contracts-frontend.md

---
# 08. API Contracts - Frontend

Bu doküman, Cinselhobi.com Next projesindeki frontend'in konuştuğu tüm API sözleşmelerini "tek doğru kaynak" olarak tanımlar. Amaç: AI asistanların (Cursor/Cursor) uydurma endpoint/alan üretmesini engellemek ve mevcut API contract'larını doğru şekilde kullanmasını sağlamak.

**Last verified from package.json:** 2025-12-31  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose & Scope

Bu doküman şunları kapsar:

1. **Route Handlers (App Router API):** `/api/*` endpoint'leri, request/response şekilleri, auth kontrolü
2. **Server Actions:** `src/actions/*` içindeki server action'lar, input/output şekilleri
3. **External APIs:** Frontend'den direkt çağrılan harici API'ler (varsa)
4. **Authentication & Session:** Auth.js v5 (NextAuth.js) kullanımı, session yönetimi
5. **Global Conventions:** Headers, error format, pagination, caching kuralları
6. **Data Types & Schemas:** Zod validation şemaları, TypeScript type'ları

Bu doküman şunları kapsamaz:

- Backend/DB query detayları (sadece API contract'ları)
- WooCommerce import script API çağrıları (frontend'den kullanılmıyor)
- Internal Drizzle ORM query'leri (sadece API response shape'leri)

**Evidence:** `src/app/api/`, `src/actions/`, `02.architecture-lock.md` (lines 250-264)

---

## 2. Base URLs & Environments (Frontend)

### 2.1 Internal API Routes

Frontend, internal API route'larına **relative path** ile erişir:
- Base URL: Yok (relative path kullanılıyor)
- Pattern: `/api/*`
- Örnek: `fetch("/api/products")`, `fetch("/api/search?q=...")`

**Evidence:** `src/components/catalog/load-more-grid.tsx` (line 54: `new URL("/api/products", window.location.origin)`), `src/components/search/search-overlay.tsx` (line 144: `fetch(\`/api/search?q=...\`)`), `src/components/product/product-detail-page.tsx` (line 88: `fetch(\`/api/products/${slug}\`)`)

### 2.2 Environment Variables (Frontend Perspective)

Frontend'den kullanılan environment variable'lar:

- **As of repo scan (2025-12-31):** Frontend'de `NEXT_PUBLIC_*` env variable'ları kullanılmıyor (kanıt: grep sonucu boş)
- **Backend env'ler:** `DATABASE_URL`, `AUTH_SECRET`, `AUTH_URL` backend'de kullanılıyor, frontend'den erişilmiyor

**Assumption:** Frontend tüm API çağrılarını relative path ile yapıyor, external API base URL'i yok.

**Evidence:** `grep -r "NEXT_PUBLIC_"` (sonuç: 0 dosya, scan date: 2025-12-31), `01.project-brief.md` (lines 220-232: env variables backend-only)

---

## 3. Authentication & Session

### 3.1 Auth Provider

- **Library:** NextAuth.js v5 (Auth.js v5)
- **Strategy:** JWT (session strategy: "jwt")
- **Provider:** Credentials (email/password)
- **Adapter:** DrizzleAdapter (PostgreSQL)

**Evidence:** `src/auth.ts` (lines 21-71), `src/auth.config.ts` (lines 18-20: `strategy: "jwt"`), `package.json` (next-auth dependency)

### 3.2 Session Management

- **Cookie-based:** NextAuth.js otomatik cookie yönetimi
- **Session access:** Server Component'lerde `await auth()`, Client Component'lerde `useAuth()` hook
- **Session shape:** `{ user: { id: string, email: string, name: string, role?: "admin" | "user" } }`

**Evidence:** `src/auth.ts` (line 21: `export const { handlers, signIn, signOut, auth }`), `src/types/auth.ts` (lines 3-22: Session/User/JWT type extensions), `src/hooks/use-auth.ts` (useAuth hook)

### 3.3 Auth Endpoints

- **NextAuth catch-all:** `/api/auth/[...nextauth]` (GET, POST)
- **Signup:** `/api/auth/signup` (POST)
- **Sign in/out:** NextAuth.js client-side helpers (`signIn`, `signOut` from `next-auth/react`)

**Evidence:** `src/app/api/auth/[...nextauth]/route.ts` (lines 1-5: `export const { GET, POST } = handlers`), `src/app/api/auth/signup/route.ts` (POST handler)

### 3.4 Protected Routes

- **Auth check:** Server Component'lerde `const session = await auth(); if (!session) { redirect("/login") }`
- **Client check:** `useAuth()` hook ile `isAuthenticated` kontrolü
- **Admin check:** `session.user.role === "admin"` kontrolü

**Evidence:** `src/actions/checkout.ts` (line 23: `if (!session?.user?.id) return { ok: false, error: "Unauthorized" }`), `src/actions/admin.ts` (lines 30-35: admin role check), `src/app/order-success/[id]/page.tsx` (auth check - referenced in 03.routes-and-navigation-map.md)

---

## 4. Global Conventions

### 4.1 Headers

#### Request Headers

- **Content-Type:** `application/json` (POST/PUT request'lerde)
- **Authorization:** Yok (cookie-based auth, NextAuth.js otomatik yönetiyor)

**Evidence:** `src/components/auth/signup-form.tsx` (line 31: `headers: { "Content-Type": "application/json" }`)

#### Response Headers

- **Content-Type:** `application/json` (API route'larında)
- **Cache-Control:** `no-store` (`/api/products` route'unda)

**Evidence:** `src/app/api/products/route.ts` (lines 145-149: `headers: { "Content-Type": "application/json", "Cache-Control": "no-store" }`)

### 4.2 Error Format

#### Route Handler Error Format

- **Shape:** `{ error: string }` (JSON)
- **Status codes:** 400 (Bad Request), 404 (Not Found), 500 (Internal Server Error)
- **Examples:**
  - `{ error: "Slug is required" }` (400)
  - `{ error: "Product not found" }` (404)
  - `{ error: "Kayıt sırasında bir hata oluştu." }` (500)

**Evidence:** `src/app/api/products/[slug]/route.ts` (lines 46, 52: error responses), `src/app/api/auth/signup/route.ts` (lines 15-18, 29-32, 53-56: error responses), `src/app/api/search/route.ts` (lines 100-105: error response)

#### Server Action Error Format

- **Shape:** `{ ok: false, error: string | "Unauthorized" | "Validation error", errors?: ZodError[] }`
- **Success shape:** `{ ok: true, ...data }`
- **Examples:**
  - `{ ok: false, error: "Unauthorized" }`
  - `{ ok: false, error: "Validation error", errors: [...] }`
  - `{ ok: true, orderId: "..." }`

**Evidence:** `src/actions/checkout.ts` (lines 24, 37, 40-44: error/success patterns), `src/actions/address.ts` (lines 30, 38-43: error patterns), `src/actions/favorites.ts` (lines 14, 35: error patterns)

### 4.3 Pagination / Filter / Sort

#### Cursor-based Pagination

- **Query params:** `cursor` (number, optional), `limit` (number, 1-50, default: PRODUCTS_PER_PAGE)
- **Response:** `{ products: Product[], nextCursor: number | null }`
- **Next cursor:** `nextCursor === null` ise son sayfa

**Evidence:** `src/app/api/products/route.ts` (lines 17-18, 29-35, 37-44, 140-143: cursor pagination), `src/components/catalog/load-more-grid.tsx` (lines 56-58, 84, 100-104: cursor usage)

#### Filtering

- **Query params:**
  - `categorySlug` (string, optional)
  - `min` (number, TL cinsinden, optional)
  - `max` (number, TL cinsinden, optional)
  - `inStock` ("1" | "true", optional)
  - `sub` (string, comma-separated wcId'ler, optional)
  - `subCategoryIds` (string, comma-separated internal id'ler, optional, deprecated)

**Evidence:** `src/app/api/products/route.ts` (lines 19-26, 53-103: filter parsing), `src/components/catalog/load-more-grid.tsx` (lines 59-76: filter usage)

#### Sorting

- **Query param:** `sort` (string, optional)
- **Valid values:** `"newest"` (default), `"price_asc"`, `"price_desc"`, `"name_asc"`

**Evidence:** `src/app/api/products/route.ts` (lines 20, 47-51: sort parsing), `src/components/catalog/load-more-grid.tsx` (line 63: sort usage)

### 4.4 Caching Rules

#### Route Handler Caching

- **Dynamic mode:** Some route handlers explicitly set `export const dynamic = "force-dynamic"` (e.g., products routes). Others do not explicitly declare it; default behavior applies.
- **Revalidate:** `export const revalidate = 0` (`/api/products` route'unda)
- **Cache-Control:** `no-store` header (`/api/products` route'unda)

**Evidence:** `src/app/api/products/route.ts` (lines 9-10: `dynamic = "force-dynamic"`, `revalidate = 0`), `src/app/api/products/[slug]/route.ts` (line 4: `dynamic = "force-dynamic"`), `src/app/api/products/[slug]/related/route.ts` (line 4: `dynamic = "force-dynamic"`), `src/app/api/search/route.ts` (no cache config, defaults to dynamic)

---

## 5. API Inventory (Route Handlers)

| Endpoint | Methods | File Path | Auth | Inputs | Response | Errors | Notes |
|----------|---------|-----------|------|--------|----------|--------|-------|
| `/api/products` | GET | `src/app/api/products/route.ts` | Optional (userId from session) | Query: `limit`, `cursor`, `categorySlug`, `sort`, `min`, `max`, `inStock`, `sub`, `subCategoryIds` | `{ products: Product[], nextCursor: number \| null }` | 500 (try-catch) | Cursor pagination, filtering, sorting. Cache: no-store |
| `/api/products/[slug]` | GET | `src/app/api/products/[slug]/route.ts` | Public | Path: `slug` (string) | `{ id, wcId, slug, name, description, shortDescription, price, regularPrice, salePrice, currency, images, sku, stockStatus, stockQuantity }` | 400 (slug required), 404 (not found) | Product detail API |
| `/api/products/[slug]/related` | GET | `src/app/api/products/[slug]/related/route.ts` | Public | Path: `slug` (string) | `Product[]` (10 items, first image only) | 400 (slug required) | Related products (10 items) |
| `/api/search` | GET | `src/app/api/search/route.ts` | Public | Query: `q` (string, required), `limit` (number, max 20, default 8) | `{ items: Product[], categories: Category[], fallbackCategory: Category \| null, fallbackItems: Product[] }` | 500 (try-catch, returns empty arrays) | Search API, returns empty arrays on error |
| `/api/auth/[...nextauth]` | GET, POST | `src/app/api/auth/[...nextauth]/route.ts` | Public | NextAuth.js catch-all | NextAuth.js responses | NextAuth.js errors | NextAuth.js endpoints (signin, signout, callback, etc.) |
| `/api/auth/signup` | POST | `src/app/api/auth/signup/route.ts` | Public | Body: `{ name: string, email: string, password: string }` | `{ message: string }` (201) | 400 (validation), 500 (server error) | User registration, Argon2id hash |

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/products/[slug]/route.ts`, `src/app/api/products/[slug]/related/route.ts`, `src/app/api/search/route.ts`, `src/app/api/auth/[...nextauth]/route.ts`, `src/app/api/auth/signup/route.ts`

---

## 6. API Inventory (External / Remote APIs)

**As of repo scan (2025-12-31):** Frontend'den direkt external API çağrısı yok. Tüm API çağrıları internal route handler'lar veya server actions üzerinden yapılıyor.

**Evidence:** `grep -r "fetch("` (tüm fetch çağrıları `/api/*` pattern'i, scan date: 2025-12-31), `codebase_search` (external API base URL yok)

---

## 7. Contracts by Feature

### 7.1 Product

#### List Products

- **Endpoint:** `GET /api/products`
- **Query params:** `limit`, `cursor`, `categorySlug`, `sort`, `min`, `max`, `inStock`, `sub`
- **Response:** `{ products: Product[], nextCursor: number | null }`
- **Product shape:** `{ id, wcId, name, slug, price, images, stockStatus, isFavorite? }`
- **Usage:** `src/components/catalog/load-more-grid.tsx`

**Evidence:** `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx` (lines 54-84)

#### Get Product Detail

- **Endpoint:** `GET /api/products/[slug]`
- **Response:** `{ id, wcId, slug, name, description, shortDescription, price, regularPrice, salePrice, currency, images: Array<{ src: string, alt?: string }>, sku, stockStatus, stockQuantity }`
- **Usage:** `src/components/product/product-detail-page.tsx`

**Evidence:** `src/app/api/products/[slug]/route.ts` (lines 57-72), `src/components/product/product-detail-page.tsx` (lines 88-99)

#### Get Related Products

- **Endpoint:** `GET /api/products/[slug]/related`
- **Response:** `Product[]` (10 items, first image only)
- **Usage:** Unknown (component'te kullanım bulunamadı)

**Evidence:** `src/app/api/products/[slug]/related/route.ts` (lines 49-66)

### 7.2 Cart

- **API route yok:** Cart state client-side (localStorage/context) yönetiliyor
- **Server action yok:** Cart işlemleri client-side

**Evidence:** `codebase_search` (cart API route yok), `src/components/cart/` (client-side cart management)

### 7.3 Checkout

- **Server Action:** `createOrderAction` (`src/actions/checkout.ts`)
- **Input:** `{ addressId: number, paymentMethod: "credit_card" | "cod", cartItems: Array<{ productId: number, quantity: number }> }`
- **Output:** `{ ok: true, orderId: string }` veya `{ ok: false, error: string, errors?: ZodError[] }`
- **Auth:** Required (Unauthorized döner)
- **Usage:** `src/app/checkout/page.tsx`

**Evidence:** `src/actions/checkout.ts` (lines 7-18, 20-49), `src/app/checkout/page.tsx`

### 7.4 Orders

- **Server Action:** `updateOrderStatus` (`src/actions/admin.ts`)
- **Input:** `orderId: string, newStatus: "pending" | "processing" | "shipped" | "delivered" | "cancelled"`
- **Output:** `{ success: boolean, error?: string }`
- **Auth:** Required, Admin role required
- **Usage:** `src/app/admin/orders/`

**Evidence:** `src/actions/admin.ts` (lines 16-71), `src/app/admin/orders/`

### 7.5 Account/Auth

#### Sign Up

- **Endpoint:** `POST /api/auth/signup`
- **Input:** `{ name: string, email: string, password: string }`
- **Output:** `{ message: string }` (201) veya `{ error: string }` (400/500)
- **Usage:** `src/components/auth/signup-form.tsx`

**Evidence:** `src/app/api/auth/signup/route.ts` (lines 10-58), `src/components/auth/signup-form.tsx` (lines 29-33)

#### Sign In/Out

- **NextAuth.js client helpers:** `signIn("credentials", { email, password, redirect })`, `signOut({ redirect })`
- **Usage:** `src/components/auth/login-form.tsx`

**Evidence:** `src/auth.ts` (exported signIn/signOut), `src/components/auth/login-form.tsx`

#### Favorites

- **Server Actions:**
  - `toggleFavoriteAction(productId: number)`: `{ ok: boolean, isFavorite: boolean, error?: string }`
  - `getMyFavoritesAction()`: `{ ok: boolean, favorites: Product[], error?: string }`
  - `checkIsFavoriteAction(productId: number)`: `{ ok: boolean, isFavorite: boolean }`
  - `getMyFavoriteProductIdsAction()`: `{ ok: boolean, productIds: number[], error?: string }`
- **Auth:** Required (Unauthorized döner)
- **Usage:** `src/components/favorites/favorite-button.tsx`

**Evidence:** `src/actions/favorites.ts` (lines 7-88), `src/components/favorites/favorite-button.tsx` (line 69: `toggleFavoriteAction`)

#### Addresses

- **Server Actions:**
  - `addAddressAction(data)`: `{ ok: boolean, address?: Address, error?: string, errors?: ZodError[] }`
  - `getAddressesAction()`: `{ ok: boolean, addresses: Address[], error?: string }`
  - `deleteAddressAction(addressId)`: `{ ok: boolean, error?: string }`
  - `updateAddressAction(addressId, data)`: `{ ok: boolean, address?: Address, error?: string, errors?: ZodError[] }`
- **Auth:** Required
- **Usage:** `src/components/account/address-form.tsx`, `src/components/account/address-list.tsx`

**Evidence:** `src/actions/address.ts` (lines 13-24, 26-119), `src/components/account/address-form.tsx`, `src/components/account/address-list.tsx`

### 7.6 Search

- **Endpoint:** `GET /api/search`
- **Query params:** `q` (string, required), `limit` (number, max 20, default 8)
- **Response:** `{ items: Product[], categories: Category[], fallbackCategory: Category | null, fallbackItems: Product[] }`
- **Error handling:** Try-catch, returns empty arrays on error
- **Usage:** `src/components/search/search-overlay.tsx`

**Evidence:** `src/app/api/search/route.ts` (lines 8-107), `src/components/search/search-overlay.tsx` (lines 144-152)

---

## 8. Data Types & Shared Schemas

### 8.1 Zod Schemas

#### Checkout Schema

- **File:** `src/actions/checkout.ts`
- **Schema:**
```typescript
z.object({
  addressId: z.number().int().positive(),
  paymentMethod: z.enum(["credit_card", "cod"]),
  cartItems: z.array(z.object({
    productId: z.number().int().positive(),
    quantity: z.number().int().positive().max(99),
  })).min(1),
})
```

**Evidence:** `src/actions/checkout.ts` (lines 7-18)

#### Address Schema

- **File:** `src/actions/address.ts`
- **Schema:**
```typescript
z.object({
  title: z.string().min(1).max(100),
  fullAddress: z.string().min(5).max(500),
  city: z.string().min(1).max(100),
  district: z.string().min(1).max(100),
  phone: z.string().min(10).max(20).regex(/^[0-9+\-\s()]+$/),
  isDefault: z.boolean().optional(),
})
```

**Evidence:** `src/actions/address.ts` (lines 13-24)

### 8.2 TypeScript Types

#### Auth Types

- **File:** `src/types/auth.ts`
- **Extensions:** NextAuth Session, User, JWT interfaces
- **Shape:** `{ id: string, role?: "admin" | "user" }`

**Evidence:** `src/types/auth.ts` (lines 3-22)

#### Product Types

- **Inferred from API responses:** Product shape API route'larından çıkarılıyor
- **No shared type file:** Product type'ları component'lerde inline tanımlı

**Evidence:** `src/components/catalog/load-more-grid.tsx` (lines 6-15: Product interface), `src/app/api/products/[slug]/route.ts` (response shape)

---

## 9. Mocking & Testing Notes

- **MSW:** Unknown (codebase'de MSW kullanımı bulunamadı)
- **Fixtures/Mock data:** Unknown (test dosyaları yok)
- **API tests:** Unknown (test framework kurulumu yok)

**Evidence:** `01.project-brief.md` (line 29: "Test framework kurulumu (şu an test dosyası yok)"), `grep -r "msw\|@testing-library"` (sonuç: 0)

---

## 10. Breaking-Change Rules (Hard)

1. **Contract alanları değişirse:** Versioning/feature flag veya migration plan zorunlu
2. **FE "Unknown field" eklemeye toleranslı olmalı:** Response'larda yeni field'lar eklenebilir, FE ignore edebilmeli
3. **Cursor/Cursor uydurma endpoint/alan yazamaz:** Bu doküman tek kaynak, yeni endpoint/alan eklemek için bu doküman güncellenmeli
4. **Server Action return shape değişirse:** Tüm client-side kullanımlar güncellenmeli
5. **Zod schema değişirse:** Validation error'ları client-side handle edilmeli

**Evidence:** `02.architecture-lock.md` (breaking change rules), `06.frontend-standards-2026.md` (API standards)

---

## 11. Open Questions

1. **Ödeme sağlayıcı entegrasyonu var mı?** `paymentMethod: "credit_card"` tanımlı ama payment gateway entegrasyonu yok (Unknown)
2. **Stok doğrulama nerede yapılıyor?** Checkout'ta stok kontrolü var mı? (Unknown)
3. **Auth refresh token var mı?** NextAuth.js JWT strategy kullanılıyor, refresh token mekanizması Unknown
4. **Rate limiting var mı?** API route'larında rate limiting yok (Unknown)
5. **API versioning stratejisi var mı?** Versioning yok, breaking change'ler için plan Unknown
6. **Webhook endpoint'leri var mı?** External webhook'lar için endpoint'ler Unknown
7. **File upload endpoint'i var mı?** Kullanıcı profil fotoğrafı veya diğer upload'lar için endpoint Unknown
8. **Email verification var mı?** Signup'ta email verification mekanizması Unknown
9. **Password reset endpoint'i var mı?** Password reset flow'u Unknown
10. **Order tracking endpoint'i var mı?** Sipariş takibi için external API entegrasyonu Unknown

**Evidence:** `src/actions/checkout.ts` (paymentMethod enum var ama gateway yok), `src/app/api/auth/signup/route.ts` (email verification yok), codebase_search (rate limiting, webhook, file upload bulunamadı)

---

## 12. Evidence Index

1. `src/app/api/products/route.ts` - Products list API, cursor pagination, filtering
2. `src/app/api/products/[slug]/route.ts` - Product detail API
3. `src/app/api/products/[slug]/related/route.ts` - Related products API
4. `src/app/api/search/route.ts` - Search API
5. `src/app/api/auth/[...nextauth]/route.ts` - NextAuth.js catch-all
6. `src/app/api/auth/signup/route.ts` - Signup API
7. `src/actions/checkout.ts` - Checkout server action, Zod schema
8. `src/actions/favorites.ts` - Favorites server actions
9. `src/actions/address.ts` - Address server actions, Zod schema
10. `src/actions/admin.ts` - Admin server actions
11. `src/auth.ts` - NextAuth.js config, JWT strategy
12. `src/auth.config.ts` - Auth config, session strategy
13. `src/types/auth.ts` - Auth TypeScript type extensions
14. `src/components/catalog/load-more-grid.tsx` - Products API usage, cursor pagination
15. `src/components/product/product-detail-page.tsx` - Product detail API usage
16. `src/components/search/search-overlay.tsx` - Search API usage
17. `src/components/auth/signup-form.tsx` - Signup API usage
18. `src/components/favorites/favorite-button.tsx` - Favorites server action usage
19. `src/components/account/address-form.tsx` - Address server action usage
20. `src/hooks/use-auth.ts` - Auth hook
21. `package.json` - Dependencies (next-auth, zod, react-hook-form)
22. `02.architecture-lock.md` - Architecture, API patterns
23. `03.routes-and-navigation-map.md` - Route table, API routes
24. `06.frontend-standards-2026.md` - Error handling, validation standards
25. `01.project-brief.md` - Environment variables, API overview

---

## 13. Self-Check

- [x] Uydurma yok (tüm endpoint'ler kanıtlı)
- [x] `.env` değerleri yok, sadece key isimleri var
- [x] Route handler inventory tam (6 endpoint)
- [x] Client-side fetch/wrapper envanteri var (load-more-grid, search-overlay, product-detail-page, signup-form)
- [x] En az 20 evidence var (25 evidence listelendi)

---
---

# DOC-09: 09.data-fetching-cache-rules.md

---
# 09. Data Fetching & Cache Rules

Bu doküman, Cinselhobi.com Next projesinin veri getirme, cache/ISR, client vs server fetch, mutation/optimistic UI ve invalidation kurallarını tanımlar. Amaç: AI asistanların (Cursor/Cursor) yanlış cache, yanlış fetch yeri ve gereksiz client state üretmesini engellemek ve tutarlı veri yönetimi sağlamak.

**Last verified from package.json:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

Bu doküman şu konuları kilitler:

1. **Doğru fetch yeri:** Server Component vs Client Component kararları, ne zaman nerede fetch yapılacağı
2. **Doğru cache stratejisi:** API route cache ayarları, revalidation pattern'leri, ISR kullanımı
3. **Doğru invalidation:** Mutation sonrası cache invalidation (revalidatePath/revalidateTag)
4. **Optimistic UI pattern'leri:** Client-side optimistic update + server sync + rollback
5. **localStorage hydration:** Client state'in server'dan hydrate edilmesi (cart, favorites, search)
6. **Error handling & retry:** Network error'lar, retry stratejileri, edge case'ler

**Evidence:** Bu doküman, repo'daki mevcut pattern'leri analiz ederek oluşturulmuştur.

---

## 2. Current Data Sources (Observed)

### 2.1 Database (PostgreSQL via Drizzle ORM)
- **Server Components:** Direct DB queries (`src/db/queries/` fonksiyonları)
- **API Routes:** Direct DB queries (`db` instance kullanımı)
- **Server Actions:** Direct DB queries (mutations için)

**Evidence:** `src/app/page.tsx` (lines 11-14: `getTopCategories`, `getLatestProductsCursor`), `src/app/api/search/route.ts` (lines 27-36: direct DB queries), `src/actions/checkout.ts` (line 4: `createOrder` query)

### 2.2 API Routes (Internal)
- `/api/products`: Cursor-based pagination, filtreleme
- `/api/products/[slug]`: Ürün detay
- `/api/products/[slug]/related`: İlgili ürünler
- `/api/search`: Arama (ürün + kategori)

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/products/[slug]/route.ts`, `src/app/api/search/route.ts`

### 2.3 Server Actions
- `src/actions/checkout.ts`: Sipariş oluşturma
- `src/actions/address.ts`: Adres CRUD
- `src/actions/favorites.ts`: Favori toggle/list
- `src/actions/admin.ts`: Admin mutations (sipariş durumu güncelleme)

**Evidence:** `src/actions/checkout.ts` (line 1: `"use server"`), `src/actions/favorites.ts` (line 1: `"use server"`)

### 2.4 localStorage
- **Cart:** `CART_STORAGE_KEY` ile sepet state'i persist edilir
- **Search:** `RECENT_SEARCHES_KEY` ile son aramalar saklanır
- **Tab scroll:** `sessionStorage` ile scroll position kaydedilir

**Evidence:** `src/components/cart/cart-store.ts` (line 16: `localStorage.getItem(CART_STORAGE_KEY)`), `src/components/search/search-overlay.tsx` (line 43: `localStorage.getItem(RECENT_SEARCHES_KEY)`), `src/components/app/tab-scroll.ts` (line 17: `sessionStorage.setItem`)

### 2.5 Session/Auth Data
- **NextAuth.js:** `auth()` helper ile session bilgisi
- **Client-side:** `useSession()` hook (next-auth/react)

**Evidence:** `package.json` (dependencies: next-auth@5.0.0-beta.25), `src/app/page.tsx` (line 8: `await auth()`), `src/components/favorites/favorites-provider.tsx` (line 18: `useSession()`)

---

## 3. Fetch Decision Tree (RSC vs Client)

### 3.1 Default: Server Components (RSC)
**Kural:** Varsayılan olarak Server Component'te fetch yapılır. SEO, performans ve initial load için tercih edilir.

**Kullanım Alanları:**
- Initial page data (kategoriler, ürün listesi, ürün detay)
- SEO-critical content (metadata, product details)
- Auth-required data (user-specific initial data)

**Pattern:**
```typescript
// Server Component (page.tsx)
export default async function Page() {
  const data = await getDataFromDB(); // Direct DB query
  return <ClientComponent initialData={data} />;
}
```

**Evidence:** `src/app/page.tsx` (lines 7-14: async Server Component, direct DB queries), `src/app/urun/[slug]/page.tsx` (line 72: async Server Component, `getProductBySlug`)

### 3.2 Client Fetch: Sadece Gerekli Durumlarda
**Kural:** Client Component'te fetch sadece şu durumlarda yapılır:
- **Interaktif/polling:** Real-time data, infinite scroll pagination
- **User-triggered:** Search overlay, filter changes
- **Optimistic UI:** Mutation sonrası immediate feedback

**Kullanım Alanları:**
- Infinite scroll pagination (`LoadMoreGrid`)
- Real-time search (`SearchOverlay`)
- Product detail fetch (Client Component içinde, AbortController ile)

**Pattern:**
```typescript
// Client Component
"use client";
useEffect(() => {
  fetch("/api/products").then(...);
}, [dependencies]);
```

**Evidence:** `src/components/catalog/load-more-grid.tsx` (lines 46-111: `useEffect` + `fetch`), `src/components/search/search-overlay.tsx` (lines 130-174: debounced search fetch), `src/components/product/product-detail-page.tsx` (lines 70-124: `useEffect` + `fetch` with AbortController)

### 3.3 Provider State (localStorage Hydration)
**Kural:** Cart, Favorites, Search gibi client state'ler:
1. Server'dan initial data alınır (auth varsa)
2. localStorage'dan hydrate edilir (client-side)
3. `hydrated` flag ile SSR/client mismatch önlenir

**Pattern:**
```typescript
// Provider
const [state, setState] = useState(initial);
const [hydrated, setHydrated] = useState(false);

useEffect(() => {
  setState(loadFromLocalStorage());
  setHydrated(true);
}, []);
```

**Evidence:** `src/components/cart/cart-provider.tsx` (lines 24-35: localStorage hydration), `src/components/favorites/favorites-provider.tsx` (lines 22-35: server fetch + hydration)

---

## 4. Server Data Fetching Rules

### 4.1 Direct DB Queries (Default)
**Kural:** Server Component'lerde varsayılan olarak Drizzle ORM ile direkt veritabanı sorguları yapılır. `fetch()` API'si kullanılmaz. İstisna durumlar için onay gerekir.

**Pattern:**
```typescript
import { getTopCategories } from "@/db/queries/catalog";

export default async function Page() {
  const categories = await getTopCategories(8);
  return <CategoryGrid categories={categories} />;
}
```

**Evidence:** `src/app/page.tsx` (lines 11-14: `getTopCategories`, `getLatestProductsCursor`), `src/app/[slug]/page.tsx` (lines 47-136: `getCategoryBySlug`, `getProductsCursor`)

### 4.2 Query Functions Location
**Kural:** Tüm query fonksiyonları `src/db/queries/` altında organize edilir.

**Evidence:** `src/db/queries/catalog.ts`, `src/db/queries/favorites.ts`, `src/db/queries/address.ts`, `src/db/queries/order.ts`

### 4.3 Auth Context in Server Components
**Kural:** Server Component'lerde `auth()` helper ile session bilgisi alınır, userId query'lere geçirilir.

**Pattern:**
```typescript
const session = await auth();
const userId = session?.user?.id ?? null;
const data = await getData({ userId });
```

**Evidence:** `src/app/page.tsx` (lines 8-9, 14: `auth()` + `userId`), `src/app/api/products/route.ts` (lines 13-14: `auth()` + `userId`)

### 4.4 Server Component Cache
**Kural:** Server Component'lerde explicit cache ayarı yok. Next.js default caching kullanılır.

**Evidence:** `src/app/page.tsx` (no `revalidate` or `dynamic` export), `src/app/urun/[slug]/page.tsx` (no cache config)

---

## 5. Client Data Fetching Rules

### 5.1 Fetch API (Native)
**Kural:** Client Component'lerde native `fetch` API kullanılır. Axios, got gibi HTTP client library'leri kullanılmaz.

**Pattern:**
```typescript
const response = await fetch("/api/products");
const data = await response.json();
```

**Evidence:** `src/components/catalog/load-more-grid.tsx` (line 78: `fetch(url.toString())`), `src/components/search/search-overlay.tsx` (line 144: `fetch(\`/api/search?q=...\`)`)

### 5.2 AbortController Pattern
**Kural:** Client Component'lerde hızlı değişen dependency'ler veya unmount riski olan fetch'lerde AbortController ile request'ler cancel edilebilir olmalı (component unmount, dependency change).

**Pattern:**
```typescript
const abortControllerRef = useRef<AbortController | null>(null);

useEffect(() => {
  if (abortControllerRef.current) {
    abortControllerRef.current.abort();
  }
  abortControllerRef.current = new AbortController();
  
  fetch(url, { signal: abortControllerRef.current.signal })
    .then(...)
    .catch(err => {
      if (err.name === "AbortError") return;
      // handle error
    });
    
  return () => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }
  };
}, [dependencies]);
```

**Evidence:** `src/components/product/product-detail-page.tsx` (lines 61, 76-120: AbortController pattern)

### 5.3 Error Handling
**Kural:** Client fetch'lerde try-catch ile error handling yapılır, error state yönetilir.

**Pattern:**
```typescript
const [error, setError] = useState<string | null>(null);

try {
  const res = await fetch(url);
  if (!res.ok) throw new Error("...");
  const data = await res.json();
  setData(data);
} catch (err) {
  setError(err instanceof Error ? err.message : "Bir hata oluştu");
}
```

**Evidence:** `src/components/catalog/load-more-grid.tsx` (lines 44, 79-81, 107: error state), `src/components/product/product-detail-page.tsx` (lines 59, 106-113: error handling)

### 5.4 Data Fetching Libraries
**Kural:** React Query, SWR, Zustand gibi data fetching library'leri kullanılmaz. Native fetch + Context API kullanılır.

**Evidence:** `package.json` (no react-query, swr, zustand dependencies), `src/components/catalog/load-more-grid.tsx` (native fetch)

---

## 6. Caching & Revalidation Strategy

### 6.1 API Route Cache Settings
**Kural:** Bazı API route handler'lar açıkça `dynamic = "force-dynamic"` ve/veya `revalidate = 0` set eder ve `Cache-Control: no-store` kullanır (örn. products route'ları). Diğerleri Next.js default'larına güvenebilir.

**Observed API Route Cache Configurations:**

| Endpoint | File | dynamic export? | revalidate export? | Cache-Control set? |
|----------|------|----------------|-------------------|-------------------|
| `/api/products` | `src/app/api/products/route.ts` | Yes (`force-dynamic`) | Yes (`0`) | Yes (`no-store`) |
| `/api/products/[slug]` | `src/app/api/products/[slug]/route.ts` | Yes (`force-dynamic`) | No | No |
| `/api/products/[slug]/related` | `src/app/api/products/[slug]/related/route.ts` | Yes (`force-dynamic`) | No | No |
| `/api/search` | `src/app/api/search/route.ts` | No | No | No |

**Evidence:** `src/app/api/products/route.ts` (lines 9-10, 148: `dynamic`, `revalidate`, `Cache-Control`), `src/app/api/products/[slug]/route.ts` (line 4: `dynamic`), `src/app/api/products/[slug]/related/route.ts` (line 4: `dynamic`), `src/app/api/search/route.ts` (no cache config exports)

### 6.2 Page-Level Cache
**Kural:** Page-level cache ayarları:
- `src/app/about/page.tsx`: `export const dynamic = "force-dynamic"`
- `src/app/account/wishlist/page.tsx`: `export const dynamic = "force-dynamic"`
- `src/app/not-found.tsx`: `export const dynamic = "force-dynamic"`

**Evidence:** `src/app/about/page.tsx` (line 3: `dynamic`), `src/app/account/wishlist/page.tsx` (line 6: `dynamic`)

### 6.3 Data Freshness Requirements
**Katalog/Listing:**
- **Freshness:** Real-time (force-dynamic, no-store)
- **Reason:** Fiyat, stok durumu, yeni ürünler anlık güncellenmeli

**Product Detail:**
- **Freshness:** Real-time (force-dynamic)
- **Reason:** Fiyat, stok, görseller güncel olmalı

**Cart:**
- **Freshness:** Client-side (localStorage), server sync yok
- **Reason:** Sepet client state, server'da persist edilmiyor

**Account (Auth):**
- **Freshness:** Session-based (NextAuth.js)
- **Reason:** Auth state session cookie ile yönetiliyor

**Evidence:** `src/app/api/products/route.ts` (force-dynamic, no-store), `src/components/cart/cart-provider.tsx` (localStorage only)

### 6.4 Cache Invalidation (revalidatePath)
**Kural:** Server Action'larda mutation sonrası `revalidatePath` ile ilgili sayfaların cache'i invalidate edilir.

**Pattern:**
```typescript
import { revalidatePath } from "next/cache";

export async function toggleFavoriteAction(productId: number) {
  // ... mutation
  revalidatePath("/", "layout");
  revalidatePath("/account/wishlist");
  revalidatePath("/urun/[slug]", "page");
}
```

**Evidence:** `src/actions/favorites.ts` (lines 4, 30-32: `revalidatePath`), `src/actions/admin.ts` (lines 7, 58-59: `revalidatePath`)

### 6.5 Cache Tags (revalidateTag)
**Kural:** `revalidateTag` kullanılmıyor. Sadece `revalidatePath` kullanılıyor.

**Evidence:** Codebase search (no `revalidateTag` usage found)

---

## 7. ISR / Revalidate Rules

### 7.1 ISR Usage
**Kural:** Tarama tarihi itibariyle (2025-01-27), page-level ISR export'ları tespit edilmedi. Tüm sayfalar force-dynamic veya default (dynamic) rendering kullanıyor.

**Evidence:** Codebase search (no `revalidate` export in page.tsx files except API routes)

### 7.2 Trade-off Notes
**Reasoning:** E-ticaret sitesi olduğu için:
- Fiyat, stok durumu anlık güncellenmeli (ISR uygun değil)
- Ürün listesi sık değişiyor (ISR cache hit rate düşük olur)
- User-specific data (favorites, cart) var (ISR ile uyumsuz)

**Evidence:** `src/app/api/products/route.ts` (force-dynamic), `src/app/page.tsx` (no ISR config)

---

## 8. Mutations & Optimistic UI

### 8.1 Server Actions Pattern
**Kural:** Tüm mutations Server Action olarak `src/actions/` altında tanımlanır. `"use server"` direktifi zorunlu.

**Pattern:**
```typescript
"use server";

export async function createOrderAction(data: z.infer<typeof schema>) {
  const session = await auth();
  if (!session?.user?.id) {
    return { ok: false, error: "Unauthorized" };
  }
  // ... validation, mutation
  return { ok: true, orderId: order.id };
}
```

**Evidence:** `src/actions/checkout.ts` (line 1: `"use server"`), `src/actions/address.ts` (line 1: `"use server"`), `src/actions/favorites.ts` (line 1: `"use server"`)

### 8.2 Optimistic UI (Favorites)
**Kural:** Favorites toggle'da optimistic update yapılır:
1. Client state hemen güncellenir (optimistic)
2. Server Action çağrılır
3. Hata durumunda rollback yapılır
4. Başarı durumunda server'dan gelen final state set edilir

**Pattern:**
```typescript
// Optimistic update
setFavoriteIds((prev) => {
  const next = new Set(prev);
  next.add(productId); // or delete
  return next;
});

// Server action
const result = await toggleFavoriteAction(productId);

if (!result.ok) {
  // Rollback
  setFavoriteIds((prev) => {
    const next = new Set(prev);
    // revert change
    return next;
  });
} else {
  // Final state from server
  setFavoriteIds((prev) => {
    const next = new Set(prev);
    if (result.isFavorite) next.add(productId);
    else next.delete(productId);
    return next;
  });
}
```

**Evidence:** `src/components/favorites/favorites-provider.tsx` (lines 52-99: optimistic update + rollback + final state)

### 8.3 Optimistic UI (Cart)
**Kural:** Cart'ta optimistic update yok. Client state direkt güncellenir (localStorage sync).

**Evidence:** `src/components/cart/cart-provider.tsx` (lines 48-57: direct state update, no server sync)

### 8.4 Feedback (Toast)
**Kural:** Mutation sonrası feedback Sonner toast ile gösterilir.

**Pattern:**
```typescript
import { toast } from "sonner";

toast.success("Ürün sepete eklendi");
```

**Evidence:** `src/components/product/product-view.tsx` (line 81: `toast.success`), `src/app/layout.tsx` (line 82: `<Toaster>`)

---

## 9. Error Handling, Retries, and Edge Cases

### 9.1 API Route Error Handling
**Kural:** API route'larda try-catch ile error handling yapılır, JSON error response döner.

**Pattern:**
```typescript
try {
  // ... logic
  return NextResponse.json({ data });
} catch (error) {
  console.error("Error:", error);
  return NextResponse.json({ error: "..." }, { status: 500 });
}
```

**Evidence:** `src/app/api/search/route.ts` (lines 25-106: try-catch), `src/app/api/products/[slug]/route.ts` (lines 46, 52: error responses)

### 9.2 Client Error Handling
**Kural:** Client Component'lerde error state yönetilir, kullanıcıya toast veya inline error gösterilir.

**Evidence:** `src/components/catalog/load-more-grid.tsx` (lines 44, 79-81: error state), `src/components/product/product-detail-page.tsx` (lines 59, 106-113: error handling)

### 9.3 Retry Strategy
**Kural:** Client-side retry pattern'i yok. Network error durumunda kullanıcı manuel retry yapmalı.

**Evidence:** `src/components/catalog/load-more-grid.tsx` (no retry logic), `src/components/search/search-overlay.tsx` (no retry logic)

### 9.4 Edge Cases
**Stock/Price Changes:**
- **Unknown:** Stock veya fiyat değişimi durumunda client-side validation yapılıyor mu bilinmiyor.

**AbortController Edge Cases:**
- Component unmount durumunda fetch cancel edilir (AbortController)
- Dependency change durumunda önceki request cancel edilir

**Evidence:** `src/components/product/product-detail-page.tsx` (lines 76-120: AbortController cleanup), `src/components/catalog/load-more-grid.tsx` (no stock/price validation)

---

## 10. Auth / Session Data Handling

### 10.1 Server-Side Auth
**Kural:** Server Component'lerde ve Server Action'larda `auth()` helper ile session bilgisi alınır.

**Pattern:**
```typescript
import { auth } from "@/auth";

const session = await auth();
const userId = session?.user?.id ?? null;
```

**Evidence:** `src/app/page.tsx` (line 8: `await auth()`), `src/actions/checkout.ts` (line 21: `await auth()`)

### 10.2 Client-Side Auth
**Kural:** Client Component'lerde `useSession()` hook (next-auth/react) kullanılır.

**Pattern:**
```typescript
import { useSession } from "next-auth/react";

const { data: session } = useSession();
const userId = session?.user?.id;
```

**Evidence:** `src/components/favorites/favorites-provider.tsx` (line 18: `useSession()`)

### 10.3 Auth-Required Data Fetching
**Kural:** Auth-required data fetch'lerde:
- Server Component: `auth()` ile kontrol, userId query'ye geçirilir
- Client Component: `useSession()` ile kontrol, auth yoksa login'e yönlendirilir

**Evidence:** `src/app/api/products/route.ts` (lines 13-14: `auth()` + `userId`), `src/components/favorites/favorites-provider.tsx` (lines 44-50: auth check + redirect)

### 10.4 Middleware
**Kural:** Middleware kullanımı bilinmiyor (codebase'de middleware.ts bulunamadı).

**Evidence:** Codebase search (no `middleware.ts` found)

---

## 11. Performance Notes

### 11.1 Minimize Client Fetch
**Kural:** Gereksiz client fetch'lerden kaçınılır. Initial data Server Component'te getirilir, client sadece pagination/infinite scroll için fetch yapar.

**Evidence:** `src/app/page.tsx` (initial products Server Component'te), `src/components/catalog/load-more-grid.tsx` (sadece "Load More" için fetch)

### 11.2 Pagination Pattern
**Kural:** Büyük listelerde cursor-based pagination kullanılır. Infinite scroll pattern ile "Load More" butonu.

**Pattern:**
```typescript
// Server Component: Initial data
const initialProducts = await getLatestProductsCursor({ limit, userId });
const initialCursor = getNextCursor(initialProducts, limit);

// Client Component: Load more
const handleLoadMore = async () => {
  const res = await fetch(`/api/products?cursor=${cursor}&limit=${limit}`);
  const { products: newProducts, nextCursor } = await res.json();
  setProducts([...products, ...newProducts]);
  setCursor(nextCursor);
};
```

**Evidence:** `src/app/page.tsx` (lines 14-15: initial cursor), `src/components/catalog/load-more-grid.tsx` (lines 46-111: load more pattern)

### 11.3 Deduplication
**Kural:** Infinite scroll'da duplicate ürünler önlenir (wcId bazlı dedup).

**Evidence:** `src/components/catalog/load-more-grid.tsx` (lines 86-93: dedup logic)

### 11.4 Debouncing (Search)
**Kural:** Search overlay'de debouncing kullanılır (300ms).

**Evidence:** `src/components/search/search-overlay.tsx` (lines 130-174: debounced search, `DEBOUNCE_MS` constant)

---

## 12. Do / Don't

### 12.1 DO

1. **DO:** Listing verisini Server Component'te getir (initial data için)
   - **Evidence:** `src/app/page.tsx` (lines 11-14: Server Component fetch)

2. **DO:** Cart gibi client state'i provider'da tut (localStorage sync ile)
   - **Evidence:** `src/components/cart/cart-provider.tsx` (localStorage pattern)

3. **DO:** Infinite scroll için Client Component'te fetch yap (pagination)
   - **Evidence:** `src/components/catalog/load-more-grid.tsx` (load more fetch)

4. **DO:** Mutation sonrası `revalidatePath` ile cache'i invalidate et
   - **Evidence:** `src/actions/favorites.ts` (lines 30-32: `revalidatePath`)

5. **DO:** AbortController ile fetch request'leri cancel et (component unmount)
   - **Evidence:** `src/components/product/product-detail-page.tsx` (lines 76-120: AbortController)

6. **DO:** Optimistic UI için rollback pattern'i kullan (error durumunda)
   - **Evidence:** `src/components/favorites/favorites-provider.tsx` (lines 68-78: rollback)

7. **DO:** `hydrated` flag ile SSR/client mismatch önle (localStorage hydration)
   - **Evidence:** `src/components/cart/cart-provider.tsx` (line 25: `hydrated` flag)

8. **DO:** Server Action'larda Zod validation kullan
   - **Evidence:** `src/actions/checkout.ts` (lines 7-18: Zod schema)

9. **DO:** Real-time data gereken API route'larda `force-dynamic` + `no-store` kullan (örn. products route)
   - **Evidence:** `src/app/api/products/route.ts` (lines 9-10, 148: dynamic + no-store)

10. **DO:** Error handling için try-catch + error state kullan
    - **Evidence:** `src/app/api/search/route.ts` (lines 25-106: try-catch), `src/components/catalog/load-more-grid.tsx` (error state)

### 12.2 DON'T

1. **DON'T:** Her component'te ayrı fetch wrapper uydurma (native fetch kullan)
   - **Evidence:** `src/components/catalog/load-more-grid.tsx` (native fetch, no wrapper)

2. **DON'T:** Cache kurallarını bozacak `no-store`'u rastgele yayma (sadece real-time data gereken API route'larda)
   - **Evidence:** `src/app/api/products/route.ts` (no-store sadece products route'da), `src/app/api/search/route.ts` (no cache config)

3. **DON'T:** Server Component'te varsayılan olarak `fetch()` kullanma (direct DB query kullan; istisna durumlar için onay gerekir)
   - **Evidence:** `src/app/page.tsx` (direct DB queries, no fetch)

4. **DON'T:** Client Component'te initial data fetch yapma (Server Component'ten prop geç)
   - **Evidence:** `src/app/page.tsx` (initial data Server Component'te, `LoadMoreGrid` prop alıyor)

5. **DON'T:** React Query/SWR gibi data fetching library ekleme (native fetch + Context API)
   - **Evidence:** `package.json` (no react-query, swr dependencies)

6. **DON'T:** ISR kullanma (force-dynamic tercih et, real-time data için)
   - **Evidence:** `src/app/api/products/route.ts` (force-dynamic, no ISR)

7. **DON'T:** `revalidateTag` kullanma (sadece `revalidatePath` kullan)
   - **Evidence:** Codebase search (no `revalidateTag` usage)

8. **DON'T:** localStorage'ı Server Component'te kullanma (sadece Client Component)
   - **Evidence:** `src/components/cart/cart-provider.tsx` (Client Component, localStorage)

9. **DON'T:** Hızlı değişen dependency'ler veya unmount riski olan fetch'lerde AbortController olmadan fetch yapma (memory leak riski)
   - **Evidence:** `src/components/product/product-detail-page.tsx` (AbortController pattern)

10. **DON'T:** Optimistic update'te rollback yapmadan error handle etme
    - **Evidence:** `src/components/favorites/favorites-provider.tsx` (lines 68-78: rollback pattern)

---

## 13. Open Gaps

### 13.1 Cache Invalidation
- **Gap:** `revalidateTag` kullanılmıyor, sadece `revalidatePath` var. Tag-based invalidation daha granular olabilir.
- **Impact:** Tüm sayfa invalidate ediliyor, tag-based daha performanslı olabilir.

**Evidence:** Codebase search (no `revalidateTag` usage)

### 13.2 Error Retry Strategy
- **Gap:** Client-side retry pattern'i yok. Network error durumunda kullanıcı manuel retry yapmalı.
- **Impact:** Geçici network error'larında kullanıcı deneyimi kötü.

**Evidence:** `src/components/catalog/load-more-grid.tsx` (no retry logic)

### 13.3 Stock/Price Validation
- **Gap:** Sepete ekleme sırasında stock/price validation yapılıyor mu bilinmiyor.
- **Impact:** Stok bitmiş veya fiyat değişmiş ürün sepete eklenebilir.

**Evidence:** `src/components/product/product-view.tsx` (no stock/price validation in `handleAddToCart`)

### 13.4 Performance Budget
- **Gap:** Data fetching için performance budget yok (max response time, max payload size).
- **Impact:** Yavaş query'ler veya büyük payload'lar tespit edilemiyor.

**Evidence:** Unknown (no performance monitoring)

### 13.5 Request Deduplication
- **Gap:** Aynı anda aynı request'lerin duplicate edilmesi önlenmiyor (request deduplication yok).
- **Impact:** Gereksiz network request'leri, server load.

**Evidence:** `src/components/search/search-overlay.tsx` (no request deduplication)

### 13.6 Offline Support
- **Gap:** Offline durumunda data caching yok (Service Worker, Cache API).
- **Impact:** Offline durumunda uygulama çalışmıyor.

**Evidence:** Unknown (no Service Worker, no Cache API usage)

---

## 14. Evidence Index

1. **src/app/page.tsx** - Server Component, direct DB queries, initial data fetch (lines 7-14)
2. **src/app/urun/[slug]/page.tsx** - Server Component, product detail fetch (line 72)
3. **src/app/[slug]/page.tsx** - Server Component, category page, direct DB queries (lines 38-173)
4. **src/app/api/products/route.ts** - API route, force-dynamic, revalidate=0, no-store header (lines 9-10, 148)
5. **src/app/api/products/[slug]/route.ts** - API route, force-dynamic, product detail (line 4)
6. **src/app/api/search/route.ts** - API route, direct DB queries, try-catch error handling (lines 8-107)
7. **src/components/catalog/load-more-grid.tsx** - Client Component, fetch API, infinite scroll, error state (lines 46-111)
8. **src/components/search/search-overlay.tsx** - Client Component, debounced search fetch (lines 130-174)
9. **src/components/product/product-detail-page.tsx** - Client Component, fetch with AbortController (lines 70-124)
10. **src/components/cart/cart-provider.tsx** - Client Component, localStorage hydration, hydrated flag (lines 23-35)
11. **src/components/favorites/favorites-provider.tsx** - Client Component, server fetch + hydration, optimistic UI (lines 17-109)
12. **src/actions/checkout.ts** - Server Action, "use server", Zod validation (lines 1-49)
13. **src/actions/favorites.ts** - Server Action, revalidatePath, optimistic UI support (lines 1-40)
14. **src/actions/address.ts** - Server Action, address CRUD (lines 1-64)
15. **src/actions/admin.ts** - Server Action, revalidatePath (lines 1-71)
16. **src/components/cart/cart-store.ts** - localStorage cart persistence (lines 16, 41)
17. **src/components/search/search-overlay.tsx** - localStorage recent searches (line 43)
18. **src/components/app/tab-scroll.ts** - sessionStorage scroll position (line 17)
19. **src/components/product/product-view.tsx** - Toast feedback, add to cart (line 81)
20. **src/app/layout.tsx** - Toaster component, toast system (line 82)
21. **src/db/queries/catalog.ts** - Query functions, direct DB access
22. **src/db/queries/favorites.ts** - Favorites queries
23. **src/db/queries/address.ts** - Address queries
24. **src/db/queries/order.ts** - Order queries
25. **src/auth.ts** - NextAuth.js config, auth() helper
26. **package.json** - NextAuth.js version (next-auth@5.0.0-beta.25)
27. **package.json** - Dependencies (no react-query, swr, zustand)
28. **src/app/about/page.tsx** - Page-level dynamic config (line 3)
29. **src/app/account/wishlist/page.tsx** - Page-level dynamic config (line 6)
30. **src/app/not-found.tsx** - Page-level dynamic config (line 4)
31. **src/components/catalog/load-more-grid.tsx** - Deduplication logic (lines 86-93)
32. **src/app/api/products/[slug]/related/route.ts** - API route, force-dynamic (line 4)

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni değişiklikler yapıldığında bu doküman güncellenmelidir.
---

# DOC-10: 10.tasks-playbook.md

---
# 10. Tasks Playbook

Bu doküman, Cursor → Cursor akışını "tek doğru görev formatı" ile standartlaştıran task yönetimi playbook'udur. Amaç: Görevlerin daha az hatayla, daha hızlı, daha deterministik uygulanmasını sağlamak.

**Last verified from package.json:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

Bu playbook şunları standartlaştırır:

1. **Task Format Standardizasyonu:** Cursor'nin Cursor'a verdiği task format'ı tek doğru formata sabitler
2. **Uydurma Engelleme:** AI asistanların (Cursor/Cursor) uydurma endpoint/alan/component üretmesini engeller
3. **Hata Azaltma:** DoD checklist, risk planı, rollback stratejisi ile hata oranını düşürür
4. **Hız Artırma:** Standart format ile task intake → uygulama → review sürecini hızlandırır
5. **Deterministik Sonuçlar:** Her task'ta aynı kalite kapıları, aynı test süreçleri
6. **Small PR Yaklaşımı:** Büyük işleri parçalayarak AI-friendly PR boyutları sağlar
7. **Evidence-Based Development:** Her karar ve değişiklik mevcut dokümantasyon (01-09) ile kanıtlanır
8. **Rollback Güvenliği:** Riskli değişikliklerde rollback planı zorunlu

**Evidence:** `02.architecture-lock.md` (hard constraints), `08.api-contracts-frontend.md` (uydurma yasağı), `06.frontend-standards-2026.md` (DoD), `07.component-inventory.md` (component envanteri)

---

## 2. Operating Model (Cursor ↔ Cursor ↔ Murti)

### 2.1 Rol Dağılımı

**Murti (Kontrol/Test + Karar Verici):**
- Task request'i hazırlar (Task Request Intake Template ile)
- Uygulama sonrası manuel test yapar (smoke checklist)
- PR review yapar
- Karar verir: approve/reject/request changes

**Cursor (Beyin - Plan, Risk, Prompt):**
- Task request'i alır, analiz eder
- Mevcut dokümantasyonu (01-09) referans alır
- Plan oluşturur (Cursor Uygulama Paketi formatında)
- Risk ve rollback stratejisi belirler
- Assumption/Unknown'ları işaretler

**Cursor (Uygulayıcı - Dosya Değişikliği, Küçük PR):**
- Cursor'den gelen planı uygular
- Dosya değişikliklerini yapar
- DoD checklist'i kontrol eder
- Small PR oluşturur (5-7 dosya max)

**Evidence:** Plan requirements, `06.frontend-standards-2026.md` (Coding Standards > Small PR Rule)

### 2.2 Tek Kaynak Dokümanlar (01-09)

Tüm task'larda referans alınacak dokümanlar:

1. **01.project-brief.md** - Ürün/proje özeti, env/scripts, high-level evidence
2. **02.architecture-lock.md** - Hard constraints, yasaklar, izinli değişiklikler
3. **03.routes-and-navigation-map.md** - Route doğruluğu, navigasyon pattern'leri
4. **04.design-system.md** - Design tokens, component kontratları, exception'lar
5. **05.native-ux-rules.md** - Feedback, PDP bottom nav istisnası, kritik UX
6. **06.frontend-standards-2026.md** - DoD, kalite kapıları, kod standartları
7. **07.component-inventory.md** - Component envanteri, kullanım yerleri
8. **08.api-contracts-frontend.md** - Endpoint/contract uydurma yasağı
9. **09.data-fetching-cache-rules.md** - Fetch/caching karar ağacı

**Evidence:** `01.project-brief.md`, `02.architecture-lock.md`, `03.routes-and-navigation-map.md`, `04.design-system.md`, `05.native-ux-rules.md`, `06.frontend-standards-2026.md`, `07.component-inventory.md`, `08.api-contracts-frontend.md`, `09.data-fetching-cache-rules.md`

---

## 3. Rules of Engagement (Hard)

### 3.1 Uydurma Yasakları

1. **Uydurma endpoint/alan yok** - `08.api-contracts-frontend.md` tek kaynak, yeni endpoint/alan eklemek için doküman güncellenmeli (kanıt: `08.api-contracts-frontend.md` (Breaking-Change Rules): "Cursor/Cursor uydurma endpoint/alan yazamaz")
2. **Design token dışı core UI yok** - Core UI renk/spacing hardcode edilemez, `04.design-system.md` token'ları kullanılmalı (kanıt: `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System): "Core UI colors CSS variables / design tokens üzerinden yönetilmelidir")
3. **Uydurma component yok** - Yeni component yazmadan önce `07.component-inventory.md` kontrol edilmeli (kanıt: `07.component-inventory.md` (Inventory Rules): "Yeni component yazmadan önce inventory kontrolü zorunlu")

**Evidence:** `08.api-contracts-frontend.md` (Breaking-Change Rules), `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System), `07.component-inventory.md` (Inventory Rules)

### 3.2 Architecture Constraints

4. **RSC/Client boundary bozulmaz** - Server Component'ten Client Component'e prop geçişi serializable olmalı (kanıt: `02.architecture-lock.md` (Non-Negotiables > Rendering Model): "Server/Client boundary korunmalı")
5. **Route path değiştirmek yasak** - Mevcut route path'leri (`/urun/[slug]`, `/account/*`, `/checkout`) değiştirilemez (kanıt: `02.architecture-lock.md` (Non-Negotiables > Framework & Routing): "Route path'leri değiştirilemez")
6. **Provider hiyerarşisi değiştirilemez** - `layout.tsx` içindeki provider sırası sabit (kanıt: `02.architecture-lock.md` (Non-Negotiables > State Management): "Provider hiyerarşisi sabit")

**Evidence:** `02.architecture-lock.md` (Non-Negotiables > Framework & Routing, Rendering Model, State Management)

### 3.3 Development Rules

7. **Archive klasörü yok sayılır** - `archive/**` klasörü build/typecheck dışı, task'larda ignore edilir (kanıt: `02.architecture-lock.md` (Non-Negotiables > Build & Environment): "Archive klasörü exclude")
8. **Büyük değişiklik → task parçalama zorunlu** - L (multi-day) task'lar bölünmeli, önce plan PR, sonra uygulama PR'ları
9. **Önce mevcut component envanterine bak** - `07.component-inventory.md` kontrol edilmeli, duplicate component açılmamalı (kanıt: `07.component-inventory.md` (Inventory Rules): "Yeni component yazmadan önce inventory kontrolü zorunlu")
10. **Her task'ta DoD checklist zorunlu** - DoD bölümünde tanımlı checklist uygulanmalı (kanıt: `06.frontend-standards-2026.md` (Definition of Done))
11. **Her task'ta risk/rollback notu zorunlu** - Risk Management bölümünde tanımlı format kullanılmalı
12. **Varsayım gerekiyorsa `Assumption:` ile açıkça işaretle** - Unknown durumlar `Unknown:` ile işaretlenmeli

**Evidence:** `02.architecture-lock.md` (Non-Negotiables > Build & Environment), `07.component-inventory.md` (Inventory Rules), `06.frontend-standards-2026.md` (Definition of Done)

---

## 4. Task Levels (S/M/L)

### 4.1 Small (S) - ≤30 dk

**Kapsam:**
- 1-3 dosya değişikliği
- Lokal test + lint
- Tek bir feature/fix

**Örnekler:**
- UI tweak (button rengi, spacing)
- Bugfix (typo, küçük hata)
- Text değişikliği
- Küçük refactor (variable rename)

**DoD:**
- `npm run lint` hatasız
- `npm run build` başarılı
- Manuel smoke test (ilgili sayfa)

**Evidence:** `06.frontend-standards-2026.md` (Coding Standards > Small PR Rule)

### 4.2 Medium (M) - 0.5-1 gün

**Kapsam:**
- 4-10 dosya değişikliği
- Smoke akış testi
- Risk planı zorunlu

**Örnekler:**
- Yeni sayfa/route ekleme
- Component refactor
- Form validation iyileştirme
- API endpoint ekleme (doküman güncellemesi ile)

**DoD:**
- `npm run lint` hatasız
- `npm run build` başarılı
- Manuel smoke checklist (PLP → PDP → Cart → Checkout)
- Risk & rollback planı yazılı

**Evidence:** `06.frontend-standards-2026.md` (Definition of Done)

### 4.3 Large (L) - multi-day

**Kapsam:**
- 10+ dosya değişikliği
- Bölünmesi zorunlu
- Önce plan PR, sonra uygulama PR'ları

**Yaklaşım:**
1. **Plan PR:** Sadece plan dokümanı, değişiklik yok
2. **Uygulama PR'ları:** Plan onaylandıktan sonra, küçük PR'lara bölünmüş

**Örnekler:**
- Büyük refactor (state management değişikliği)
- Yeni feature (payment gateway entegrasyonu)
- Migration (Next.js version upgrade)

**Evidence:** Best practice (AI-friendly PR size)

---

## 5. Task Request Intake Template

Kullanıcının (Murti) bir task açarken göndereceği minimum bilgiler:

### 5.1 Zorunlu Alanlar

1. **Hedef route/sayfa:**
   - Örnek: `/urun/[slug]`, `/checkout`, `/account/addresses`
   - Route yoksa: "Yeni route: `/yeni-sayfa`"

2. **Amaç:**
   - Kısa açıklama (1-2 cümle)
   - Örnek: "Ürün detay sayfasında CTA butonunun rengini primary token'a göre güncelle"

3. **Kabul kriterleri:**
   - Test senaryoları
   - Örnek: "Button rengi `bg-primary` olmalı, dark mode'da doğru görünmeli"

4. **Tasarım referansı (varsa):**
   - Figma link, screenshot
   - Örnek: "Figma: https://figma.com/..."

5. **Yasaklar/korunacaklar:**
   - Değiştirilmemesi gerekenler
   - Örnek: "Route path değiştirilemez, mevcut component yapısı korunmalı"

6. **Test senaryosu:**
   - Manuel test adımları
   - Örnek: "1. `/urun/test-slug` sayfasına git, 2. Button rengini kontrol et"

**Evidence:** `03.routes-and-navigation-map.md` (route table), `04.design-system.md` (design tokens)

---

## 6. Cursor Uygulama Paketi (Standard Output)

Cursor'nin her cevapta Cursor'a vereceği standart format:

### 6.1 Teşhis (1-3 madde)

Mevcut durum analizi:
- Sorun nedir?
- Neden gerekli?
- Mevcut dokümantasyondan kanıt

**Örnek:**
```
Teşhis:
1. Ürün detay sayfasında CTA butonu hardcode renk kullanıyor, design token'a geçilmeli
2. 04.design-system.md'de primary token tanımlı (#ff2357), component'ler token kullanmalı
3. Mevcut kod: `bg-[#ff2357]` → Değişiklik: `bg-primary`
```

### 6.2 Plan (adım adım)

1. Dosya okuma (mevcut durum)
2. Değişiklik yapılacak yerler
3. Test adımları

**Örnek:**
```
Plan:
1. `src/components/product/product-view.tsx` dosyasını oku
2. `bg-[#ff2357]` class'ının geçtiği yerde `bg-primary` olarak değiştir
3. Dark mode'da test et (theme toggle ile)
```

### 6.3 Dosya Bazlı Değişiklik Listesi

Her dosya için:
- Dosya yolu
- Değişiklik türü (edit/create/delete)
- Değişiklik açıklaması (hangi bölüm/component/fonksiyon)

**Örnek:**
```
Dosya Değişiklikleri:
1. `src/components/product/product-view.tsx` (edit)
   - `bg-[#ff2357]` class'ının geçtiği yerde `bg-primary` olarak değiştir
   - Açıklama: Hardcode renk yerine design token kullan
```

### 6.4 DoD

DoD checklist'i (Definition of Done bölümünden):
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: [test senaryosu]

### 6.5 Risk & Rollback

Risk analizi ve rollback stratejisi:
- Risk: [risk açıklaması]
- Rollback: [rollback yöntemi]
- Örnek: "Risk: Düşük - Sadece CSS class değişikliği. Rollback: Git revert veya manuel class değişikliği"

### 6.6 Assumptions / Unknowns

Varsayımlar ve bilinmeyenler:
- `Assumption:` [varsayım]
- `Unknown:` [bilinmeyen]

**Örnek:**
```
Assumptions:
- Dark mode theme provider çalışıyor (04.design-system.md'de tanımlı)

Unknowns:
- Button'un diğer kullanım yerleri (07.component-inventory.md kontrol edilmeli)
```

**Evidence:** `06.frontend-standards-2026.md` (DoD), `02.architecture-lock.md` (risk management)

---

## 7. Definition of Done (DoD)

Bir task'ın "done" sayılması için zorunlu checklist:

### 7.1 Code Quality

1. **Lint:** `npm run lint` hatasız geçmeli (kanıt: `package.json` scripts: `"lint": "eslint"`)
2. **Build:** `npm run build` başarılı olmalı (kanıt: `package.json` scripts: `"build": "TZ=Europe/Istanbul next build"`)
3. **TypeScript:** Build sırasında TypeScript kontrol ediliyor, hata olmamalı (kanıt: `tsconfig.json` - strict mode)

**Evidence:** `package.json` (scripts), `tsconfig.json` (strict mode)

### 7.2 Functionality

4. **Server Component pattern:** Yeni sayfalar Server Component olmalı (gerekliyse Client Component)
5. **Error handling:** API route'lar ve Server Action'larda try-catch ile error handling
6. **Validation:** Form submit'ler ve API input'ları Zod ile validate edilmeli

**Evidence:** `02.architecture-lock.md` (Non-Negotiables > Rendering Model), `06.frontend-standards-2026.md` (Error Handling Standards)

### 7.3 Styling

7. **Design tokens kullanımı:** Tailwind class'ları design token'ları kullanmalı (`bg-primary`, `text-foreground`, vb.)
8. **Responsive design:** Mobile-first yaklaşım, breakpoint'ler doğru kullanılmalı

**Evidence:** `04.design-system.md` (Design Tokens), `05.native-ux-rules.md` (Mobile-First Patterns)

### 7.4 Manuel Test

9. **Smoke checklist:** Kritik akışlar manuel test edilmeli:
   - PLP (Product List Page) - kategori sayfası (`/[slug]`)
   - PDP (Product Detail Page) - ürün detay sayfası (`/urun/[slug]`)
   - Cart - sepet işlemleri (`/cart`)
   - Checkout - sipariş akışı (`/checkout`)
10. **Mobile test:** Mobile görünüm test edilmeli (`xl:hidden` breakpoint)
11. **Dark mode test:** Dark mode görünüm test edilmeli (theme toggle ile)

**Evidence:** `06.frontend-standards-2026.md` (Definition of Done), `03.routes-and-navigation-map.md` (Route Table)

---

## 8. Quality Gates

Her task'ta kontrol edilecek kalite kapıları:

### 8.1 Accessibility (A11y)

- **Focus ring:** Tüm interactive elementlerde `focus-visible:ring-2` pattern (kanıt: `04.design-system.md` (Accessibility Guidelines))
- **Keyboard navigation:** Dialog/Drawer'da keyboard navigation (Radix UI built-in)
- **ARIA labels:** Icon-only butonlarda `aria-label` (kanıt: `05.native-ux-rules.md` (Accessibility UX Rules))

**Evidence:** `04.design-system.md` (Accessibility Guidelines), `05.native-ux-rules.md` (Accessibility UX Rules)

### 8.2 UX

- **Loading/empty/error state zorunluluğu:** Her component'te loading, empty, error state'leri (kanıt: `05.native-ux-rules.md` (Loading / Empty / Error States))
- **Touch target min 44px:** Mobile'da interactive elementler `h-11` (44px) veya daha büyük (kanıt: `05.native-ux-rules.md` (Native UX Principles > Touch Target Sizes))
- **Safe area support:** iOS home indicator alanına uyum - `env(safe-area-inset-bottom)` (kanıt: `05.native-ux-rules.md` (Native UX Principles > Critical CTA Visibility))

**Evidence:** `05.native-ux-rules.md` (Native UX Principles > Touch Target Sizes, Loading / Empty / Error States)

### 8.3 Performance

- **Gereksiz `use client` yok:** Sadece gerekli durumlarda Client Component (kanıt: `06.frontend-standards-2026.md` (Component Standards > RSC vs Client Component Decision Tree))
- **Image optimization:** Next.js Image component kullanılmalı (kanıt: `06.frontend-standards-2026.md` (Performance Standards > Image Optimization))

**Evidence:** `06.frontend-standards-2026.md` (Component Standards > RSC vs Client Component Decision Tree, Performance Standards > Image Optimization)

### 8.4 Design

- **Token uyumu:** Core UI colors design token kullanmalı, hardcode renk yok (kanıt: `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System))
- **Component inventory:** Yeni component yazmadan önce envanter kontrolü (kanıt: `07.component-inventory.md` (Inventory Rules))

**Evidence:** `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System), `07.component-inventory.md` (Inventory Rules)

### 8.5 API

- **Contract uyumu:** API endpoint'leri `08.api-contracts-frontend.md`'de tanımlı olmalı (kanıt: `08.api-contracts-frontend.md` (Breaking-Change Rules))

**Evidence:** `08.api-contracts-frontend.md` (Breaking-Change Rules)

---

## 9. Risk Management & Rollback

### 9.1 Risk Seviyeleri

**Düşük Risk:**
- CSS class değişikliği
- Text değişikliği
- Küçük UI tweak
- **Rollback:** Git revert veya manuel değişiklik

**Orta Risk:**
- Component refactor
- Form validation değişikliği
- API endpoint ekleme
- **Rollback:** Git revert + smoke test

**Yüksek Risk:**
- Route path değişikliği
- State management değişikliği
- Database schema değişikliği
- **Rollback:** Git revert + migration rollback + smoke test

**Evidence:** `02.architecture-lock.md` (Non-Negotiables > Framework & Routing)

### 9.2 Rollback Stratejisi

**Git Revert:**
- En basit yöntem
- `git revert <commit-hash>`
- Smoke test sonrası merge

**Feature Flag (varsa):**
- Feature flag ile toggle
- Production'da test edilebilir
- Rollback: Flag'i kapat

**Snapshot/Tag:**
- Riskli değişikliklerden önce tag oluştur
- Rollback: Tag'a geri dön

**Evidence:** Best practice (git workflow)

### 9.3 "Breaks Routes" Riskine Karşı

- Route map kontrolü: `03.routes-and-navigation-map.md` referans alınmalı
- Route path değişikliği yasak: `02.architecture-lock.md` (Non-Negotiables > Framework & Routing)
- Dynamic route pattern korunmalı: `[slug]`, `[id]` pattern'leri değiştirilemez

**Evidence:** `03.routes-and-navigation-map.md`, `02.architecture-lock.md` (Non-Negotiables > Framework & Routing)

---

## 10. PR & Commit Rules

### 10.1 Commit Mesaj Standardı

**Format:** `type: kısa açıklama`

**Tipler:**
- `feat:` - Yeni feature
- `fix:` - Bug fix
- `docs:` - Dokümantasyon değişikliği
- `chore:` - Build/config değişikliği
- `refactor:` - Kod refactor (feature/fix değil)
- `style:` - Formatting (lint, prettier)

**Örnekler:**
- `feat: add address form drawer to checkout page`
- `fix: product card image alt text missing`
- `docs: update tasks playbook with examples`

**Evidence:** Conventional commits standard

### 10.2 PR Açıklaması

**Zorunlu Bölümler:**

1. **Değişen Dosyalar:**
   - Liste formatında
   - Örnek: `- src/components/product/product-view.tsx (edit)`

2. **Test Kanıtı:**
   - Screenshot (UI değişiklikleri için)
   - Test senaryosu
   - Örnek: "Test: `/urun/test-slug` sayfasında button rengi primary token kullanıyor"

3. **Risk & Rollback:**
   - Risk seviyesi
   - Rollback planı
   - Örnek: "Risk: Düşük - CSS class değişikliği. Rollback: Git revert"

4. **DoD Checklist:**
   - [x] `npm run lint` hatasız
   - [x] `npm run build` başarılı
   - [x] Manuel test: [test senaryosu]

**Evidence:** `06.frontend-standards-2026.md` (PR / Review Standards)

### 10.3 UI Değişimlerinde Görsel Şartı

- **Before/After screenshot:** UI değişikliklerinde zorunlu
- **Mobile & Desktop:** Her iki görünüm de gösterilmeli
- **Dark mode:** Dark mode görünümü de gösterilmeli (varsa)

**Evidence:** `06.frontend-standards-2026.md` (PR / Review Standards)

---

## 11. Anti-Patterns (Do/Don't)

### 11.1 DO

1. ✅ **Önce mevcut component envanterine bak** - `07.component-inventory.md` kontrol et
2. ✅ **Design token kullan** - Hardcode renk/spacing yok, `04.design-system.md` token'ları kullan
3. ✅ **API contract'a uy** - `08.api-contracts-frontend.md` tek kaynak, uydurma endpoint yok
4. ✅ **Small PR** - Her PR maksimum 5-7 dosya değişikliği
5. ✅ **DoD checklist** - Her task'ta DoD kontrolü zorunlu
6. ✅ **Assumption işaretle** - Varsayım gerekiyorsa `Assumption:` ile açıkça işaretle
7. ✅ **Route map kontrolü** - Route değişikliği yapmadan önce `03.routes-and-navigation-map.md` kontrol et

**Evidence:** `07.component-inventory.md` (Inventory Rules), `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System), `08.api-contracts-frontend.md` (Breaking-Change Rules), `06.frontend-standards-2026.md` (Coding Standards > Small PR Rule)

### 11.2 DON'T

1. ❌ **Yeni component yazıp var olanı bypass etmek** - Önce envanter kontrolü
2. ❌ **Hardcode core UI renk/spacing** - Design token kullan
3. ❌ **Uydurma endpoint/field** - `08.api-contracts-frontend.md` tek kaynak
4. ❌ **Tek PR'da çok iş** - Small PR yaklaşımı, maksimum 5-7 dosya
5. ❌ **Test etmeden teslim** - DoD checklist zorunlu
6. ❌ **Assumption belirtmeden karar verme** - Unknown durumlar `Unknown:` ile işaretlenmeli
7. ❌ **Route path değiştirmek** - Mevcut route path'leri değiştirilemez (`02.architecture-lock.md`)

**Evidence:** `07.component-inventory.md` (Inventory Rules), `04.design-system.md` (Design System Constraints > Non-Negotiables > Color System), `08.api-contracts-frontend.md` (Breaking-Change Rules), `02.architecture-lock.md` (Non-Negotiables > Framework & Routing)

---

## 12. Task Templates

### 12.1 UI Tweak (Small)

**Amaç:** Küçük UI değişikliği (renk, spacing, text)

**Kapsam:**
- 1-3 dosya değişikliği
- Design token kullanımı
- Text değişikliği

**Dosyalar:**
- Component dosyası (edit)
- Test: İlgili sayfa

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: [sayfa] görünümü kontrol edildi
- [ ] Dark mode test edildi

**Risk:** Düşük - CSS/text değişikliği. Rollback: Git revert

**Evidence:** `04.design-system.md` (design tokens)

### 12.2 New Page/Route (Medium)

**Amaç:** Yeni sayfa/route ekleme

**Kapsam:**
- 4-10 dosya değişikliği
- Route dosyası (`src/app/[route]/page.tsx`)
- Component'ler (gerekirse)
- Loading/error state'ler

**Dosyalar:**
- `src/app/[route]/page.tsx` (create)
- Component dosyaları (create/edit)
- `03.routes-and-navigation-map.md` (edit - route ekle)

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: Yeni route çalışıyor
- [ ] Mobile test edildi
- [ ] Dark mode test edildi
- [ ] Route map güncellendi

**Risk:** Orta - Yeni route ekleme. Rollback: Git revert + route map güncelleme

**Evidence:** `03.routes-and-navigation-map.md` (route table), `02.architecture-lock.md` (App Router pattern)

### 12.3 Refactor (Medium)

**Amaç:** Component/function refactor

**Kapsam:**
- 4-10 dosya değişikliği
- Component yapısı değişikliği
- Function extraction/consolidation

**Dosyalar:**
- Component dosyaları (edit)
- Utility dosyaları (edit/create)
- Test: İlgili sayfalar

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel smoke test: PLP → PDP → Cart → Checkout
- [ ] Component inventory güncellendi (gerekirse)

**Risk:** Orta - Refactor riski. Rollback: Git revert + smoke test

**Evidence:** `07.component-inventory.md` (component envanteri)

### 12.4 Bugfix (Small)

**Amaç:** Bug düzeltme

**Kapsam:**
- 1-3 dosya değişikliği
- Hata düzeltme
- Test senaryosu

**Dosyalar:**
- Hatalı dosya (edit)
- Test: Hata senaryosu

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: Hata senaryosu test edildi, düzeltildi
- [ ] Regression test: İlgili sayfalar test edildi

**Risk:** Düşük - Bug fix. Rollback: Git revert

**Evidence:** `06.frontend-standards-2026.md` (error handling)

---

## 13. Examples (3-5 Örnek Task)

### 13.1 Örnek 1: PDP'de CTA Davranışı İyileştirme

**Task Request:**
- **Hedef route:** `/urun/[slug]`
- **Amaç:** Ürün detay sayfasında "Sepete Ekle" butonunun rengini hardcode `#ff2357` yerine design token `bg-primary` kullan
- **Kabul kriterleri:** Button rengi `bg-primary` olmalı, dark mode'da doğru görünmeli
- **Yasaklar:** Route path değiştirilemez, mevcut component yapısı korunmalı
- **Test senaryosu:** 1. `/urun/test-slug` sayfasına git, 2. Button rengini kontrol et, 3. Dark mode toggle ile test et

**Cursor Uygulama Paketi:**

**Teşhis:**
1. Ürün detay sayfasında CTA butonu hardcode renk kullanıyor, design token'a geçilmeli
2. `04.design-system.md`'de primary token tanımlı (`--primary: #ff2357`), component'ler token kullanmalı
3. Mevcut kod: `bg-[#ff2357]` → Değişiklik: `bg-primary`

**Plan:**
1. `src/components/product/product-view.tsx` dosyasını oku
2. `bg-[#ff2357]` class'ının geçtiği yerde (CTA button bölümünde) `bg-primary` olarak değiştir
3. Dark mode'da test et (theme toggle ile)

**Dosya Değişiklikleri:**
1. `src/components/product/product-view.tsx` (edit)
   - CTA button bölümünde `bg-[#ff2357]` class'ını `bg-primary` olarak değiştir
   - Açıklama: Hardcode renk yerine design token kullan

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: `/urun/test-slug` sayfasında button rengi `bg-primary` kullanıyor
- [ ] Dark mode test: Theme toggle ile dark mode'da button rengi doğru görünüyor

**Risk & Rollback:**
- Risk: Düşük - Sadece CSS class değişikliği
- Rollback: Git revert veya manuel class değişikliği

**Assumptions:**
- Dark mode theme provider çalışıyor (`04.design-system.md`'de tanımlı)
- Primary token dark mode'da da doğru çalışıyor

**Evidence:** `04.design-system.md` (Design Tokens > Colors), `src/components/product/product-view.tsx`

### 13.2 Örnek 2: LoadMoreGrid Filtre/Sort Bugfix

**Task Request:**
- **Hedef route:** `/[slug]` (kategori sayfası)
- **Amaç:** LoadMoreGrid component'inde filtre değiştiğinde cursor reset edilmiyor, ilk sayfadan başlamalı
- **Kabul kriterleri:** Filtre değiştiğinde ürün listesi baştan başlamalı, cursor reset edilmeli
- **Yasaklar:** API contract değiştirilemez (`08.api-contracts-frontend.md`)
- **Test senaryosu:** 1. `/[slug]` sayfasına git, 2. Filtre değiştir, 3. Ürün listesi baştan başlamalı

**Cursor Uygulama Paketi:**

**Teşhis:**
1. LoadMoreGrid component'inde filtre değiştiğinde cursor reset edilmiyor
2. `09.data-fetching-cache-rules.md`'de cursor pagination pattern tanımlı
3. Filtre değişikliğinde `cursor` state'i reset edilmeli

**Plan:**
1. `src/components/catalog/load-more-grid.tsx` dosyasını oku
2. Filtre değişikliğini detect et (`useEffect` ile)
3. Filtre değiştiğinde `cursor` state'ini `null` yap
4. `hasMore` state'ini `true` yap

**Dosya Değişiklikleri:**
1. `src/components/catalog/load-more-grid.tsx` (edit)
   - `useEffect` ekle: Filtre değişikliğinde cursor reset
   - Açıklama: Filtre değiştiğinde pagination baştan başlamalı

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: `/[slug]` sayfasında filtre değiştiğinde ürün listesi baştan başlıyor
- [ ] Regression test: Infinite scroll hala çalışıyor

**Risk & Rollback:**
- Risk: Orta - State management değişikliği
- Rollback: Git revert + smoke test

**Assumptions:**
- Filtre değişikliği `useEffect` ile detect edilebilir
- Cursor reset mekanizması mevcut API contract'a uygun

**Evidence:** `09.data-fetching-cache-rules.md` (cursor pagination), `src/components/catalog/load-more-grid.tsx`

### 13.3 Örnek 3: Signup Form Validation UX İyileştirme

**Task Request:**
- **Hedef route:** `/signup`
- **Amaç:** Signup form'unda validation error'ları inline gösterilmeli, sadece toast değil
- **Kabul kriterleri:** Form field'larında validation error'ları inline gösterilmeli, `text-destructive` rengi kullanılmalı
- **Yasaklar:** API contract değiştirilemez, mevcut Zod schema korunmalı
- **Test senaryosu:** 1. `/signup` sayfasına git, 2. Geçersiz email gir, 3. Submit et, 4. Inline error görünmeli

**Cursor Uygulama Paketi:**

**Teşhis:**
1. Signup form'unda validation error'ları sadece toast ile gösteriliyor, inline error yok
2. `06.frontend-standards-2026.md`'de form error display pattern tanımlı (inline error)
3. `src/components/auth/signup-form.tsx` dosyasında inline error display eklenmeli

**Plan:**
1. `src/components/auth/signup-form.tsx` dosyasını oku
2. React Hook Form `formState.errors` kullanarak inline error display ekle
3. Error mesajları `text-destructive bg-destructive/10` class'ları ile göster
4. Toast'u koru (kritik feedback için)

**Dosya Değişiklikleri:**
1. `src/components/auth/signup-form.tsx` (edit)
   - Inline error display ekle (form field'ların altında)
   - `text-destructive bg-destructive/10` class'ları kullan
   - Açıklama: Validation error'ları inline göster, toast'u koru

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: `/signup` sayfasında geçersiz form submit'inde inline error görünüyor
- [ ] A11y test: Error mesajları screen reader tarafından okunabilir

**Risk & Rollback:**
- Risk: Düşük - UI değişikliği, mevcut validation logic korunuyor
- Rollback: Git revert

**Assumptions:**
- React Hook Form `formState.errors` mevcut
- Destructive token tanımlı (`04.design-system.md`)

**Evidence:** `06.frontend-standards-2026.md` (Accessibility Standards > Form Error Messages), `04.design-system.md` (Design Tokens > Colors), `src/components/auth/signup-form.tsx`

### 13.4 Örnek 4: Checkout Empty Cart Handling İyileştirme

**Task Request:**
- **Hedef route:** `/checkout`
- **Amaç:** Checkout sayfasında sepet boşsa kullanıcıya daha iyi feedback verilmeli, empty state component'i eklenmeli
- **Kabul kriterleri:** Sepet boşsa empty state gösterilmeli, "Alışverişe Devam Et" butonu olmalı
- **Yasaklar:** Route path değiştirilemez, mevcut redirect logic korunmalı
- **Test senaryosu:** 1. Sepeti boşalt, 2. `/checkout` sayfasına git, 3. Empty state görünmeli

**Cursor Uygulama Paketi:**

**Teşhis:**
1. Checkout sayfasında sepet boşsa sadece redirect var, empty state yok
2. `05.native-ux-rules.md`'de empty state pattern tanımlı (Loading / Empty / Error States > Empty States)
3. Empty state component'i eklenmeli, redirect logic korunmalı

**Plan:**
1. `src/app/checkout/page.tsx` dosyasını oku
2. Sepet boş kontrolü yapılan yerde empty state component'i ekle
3. Empty state: "Sepetiniz boş" mesajı + "Alışverişe Devam Et" butonu (`/` route'una)
4. Redirect logic'i koru (server-side kontrol için)

**Dosya Değişiklikleri:**
1. `src/app/checkout/page.tsx` (edit)
   - Empty state component'i ekle (sepet boşsa)
   - "Alışverişe Devam Et" butonu ekle (`/` route'una)
   - Açıklama: Empty state UX iyileştirmesi

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: Sepet boşsa empty state görünüyor
- [ ] Manuel test: "Alışverişe Devam Et" butonu `/` route'una gidiyor
- [ ] Mobile test: Empty state mobile'da doğru görünüyor

**Risk & Rollback:**
- Risk: Düşük - UI değişikliği, mevcut logic korunuyor
- Rollback: Git revert

**Assumptions:**
- Sepet boş kontrolü mevcut (`useCart` hook)
- Empty state pattern `05.native-ux-rules.md`'de tanımlı

**Evidence:** `05.native-ux-rules.md` (Loading / Empty / Error States > Empty States), `src/app/checkout/page.tsx`

### 13.5 Örnek 5: ProductCard Image Alt Text Eksik

**Task Request:**
- **Hedef route:** Tüm sayfalar (ProductCard kullanılan yerler)
- **Amaç:** ProductCard component'inde image alt text eksik, a11y için eklenmeli
- **Kabul kriterleri:** Tüm ProductCard image'larında `alt` attribute olmalı, ürün adı kullanılmalı
- **Yasaklar:** Component yapısı değiştirilemez, sadece alt text eklenmeli
- **Test senaryosu:** 1. Herhangi bir sayfada ProductCard görünümünü kontrol et, 2. Image'da alt text olmalı

**Cursor Uygulama Paketi:**

**Teşhis:**
1. ProductCard component'inde image alt text eksik, a11y sorunu
2. `07.component-inventory.md`'de ProductCard a11y gap olarak işaretlenmiş (Component Health > Potential A11y Gaps)
3. Image component'ine `alt` prop'u eklenmeli, ürün adı kullanılmalı

**Plan:**
1. `src/components/product/product-card.tsx` dosyasını oku
2. Image component'ine `alt` prop'u ekle (`title` veya `name` prop'undan)
3. Tüm ProductCard kullanım yerlerini kontrol et (gerekirse)

**Dosya Değişiklikleri:**
1. `src/components/product/product-card.tsx` (edit)
   - Image component'ine `alt` prop'u ekle
   - Açıklama: A11y iyileştirmesi - image alt text

**DoD:**
- [ ] `npm run lint` hatasız
- [ ] `npm run build` başarılı
- [ ] Manuel test: ProductCard image'larında alt text görünüyor (dev tools ile kontrol)
- [ ] A11y test: Screen reader image alt text'i okuyor

**Risk & Rollback:**
- Risk: Düşük - Sadece alt text ekleme
- Rollback: Git revert

**Assumptions:**
- ProductCard'da `title` veya `name` prop'u mevcut
- Next.js Image component `alt` prop'unu destekliyor

**Evidence:** `07.component-inventory.md` (Component Health > Potential A11y Gaps), `src/components/product/product-card.tsx`

---

## 14. Evidence Index

En önemli referanslar:

1. **01.project-brief.md** - Ürün/proje özeti, env/scripts, high-level evidence
2. **02.architecture-lock.md** - Hard constraints, yasaklar, izinli değişiklikler, route path değiştirilemez kuralı
3. **03.routes-and-navigation-map.md** - Route table, navigasyon pattern'leri, dynamic routes
4. **04.design-system.md** - Design tokens, component kontratları, core UI colors token kuralı
5. **05.native-ux-rules.md** - UX kuralları, feedback pattern'leri, empty state pattern'leri
6. **06.frontend-standards-2026.md** - DoD, kalite kapıları, Small PR Rule, kod standartları
7. **07.component-inventory.md** - Component envanteri, yeni component yazmadan önce kontrol kuralı
8. **08.api-contracts-frontend.md** - API contract'ları, uydurma endpoint/alan yasağı
9. **09.data-fetching-cache-rules.md** - Fetch/caching karar ağacı, cursor pagination pattern
10. **package.json** - Dependencies, scripts (`npm run lint`, `npm run build`)
11. **tsconfig.json** - TypeScript strict mode, path aliases
12. **src/app/layout.tsx** - Provider hiyerarşisi, Server Component default
13. **src/components/product/product-view.tsx** - Product detail component, CTA button
14. **src/components/catalog/load-more-grid.tsx** - Infinite scroll, cursor pagination
15. **src/components/auth/signup-form.tsx** - Signup form, validation pattern
16. **src/app/checkout/page.tsx** - Checkout page, empty cart handling
17. **src/components/product/product-card.tsx** - Product card, image alt text

**Evidence:** Tüm yukarıdaki dosyalar codebase'de mevcut ve kanıt olarak kullanıldı

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni task pattern'leri eklendiğinde veya mevcut pattern'ler değiştirildiğinde bu doküman güncellenmelidir.
---

# DOC-11: 11.qa-test-matrix.md

---
# 11. QA Test Matrix

Bu doküman, Cinselhobi.com Next projesinin QA test matrisini, kritik akış test senaryolarını, erişilebilirlik kontrol listelerini ve release gate kriterlerini tanımlar. Amaç: Murti'nin "Cursor ile kontrol/test" rolünü standardize etmek ve her release öncesi tutarlı kalite kontrolü sağlamak.

**Last verified from package.json:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

Bu doküman şunları kapsar:

1. **Smoke Test Senaryoları:** Kritik kullanıcı akışlarının test edilmesi
2. **Route-by-Route Checklist:** Her kritik ekranın zorunlu UI elementleri ve state'leri
3. **UI States Checklist:** Loading, empty, error, success state kontrolleri
4. **Accessibility Checklist:** Klavye navigasyonu, focus yönetimi, screen reader desteği
5. **Responsive & Cross-Browser Matrix:** Farklı cihaz ve tarayıcı kombinasyonları
6. **Performance Checklist:** LCP, INP, CLS ve bundle size kontrolleri
7. **Data/Cache Regression Checks:** Cache invalidation, localStorage hydration kontrolleri
8. **API Contract Regression Checks:** Endpoint ve field uydurma yasağı kontrolleri
9. **Visual Regression:** Manuel görsel kontrol listesi
10. **Bug Report Template:** Standart hata raporlama formatı
11. **Exit Criteria:** Release gate kriterleri

**Evidence:** `03.routes-and-navigation-map.md`, `05.native-ux-rules.md`, `06.frontend-standards-2026.md`, `08.api-contracts-frontend.md`, `09.data-fetching-cache-rules.md`

---

## 2. Test Environments

### 2.1 Local Development
- **Command:** `npm run dev`
- **URL:** `http://localhost:3000`
- **Purpose:** Development sırasında hızlı test

**Evidence:** `package.json` (scripts: dev)

### 2.2 Local Production Simulation
- **Commands:** `npm run build && npm run start`
- **URL:** `http://localhost:3000`
- **Purpose:** Production build test, SSR/SSG davranışı kontrolü

**Evidence:** `package.json` (scripts: build, start)

### 2.3 Stage/Production
- **Stage URL:** Unknown (not found in repo as of scan 2025-01-27)
- **Production URL:** Unknown (not found in repo as of scan 2025-01-27)
- **Purpose:** Pre-production ve production ortam testleri

**Evidence:** Unknown (README or env files not found in repo as of scan 2025-01-27)

---

## 3. Smoke Tests (Critical User Flows)

En az 8 kritik akış test edilmelidir. Her akış için:
- **Flow ID:** SMK-XX formatında
- **Name:** Akış adı
- **Steps:** Route route adımlar
- **Expected:** Beklenen davranış (toast, loading, state)
- **Evidence:** Route map + component evidence

### SMK-01: Home → Category → Product → Add to Cart
- **Steps:**
  1. `/` - Ana sayfa yüklenir
  2. Kategori grid'den bir kategori seçilir → `/[slug]`
  3. Ürün listesinden bir ürün seçilir → `/urun/[slug]`
  4. "Sepete Ekle" butonuna tıklanır
- **Expected:**
  - Button state: "Eklendi ✓" (2s timeout)
  - Toast: "Ürün sepete eklendi" (top-center)
  - Cart icon badge güncellenir
- **Evidence:** `03.routes-and-navigation-map.md` (section 6.1), `05.native-ux-rules.md` (section 3.1), `src/components/product/product-view.tsx` (add to cart pattern)

### SMK-02: Search → Product Detail
- **Steps:**
  1. Header'da search butonuna tıklanır → Search overlay açılır
  2. Arama sorgusu yazılır (debounce 300ms)
  3. Sonuçlardan bir ürün seçilir → `/urun/[slug]`
- **Expected:**
  - Search overlay açılır (fullscreen dialog)
  - Debounced search çalışır
  - Sonuçlar gösterilir
- **Evidence:** `03.routes-and-navigation-map.md` (section 6.2), `src/components/search/search-overlay.tsx`

### SMK-03: Cart → Checkout → Order Success
- **Steps:**
  1. `/cart` - Sepet sayfası açılır
  2. "Siparişi Tamamla" butonuna tıklanır → `/checkout`
  3. Adres seçilir (veya yeni adres eklenir)
  4. Ödeme yöntemi seçilir
  5. "Siparişi Tamamla" butonuna tıklanır → `/order-success/[id]`
- **Expected:**
  - Boş sepet kontrolü: `/cart` redirect
  - Loading state: "İşleniyor..." text, button disabled
  - Success: `/order-success/[id]` redirect
- **Evidence:** `03.routes-and-navigation-map.md` (section 6.1), `05.native-ux-rules.md` (section 6.3), `src/app/checkout/page.tsx` (empty cart redirect, loading state, submit button)

### SMK-04: Login → Account → Wishlist
- **Steps:**
  1. `/login` - Giriş sayfası
  2. Email/password ile giriş yapılır
  3. `/account` - Hesap ana sayfası (auth redirect kontrolü)
  4. `/account/wishlist` - Favoriler sayfası
- **Expected:**
  - Auth kontrolü: Session yoksa `/login?callbackUrl=/account` redirect
  - Favoriler listesi gösterilir
- **Evidence:** `03.routes-and-navigation-map.md` (section 6.3), `src/app/account/layout.tsx` (auth protection)

### SMK-05: Product Detail → Add to Favorites
- **Steps:**
  1. `/urun/[slug]` - Ürün detay sayfası
  2. Favorite button'a tıklanır
- **Expected:**
  - Optimistic update: Button state hemen güncellenir
  - Server sync: Server action çağrılır
  - Rollback: Hata durumunda state geri alınır
- **Evidence:** `09.data-fetching-cache-rules.md` (section 8.2), `src/components/favorites/favorites-provider.tsx` (optimistic update pattern)

### SMK-06: Empty Cart Flow
- **Steps:**
  1. `/cart` - Sepet sayfası (boş sepet)
  2. `/checkout` - Checkout sayfasına gidilmeye çalışılır
- **Expected:**
  - Empty cart state gösterilir
  - Checkout'ta boş sepet kontrolü: `/cart` redirect
- **Evidence:** `05.native-ux-rules.md` (section 7.2), `src/app/checkout/page.tsx` (empty cart redirect)

### SMK-07: Empty Search Results
- **Steps:**
  1. Search overlay açılır
  2. Olmayan bir ürün aranır (örn: "xyz123")
- **Expected:**
  - Empty state: "Sonuç bulunamadı" + kategori linki
- **Evidence:** `05.native-ux-rules.md` (section 7.2), `src/app/search/page.tsx` (empty search state)

### SMK-08: Protected Route Access (Unauthenticated)
- **Steps:**
  1. `/account` - Hesap sayfasına gidilmeye çalışılır (session yok)
- **Expected:**
  - Auth kontrolü: `/login?callbackUrl=/account` redirect
- **Evidence:** `03.routes-and-navigation-map.md` (section 7.1), `src/app/account/layout.tsx` (auth protection)

---

## 4. Route-by-Route Checklist (Critical Screens)

Kritik ekranlar için zorunlu UI elementleri ve state kontrolleri.

| Route | Must-have UI Elements | Must-have States | Navigation Expectations | Evidence |
|-------|----------------------|------------------|------------------------|----------|
| `/` | Category grid, Product grid (LoadMoreGrid), Header, Footer, MobileBottomNav | Loading (skeleton), Empty (kategori/ürün yoksa) | Tab scroll preservation | `src/app/page.tsx`, `03.routes-and-navigation-map.md` (section 2) |
| `/[slug]` | CategoryHeaderSetter, ActiveFiltersBar, LoadMoreGrid, CatalogControls | Loading (`loading.tsx`), Empty (ürün yoksa), Error (notFound) | Back button, scroll restore | `src/app/[slug]/page.tsx`, `src/app/[slug]/loading.tsx` |
| `/urun/[slug]` | ProductView, HeaderTitle, FavoriteButton, Sticky action bar (Sepete Ekle) | Loading (`loading.tsx`), Error (notFound) | Back button, Bottom nav hidden | `src/app/urun/[slug]/page.tsx`, `src/app/urun/[slug]/loading.tsx`, `05.native-ux-rules.md` (section 12.1) |
| `/cart` | CartView (variant="page"), Header, MobileBottomNav | Empty (sepet boş), Loading (item update) | Cart drawer (mobile) | `src/app/cart/page.tsx`, `src/components/cart/cart-view.tsx` |
| `/checkout` | AddressForm (drawer), Payment method selection, Submit button | Empty (sepet boş → redirect), Loading (isLoading), Error (inline) | Back to cart | `src/app/checkout/page.tsx`, `05.native-ux-rules.md` (section 6.3) |
| `/order-success/[id]` | Order details, Success message, "Devam Et" button | Error (auth check → redirect, order not found) | - | `src/app/order-success/[id]/page.tsx`, `03.routes-and-navigation-map.md` (section 2) |
| `/search` | SearchResultItem list, Suspense fallback | Loading (Suspense), Empty (sonuç yok) | - | `src/app/search/page.tsx`, `05.native-ux-rules.md` (section 7.1) |
| `/account/*` | AccountSidebar (xl+), AccountMobileNav (xl-), Page content | Auth check (redirect), Loading, Empty (orders/wishlist boşsa) | Sidebar navigation | `src/app/account/layout.tsx`, `03.routes-and-navigation-map.md` (section 4.2) |
| `/login` | LoginForm, Input fields, Submit button | Loading (button disabled), Error (inline) | Redirect after login | `src/app/login/page.tsx`, `src/components/auth/login-form.tsx` |

**Evidence:** `03.routes-and-navigation-map.md` (section 2), `05.native-ux-rules.md` (section 7), `07.component-inventory.md` (section 8)

---

## 5. UI States Checklist (Loading/Empty/Error/Success)

### 5.1 Loading States
- [ ] **Category page (`/[slug]`):** `loading.tsx` skeleton gösterilir
- [ ] **Product detail (`/urun/[slug]`):** `loading.tsx` skeleton gösterilir
- [ ] **Search page:** Suspense fallback "Aranıyor..." gösterilir
- [ ] **Checkout submit:** Button "İşleniyor..." text, disabled state
- [ ] **Add to cart:** Button loading state (2s timeout)
- [ ] **Infinite scroll:** LoadMoreGrid'de "Daha Fazla Yükle" button loading state

**Evidence:** `src/app/[slug]/loading.tsx`, `src/app/urun/[slug]/loading.tsx`, `src/app/search/page.tsx` (Suspense fallback), `05.native-ux-rules.md` (section 7.1)

### 5.2 Empty States
- [ ] **Empty cart:** "Sepetiniz boş" + "Alışverişe Devam Et" button
- [ ] **Empty search:** "Sonuç bulunamadı" + kategori linki
- [ ] **Empty addresses:** "Henüz adres eklenmemiş" + "İlk Adresini Ekle" button
- [ ] **Empty wishlist:** "Henüz favorin yok" + "Kategorilere Git" button
- [ ] **Empty orders:** Unknown (not found in repo as of scan 2025-01-27)
- [ ] **Empty product list:** Unknown (not found in repo as of scan 2025-01-27)

**Evidence:** `05.native-ux-rules.md` (section 7.2), `src/app/checkout/page.tsx` (empty cart, empty addresses), `src/app/search/page.tsx` (empty search), `src/components/favorites/wishlist-client.tsx` (empty wishlist state)

### 5.3 Error States
- [ ] **Form validation errors:** Inline error display (`text-destructive bg-destructive/10`)
- [ ] **API errors:** Try-catch ile error handling, error state gösterilir
- [ ] **Not found (404):** Root `not-found.tsx` gösterilir
- [ ] **Product not found:** `notFound()` çağrılır, 404 gösterilir
- [ ] **Category not found:** `notFound()` çağrılır, 404 gösterilir
- [ ] **Global error boundary:** Not implemented (root error.tsx not found in repo as of scan 2025-01-27)

**Evidence:** `03.routes-and-navigation-map.md` (section 9), `05.native-ux-rules.md` (section 7.3), `src/app/not-found.tsx`

### 5.4 Success States
- [ ] **Add to cart:** Toast "Ürün sepete eklendi" (top-center, 2s)
- [ ] **Order success:** `/order-success/[id]` redirect, success message
- [ ] **Address added:** Drawer kapanır, address list refresh edilir
- [ ] **Favorite toggled:** Optimistic update + server sync

**Evidence:** `05.native-ux-rules.md` (section 3.1), `src/components/product/product-view.tsx` (toast.success), `src/app/layout.tsx` (Toaster component), `src/components/account/address-form.tsx` (form submission)

---

## 6. Accessibility Checklist

### 6.1 Keyboard Navigation
- [ ] **Tab order:** Logical tab order (DOM sırasına uygun)
- [ ] **Shift+Tab:** Reverse navigation çalışır
- [ ] **Enter/Space:** Button/link activation çalışır
- [ ] **Escape:** Dialog/Drawer kapatma çalışır
- [ ] **Arrow keys:** Unknown (dropdown/menu arrow key navigation not verified in repo as of scan 2025-01-27)

**Evidence:** `05.native-ux-rules.md` (section 9.1), `06.frontend-standards-2026.md` (section 4.2)

### 6.2 Focus Visibility & Focus Order
- [ ] **Focus ring:** Tüm interactive elementlerde `focus-visible:ring-2` görünür
- [ ] **Focus order:** Logical order (header → content → footer)
- [ ] **Skip links:** Not implemented (skip to content link not found in repo as of scan 2025-01-27)
- [ ] **Focus trap:** Dialog/Drawer açıldığında focus trap çalışır (Radix UI)

**Evidence:** `06.frontend-standards-2026.md` (section 4.1), `src/components/ui/button.tsx` (focus-visible:ring pattern), `src/components/ui/dialog.tsx` (Radix UI)

### 6.3 Dialog/Drawer Focus Management
- [ ] **Focus trap:** Dialog açıldığında focus trap aktif
- [ ] **Escape close:** Escape key ile dialog/drawer kapanır
- [ ] **Focus return:** Dialog kapandığında focus önceki elemente döner
- [ ] **sr-only close button:** Screen reader için close button mevcut

**Evidence:** `src/components/ui/dialog.tsx` (Radix UI), `src/components/ui/drawer.tsx` (Vaul)

### 6.4 Form Errors
- [ ] **aria-describedby:** Form field'larda error için `aria-describedby` kullanılır
- [ ] **aria-invalid:** Invalid field'larda `aria-invalid="true"` set edilir
- [ ] **Inline errors:** Error mesajları inline gösterilir
- [ ] **Screen reader announcements:** Not implemented (aria-live live region usage not found in repo as of scan 2025-01-27)

**Evidence:** `06.frontend-standards-2026.md` (section 4.3), `src/components/ui/input.tsx`, `src/app/checkout/page.tsx` (error display)

### 6.5 Color Contrast
- [ ] **Text contrast:** WCAG AA minimum (4.5:1 normal text, 3:1 large text)
- [ ] **Interactive elements:** Button, link contrast yeterli
- [ ] **Error states:** Error text contrast yeterli
- [ ] **Dark mode:** Dark mode'da contrast kontrolleri

**Evidence:** `04.design-system.md` (color system), `06.frontend-standards-2026.md` (section 4.4)

### 6.6 Screen Reader Labels
- [ ] **Icon buttons:** `aria-label` mevcut (örn: cart icon, favorite button)
- [ ] **Image alt text:** Product images'da `alt` attribute mevcut
- [ ] **Navigation:** `aria-current="page"` active tab için kullanılır
- [ ] **Form labels:** Input field'larda `<label>` veya `aria-label` mevcut

**Evidence:** `05.native-ux-rules.md` (section 9.3), `src/components/app/mobile-bottom-nav.tsx` (aria-label, aria-current), `src/components/cart/cart-icon-button.tsx`

---

## 7. Responsive & Cross-Browser Matrix

### 7.1 Device Breakpoints
- **Mobile (sm):** iPhone SE (375px)
- **Mobile (md):** iPhone 13 (390px)
- **Mobile (lg):** iPhone 15 Pro Max (430px)
- **Tablet:** iPad (768px)
- **Desktop (xl):** 1280px
- **Desktop (2xl):** 1536px

**Evidence:** `04.design-system.md` (breakpoints), `05.native-ux-rules.md` (section 4)

### 7.2 Browser Matrix

| Browser | Version | Mobile | Tablet | Desktop | Test Scope |
|---------|---------|--------|--------|---------|------------|
| Chrome | Latest | ✅ | ✅ | ✅ | Smoke flows + PDP/cart/checkout |
| Safari | Latest (iOS/macOS) | ✅ | ✅ | ✅ | Smoke flows + PDP/cart/checkout |
| Firefox | Latest | ✅ | - | ✅ | Smoke flows + PDP/cart/checkout |

**Assumption:** Standard browser matrix. Production'da gerçek kullanıcı verilerine göre güncellenebilir. (Browser matrix not defined in repo as of scan 2025-01-27)

### 7.3 Critical Test Scenarios (Responsive)
- [ ] **Mobile bottom nav:** 5 tab görünür, cart drawer çalışır
- [ ] **PDP bottom nav hidden:** `/urun/[slug]` sayfalarında bottom nav gizlenir
- [ ] **Sticky action bar:** Safe area support (`env(safe-area-inset-bottom)`)
- [ ] **Desktop navigation:** Mega menu dropdown çalışır
- [ ] **Tablet layout:** Account sidebar (xl+) görünür

**Evidence:** `05.native-ux-rules.md` (section 4.1, 12.1), `src/components/app/mobile-bottom-nav.tsx` (PDP bottom nav hide logic)

---

## 8. Performance Checklist

### 8.1 Core Web Vitals (Manual Check)
- [ ] **LCP (Largest Contentful Paint):** < 2.5s (hedef)
- [ ] **INP (Interaction to Next Paint):** < 200ms (hedef)
- [ ] **CLS (Cumulative Layout Shift):** < 0.1 (hedef)
- **Tool:** Chrome DevTools Lighthouse, Web Vitals extension

**Evidence:** `06.frontend-standards-2026.md` (section 5), `09.data-fetching-cache-rules.md` (section 11)

### 8.2 Bundle Size
- [ ] **Client component check:** Gereksiz "use client" yok
- [ ] **Dynamic imports:** Unknown (dynamic import pattern not found in repo as of scan 2025-01-27)
- [ ] **Bundle analysis:** `npm run build` sonrası bundle size kontrolü

**Evidence:** `06.frontend-standards-2026.md` (section 5.1, 5.3), `package.json` (build script)

### 8.3 Image Optimization
- [ ] **next/image usage:** Tüm görseller `next/image` component'i ile
- [ ] **Remote patterns:** `next.config.ts` içinde `remotePatterns` tanımlı
- [ ] **Lazy loading:** Image lazy loading çalışır

**Evidence:** `06.frontend-standards-2026.md` (section 5.2), `next.config.ts` (remotePatterns config), `src/components/product/product-view.tsx` (next/image import)

### 8.4 Infinite Scroll Performance
- [ ] **LoadMoreGrid:** Cursor pagination çalışır, duplicate önlenir
- [ ] **Deduplication:** wcId bazlı duplicate kontrolü
- [ ] **Memory leak:** AbortController ile request cancel çalışır

**Evidence:** `09.data-fetching-cache-rules.md` (section 11.2, 11.3), `src/components/catalog/load-more-grid.tsx` (deduplication logic)

---

## 9. Data/Cache Regression Checks

### 9.1 Cache Invalidation
- [ ] **Favorites mutation:** `revalidatePath` ile cache invalidate edilir
- [ ] **Admin order update:** `revalidatePath` ile cache invalidate edilir
- [ ] **revalidateTag:** Not implemented (revalidateTag not used, only revalidatePath as of scan 2025-01-27)

**Evidence:** `09.data-fetching-cache-rules.md` (section 6.4), `src/actions/favorites.ts` (revalidatePath usage), `src/actions/admin.ts` (revalidatePath usage)

### 9.2 localStorage Hydration
- [ ] **Cart hydration:** Cart state localStorage'dan hydrate edilir, `hydrated` flag çalışır
- [ ] **Favorites hydration:** Server fetch + localStorage sync çalışır
- [ ] **Tab scroll:** sessionStorage ile scroll position korunur
- [ ] **SSR/client mismatch:** `hydrated` flag ile mismatch önlenir

**Evidence:** `09.data-fetching-cache-rules.md` (section 3.3), `src/components/cart/cart-provider.tsx` (localStorage hydration pattern), `src/components/favorites/favorites-provider.tsx` (server fetch + hydration)

### 9.3 Mutation UI Updates
- [ ] **Add to cart:** UI hemen güncellenir, toast gösterilir
- [ ] **Favorites toggle:** Optimistic update + rollback çalışır
- [ ] **Order creation:** Success redirect çalışır

**Evidence:** `09.data-fetching-cache-rules.md` (section 8), `src/components/product/product-view.tsx` (add to cart pattern), `src/components/favorites/favorites-provider.tsx` (optimistic update pattern)

---

## 10. API Contract Regression Checks

### 10.1 Endpoint Uydurma Yasağı
- [ ] **Products API:** `/api/products` endpoint contract bozulmamış
- [ ] **Product detail API:** `/api/products/[slug]` contract bozulmamış
- [ ] **Search API:** `/api/search` contract bozulmamış
- [ ] **Auth endpoints:** NextAuth endpoints çalışır

**Evidence:** `08.api-contracts-frontend.md` (section 5), `03.routes-and-navigation-map.md` (section 3)

### 10.2 Field Uydurma Yasağı
- [ ] **Product response:** Product response shape değişmemiş
- [ ] **Pagination:** Cursor pagination contract bozulmamış (`nextCursor` field)
- [ ] **Filter params:** Filter query params bozulmamış (`sort`, `min`, `max`, `inStock`, `sub`)

**Evidence:** `08.api-contracts-frontend.md` (section 4.3, 7.1), `src/app/api/products/route.ts`

### 10.3 Server Action Contracts
- [ ] **Checkout action:** `createOrderAction` input/output shape bozulmamış
- [ ] **Favorites actions:** `toggleFavoriteAction`, `getMyFavoritesAction` contract bozulmamış
- [ ] **Address actions:** Address CRUD actions contract bozulmamış

**Evidence:** `08.api-contracts-frontend.md` (section 7), `src/actions/checkout.ts`, `src/actions/favorites.ts`, `src/actions/address.ts`

---

## 11. Visual Regression (Manual)

Manuel görsel kontrol listesi. Her release öncesi "Before/After screenshot" alınmalı.

### 11.1 Critical UI Components
- [ ] **Header:** Mobile/Desktop header görünümü
- [ ] **Product detail gallery:** Image gallery, zoom, navigation
- [ ] **Price block:** Fiyat gösterimi, indirim badge
- [ ] **CTA buttons:** Sepete Ekle, Siparişi Tamamla button'ları
- [ ] **Cart summary:** Sepet özeti, toplam fiyat
- [ ] **Checkout form:** Adres formu, ödeme yöntemi seçimi

**Evidence:** `07.component-inventory.md` (section 5), `04.design-system.md`

### 11.2 Dark Mode
- [ ] **Dark mode toggle:** Theme toggle çalışır
- [ ] **Color contrast:** Dark mode'da contrast yeterli
- [ ] **Image visibility:** Dark mode'da görseller görünür

**Evidence:** `src/components/theme/theme-toggle.tsx`, `04.design-system.md` (dark mode tokens)

### 11.3 Mobile-Specific
- [ ] **Bottom nav:** 5 tab görünümü, active state
- [ ] **Cart drawer:** Drawer açılma/kapanma animasyonu
- [ ] **Sticky action bar:** Safe area support, iOS home indicator

**Evidence:** `05.native-ux-rules.md` (section 4.1, 4.2), `src/components/app/mobile-bottom-nav.tsx`

---

## 12. Bug Report Template

Kopyalanabilir bug report şablonu.

```markdown
## Bug Summary
[Kısa özet - 1 cümle]

## Environment
- **Browser:** [Chrome/Safari/Firefox + version]
- **Device:** [iPhone 13 / iPad / Desktop]
- **OS:** [iOS 17 / macOS 14 / Windows 11]
- **URL:** [Hangi sayfa/route]
- **User:** [Authenticated/Guest]

## Steps to Reproduce
1. [Adım 1]
2. [Adım 2]
3. [Adım 3]

## Expected Behavior
[Ne olması gerekiyordu]

## Actual Behavior
[Ne oldu]

## Screenshots/Video
[Ekran görüntüsü veya video linki]

## Console/Network Logs
[Browser console hataları, network request/response]

## Suspected Area
- **Route:** [örn: `/urun/[slug]`]
- **Component:** [örn: `ProductView`]
- **File:** [örn: `src/components/product/product-view.tsx`]

## Severity
- [ ] S0 - Critical (site down, checkout broken)
- [ ] S1 - High (major feature broken)
- [ ] S2 - Medium (minor feature broken, workaround var)
- [ ] S3 - Low (cosmetic, edge case)
```

**Evidence:** Best practice (standard bug report format)

---

## 13. Exit Criteria (Release Gate)

Release için minimum kriterler. Tümü PASS olmalı.

### 13.1 Critical Checks
- [ ] **Tüm smoke testler PASS:** SMK-01 ile SMK-08 arası tüm akışlar çalışır
- [ ] **Critical a11y issues yok:** Keyboard navigation, focus trap çalışır
- [ ] **Build PASS:** `npm run build` hatasız geçer
- [ ] **Lint PASS:** `npm run lint` hatasız geçer
- [ ] **High severity bug yok:** S0, S1 severity bug'lar fix edilmiş
- [ ] **Checkout akışı PASS:** SMK-03 (Cart → Checkout → Success) çalışır

### 13.2 Nice-to-Have
- [ ] **Performance metrics:** LCP < 2.5s, INP < 200ms, CLS < 0.1
- [ ] **Visual regression:** Critical UI component'lerde görsel değişiklik yok
- [ ] **Cross-browser:** Chrome, Safari, Firefox'ta smoke testler PASS

**Evidence:** `06.frontend-standards-2026.md` (section 12), `10.tasks-playbook.md` (DoD checklist)

---

## 14. Evidence Index

En önemli kanıt dosyaları ve referanslar:

1. **03.routes-and-navigation-map.md** - Route table, kritik akışlar (section 6)
2. **05.native-ux-rules.md** - UX kuralları, toast pattern, button states (section 3.1, 7)
3. **06.frontend-standards-2026.md** - DoD, kalite kapıları (section 12)
4. **08.api-contracts-frontend.md** - API endpoint contracts, uydurma yasağı
5. **09.data-fetching-cache-rules.md** - Cache invalidation, localStorage hydration
6. **07.component-inventory.md** - Component envanteri, kritik component'ler
7. **src/app/page.tsx** - Ana sayfa, Server Component pattern
8. **src/app/[slug]/page.tsx** - Kategori sayfası, loading state
9. **src/app/urun/[slug]/page.tsx** - Ürün detay, notFound pattern
10. **src/app/checkout/page.tsx** - Checkout flow, form validation, error handling
11. **src/app/cart/page.tsx** - Sepet sayfası
12. **src/app/search/page.tsx** - Arama sayfası, Suspense pattern
13. **src/components/product/product-view.tsx** - Add to cart pattern, toast
14. **src/components/cart/cart-provider.tsx** - Cart state, localStorage hydration
15. **src/components/favorites/favorites-provider.tsx** - Optimistic UI, rollback pattern
16. **src/components/app/mobile-bottom-nav.tsx** - Bottom nav, PDP hide exception
17. **src/app/[slug]/loading.tsx** - Category loading state
18. **src/app/urun/[slug]/loading.tsx** - Product loading state
19. **src/app/not-found.tsx** - Root not-found page
20. **src/actions/checkout.ts** - Checkout server action, Zod validation
21. **src/actions/favorites.ts** - Favorites server actions, revalidatePath
22. **src/app/api/products/route.ts** - Products API, cursor pagination
23. **src/app/api/search/route.ts** - Search API, error handling
24. **package.json** - Scripts (dev, build, lint), dependencies
25. **04.design-system.md** - Design tokens, color system
26. **src/components/favorites/wishlist-client.tsx** - Empty wishlist state
27. **src/components/account/address-form.tsx** - Address form, form submission
28. **src/components/cart/cart-view.tsx** - Empty cart state
29. **next.config.ts** - Image remotePatterns configuration
30. **src/app/account/layout.tsx** - Account layout, auth protection

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni route'lar, component'ler veya API contract'lar eklendiğinde bu doküman güncellenmelidir.
---

# DOC-12: 12.release-prod-checklist.md

---
# 12. Release Production Checklist

Bu doküman, Cinselhobi.com Next projesinin production release öncesi ve sonrası yapılacakları "tek doğru checklist" olarak dokümante eder. Amaç: env/cache/route/API/UX kalite kapılarını release anında kaçırmayı engellemek.

**As of repo scan:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

Bu checklist şunları garanti eder:

1. **Build & Lint Kontrolü:** Production build başarılı, lint hatası yok
2. **Route Doğrulama:** Kırık link yok, dynamic slug conflicts kontrolü
3. **API Contract Korunması:** Endpoint/field uydurma yok, pagination/filter/sort bozulmadı
4. **Cache/ISR Doğrulama:** Cache invalidation, localStorage hydration, revalidate kuralları korunuyor
5. **UX/A11y Kalite:** Kritik feedback pattern'leri, keyboard navigation, focus yönetimi çalışıyor
6. **Env & Secrets Güvenliği:** Production env variable'ları doğru, `NEXT_PUBLIC_*` anahtarları kontrol edildi
7. **Rollback Hazırlığı:** Riskli değişiklikler için rollback planı mevcut
8. **Post-Release Doğrulama:** Smoke testler, API health, critical UI kontrolleri

**Evidence:** `06.frontend-standards-2026.md` (DoD), `11.qa-test-matrix.md` (exit criteria), `08.api-contracts-frontend.md` (contract rules), `09.data-fetching-cache-rules.md` (cache rules), `03.routes-and-navigation-map.md` (route validation)

---

## 2. Release Types

### 2.1 Hotfix (Kritik Bug)
**Minimum Gates:**
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: Kritik akış (checkout, sepete ekleme) çalışıyor
- [ ] Rollback planı hazır

**Evidence:** `package.json` (scripts: lint, build), `11.qa-test-matrix.md` (smoke tests)

### 2.2 Minor UI Release
**Minimum Gates:**
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: SMK-01, SMK-02, SMK-03 (11.qa-test-matrix.md'ye göre)
- [ ] Visual regression: Değişen UI component'leri kontrol edildi
- [ ] Mobile test: Bottom nav, cart drawer çalışıyor

**Evidence:** `11.qa-test-matrix.md` (smoke tests, visual regression)

### 2.3 Feature Release
**Minimum Gates:**
- [ ] Tüm Pre-Release Checklist (Local) PASS
- [ ] Tüm Pre-Release Checklist (CI) PASS
- [ ] Env & Secrets Checklist PASS
- [ ] Routing & Navigation Checklist PASS
- [ ] API Contract Checklist PASS
- [ ] Data/Cache/ISR Checklist PASS
- [ ] UX/A11y Checklist PASS
- [ ] Post-Release Verification PASS

**Evidence:** Bu doküman (tüm bölümler)

### 2.4 Config/Env Only
**Minimum Gates:**
- [ ] Env & Secrets Checklist PASS
- [ ] `npm run build` PASS (env değişikliği build'i bozmadı)
- [ ] Manuel smoke: Env'e bağlı ekranlar çalışıyor (örn: API base URL değiştiyse)

**Evidence:** `package.json` (build script), Env & Secrets Checklist (section 5)

---

## 3. Pre-Release Checklist (Local)

### 3.1 Lint & Type Check
- [ ] `npm run lint` hatasız geçiyor
- [ ] `npm run build` TypeScript hataları yok (build sırasında kontrol ediliyor)

**Evidence:** `package.json` (scripts: lint, build), `06.frontend-standards-2026.md` (section 12: DoD)

### 3.2 Build Test
- [ ] `npm run build` başarılı
- [ ] Build output: `.next/` klasörü oluştu
- [ ] Build hatası yok (route errors, missing dependencies, vb.)

**Evidence:** `package.json` (scripts: build)

### 3.3 Production Simulation
- [ ] `npm run build && npm run start` çalışıyor
- [ ] `http://localhost:3000` açılıyor
- [ ] SSR/SSG davranışı doğru (Server Component'ler render ediliyor)

**Evidence:** `package.json` (scripts: build, start), `11.qa-test-matrix.md` (section 2.2: Local Production Simulation)

### 3.4 Manuel Smoke Tests
**Minimum Smoke Tests (11.qa-test-matrix.md'ye göre):**
- [ ] SMK-01: Home → Category → Product → Add to Cart (toast + button state)
- [ ] SMK-02: Search → Product Detail
- [ ] SMK-03: Cart → Checkout → Order Success (boş sepet kontrolü, loading state)
- [ ] SMK-04: Login → Account → Wishlist (auth redirect çalışıyor)

**Evidence:** `11.qa-test-matrix.md` (section 3: Smoke Tests)

---

## 4. Pre-Release Checklist (CI)

### 4.1 CI Configuration
- [ ] CI config var mı? (GitHub Actions, GitLab CI, vb.)
  - [ ] Lint step var
  - [ ] Build step var
  - [ ] Test step var (varsa)
  - [ ] Cache steps var (node_modules, .next cache)

**Evidence:** Unknown (CI config dosyası bulunamadı, as of repo scan: 2025-01-27)

### 4.2 CI Pipeline
- [ ] CI pipeline başarılı geçiyor
- [ ] Build artifact oluşuyor (varsa)
- [ ] Deployment trigger çalışıyor (varsa)

**Evidence:** Unknown (CI config yok)

---

## 5. Env & Secrets Checklist

### 5.1 Environment Files
**Dosya İsimleri (değer yok):**
- [ ] `.env.local` (local development, gitignore'da)
- [ ] `.env` (default, gitignore'da olabilir)
- [ ] `.env.production` (production secrets, gitignore'da)

**Evidence:** `.gitignore` (env files ignore edilir, assumption)

### 5.2 Observed env keys (found in code/docs)
**Backend Env (Frontend'den erişilmiyor, kodda kullanılıyor):**
- [ ] `DATABASE_URL` - PostgreSQL connection string (kodda kullanılıyor)
- [ ] `AUTH_SECRET` - NextAuth.js secret (kodda kullanılıyor)
- [ ] `AUTH_URL` - NextAuth.js base URL (dokümanlarda geçiyor)

**Evidence:** `src/db/connection.ts` (DATABASE_URL usage), `src/auth.ts` (AUTH_SECRET check), `08.api-contracts-frontend.md` (section 2.2: Environment Variables), `02.architecture-lock.md` (env keys)

### 5.3 Expected env keys (if used)
**Frontend Env (NEXT_PUBLIC_*):**
- [ ] `NEXT_PUBLIC_*` env variable'ları: As of repo scan 2025-01-27, no `NEXT_PUBLIC_*` usage detected in codebase

**Evidence:** `grep -r "NEXT_PUBLIC_"` (as of repo scan 2025-01-27: 0 files found), `08.api-contracts-frontend.md` (section 2.2: "Frontend'de NEXT_PUBLIC_* env variable'ları kullanılmıyor")

**Assumption:** Frontend tüm API çağrılarını relative path ile yapıyor, external API base URL'i yok. Eğer ileride `NEXT_PUBLIC_*` kullanılacaksa bu bölüm güncellenmelidir.

### 5.4 Env Değişikliği Impact
- [ ] Env değişince hangi ekran etkilenir? (örn: API base URL değiştiyse tüm fetch'ler)
- [ ] Env değişikliği build'i bozmadı (`npm run build` PASS)

**Evidence:** `08.api-contracts-frontend.md` (section 2.1: Internal API Routes - relative path kullanılıyor, env değişikliği etkilemez)

---

## 6. Build & Artifact Checklist

### 6.1 Node & Package Manager
- [ ] Node sürümü: Unknown (package.json'da engines field yok)
- [ ] Package manager: npm (as of repo scan 2025-01-27: `package-lock.json` detected)
- [ ] Lockfile commit edilmiş: `package-lock.json` (npm lockfile)

**Evidence:** `package.json` (engines field yok), `package-lock.json` (as of repo scan 2025-01-27: npm lockfile detected)

### 6.2 Build Output
- [ ] Build output: `.next/` klasörü
- [ ] Static assets: `public/` klasörü build'e dahil
- [ ] Images: `next/image` remotePatterns doğru (`next.config.ts`)

**Evidence:** `next.config.ts` (images.remotePatterns), `06.frontend-standards-2026.md` (section 5.2: Image Optimization)

### 6.3 Bundle Size
- [ ] Bundle şişmesi kontrolü: Chrome DevTools → Network → JS bundle size
- [ ] Gereksiz "use client" yok (Server Component default)
- [ ] Dynamic import pattern kullanılıyor mu? Unknown (codebase'de görülmedi)

**Evidence:** `06.frontend-standards-2026.md` (section 5.1, 5.3: Client Component Optimization, Bundle Size)

---

## 7. Routing & Navigation Checklist

### 7.1 Route Validation
- [ ] Kırık link yok (Footer, Header, Mobile Bottom Nav linkleri çalışıyor)
- [ ] Dynamic slug conflicts: `RESERVED_SLUGS` kontrolü (`/[slug]` route'u için)
- [ ] Not-found coverage: `notFound()` çağrıları doğru (`/[slug]`, `/urun/[slug]`)

**Evidence:** `03.routes-and-navigation-map.md` (section 8.1: Dynamic Route Params, section 9.3: Not-Found States), `src/components/layout/header.tsx` (RESERVED_SLUGS array)

### 7.2 Navigation Links
- [ ] Footer linkleri çalışıyor (`/about`, `/support`, `/gizlilik-ve-guvenlik`, vb.)
- [ ] Header navigation çalışıyor (mega menu, search overlay)
- [ ] Mobile bottom nav çalışıyor (5 tab: Home, Categories, Cart, Wishlist, Profile)
- [ ] Account sidebar navigation çalışıyor (`/account/*` routes)

**Evidence:** `03.routes-and-navigation-map.md` (section 5: Navigation Entry Points), `src/components/app/Footer.tsx`, `src/components/app/mobile-bottom-nav.tsx`

### 7.3 Broken Link Risk
- [ ] Footer'da `/sss` linki var ama route yok (404 riski) - bilinen gap

**Evidence:** `03.routes-and-navigation-map.md` (section 9.4: Gaps), `src/components/app/Footer.tsx` ("/sss" link)

---

## 8. API Contract Checklist

### 8.1 Endpoint Uydurma Yasağı
- [ ] Yeni endpoint eklenmedi (sadece mevcut endpoint'ler kullanılıyor)
- [ ] Endpoint contract'ları bozulmadı:
  - [ ] `/api/products` - cursor pagination, filter params
  - [ ] `/api/products/[slug]` - product detail response shape
  - [ ] `/api/search` - search response shape
  - [ ] `/api/auth/[...nextauth]` - NextAuth endpoints
  - [ ] `/api/auth/signup` - signup request/response

**Evidence:** `08.api-contracts-frontend.md` (section 5: API Inventory), `10.tasks-playbook.md` (uydurma yasağı)

### 8.2 Field Uydurma Yasağı
- [ ] Product response shape değişmedi (`id`, `wcId`, `slug`, `name`, `price`, `images`, vb.)
- [ ] Pagination contract bozulmadı (`nextCursor` field)
- [ ] Filter params bozulmadı (`sort`, `min`, `max`, `inStock`, `sub`)

**Evidence:** `08.api-contracts-frontend.md` (section 4.3: Pagination/Filter/Sort, section 7.1: Product Contracts)

### 8.3 Server Action Contracts
- [ ] `createOrderAction` input/output shape bozulmadı
- [ ] `toggleFavoriteAction`, `getMyFavoritesAction` contract bozulmadı
- [ ] Address CRUD actions contract bozulmadı

**Evidence:** `08.api-contracts-frontend.md` (section 7: Contracts by Feature), `src/actions/checkout.ts`, `src/actions/favorites.ts`, `src/actions/address.ts`

---

## 9. Data/Cache/ISR Checklist

### 9.1 Cache-Control & Dynamic Rules
- [ ] `/api/products` route: `dynamic = "force-dynamic"`, `revalidate = 0`, `Cache-Control: no-store` korunuyor
- [ ] `/api/products/[slug]` route: `dynamic = "force-dynamic"` korunuyor
- [ ] `/api/search` route: Cache config değişmedi (default dynamic)

**Evidence:** `09.data-fetching-cache-rules.md` (section 6.1: API Route Cache Settings), `src/app/api/products/route.ts` (dynamic, revalidate, Cache-Control)

### 9.2 Cache Invalidation (revalidatePath)
- [ ] Favorites mutation: `revalidatePath` ile cache invalidate ediliyor
- [ ] Admin order update: `revalidatePath` ile cache invalidate ediliyor
- [ ] `revalidateTag` kullanılmıyor (sadece `revalidatePath` kullanılıyor)

**Evidence:** `09.data-fetching-cache-rules.md` (section 6.4: Cache Invalidation), `src/actions/favorites.ts` (revalidatePath), `src/actions/admin.ts` (revalidatePath)

### 9.3 localStorage Hydration
- [ ] Cart hydration: `hydrated` flag çalışıyor, SSR/client mismatch yok
- [ ] Favorites hydration: Server fetch + localStorage sync çalışıyor
- [ ] Tab scroll: sessionStorage ile scroll position korunuyor

**Evidence:** `09.data-fetching-cache-rules.md` (section 3.3: Provider State, section 9.2: localStorage Hydration), `src/components/cart/cart-provider.tsx` (hydrated flag)

### 9.4 Mutation UI Updates
- [ ] Add to cart: UI hemen güncelleniyor, toast gösteriliyor
- [ ] Favorites toggle: Optimistic update + rollback çalışıyor
- [ ] Order creation: Success redirect çalışıyor (`/order-success/[id]`)

**Evidence:** `09.data-fetching-cache-rules.md` (section 8: Mutations & Optimistic UI), `src/components/product/product-view.tsx` (add to cart), `src/components/favorites/favorites-provider.tsx` (optimistic update)

### 9.5 ISR Usage
- [ ] ISR kullanılmıyor (force-dynamic tercih ediliyor, real-time data için)

**Evidence:** `09.data-fetching-cache-rules.md` (section 7: ISR/Revalidate Rules)

---

## 10. UX/A11y Checklist

### 10.1 Critical Feedback Patterns
- [ ] Add to cart: Button state "Eklendi ✓" (2s timeout) + toast "Ürün sepete eklendi"
- [ ] Checkout submit: Loading state "İşleniyor..." + button disabled
- [ ] Toast position: `top-center` (Sonner config)

**Evidence:** `05.native-ux-rules.md` (section 3.1: Critical Action Feedback Pattern), `src/components/product/product-view.tsx` (add to cart), `src/app/layout.tsx` (Toaster config)

### 10.2 Mobile UX
- [ ] PDP bottom nav hidden: `/urun/[slug]` sayfalarında bottom nav gizleniyor
- [ ] Sticky action bar: Safe area support (`env(safe-area-inset-bottom)`)
- [ ] Touch targets: Minimum 44px (`h-11` veya daha büyük)

**Evidence:** `05.native-ux-rules.md` (section 2.1: Critical CTA Visibility, section 4.1: Mobile Bottom Navigation Rules), `src/components/app/mobile-bottom-nav.tsx` (PDP hide logic)

### 10.3 Keyboard Navigation
- [ ] Focus ring: `focus-visible:ring-2` görünür
- [ ] Tab order: Logical order (DOM sırasına uygun)
- [ ] Escape key: Dialog/Drawer kapatma çalışıyor
- [ ] Focus trap: Dialog açıldığında focus trap aktif (Radix UI)

**Evidence:** `06.frontend-standards-2026.md` (section 4.1, 4.2: Focus Visibility, Keyboard Navigation), `src/components/ui/dialog.tsx` (Radix UI)

### 10.4 Form Errors
- [ ] Inline error display: `text-destructive bg-destructive/10` pattern
- [ ] ARIA connection: `aria-describedby` veya `aria-invalid` kullanılıyor (varsa)

**Evidence:** `06.frontend-standards-2026.md` (section 4.3: Form Error Messages), `src/app/checkout/page.tsx` (error display)

### 10.5 Reduced Motion
- [ ] `useReducedMotion()` hook kullanılıyor (framer-motion)
- [ ] Reduced motion aktifse animasyon disable ediliyor

**Evidence:** `05.native-ux-rules.md` (section 8.2: Reduced Motion Support), `src/components/app/page-transition.tsx` (useReducedMotion)

---

## 11. Observability Checklist

### 11.1 Error Tracking
- [ ] Error tracking var mı? (Sentry, LogRocket, vb.)
  - [ ] Error tracking config doğru
  - [ ] Error boundaries var mı? Unknown (root error.tsx yok)

**Evidence:** Unknown (error tracking tool yok, as of repo scan: 2025-01-27), `06.frontend-standards-2026.md` (section 7.1: Error Boundaries - root error.tsx yok)

### 11.2 Logging
- [ ] Structured logging var mı? Unknown (console.error kullanılıyor)
- [ ] Production log level ayarlı mı? Unknown

**Evidence:** `09.data-fetching-cache-rules.md` (section 9.1: API Route Error Handling - console.error), Unknown (structured logging yok)

### 11.3 Analytics Events
- [ ] Analytics events var mı? (Google Analytics, Plausible, vb.)
  - [ ] Event tracking config doğru
  - [ ] Critical events track ediliyor (add to cart, checkout, vb.)

**Evidence:** Unknown (analytics tool yok, as of repo scan: 2025-01-27)

### 11.4 Open Items
- [ ] Error tracking: Open item (Sentry veya benzeri tool eklenmeli)
- [ ] Structured logging: Open item (console.error yerine structured logging)
- [ ] Analytics: Open item (analytics events eklenmeli)

**Evidence:** Unknown (observability tools yok)

---

## 12. Rollback Plan

### 12.1 Rollback Yöntemleri
- [ ] **Revert commit:** Git revert ile son commit geri alınabilir
- [ ] **Redeploy previous release (Kamatera VPS):**
  - Sunucuya SSH ile gir
  - Uygulama dizininde (`/var/www/cinselhobi.com-next`) `git` ile önceki stabil commit/tag'e dön (hangi tag/commit kullanıldığı Unknown ise not düş)
  - Deploy dokümanındaki akışla tekrar build al (`npm ci`, `npm run build`)
  - PM2 ile process'i restart et (`pm2 restart cinselhobi-next`)
- [ ] **Hotfix revert (self-hosted):**
  - `git revert` ile hatalı commit'i geri al
  - Deploy dokümanındaki standart deploy akışını tekrar çalıştır (`git pull`, `npm ci`, `npm run build`, `pm2 restart cinselhobi-next`)
- [ ] **Config-only rollback:**
  - Env değişikliği ise: önce eski env değerlerine dön, PM2 reload/restart + `--update-env` ihtiyacı varsa deploy dokümanına göre uygula (dokümanda yoksa Unknown yaz)
- [ ] **Feature flag:** Feature flag kullanılıyor mu? Unknown (feature flag tool yok)

**Evidence:** `01.project-brief.md` (Goals: Kamatera VPS self-hosted), `docs/04-deploy-kamatera-pm2.md` (deploy/pm2 akışı), `12.release-prod-checklist.md` (Rollback hazırlığı)

### 12.1.1 PM2 Rollback Checklist (LOCKED)
- [ ] `pm2 list` ile doğru process (`cinselhobi-next`) doğrulandı
- [ ] Uygulama health endpoint / kritik sayfalar açılıyor (Home, PDP, Cart)
- [ ] Log kontrolü (`pm2 logs cinselhobi-next --lines 200`)

### 12.2 Riskli Değişiklikler
**En riskli değişiklikler ve geri dönüş adımları:**
- [ ] **Database schema değişikliği:** Migration rollback planı hazır mı?
- [ ] **API contract değişikliği:** Breaking change varsa versioning/feature flag planı var mı?
- [ ] **Auth flow değişikliği:** NextAuth.js config değiştiyse rollback test edildi mi?
- [ ] **State management değişikliği:** Provider hiyerarşisi değiştiyse rollback test edildi mi?

**Evidence:** `02.architecture-lock.md` (section 2: Non-Negotiables), `10.tasks-playbook.md` (rollback stratejisi)

### 12.3 DB Migration Note
- [ ] **DB migration yoksa:** Frontend scope'unda DB migration yok, rollback sadece code revert

**Evidence:** `02.architecture-lock.md` (section 2.3: Database & ORM - migration pattern)

---

## 13. Post-Release Verification

### 13.1 Smoke Tests
- [ ] SMK-01: Home → Category → Product → Add to Cart (toast + button state)
- [ ] SMK-02: Search → Product Detail
- [ ] SMK-03: Cart → Checkout → Order Success (boş sepet kontrolü, loading state)
- [ ] SMK-04: Login → Account → Wishlist (auth redirect)
- [ ] SMK-05: Product Detail → Add to Favorites (optimistic update)
- [ ] SMK-06: Empty Cart Flow (empty state, redirect)
- [ ] SMK-07: Empty Search Results (empty state)
- [ ] SMK-08: Protected Route Access (unauth redirect)

**Evidence:** `11.qa-test-matrix.md` (section 3: Smoke Tests)

### 13.2 API Health
- [ ] `/api/products` çalışıyor (cursor pagination, filter params)
- [ ] `/api/products/[slug]` çalışıyor (product detail)
- [ ] `/api/search` çalışıyor (search query)
- [ ] `/api/auth/[...nextauth]` çalışıyor (NextAuth endpoints)

**Evidence:** `08.api-contracts-frontend.md` (section 5: API Inventory), `11.qa-test-matrix.md` (section 10: API Contract Regression Checks)

### 13.3 Cache Behavior
- [ ] Cart hydration çalışıyor (localStorage → UI sync)
- [ ] Favorites hydration çalışıyor (server fetch + localStorage sync)
- [ ] Cache invalidation çalışıyor (favorites toggle sonrası UI güncelleniyor)

**Evidence:** `09.data-fetching-cache-rules.md` (section 9.2: localStorage Hydration, section 9.3: Mutation UI Updates)

### 13.4 Critical UI
- [ ] PDP: Sticky action bar görünür, bottom nav gizli
- [ ] Cart: Drawer açılıyor (mobile), empty state çalışıyor
- [ ] Checkout: Form validation çalışıyor, loading state çalışıyor, error display çalışıyor
- [ ] Mobile bottom nav: 5 tab görünür, active state çalışıyor

**Evidence:** `05.native-ux-rules.md` (section 4.1: Mobile Bottom Navigation Rules, section 6.3: Checkout Flow UX), `11.qa-test-matrix.md` (section 4: Route-by-Route Checklist)

### 13.5 Error Logs
- [ ] Error logs kontrol edildi (varsa: Sentry, console errors, vb.)
- [ ] Critical error yok (S0, S1 severity)

**Evidence:** Unknown (error tracking tool yok), `11.qa-test-matrix.md` (section 12: Bug Report Template)

---

## 14. Incident Playbook (Quick)

### 14.1 Severity Definitions
- **S0 - Critical:** Site down, checkout broken, tüm kullanıcılar etkileniyor
- **S1 - High:** Major feature broken (sepete ekleme, arama, vb.)
- **S2 - Medium:** Minor feature broken, workaround var
- **S3 - Low:** Cosmetic, edge case

**Evidence:** `11.qa-test-matrix.md` (section 12: Bug Report Template - Severity)

### 14.2 İlk 10 Dakika
- [ ] **Rollback mi hotfix mi?** Karar verildi
  - S0/S1: Rollback (bkz. 12.1 — Redeploy previous release (Kamatera VPS + PM2))
  - S2/S3: Hotfix (hızlı fix + redeploy)
- [ ] **Impact değerlendirmesi:** Kaç kullanıcı etkileniyor? (analytics, error logs)
- [ ] **Communication:** Kullanıcılara bilgi verildi mi? (varsa: status page, email, vb.)

**Evidence:** `11.qa-test-matrix.md` (section 12: Bug Report Template), `10.tasks-playbook.md` (rollback stratejisi)

### 14.3 Kim Bilgilendirilecek?
- [ ] **Internal:** Development team, product owner
- [ ] **External:** Kullanıcılar (varsa: status page, email notification)

**Evidence:** Unknown (communication plan yok)

### 14.4 Not Alma Standardı
- [ ] **Incident report:** Bug summary, environment, steps to reproduce, expected vs actual behavior
- [ ] **Root cause:** Neden oldu? (code change, env change, dependency update, vb.)
- [ ] **Prevention:** Nasıl önlenebilir? (test coverage, CI/CD gate, vb.)

**Evidence:** `11.qa-test-matrix.md` (section 12: Bug Report Template)

---

## 15. Evidence Index

En önemli kanıt dosyaları ve referanslar:

1. **package.json** - Scripts (dev, build, lint, start), dependencies (next@16.1.1, react@19.2.3)
2. **next.config.ts** - Image remotePatterns configuration
3. **06.frontend-standards-2026.md** - DoD, kalite kapıları (section 12)
4. **11.qa-test-matrix.md** - Smoke test senaryoları, exit criteria (section 3, 13)
5. **08.api-contracts-frontend.md** - API endpoint contracts, uydurma yasağı
6. **09.data-fetching-cache-rules.md** - Cache invalidation, localStorage hydration, revalidatePath
7. **03.routes-and-navigation-map.md** - Route table, RESERVED_SLUGS, navigation links
8. **05.native-ux-rules.md** - UX kuralları, toast pattern, button states, mobile UX
9. **02.architecture-lock.md** - Architecture decisions, yasaklar, hard constraints
10. **10.tasks-playbook.md** - Rollback stratejisi, DoD checklist
11. **src/app/api/products/route.ts** - Products API, force-dynamic, revalidate=0, no-store
12. **src/app/api/products/[slug]/route.ts** - Product detail API, force-dynamic
13. **src/app/api/search/route.ts** - Search API, error handling
14. **src/actions/checkout.ts** - Checkout server action, Zod validation
15. **src/actions/favorites.ts** - Favorites server actions, revalidatePath
16. **src/components/cart/cart-provider.tsx** - Cart state, localStorage hydration, hydrated flag
17. **src/components/favorites/favorites-provider.tsx** - Optimistic UI, rollback pattern
18. **src/components/product/product-view.tsx** - Add to cart pattern, toast, button state
19. **src/components/app/mobile-bottom-nav.tsx** - Bottom nav, PDP hide exception, safe area
20. **src/app/checkout/page.tsx** - Checkout flow, form validation, error handling, loading state
21. **src/app/layout.tsx** - Toaster component, toast config (position: top-center)
22. **src/components/layout/header.tsx** - RESERVED_SLUGS array
23. **src/components/app/Footer.tsx** - Footer navigation links (broken link: /sss)
24. **src/app/[slug]/page.tsx** - Category page, RESERVED_SLUGS kontrolü, notFound()
25. **src/app/urun/[slug]/page.tsx** - Product detail page, notFound()

**Evidence:** Tüm yukarıdaki dosyalar codebase'de mevcut ve kanıt olarak kullanıldı

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni route'lar, API endpoint'leri, component'ler veya cache kuralları eklendiğinde bu doküman güncellenmelidir.
---

# DOC-13: 13.security-and-deps.md

---
şimdi # 13. Security and Dependencies

**As of repo scan: 2025-01-27**

## 1. Purpose

Bu doküman, cinselhobi.com-next projesi için frontend ve route handler güvenlik standartlarını ve dependency yönetim politikasını tanımlar. Aşağıdaki güvenlik alanlarını kapsar:

1. **XSS (Cross-Site Scripting) Koruması**: Kullanıcı girdilerinin sanitize edilmesi ve HTML render kuralları
2. **Authentication & Session Security**: Kullanıcı oturum yönetimi ve yetkilendirme
3. **Secrets Management**: Environment variable'ların güvenli kullanımı ve client'a sızma önleme
4. **Supply Chain Security**: Dependency güncelleme politikası ve vulnerability yönetimi
5. **Input Validation**: Server boundary'de validation ve output encoding
6. **API Security**: Route handler'larda auth check, rate limiting, error handling
7. **PII & Privacy**: Kişisel verilerin loglama ve analytics'te korunması
8. **Browser Security**: Security headers ve Content Security Policy (CSP)

---

## 2. Threat Model (Frontend Scope)

### Assets

Korunması gereken varlıklar:

- **User Session**: JWT token'ları ve session bilgileri
- **Order Data**: Sipariş detayları, ödeme bilgileri
- **Address Data**: Kullanıcı adres bilgileri (PII)
- **Favorites**: Kullanıcı favori ürün listesi
- **Admin Endpoints**: `/admin/*` route'ları ve admin-only actions
- **User Credentials**: Email ve password hash'leri (server-side)

**Evidence:** `src/app/account/layout.tsx` (protected routes), `src/app/admin/layout.tsx` (admin routes), `src/auth.ts` (session management)

### Attack Surface

Saldırı yüzeyleri:

- **Forms**: Login, signup, checkout, address forms (XSS, injection riski)
- **Search Parameters**: Query string'lerdeki user input (`/api/products`, `/api/search`)
- **Route Handlers**: `/api/*` endpoint'leri (auth bypass, rate limit bypass)
- **Server Actions**: `src/actions/*` (unauthorized access, validation bypass)
- **HTML Rendering**: `dangerouslySetInnerHTML` kullanımı (XSS riski)
- **3rd Party Scripts**: External image sources (Next.js Image component)

**Evidence:** `src/app/api/products/route.ts` (searchParams parsing), `src/components/product/product-view.tsx` (dangerouslySetInnerHTML), `src/actions/checkout.ts` (form validation)

### Admin Area

Admin area mevcut: `/admin/*` route'ları role-based access control ile korunuyor. Admin-only actions `src/actions/admin.ts` içinde tanımlı.

**Evidence:** `src/app/admin/layout.tsx` (role check: `session.user?.role !== "admin"`), `src/actions/admin.ts` (admin authorization check)

---

## 3. Secrets & Environment Variables

### Environment Files

Environment dosyaları repo'da görünmüyor (muhtemelen `.gitignore`'da). Beklenen dosyalar:

- `.env.local` (local development)
- `.env.production` (production, VPS'te olmalı)

**Evidence:** `.env*` dosyaları bulunamadı (as of repo scan: 2025-01-27)

### Environment Keys in Use

Kodda kullanılan environment key'leri:

- `AUTH_SECRET` - NextAuth secret (required)
- `DATABASE_URL` - PostgreSQL connection string
- `WOO_BASE_URL` - WooCommerce API base URL (import script)
- `WOO_CONSUMER_KEY` - WooCommerce API consumer key
- `WOO_CONSUMER_SECRET` - WooCommerce API consumer secret
- `WOO_IMPORT_MODE` - Import mode (`full` | `sample`)
- `WOO_IMPORT_LIMIT` - Sample mode limit
- `WOO_AUTH_MODE` - Auth mode (`basic` | `query`)
- `WOO_PRODUCT_STATUS` - Product status filter
- `NODE_ENV` - Environment mode (`development` | `production`)
- `TZ` - Timezone (`Europe/Istanbul`)

**Evidence:** `src/auth.ts` (AUTH_SECRET), `src/db/connection.ts` (DATABASE_URL), `scripts/woo-import.ts` (WOO_* keys), `next.config.ts` (TZ), `src/app/api/products/route.ts` (NODE_ENV)

### Rules

1. **Secret Leakage Prevention**: `NEXT_PUBLIC_*` prefix'i olmayan env key'ler client'a expose edilmez
2. **Server-Only Secrets**: `AUTH_SECRET`, `DATABASE_URL`, `WOO_CONSUMER_SECRET` gibi secret'lar sadece server-side kullanılır
3. **Client-Safe Keys**: `NEXT_PUBLIC_*` prefix'i olan key'ler client'a gönderilebilir (şu an kullanılmıyor)
4. **Production Validation**: Production'da `AUTH_SECRET` zorunludur (dev'de warning var)

**Evidence:** `src/auth.ts` (AUTH_SECRET check with console.warn), `src/db/connection.ts` (server-only DATABASE_URL)

---

## 4. Authentication & Session Security

### Authentication Method

**NextAuth v5 (Auth.js)** kullanılıyor. Credentials provider ile email/password authentication.

- **Provider**: `next-auth@5.0.0-beta.25`
- **Adapter**: `@auth/drizzle-adapter` (Drizzle ORM ile entegrasyon)
- **Password Hashing**: Argon2id (`argon2@0.44.0`)
- **Session Strategy**: JWT (database session değil)

**Evidence:** `package.json` (next-auth@5.0.0-beta.25, @auth/drizzle-adapter@1.11.1, argon2@0.44.0), `src/auth.ts` (NextAuth config, Credentials provider, argon2.verify), `src/auth.config.ts` (session strategy: "jwt")

### Protected Route Strategy

**Layout-level protection** kullanılıyor (middleware yok):

- `/account/*` - `src/app/account/layout.tsx` içinde `auth()` check, redirect `/login`
- `/admin/*` - `src/app/admin/layout.tsx` içinde `auth()` check + role check (`role !== "admin"`), redirect `/account` veya `/login`

**Evidence:** `src/app/account/layout.tsx` (session check, redirect), `src/app/admin/layout.tsx` (session + role check)

### Cookie Flags

NextAuth v5 default cookie flags kullanılıyor. Explicit configuration görülmedi.

**Assumption:** NextAuth v5 production'da `httpOnly`, `secure` (HTTPS'te), `sameSite: "lax"` kullanır.

**Reasoning:** NextAuth v5 default behavior. Explicit config yok, assumption.

**Evidence:** `src/auth.ts` (NextAuth config, cookie flags explicit değil), `src/auth.config.ts` (session config var ama cookie flags yok)

### CSRF Protection

**Unknown (as of repo scan: 2025-01-27)**

NextAuth v5 default olarak CSRF koruması sağlar, ancak explicit CSRF token check veya middleware'de CSRF validation görülmedi.

**Assumption:** NextAuth v5 built-in CSRF koruması aktif (default behavior).

**Reasoning:** NextAuth v5 documentation'a göre CSRF koruması default'ta var, ancak repo'da explicit kanıt yok.

**Evidence:** `src/auth.ts` (NextAuth config, CSRF explicit değil), middleware.ts yok

---

## 5. Input Validation & Output Encoding

### Validation Library

**Zod** kullanılıyor (`zod@4.2.1`). Server actions ve form validation'da kullanılıyor.

- Server actions: `src/actions/checkout.ts`, `src/actions/address.ts`
- Client forms: `src/components/account/address-form.tsx` (React Hook Form + Zod resolver)

**Evidence:** `package.json` (zod@4.2.1), `src/actions/checkout.ts` (checkoutSchema with zod), `src/actions/address.ts` (addressSchema with zod), `src/components/account/address-form.tsx` (zodResolver)

### Validation Rules

**Server boundary'de validate et; client-side sadece UX**

1. **Server Actions**: Tüm input'lar Zod schema ile validate edilir (`schema.parse(data)`)
2. **API Routes**: Search params manuel parse edilir (type coercion, clamp, whitelist)
3. **Client Forms**: React Hook Form + Zod resolver UX için kullanılır, ancak server action'da tekrar validate edilir
4. **Error Handling**: Zod validation error'ları user-friendly mesajlara çevrilir

**Evidence:** `src/actions/checkout.ts` (checkoutSchema.parse), `src/actions/address.ts` (addressSchema.parse), `src/app/api/products/route.ts` (searchParams manual parsing with validation)

### XSS Prevention

**Observed**: `dangerouslySetInnerHTML` kullanılıyor, ancak **sanitize edilmiş HTML** ile.

- **Sanitization Function**: `stripUnsafeHtml()` - `<script>`, `<style>` tag'lerini ve `on*` event handler'larını kaldırır
- **Usage**: `src/components/product/product-view.tsx` içinde product description render'ında kullanılıyor
- **Rule**: Sadece sanitize edilmiş HTML `dangerouslySetInnerHTML` ile render edilir

**Evidence:** `src/components/product/product-view.tsx` (stripUnsafeHtml function, dangerouslySetInnerHTML with safeDescriptionHtml)

---

## 6. API / Route Handler Security

### Authentication Checks

**Observed**: Bazı endpoint'lerde auth check var, bazılarında yok:

- `/api/products` - Optional auth (userId için favorites check, public endpoint)
- `/api/search` - Public endpoint (auth check yok)
- `/api/auth/signup` - Public endpoint (auth check yok)
- `/api/auth/[...nextauth]` - NextAuth handler (built-in auth)

**Protected endpoints**: Explicit protected API route yok. Protection layout seviyesinde (`/account/*`, `/admin/*`).

**Evidence:** `src/app/api/products/route.ts` (optional session check), `src/app/api/search/route.ts` (no auth check), `src/app/api/auth/signup/route.ts` (no auth check)

### Rate Limiting

**Not implemented (as of repo scan: 2025-01-27)**

API route'larında rate limiting yok. `/api/auth/signup` ve diğer public endpoint'ler rate limit koruması olmadan çalışıyor.

**Evidence:** Codebase search (rate limiting, ratelimit, throttle bulunamadı), `src/app/api/*/route.ts` (rate limit check yok)

### Error Handling

**Observed**: Error handling var, ancak stack trace sızdırma riski var:

- **API Routes**: `console.error` ile loglanıyor, user'a generic error mesajı dönülüyor
- **Server Actions**: Zod error'ları user-friendly mesajlara çevriliyor, internal error'lar generic mesajla dönülüyor
- **Risk**: `console.error` içinde full error object loglanıyor (production'da stack trace sızabilir)

**Evidence:** `src/app/api/search/route.ts` (console.error("Search error:", error), generic response), `src/actions/checkout.ts` (console.error with full error, generic user message)

### Logging & PII Masking

**Not implemented (as of repo scan: 2025-01-27)**

PII masking policy yok. `console.error` ve `console.log` içinde PII (email, address, phone) loglanabilir.

**Policy (recommended)**: 
- Email'ler maskelenmeli: `user@example.com` → `u***@example.com`
- Phone number'lar maskelenmeli: `+905551234567` → `+90***1234567`
- Address'ler loglanmamalı veya sadece city/district loglanmalı

**Evidence:** `src/app/api/auth/signup/route.ts` (console.error with potential PII), `src/actions/address.ts` (console.error with address data), `src/actions/favorites.ts` (console.log with user data)

---

## 7. Browser Security Headers & CSP

### Security Headers Configuration

**Not implemented (as of repo scan: 2025-01-27)**

`next.config.ts` veya `middleware.ts` içinde security headers set edilmiyor. Next.js default headers kullanılıyor.

**Evidence:** `next.config.ts` (sadece images config, headers yok), middleware.ts yok, `src/proxy.ts` (sadece NextResponse.next(), headers yok)

### Content Security Policy (CSP)

**Not implemented (as of repo scan: 2025-01-27)**

CSP header'ı set edilmiyor.

### Recommended Baseline (if not implemented)

**Assumption**: Production'da aşağıdaki headers set edilmeli:

- `X-Content-Type-Options: nosniff` - MIME type sniffing önleme
- `Referrer-Policy: strict-origin-when-cross-origin` - Referrer bilgisi kontrolü
- `Permissions-Policy: geolocation=(), microphone=(), camera=()` - Feature policy

**Content Security Policy (CSP) - Secure Baseline:**

If you must use inline scripts/styles, prefer `nonce-` or `sha256-` hashes. Avoid `unsafe-inline` and `unsafe-eval` in production.

Example secure CSP baseline (domain allowlist projeye göre güncellenecek):

```
default-src 'self';
base-uri 'self';
object-src 'none';
frame-ancestors 'none';
img-src 'self' data: https:;
font-src 'self' data: https:;
style-src 'self' 'nonce-<RANDOM_NONCE>' https:;
script-src 'self' 'nonce-<RANDOM_NONCE>' https:;
connect-src 'self' https:;
upgrade-insecure-requests;
```

**Note**: CSP must be validated against actual third-party integrations (analytics, payments, CDN).

**Reasoning**: Next.js default headers yeterli değil, explicit CSP ve security headers önerilir.

**Evidence:** `next.config.ts` (headers config yok), middleware.ts yok

---

## 8. File Uploads & Media

### Upload Implementation

**Not implemented (as of repo scan: 2025-01-27)**

File upload component veya route handler bulunamadı. `input type="file"` kullanımı yok.

**Evidence:** Codebase search (`type="file"`, `multipart`, `upload` bulunamadı)

### Validation & Limits

N/A (upload yok)

---

## 9. Dependency Policy (2026)

### Update Cadence

**Policy (recommended)**:

- **Patch updates**: Haftalık veya iki haftada bir (`npm update` veya `npm audit fix`)
- **Minor updates**: Aylık (planlı, test edilerek)
- **Major updates**: Karar kaydı (15) + kısa spike (dependency breaking changes değerlendirmesi)

**Evidence:** `package.json` (dependencies list, version ranges)

### Package Manager & Lockfile

**Observed**: **npm** kullanılıyor. `package-lock.json` mevcut.

- **Lockfile**: `package-lock.json` (git'te commit edilmeli)
- **Policy**: Tek package manager kullan (npm). `pnpm` veya `yarn` kullanılmamalı.

**Evidence:** `package-lock.json` (mevcut), `package.json` (npm scripts)

### Allowed Libraries

**Policy**: Mevcut stack dışına çıkmak approval ister:

- **Approval Required**: Yeni major dependency eklemeden önce karar kaydı (15) + spike
- **Stack**: Next.js 16, React 19, Drizzle ORM, NextAuth v5, Zod, Radix UI, Tailwind CSS
- **Exception**: Security patches ve minor updates approval gerektirmez

**Evidence:** `package.json` (current dependencies: next@16.1.1, react@19.2.3, drizzle-orm@0.45.1, next-auth@5.0.0-beta.25, zod@4.2.1)

---

## 10. Vulnerability Management (SCA)

### Security Audit Tools

**Not implemented (as of repo scan: 2025-01-27)**

`package.json` scripts'te `npm audit` veya başka security audit tool yok. GitHub Dependabot config yok.

**Evidence:** `package.json` (scripts: dev, build, start, lint, db:generate, db:migrate, woo:import - audit yok)

### Recommended Tools (if not implemented)

**Assumption**: Aşağıdaki tools önerilir:

- **npm audit**: `npm audit --production` (production dependencies için)
- **GitHub Dependabot**: Automated dependency updates ve security alerts
- **CI/CD Integration**: Pre-commit veya CI'da `npm audit` check

**Reasoning**: Dependency vulnerability management için automated tooling gerekli.

**Evidence:** `package.json` (audit script yok), `.github/dependabot.yml` yok

### Critical Vulnerability SLA

**Policy (recommended)**:

- **Critical (S0)**: 24 saat içinde patch veya workaround
- **High (S1)**: 7 gün içinde patch
- **Medium (S2)**: 30 gün içinde patch
- **Low (S3)**: Next minor update'te patch

**Evidence:** Policy (recommended, not implemented)

---

## 11. Logging, PII & Privacy

### PII Fields

PII sayılan alanlar:

- **Email**: Kullanıcı email adresi
- **Phone**: Telefon numarası (`src/actions/address.ts` içinde)
- **Address**: Tam adres bilgisi (`fullAddress`, `city`, `district`)
- **Name**: Kullanıcı adı
- **Order Notes**: Sipariş notları (varsa)

**Evidence:** `src/actions/address.ts` (addressSchema: phone, fullAddress, city, district), `src/auth.ts` (user email, name)

### Frontend Logging Rules

**Policy (recommended)**: PII console'a basılmaz.

**Observed**: `console.log` ve `console.error` içinde PII loglanıyor:

- `src/actions/favorites.ts`: `console.log("[toggleFavoriteAction] User ID:", userId)` - User ID PII değil ama loglanıyor
- `src/app/api/auth/signup/route.ts`: `console.error("Signup error:", error)` - Error içinde email olabilir

**Evidence:** `src/actions/favorites.ts` (console.log with user data), `src/app/api/auth/signup/route.ts` (console.error with potential PII)

### Analytics & PII

**Unknown (as of repo scan: 2025-01-27)**

Analytics tool (Google Analytics, Plausible, PostHog) bulunamadı. Analytics event'lerde PII yasağı policy olarak tanımlanmalı.

**Policy (recommended)**: Analytics event'lerde PII (email, phone, address) gönderilmez. Sadece anonymized user ID veya session ID kullanılır.

**Evidence:** Codebase search (analytics, ga, gtag, posthog, mixpanel bulunamadı)

---

## 12. Security Checklist (Do / Don't)

### DO

1. **DO**: Server boundary'de (server actions, API routes) tüm input'ları Zod ile validate et
2. **DO**: Protected sayfaları layout seviyesinde `auth()` check ile kilitle
3. **DO**: Admin-only actions'da role check yap (`session.user.role !== "admin"`)
4. **DO**: `dangerouslySetInnerHTML` kullanırken HTML'i sanitize et (`stripUnsafeHtml`)
5. **DO**: API error response'larında generic mesaj dön, internal detay sızdırma
6. **DO**: Environment variable'ları server-only kullan (`NEXT_PUBLIC_` prefix'i olmadan)
7. **DO**: Password'ları Argon2id ile hashle (argon2.verify kullan)
8. **DO**: Dependency update'lerde lockfile'ı güncelle (`package-lock.json`)
9. **DO**: Major dependency update'lerde karar kaydı (15) + spike yap
10. **DO**: Search params'ı manuel parse et ve validate et (type coercion, clamp, whitelist)
11. **DO**: Server actions'da Zod error'ları user-friendly mesajlara çevir
12. **DO**: Production'da `AUTH_SECRET` environment variable'ını set et
13. **DO**: Error log'larında PII mask'le (email, phone, address)
14. **DO**: `console.error` kullanırken stack trace'i production'da mask'le
15. **DO**: Dependency vulnerability'leri düzenli kontrol et (`npm audit`)

### DON'T

1. **DON'T**: `NEXT_PUBLIC_` prefix'i ile secret'ları client'a expose et
2. **DON'T**: User input'u sanitize etmeden `dangerouslySetInnerHTML` ile HTML bas
3. **DON'T**: API route'larda auth check yapmadan protected data döndür
4. **DON'T**: `console.log` veya `console.error` içinde PII (email, phone, address) logla
5. **DON'T**: Error response'larında stack trace veya internal error detayı sızdır
6. **DON'T**: Client-side validation'a güven, server-side validation zorunlu
7. **DON'T**: Rate limiting olmadan public API endpoint'leri expose et
8. **DON'T**: CSP ve security headers olmadan production'a deploy et
9. **DON'T**: Dependency update'lerde lockfile'ı ignore et
10. **DON'T**: Major dependency update'lerde test etmeden production'a deploy et

---

## 13. Open Gaps

Aşağıdaki security eksiklikleri repo taramasında bulunamadı (as of repo scan: 2025-01-27):

1. **Rate Limiting**: API route'larında rate limiting yok (`/api/auth/signup`, `/api/search` vb.)
2. **CSP (Content Security Policy)**: CSP header'ı set edilmiyor. CSP must be validated against actual third-party integrations (analytics, payments, CDN).
3. **Security Headers**: `X-Content-Type-Options`, `Referrer-Policy`, `Permissions-Policy` header'ları set edilmiyor
4. **Audit Pipeline**: `npm audit` CI/CD pipeline'ında yok, automated dependency updates yok
5. **Sentry/Monitoring**: Error tracking service (Sentry, LogRocket) yok
6. **Structured Logging**: `console.error` kullanılıyor, structured logging (Winston, Pino) yok
7. **PII Masking**: Log'larda PII masking policy yok
8. **Middleware**: `middleware.ts` yok, layout-level protection kullanılıyor (middleware daha güvenli)
9. **CSRF Explicit Check**: NextAuth default CSRF koruması var ama explicit check yok
10. **Analytics PII Policy**: Analytics tool yok, PII policy tanımlı değil

---

## 14. Evidence Index

1. `package.json` - Dependencies (next-auth@5.0.0-beta.25, zod@4.2.1, argon2@0.44.0)
2. `package-lock.json` - npm lockfile (package manager evidence)
3. `src/auth.ts` - NextAuth config, Credentials provider, Argon2 password verification
4. `src/auth.config.ts` - NextAuth config, JWT session strategy
5. `src/app/account/layout.tsx` - Protected route strategy (layout-level auth check)
6. `src/app/admin/layout.tsx` - Admin route protection (role check)
7. `src/actions/checkout.ts` - Zod validation, auth check, error handling
8. `src/actions/address.ts` - Zod validation, PII fields (phone, address), auth check
9. `src/actions/admin.ts` - Admin authorization check, role-based access
10. `src/app/api/products/route.ts` - Search params validation, optional auth check
11. `src/app/api/search/route.ts` - Public endpoint, no auth check, error handling
12. `src/app/api/auth/signup/route.ts` - Public endpoint, Argon2 password hashing, error logging
13. `src/components/product/product-view.tsx` - dangerouslySetInnerHTML with sanitization (stripUnsafeHtml)
14. `src/components/account/address-form.tsx` - React Hook Form + Zod resolver
15. `next.config.ts` - No security headers config, only images config
16. `src/db/connection.ts` - DATABASE_URL env key usage (server-only)
17. `scripts/woo-import.ts` - WOO_* env keys usage
18. `eslint.config.mjs` - ESLint config (no security plugin)
19. `src/proxy.ts` - Empty proxy, no middleware security
20. `src/actions/favorites.ts` - Console logging with user data (PII risk)
21. Codebase search - No rate limiting implementation found
22. Codebase search - No CSP/security headers implementation found
23. Codebase search - No analytics tool found (GA, Sentry, etc.)
24. Codebase search - No file upload implementation found
25. Codebase search - No npm audit script found
26. Codebase search - No middleware.ts found
27. Codebase search - No sanitize/DOMPurify library found (custom stripUnsafeHtml used)
28. `.env*` files - Not found in repo (likely in .gitignore)
---

# DOC-14: 14.Cursor-bridge-instructions.md

---
# 14. Cursor Bridge Instructions

Bu doküman, Cursor AI'nin Cursor'a "projede yaşıyormuş" gibi doğru bağlamla, uydurma yapmadan, %100 uygulanabilir promptlar üretmesini sağlayacak köprü dokümanıdır. Amaç: Cursor → Cursor akışını standartlaştırmak ve hata oranını minimize etmek.

**Last verified from package.json:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

**Evidence:** `package.json` (dependencies: next@16.1.1, react@19.2.3, react-dom@19.2.3)

---

## 1. Purpose

Bu doküman şunları garanti eder:

1. **Uydurma Engelleme:** Cursor hiçbir zaman "repo'da yok" endpoint/route/component/field uydurmaz
2. **Doğru Prompt Üretimi:** Her prompt mevcut dokümantasyon (01-13) ile kanıtlanır, referans verilir
3. **Hızlı Döngü:** Standart format ile task intake → uygulama → review sürecini hızlandırır
4. **Deterministik Sonuçlar:** Her task'ta aynı kalite kapıları, aynı test süreçleri
5. **Small PR Yaklaşımı:** Büyük işleri parçalayarak AI-friendly PR boyutları sağlar
6. **Evidence-Based Development:** Her karar ve değişiklik mevcut dokümantasyon ile kanıtlanır
7. **Rollback Güvenliği:** Riskli değişikliklerde rollback planı zorunlu
8. **Tutarlı Kalite:** DoD checklist, risk planı, rollback stratejisi ile hata oranını düşürür

**Evidence:** `02.architecture-lock.md` (hard constraints), `08.api-contracts-frontend.md` (uydurma yasağı), `06.frontend-standards-2026.md` (DoD), `07.component-inventory.md` (component envanteri), `10.tasks-playbook.md` (task format standardizasyonu)

---

## 2. Cursor Role Definition

### 2.1 Rol Dağılımı

**Cursor (Brain / Architect / QA Reviewer):**
- Task request'i alır, analiz eder
- Mevcut dokümantasyonu (01-13) referans alır
- Plan oluşturur (Cursor Uygulama Paketi formatında)
- Risk ve rollback stratejisi belirler
- Assumption/Unknown'ları işaretler
- **Hiçbir zaman "repo'da yok" endpoint/route/component/field uydurmaz**

**Cursor (Implementer):**
- Cursor'den gelen planı uygular
- Dosya değişikliklerini yapar
- Small PR'lar oluşturur (5-7 dosya max)
- DoD checklist'i takip eder

**Murti (Decision Maker + Tester):**
- Task request'i hazırlar
- Uygulama sonrası manuel test yapar (smoke checklist)
- PR review yapar
- Karar verir: approve/reject/request changes

### 2.2 Cursor'nin Sorumlulukları

1. **Dokümantasyon Okuma:** Tüm ilgili dokümanları (01-13) okur, referans verir
2. **Plan Oluşturma:** Prompt Output Contract formatında plan üretir
3. **Risk Değerlendirme:** Riskli değişiklikleri işaretler, rollback planı önerir
4. **Assumption Yönetimi:** Bilinmeyen durumları "Unknown" veya "Assumption" olarak işaretler
5. **Evidence Sağlama:** Her karar için doküman/section referansı verir

**Evidence:** `10.tasks-playbook.md` (section 2: Operating Model)

---

## 3. Source of Truth (Documents & Priority Order)

Cursor, aşağıdaki dokümanları **öncelik sırasına göre** referans almalıdır. Çelişki durumunda üst sıradaki doküman kazanır ve "Decision record (15)" açılır.

### 3.1 Öncelik Sırası

| Öncelik | Doküman | Kapsam | Kullanım |
|---------|---------|--------|----------|
| 1 | `02.architecture-lock.md` | Hard constraints, yasaklar, mimari kararlar | Route path değişikliği, ORM seçimi, state management, framework constraints |
| 2 | `04.design-system.md` | Design tokens, UI components, styling kuralları | Renk sistemi, component kullanımı, theme system |
| 3 | `05.native-ux-rules.md` | Native UX patterns, feedback, mobile-first | Toast pattern, button states, mobile navigation, touch interactions |
| 4 | `08.api-contracts-frontend.md` | API endpoint contracts, field shapes, uydurma yasağı | Endpoint kullanımı, response shape, Server Action contracts |
| 5 | `03.routes-and-navigation-map.md` | Route table, navigation links, dynamic params | Route path'leri, link verme, navigation patterns |
| 6 | `09.data-fetching-cache-rules.md` | Data fetching, cache, ISR, mutation patterns | RSC vs Client fetch, cache invalidation, optimistic UI |
| 7 | `06.frontend-standards-2026.md` | Coding standards, DoD, quality gates | TypeScript, component structure, accessibility, error handling |
| 8 | `07.component-inventory.md` | Component envanteri, kullanım yerleri | Mevcut component'leri kullanma, duplicate önleme |
| 9 | `10.tasks-playbook.md` | Task format, PR size, DoD checklist | Task packaging, small PR rule, DoD |
| 10 | `11.qa-test-matrix.md` | Test senaryoları, exit criteria | Smoke tests, QA checklist |
| 11 | `12.release-prod-checklist.md` | Release checklist, post-release verification | Release gates, rollback plan |
| 12 | `01.project-brief.md` | Proje genel bakış, tech stack | Proje context, teknoloji seçimleri |
| 13 | `13.security-and-deps.md` | Security rules, dependency policy | Security guardrails, dependency updates |

### 3.2 Çelişki Çözümü

Çelişki durumunda:
1. Üst sıradaki doküman kazanır
2. "Decision record (15)" açılır (eğer yoksa oluşturulur)
3. Çelişki ve çözüm dokümante edilir
4. Murti onayı gerekir (riskli değişiklikler için)

**Evidence:** `02.architecture-lock.md` (section 2: Non-Negotiables), `10.tasks-playbook.md` (section 2.3: Source of Truth)

---

## 4. Non-Negotiables (Hard Constraints)

Aşağıdaki kurallar **asla ihlal edilemez**. Cursor bu kuralları her prompt'ta kontrol etmelidir.

### 4.1 Route & Navigation

- **Route path'leri değiştirilemez:** `/urun/[slug]`, `/account/*`, `/checkout`, `/cart` gibi mevcut route'lar değiştirilemez
- **Dynamic route pattern korunmalı:** `[slug]`, `[id]` gibi dynamic segment pattern'leri değiştirilemez
- **RESERVED_SLUGS kontrolü:** Yeni top-level sayfa açılırsa slug `RESERVED_SLUGS` array'ine eklenmeli
- **Link verme:** Route map'e uygun link'ler verilmeli, kırık link yok

**Evidence:** `02.architecture-lock.md` (section 2.1: Framework & Routing), `03.routes-and-navigation-map.md` (section 8.1: Dynamic Route Params)

### 4.2 Design System & Styling

- **Core UI colors token kullanımı:** Component içinde rastgele `#hex`, `rgb(...)` veya keyfi Tailwind palette class'ları ile core UI rengi verilmemelidir
- **Brand Primary değiştirilemez:** `--primary: #ff2357` değeri değişecekse karar kaydı (15) ile yapılmalıdır
- **Status colors exception:** `success / warning / info` gibi durum renkleri şu an Tailwind palette ile uygulanıyor olabilir (geçici istisna)
- **shadcn/ui New York style:** `components.json` config değiştirilemez
- **Theme system:** next-themes kullanılmalı, `attribute="class"` pattern korunmalı

**Evidence:** `04.design-system.md` (section 9.1: Non-Negotiables), `02.architecture-lock.md` (section 2.5: Styling & Design System)

### 4.3 Native UX Patterns

- **PDP bottom nav hidden:** `/urun/[slug]` sayfalarında bottom nav gizlenir (bilinçli istisna)
- **Add-to-cart feedback standardı:** Button state "Eklendi ✓" (2s timeout) + toast "Ürün sepete eklendi"
- **Toast position:** `position="top-center"` sabit, değiştirilemez
- **Sticky action bar:** Ürün detay sayfalarında kritik CTA her zaman görünür olmalı
- **Safe area support:** iOS home indicator alanına uyum zorunlu

**Evidence:** `05.native-ux-rules.md` (section 2.1: Critical CTA Visibility, section 3.1: Critical Action Feedback Pattern, section 12.1: Product Detail Page - Bottom Nav Hidden)

### 4.4 API & Data Contracts

- **Endpoint uydurma yasağı:** Mevcut endpoint'ler dışında yeni endpoint eklenemez (bu doküman güncellenmeli)
- **Field uydurma yasağı:** API response shape'lerinde yeni field eklenemez (contract bozulur)
- **Server Action contract:** Server Action input/output shape'leri değiştirilemez
- **Breaking change prosedürü:** Contract değişirse versioning/feature flag planı zorunlu

**Evidence:** `08.api-contracts-frontend.md` (section 10: Breaking-Change Rules), `02.architecture-lock.md` (section 2.8: API & Data Fetching)

### 4.5 Architecture Constraints

- **App Router zorunlu:** `pages/` klasörü oluşturulmamalı
- **Server Components varsayılan:** Client Component'e geçiş sadece `"use client"` ile
- **Drizzle ORM zorunlu:** Prisma veya başka ORM kullanılamaz
- **Context API zorunlu:** Redux, Zustand gibi external state library'leri kullanılamaz
- **Archive klasörü exclude:** `archive/**` klasörü build/typecheck dışı

**Evidence:** `02.architecture-lock.md` (section 2: Non-Negotiables)

### 4.6 Component Usage

- **Yeni component yazmadan önce inventory kontrolü:** Mevcut component'ler kullanılmalı, duplicate component açılmamalı
- **Core UI sadece design system layer'dan:** `src/components/ui/*` klasöründeki component'ler tek kaynak
- **Aynı amaç için duplicate component açmak yasak:** İstisna: A/B test (karar kaydı gerekir)

**Evidence:** `07.component-inventory.md` (section 2: Inventory Rules), `04.design-system.md` (section 3.1: Base Components)

---

## 5. Assumptions & Unknowns Policy

### 5.1 "Unknown" Ne Zaman Yazılır?

- **Codebase'de kanıt yok:** Grep/codebase search sonuçsuz
- **Dokümantasyonda belirtilmemiş:** 01-13 dokümanlarında bilgi yok
- **Test edilmemiş:** Manuel test yapılmamış, assumption yapılamaz

**Format:**
```
**Unknown:** [Açıklama] (kanıt: codebase search sonuçsuz / dokümantasyonda yok)
```

**Evidence:** `02.architecture-lock.md` (section 10.4: Error Handling - "Unknown: error boundary pattern'i kullanılmıyor")

### 5.2 "Assumption" Ne Zaman Yazılır?

- **Mantıklı çıkarım:** Mevcut pattern'lerden çıkarılabilir
- **Best practice:** Industry standard'a uygun
- **Düşük risk:** Yanlış olması durumunda kolay düzeltilebilir

**Format:**
```
**Assumption:** [Açıklama]
**Reasoning:** [Neden bu assumption yapıldı]
**Evidence:** [İlgili pattern/kanıt]
```

**Evidence:** `02.architecture-lock.md` (section 6.4: Environment Variables - "Assumption: `.gitignore` dosyası kontrol edilmedi")

### 5.3 Her Assumption İçin "Reasoning" Şartı

Her assumption mutlaka "Reasoning" ile desteklenmelidir. Reasoning yoksa assumption yazılamaz.

**Evidence:** `02.architecture-lock.md` (assumption pattern'leri)

### 5.4 Yüksek Risk Assumption'lar

Aşağıdaki durumlarda assumption yapılmamalı, Murti onayı gerekir:
- Route path değişikliği
- API contract değişikliği
- Auth/cookie/session değişikliği
- Cache stratejisi değişikliği
- Database schema değişikliği

**Evidence:** `10.tasks-playbook.md` (section 2.13: Escalation Rules)

---

## 6. Prompt Output Contract (Cursor → Cursor)

Cursor her promptu aşağıdaki yapıda üretir. Bu format **zorunludur** ve değiştirilemez.

### 6.1 Prompt Yapısı

```markdown
## Goal
[Kısa, net hedef - 1-2 cümle]

## Context (docs refs)
- `02.architecture-lock.md` (section X: ...)
- `04.design-system.md` (section Y: ...)
- [Diğer ilgili doküman referansları]

## Plan (steps)
1. [Adım 1 - dosya bazlı]
2. [Adım 2 - dosya bazlı]
3. [Adım 3 - dosya bazlı]

## Files to touch (explicit paths)
- `src/components/product/product-view.tsx` - [Değişiklik açıklaması]
- `src/app/checkout/page.tsx` - [Değişiklik açıklaması]
- [Maksimum 5-7 dosya]

## Implementation notes
- [Özel dikkat edilmesi gereken noktalar]
- [Pattern kullanımı]
- [Edge case'ler]

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: [SMK-XX] çalışıyor
- [ ] [Diğer DoD maddeleri]

## Risk & rollback
- **Risk:** [Risk açıklaması]
- **Rollback:** [Geri dönüş planı]

## Assumptions / Unknowns
- **Assumption:** [Açıklama] (Reasoning: ...)
- **Unknown:** [Açıklama] (kanıt: ...)

## Evidence checklist
- [ ] `02.architecture-lock.md` (section X) referans verildi
- [ ] `08.api-contracts-frontend.md` (section Y) referans verildi
- [ ] [Diğer evidence maddeleri]
```

### 6.2 Zorunlu Bölümler

1. **Goal:** Mutlaka olmalı, kısa ve net
2. **Context (docs refs):** En az 2-3 doküman referansı
3. **Plan (steps):** Dosya bazlı, adım adım
4. **Files to touch:** Maksimum 5-7 dosya (small PR rule)
5. **DoD:** En az 3-5 madde
6. **Risk & rollback:** Riskli değişikliklerde zorunlu
7. **Assumptions / Unknowns:** Varsa mutlaka belirtilmeli
8. **Evidence checklist:** En az 3-5 evidence referansı

**Evidence:** `10.tasks-playbook.md` (section 2.6: Prompt Output Contract)

---

## 7. Task Packaging (Files, Steps, DoD, Risk)

### 7.1 Small/Medium/Large Task Bölme

**Small Task (1-3 dosya):**
- Tek component değişikliği
- Tek route değişikliği
- Tek utility fonksiyonu ekleme

**Medium Task (4-7 dosya):**
- Feature ekleme (component + route + action)
- Refactor (birkaç ilgili dosya)
- Bug fix (birkaç ilgili dosya)

**Large Task (8+ dosya):**
- **Yasak:** Large task'lar küçük PR'lara bölünmeli
- Örnek: "Checkout flow iyileştirme" → "Address form iyileştirme" + "Payment method seçimi" + "Order summary"

### 7.2 "One PR = One Intent" Kuralı

Her PR tek bir intent içermeli:
- ✅ "PDP add-to-cart UX iyileştirme"
- ❌ "PDP UX iyileştirme + Checkout bug fix + Footer link cleanup"

### 7.3 "Cleanup Ayrı PR" Kuralı

Refactor/cleanup işlemleri feature PR'larından ayrı olmalı:
- ✅ Feature PR: "Yeni favori butonu ekleme"
- ✅ Cleanup PR: "Unused component'leri kaldırma"

**Evidence:** `10.tasks-playbook.md` (section 2.7: Task Packaging, section 3: Small PR Rule)

---

## 8. UI/UX Guardrails (Native + Design System)

### 8.1 Design Tokens

- **Core UI colors:** CSS variables / design tokens üzerinden yönetilmelidir
- **Token kullanımı:** `bg-primary`, `text-foreground`, `border-input` gibi token'lar kullanılmalı
- **Exception (Status Colors):** `success / warning / info` şu an Tailwind palette ile (geçici istisna)

**Evidence:** `04.design-system.md` (section 2.1: Colors, section 9.1: Non-Negotiables)

### 8.2 Component Contracts

- **shadcn/ui pattern:** Radix UI + CVA + Tailwind pattern korunmalı
- **Variant yönetimi:** CVA ile variant yönetimi yapılmalı
- **Component kullanımı:** Yeni UI deseni eklemeden önce mevcut component'i kullan

**Evidence:** `04.design-system.md` (section 3.1: Base Components), `07.component-inventory.md` (section 2: Inventory Rules)

### 8.3 Feedback Patterns

- **Toast:** Sadece kritik aksiyonlarda toast (sepete ekleme, sipariş oluşturma)
- **Button state:** Add-to-cart pattern: "Eklendi ✓" (2s timeout) + toast
- **Loading state:** Kritik form submit'lerde `isLoading` + "İşleniyor..." text
- **Error display:** Inline error - `text-destructive bg-destructive/10`

**Evidence:** `05.native-ux-rules.md` (section 3: Interaction & Feedback Rules)

### 8.4 Mobile Patterns

- **Bottom nav:** Mobile'da 5 tab (Home, Categories, Cart, Wishlist, Profile)
- **PDP bottom nav hidden:** `/urun/[slug]` sayfalarında bottom nav gizlenir
- **Sticky action bar:** Ürün detay sayfalarında kritik CTA her zaman görünür
- **Touch targets:** Minimum `h-11` (44px)
- **Safe area:** `env(safe-area-inset-bottom)` kullanılmalı

**Evidence:** `05.native-ux-rules.md` (section 4: Mobile-First Patterns, section 2.2: Touch Target Sizes)

---

## 9. Routes & API Contract Guardrails

### 9.1 Route Map Uyumu

- **Link verme:** Route map'e uygun link'ler verilmeli (`03.routes-and-navigation-map.md`)
- **Dynamic params:** `[slug]`, `[id]` pattern'leri korunmalı
- **RESERVED_SLUGS:** Yeni top-level sayfa açılırsa slug `RESERVED_SLUGS` array'ine eklenmeli

**Evidence:** `03.routes-and-navigation-map.md` (section 8.1: Dynamic Route Params, section 9.4: Gaps)

### 9.2 Endpoint Uydurma Yasağı

- **Mevcut endpoint'ler:** Sadece `08.api-contracts-frontend.md`'de listelenen endpoint'ler kullanılabilir
- **Yeni endpoint:** Yeni endpoint eklemek için bu doküman güncellenmeli ve Murti onayı gerekir
- **Contract değişikliği:** Breaking change varsa versioning/feature flag planı zorunlu

**Evidence:** `08.api-contracts-frontend.md` (section 10: Breaking-Change Rules, section 5: API Inventory)

### 9.3 Field Uydurma Yasağı

- **Response shape:** API response shape'leri değiştirilemez
- **Server Action contract:** Server Action input/output shape'leri değiştirilemez
- **Yeni field:** Yeni field eklemek için contract dokümante edilmeli

**Evidence:** `08.api-contracts-frontend.md` (section 10: Breaking-Change Rules, section 7: Contracts by Feature)

---

## 10. Data/Cache Guardrails

### 10.1 RSC vs Client Fetch Decision Tree

**Default: Server Components (RSC)**
- Initial page data (kategoriler, ürün listesi, ürün detay)
- SEO-critical content (metadata, product details)
- Auth-required data (user-specific initial data)

**Client Fetch: Sadece Gerekli Durumlarda**
- Interaktif/polling: Real-time data, infinite scroll pagination
- User-triggered: Search overlay, filter changes
- Optimistic UI: Mutation sonrası immediate feedback

**Evidence:** `09.data-fetching-cache-rules.md` (section 3: Fetch Decision Tree)

### 10.2 Cache/Revalidate Kuralları

- **API route cache:** Bazı route'lar `force-dynamic` + `no-store` kullanır (örn: products route)
- **Cache invalidation:** Mutation sonrası `revalidatePath` ile cache invalidate edilir
- **revalidateTag:** Kullanılmıyor, sadece `revalidatePath` kullanılıyor

**Evidence:** `09.data-fetching-cache-rules.md` (section 6: Caching & Revalidation Strategy, section 6.4: Cache Invalidation)

### 10.3 Mutation + UI Update Standardı

- **Optimistic UI (Favorites):** Client state hemen güncellenir, server action çağrılır, hata durumunda rollback
- **Cart:** Client state direkt güncellenir (localStorage sync), optimistic update yok
- **Feedback:** Mutation sonrası Sonner toast ile feedback gösterilir

**Evidence:** `09.data-fetching-cache-rules.md` (section 8: Mutations & Optimistic UI)

---

## 11. Quality Gates

### 11.1 Lint & Build

- **Lint:** `npm run lint` hatasız geçmeli
- **Build:** `npm run build` başarılı olmalı
- **TypeScript:** Build sırasında TypeScript kontrol ediliyor, hata olmamalı

**Evidence:** `06.frontend-standards-2026.md` (section 12: Definition of Done), `package.json` (scripts: lint, build)

### 11.2 Smoke Flows

- **SMK-01:** Home → Category → Product → Add to Cart
- **SMK-02:** Search → Product Detail
- **SMK-03:** Cart → Checkout → Order Success
- **SMK-04:** Login → Account → Wishlist
- **SMK-05:** Product Detail → Add to Favorites
- **SMK-06:** Empty Cart Flow
- **SMK-07:** Empty Search Results
- **SMK-08:** Protected Route Access (Unauthenticated)

**Evidence:** `11.qa-test-matrix.md` (section 3: Smoke Tests)

### 11.3 A11y Checks

- **Focus ring:** Tüm interactive elementlerde `focus-visible:ring-2` görünür
- **Keyboard navigation:** Tab order logical, Escape key çalışır
- **Screen reader:** ARIA labels, semantic HTML kullanılır
- **Color contrast:** WCAG AA minimum (4.5:1 normal text)

**Evidence:** `06.frontend-standards-2026.md` (section 4: Accessibility Standards), `11.qa-test-matrix.md` (section 6: Accessibility Checklist)

---

## 12. How to Review Cursor Output

Murti'nin yapacağı review checklist:

### 12.1 Diff Kontrolü (Dosya Bazlı)

- [ ] Değişen dosyalar maksimum 5-7 dosya (small PR rule)
- [ ] Her dosya değişikliği mantıklı ve gerekli
- [ ] Gereksiz değişiklik yok (formatting, whitespace)

**Evidence:** `10.tasks-playbook.md` (section 3: Small PR Rule)

### 12.2 UI Smoke (PDP/Cart/Checkout)

- [ ] SMK-01: Add to cart çalışıyor (toast + button state)
- [ ] SMK-03: Checkout akışı çalışıyor (loading state, success redirect)
- [ ] SMK-05: Favorites toggle çalışıyor (optimistic update)

**Evidence:** `11.qa-test-matrix.md` (section 3: Smoke Tests)

### 12.3 API Contract Bozulmadı

- [ ] Endpoint contract'ları bozulmamış (`08.api-contracts-frontend.md`)
- [ ] Field uydurma yok
- [ ] Server Action contract'ları bozulmamış

**Evidence:** `08.api-contracts-frontend.md` (section 10: Breaking-Change Rules)

### 12.4 Bottom Nav İstisnası Korundu

- [ ] `/urun/[slug]` sayfalarında bottom nav gizleniyor
- [ ] Sticky action bar görünür

**Evidence:** `05.native-ux-rules.md` (section 12.1: Product Detail Page - Bottom Nav Hidden)

### 12.5 Evidence Referansları

- [ ] En az 3-5 doküman referansı verilmiş
- [ ] Evidence referansları doğru (section/heading bazlı, satır numarası yok)

**Evidence:** Bu doküman (section 6: Prompt Output Contract)

---

## 13. Escalation Rules

Şu durumlarda Murti onayı şart:

### 13.1 Yeni Dependency Ekleme

- Yeni major dependency eklemeden önce karar kaydı (15) + spike
- Security patches ve minor updates approval gerektirmez

**Evidence:** `02.architecture-lock.md` (section 2.10: Build & Environment), `13.security-and-deps.md` (section 9: Dependency Policy)

### 13.2 Route Path Değişimi

- Mevcut route path'lerini değiştirmek yasak
- Yeni route eklemek serbest (App Router pattern'i takip edilmeli)

**Evidence:** `02.architecture-lock.md` (section 2.1: Framework & Routing, section 4.1: Forbidden Changes)

### 13.3 API Contract Breaking Change

- Endpoint/field contract değişikliği
- Versioning/feature flag planı zorunlu

**Evidence:** `08.api-contracts-frontend.md` (section 10: Breaking-Change Rules)

### 13.4 Theme/Token Değişimi

- Design token'ları değiştirmek yasak
- Brand Primary değişecekse karar kaydı (15) ile yapılmalıdır

**Evidence:** `04.design-system.md` (section 9.1: Non-Negotiables), `02.architecture-lock.md` (section 2.5: Styling & Design System)

### 13.5 Auth/Cookie/Session Değişimi

- NextAuth.js config değişikliği
- Cookie flags değişikliği
- Session strategy değişikliği

**Evidence:** `02.architecture-lock.md` (section 2.4: Authentication), `13.security-and-deps.md` (section 4: Authentication & Session Security)

### 13.6 Cache Stratejisi Değişimi

- ISR kullanımı (şu an kullanılmıyor)
- Cache invalidation pattern değişikliği
- `revalidateTag` kullanımı (şu an sadece `revalidatePath`)

**Evidence:** `09.data-fetching-cache-rules.md` (section 6: Caching & Revalidation Strategy, section 7: ISR / Revalidate Rules)

---

## 14. Examples (3–5 "Perfect Prompts")

### 14.1 Example 1: PDP Add-to-Cart UX İyileştirme

```markdown
## Goal
Ürün detay sayfasında sepete ekleme butonunun UX'ini iyileştirmek: button state feedback süresini optimize etmek ve toast mesajını güncellemek.

## Context (docs refs)
- `05.native-ux-rules.md` (section 3.1: Critical Action Feedback Pattern)
- `04.design-system.md` (section 3.1: Base Components - Button)
- `07.component-inventory.md` (section 5.1: Product Components - ProductView)

## Plan (steps)
1. `src/components/product/product-view.tsx` - Button state timeout'u 2s'den 1.5s'ye düşür
2. `src/components/product/product-view.tsx` - Toast mesajını "Ürün sepete eklendi" → "Sepete eklendi" olarak kısalt

## Files to touch (explicit paths)
- `src/components/product/product-view.tsx` - Button state timeout ve toast mesajı güncellemesi

## Implementation notes
- Mevcut pattern korunmalı: `setIsAdded(true)` + `toast.success()` + `setTimeout(() => setIsAdded(false), 2000)`
- Sadece timeout değeri ve toast mesajı değişecek
- Button state pattern'i (`05.native-ux-rules.md` section 3.1) korunmalı

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: SMK-01 (Add to cart) çalışıyor
- [ ] Button state "Eklendi ✓" 1.5s sonra reset oluyor
- [ ] Toast mesajı "Sepete eklendi" gösteriliyor

## Risk & rollback
- **Risk:** Düşük - sadece timeout ve mesaj değişikliği
- **Rollback:** `setTimeout` değerini 2000'e, toast mesajını "Ürün sepete eklendi"ye geri al

## Assumptions / Unknowns
- **Assumption:** 1.5s timeout kullanıcı deneyimini bozmayacak (Reasoning: 2s'den sadece 0.5s kısa, hala yeterli feedback süresi)

## Evidence checklist
- [ ] `05.native-ux-rules.md` (section 3.1) referans verildi
- [ ] `04.design-system.md` (section 3.1) referans verildi
- [ ] `07.component-inventory.md` (section 5.1) referans verildi
```

### 14.2 Example 2: Broken Footer Link Cleanup

```markdown
## Goal
Footer'da kırık link olan `/sss` linkini kaldırmak veya route oluşturmak.

## Context (docs refs)
- `03.routes-and-navigation-map.md` (section 9.4: Gaps - Broken Navigation Link)
- `07.component-inventory.md` (section 4: Layout Components - Footer)
- `03.routes-and-navigation-map.md` (section 5.2: Footer Navigation)

## Plan (steps)
1. `src/components/app/Footer.tsx` - `/sss` linkini kaldır (route yok, 404 riski)
2. Alternatif: `/support` linkine yönlendir (varsa)

## Files to touch (explicit paths)
- `src/components/app/Footer.tsx` - `/sss` linkini kaldır veya `/support`'a yönlendir

## Implementation notes
- Footer'da "Müşteri Hizmetleri" bölümünde `/sss` linki var (line 61)
- Route yok, 404 riski var
- `/support` route'u var, alternatif olarak kullanılabilir

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: Footer linkleri çalışıyor
- [ ] `/sss` linki kaldırıldı veya `/support`'a yönlendiriliyor
- [ ] 404 hatası yok

## Risk & rollback
- **Risk:** Çok düşük - sadece link kaldırma/değiştirme
- **Rollback:** `/sss` linkini geri ekle

## Assumptions / Unknowns
- **Assumption:** `/sss` route'u oluşturulmayacak (Reasoning: `03.routes-and-navigation-map.md`'de route yok, gap olarak işaretlenmiş)

## Evidence checklist
- [ ] `03.routes-and-navigation-map.md` (section 9.4) referans verildi
- [ ] `07.component-inventory.md` (section 4) referans verildi
- [ ] `03.routes-and-navigation-map.md` (section 5.2) referans verildi
```

### 14.3 Example 3: Cart Provider Hydration Bugfix

```markdown
## Goal
Cart provider'da localStorage hydration sırasında SSR/client mismatch hatasını düzeltmek.

## Context (docs refs)
- `09.data-fetching-cache-rules.md` (section 3.3: Provider State - localStorage Hydration)
- `07.component-inventory.md` (section 6: Providers & State Modules - CartProvider)
- `06.frontend-standards-2026.md` (section 6.2: State Management)

## Plan (steps)
1. `src/components/cart/cart-provider.tsx` - `hydrated` flag kontrolünü güçlendir
2. `src/components/cart/cart-provider.tsx` - SSR sırasında localStorage'a erişim yapılmadığından emin ol

## Files to touch (explicit paths)
- `src/components/cart/cart-provider.tsx` - Hydration logic iyileştirmesi

## Implementation notes
- Mevcut pattern: `useState(false)` → `useEffect` içinde `setHydrated(true)`
- SSR/client mismatch önlemek için `hydrated` flag kullanılıyor
- `typeof window !== "undefined"` kontrolü eklenebilir

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: SMK-01 (Add to cart) çalışıyor
- [ ] Cart state localStorage'dan doğru hydrate ediliyor
- [ ] SSR/client mismatch hatası yok

## Risk & rollback
- **Risk:** Orta - state management değişikliği, cart state bozulabilir
- **Rollback:** Önceki hydration logic'e geri dön

## Assumptions / Unknowns
- **Assumption:** `typeof window !== "undefined"` kontrolü yeterli olacak (Reasoning: Next.js standard pattern)

## Evidence checklist
- [ ] `09.data-fetching-cache-rules.md` (section 3.3) referans verildi
- [ ] `07.component-inventory.md` (section 6) referans verildi
- [ ] `06.frontend-standards-2026.md` (section 6.2) referans verildi
```

### 14.4 Example 4: Category Page Empty State Ekleme

```markdown
## Goal
Kategori sayfasında ürün yoksa empty state component'i eklemek.

## Context (docs refs)
- `05.native-ux-rules.md` (section 7.2: Empty States)
- `03.routes-and-navigation-map.md` (section 2: Route Table - `/[slug]`)
- `07.component-inventory.md` (section 5.3: Catalog Components - LoadMoreGrid)

## Plan (steps)
1. `src/app/[slug]/page.tsx` - Ürün listesi boşsa empty state kontrolü ekle
2. Yeni empty state component oluştur: `src/components/catalog/empty-product-list.tsx` (veya mevcut component kullan)

## Files to touch (explicit paths)
- `src/app/[slug]/page.tsx` - Empty state kontrolü
- `src/components/catalog/empty-product-list.tsx` - Yeni empty state component (veya mevcut component)

## Implementation notes
- Mevcut empty state pattern'leri: `src/app/search/page.tsx` (empty search), `src/app/checkout/page.tsx` (empty cart)
- Pattern: "Ürün bulunamadı" + "Kategorilere Git" button
- Component inventory kontrolü: Mevcut empty state component var mı?

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: Kategori sayfası (ürün yok) empty state gösteriyor
- [ ] Empty state component mevcut pattern'lere uygun
- [ ] "Kategorilere Git" button çalışıyor

## Risk & rollback
- **Risk:** Düşük - sadece UI ekleme
- **Rollback:** Empty state kontrolünü kaldır

## Assumptions / Unknowns
- **Unknown:** Mevcut empty state component var mı? (kanıt: `07.component-inventory.md` section 10.2 - Empty state component'leri görülmedi)

## Evidence checklist
- [ ] `05.native-ux-rules.md` (section 7.2) referans verildi
- [ ] `03.routes-and-navigation-map.md` (section 2) referans verildi
- [ ] `07.component-inventory.md` (section 5.3) referans verildi
```

### 14.5 Example 5: Search Overlay Debounce Optimizasyonu

```markdown
## Goal
Search overlay'de debounce süresini optimize etmek (300ms'den 250ms'ye düşürmek).

## Context (docs refs)
- `09.data-fetching-cache-rules.md` (section 11.4: Debouncing - Search)
- `07.component-inventory.md` (section 5.6: Search Components - SearchOverlay)
- `08.api-contracts-frontend.md` (section 7.6: Search - Endpoint contract)

## Plan (steps)
1. `src/components/search/search-overlay.tsx` - `DEBOUNCE_MS` constant'ını 300'den 250'ye düşür

## Files to touch (explicit paths)
- `src/components/search/search-overlay.tsx` - Debounce süresi güncellemesi

## Implementation notes
- Mevcut pattern: `DEBOUNCE_MS = 300` constant kullanılıyor
- Sadece constant değeri değişecek
- API contract değişmeyecek, sadece client-side debounce süresi

## DoD
- [ ] `npm run lint` PASS
- [ ] `npm run build` PASS
- [ ] Manuel smoke: SMK-02 (Search → Product Detail) çalışıyor
- [ ] Debounce 250ms çalışıyor (network tab'de kontrol)
- [ ] Search sonuçları doğru gösteriliyor

## Risk & rollback
- **Risk:** Çok düşük - sadece debounce süresi değişikliği
- **Rollback:** `DEBOUNCE_MS` değerini 300'e geri al

## Assumptions / Unknowns
- **Assumption:** 250ms debounce kullanıcı deneyimini bozmayacak (Reasoning: 300ms'den sadece 50ms kısa, hala yeterli debounce süresi)

## Evidence checklist
- [ ] `09.data-fetching-cache-rules.md` (section 11.4) referans verildi
- [ ] `07.component-inventory.md` (section 5.6) referans verildi
- [ ] `08.api-contracts-frontend.md` (section 7.6) referans verildi
```

**Evidence:** `10.tasks-playbook.md` (section 2.14: Examples), bu doküman (section 14: Examples)

---

## 15. Evidence Index

En önemli kanıt dosyaları ve referanslar:

1. **02.architecture-lock.md** - Hard constraints, yasaklar, mimari kararlar (section 2: Non-Negotiables)
2. **04.design-system.md** - Design tokens, UI components, styling kuralları (section 9.1: Non-Negotiables)
3. **05.native-ux-rules.md** - Native UX patterns, feedback, mobile-first (section 3.1: Critical Action Feedback Pattern)
4. **08.api-contracts-frontend.md** - API endpoint contracts, uydurma yasağı (section 10: Breaking-Change Rules)
5. **03.routes-and-navigation-map.md** - Route table, navigation links, dynamic params (section 8.1: Dynamic Route Params)
6. **09.data-fetching-cache-rules.md** - Data fetching, cache, ISR, mutation patterns (section 3: Fetch Decision Tree)
7. **06.frontend-standards-2026.md** - Coding standards, DoD, quality gates (section 12: Definition of Done)
8. **07.component-inventory.md** - Component envanteri, kullanım yerleri (section 2: Inventory Rules)
9. **10.tasks-playbook.md** - Task format, PR size, DoD checklist (section 2.6: Prompt Output Contract)
10. **11.qa-test-matrix.md** - Test senaryoları, exit criteria (section 3: Smoke Tests)
11. **12.release-prod-checklist.md** - Release checklist, post-release verification (section 13: Post-Release Verification)
12. **01.project-brief.md** - Proje genel bakış, tech stack (section 5: Tech Stack)
13. **13.security-and-deps.md** - Security rules, dependency policy (section 9: Dependency Policy)
14. **package.json** - Dependencies, scripts, project name
15. **src/app/layout.tsx** - Root layout, provider hierarchy
16. **src/components/product/product-view.tsx** - Add to cart pattern, toast usage
17. **src/components/cart/cart-provider.tsx** - Cart state, localStorage hydration
18. **src/components/favorites/favorites-provider.tsx** - Optimistic UI, rollback pattern
19. **src/app/api/products/route.ts** - Products API, cursor pagination
20. **src/actions/checkout.ts** - Checkout server action, Zod validation

**Evidence:** Tüm yukarıdaki dosyalar codebase'de mevcut ve kanıt olarak kullanıldı

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni route'lar, API endpoint'leri, component'ler veya cache kuralları eklendiğinde bu doküman güncellenmelidir.
---
