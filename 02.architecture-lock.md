# 02. Architecture Lock

Bu doküman, Cinselhobi.com Next projesinin mimari kararlarını, değişmez kuralları ve yasakları tanımlar. Amaç: AI asistanların (Cursor/Gemini) yanlış değişiklik yapmasını önlemek ve tutarlı geliştirme sağlamak.

**Son Güncelleme:** 2025-01-27  
**Proje:** cinselhobi-com-next  
**Next.js:** 16.1.1  
**React:** 19.2.3

---

## 1. Architecture Snapshot

1. **Next.js App Router kullanılıyor** - `pages/` klasörü yok, tüm route'lar `src/app/` altında (kanıt: `src/app/` yapısı, `package.json` next@16.1.1)
2. **Server Components varsayılan** - Client Component'ler sadece `"use client"` direktifi ile işaretlenmiş dosyalarda (kanıt: `src/app/page.tsx` Server Component, `src/components/cart/cart-provider.tsx` Client Component)
3. **Drizzle ORM + PostgreSQL** - Prisma kullanılmıyor (kanıt: `package.json` drizzle-orm@0.45.1, `src/db/schema.ts`, `README.md` line 185)
4. **NextAuth.js v5 (Auth.js)** - Credentials provider, Drizzle adapter (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)
5. **Tailwind CSS v4** - PostCSS plugin ile, shadcn/ui (New York style) entegrasyonu (kanıt: `package.json` tailwindcss@4, `components.json`, `postcss.config.mjs`)
6. **Context API state management** - Cart, Favorites, Search, Auth, Theme provider'ları (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`)
7. **Server Actions** - `src/actions/` klasöründe, Zod validation ile (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)
8. **Cursor-based pagination** - Infinite scroll pattern, `/api/products` endpoint'i (kanıt: `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`)
9. **Sonner toast sistemi** - Feedback için (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
10. **Archive klasörü build/typecheck dışı** - `tsconfig.json` ve `eslint.config.mjs` exclude ediyor (kanıt: `tsconfig.json` line 34, `eslint.config.mjs` line 16)

**Evidence:** `package.json`, `src/app/`, `src/components/`, `tsconfig.json`, `eslint.config.mjs`, `README.md`

---

## 2. Non-Negotiables (Hard Constraints)

### 2.1 Framework & Routing
- **App Router zorunlu** - `pages/` klasörü oluşturulmamalı, tüm route'lar `src/app/` altında olmalı (kanıt: `src/app/` yapısı, `package.json` next@16.1.1)
- **Route path'leri değiştirilemez** - Mevcut route path'leri (örn: `/urun/[slug]`, `/account/*`, `/checkout`) değiştirilemez (kanıt: `src/app/urun/[slug]/page.tsx`, `src/app/account/`, `src/app/checkout/page.tsx`)
- **Dynamic routes pattern korunmalı** - `[slug]`, `[id]` gibi dynamic segment pattern'leri değiştirilemez (kanıt: `src/app/urun/[slug]/page.tsx`, `src/app/order-success/[id]/page.tsx`)

**Evidence:** `src/app/` directory structure, `package.json` (next version)

### 2.2 Rendering Model
- **Server Components varsayılan** - Client Component'e geçiş sadece `"use client"` direktifi ile, gereksiz yere Client Component oluşturulmamalı (kanıt: `src/app/page.tsx` Server Component, `src/components/cart/cart-provider.tsx` Client Component)
- **Provider'lar sadece `layout.tsx`'te** - Theme, Auth, Cart, Favorites, Search provider'ları `src/app/layout.tsx` içinde, başka yerde provider açılmamalı (kanıt: `src/app/layout.tsx` lines 59-87)
- **Server/Client boundary korunmalı** - Server Component'ten Client Component'e prop geçişi serializable olmalı, function/Date/class instance geçirilemez (kanıt: `src/app/page.tsx` → `LoadMoreGrid` prop geçişi)

**Evidence:** `src/app/layout.tsx`, `src/app/page.tsx`, `src/components/cart/cart-provider.tsx`

### 2.3 Database & ORM
- **Drizzle ORM zorunlu** - Prisma veya başka ORM kullanılamaz (kanıt: `package.json` drizzle-orm@0.45.1, `README.md` line 185)
- **Schema değişikliği migration ile** - `src/db/schema.ts` değişiklikleri `npm run db:generate` ve `npm run db:migrate` ile yapılmalı (kanıt: `package.json` scripts, `drizzle/` migration files)
- **Connection singleton** - `src/db/connection.ts` export edilen `db` instance kullanılmalı, yeni connection pool oluşturulmamalı (kanıt: `src/db/connection.ts`)

**Evidence:** `package.json`, `src/db/schema.ts`, `src/db/connection.ts`, `README.md`

### 2.4 Authentication
- **NextAuth.js v5 zorunlu** - Auth.js v5 API'si kullanılmalı, eski v4 pattern'leri kullanılamaz (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)
- **Credentials provider pattern** - Email + password authentication, Argon2 hash (kanıt: `src/auth.ts` lines 31-68)
- **Auth adapter Drizzle** - `@auth/drizzle-adapter` kullanılmalı (kanıt: `package.json` @auth/drizzle-adapter@1.11.1, `src/auth.ts` lines 24-29)

**Evidence:** `package.json`, `src/auth.ts`, `src/auth.config.ts`

### 2.5 Styling & Design System
- **Tailwind CSS v4 zorunlu** - PostCSS plugin ile, `@tailwindcss/postcss` (kanıt: `package.json` tailwindcss@4, `postcss.config.mjs`)
- **shadcn/ui New York style** - `components.json` config değiştirilemez (kanıt: `components.json` style: "new-york")
- **Design tokens değiştirilemez** - `src/app/globals.css` içindeki CSS custom properties (`--primary`, `--background`, vb.) değiştirilemez (kanıt: `src/app/globals.css` lines 12-79)
- **Theme provider pattern** - `next-themes` kullanılmalı, `src/components/theme/theme-provider.tsx` wrapper'ı değiştirilemez (kanıt: `package.json` next-themes@0.4.6, `src/components/theme/theme-provider.tsx`)

**Evidence:** `package.json`, `components.json`, `src/app/globals.css`, `src/components/theme/theme-provider.tsx`, `postcss.config.mjs`

### 2.6 State Management
- **Context API zorunlu** - Redux, Zustand, Jotai gibi external state library'leri kullanılamaz (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`)
- **Provider hiyerarşisi sabit** - `layout.tsx` içindeki provider sırası değiştirilemez: ThemeProvider → AuthProvider → FavoritesProvider → CartProvider → HeaderProvider → SearchProvider (kanıt: `src/app/layout.tsx` lines 59-87)

**Evidence:** `src/app/layout.tsx`, `src/components/cart/cart-provider.tsx`

### 2.7 Forms & Validation
- **React Hook Form + Zod zorunlu** - Form validation için (kanıt: `package.json` react-hook-form@7.69.0, zod@4.2.1, `src/components/auth/login-form.tsx`)
- **Server Actions pattern** - Form submit'ler `src/actions/` içinde Server Action olmalı, Zod schema ile validate edilmeli (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `package.json`, `src/actions/checkout.ts`, `src/components/auth/login-form.tsx`

### 2.8 API & Data Fetching
- **Cursor-based pagination zorunlu** - `/api/products` endpoint'i cursor pattern kullanır, offset-based pagination kullanılamaz (kanıt: `src/app/api/products/route.ts` lines 37-44, 140-141)
- **API route handlers pattern** - `src/app/api/*/route.ts` pattern'i korunmalı, eski `pages/api/*` kullanılamaz (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Force-dynamic default** - API route'lar `export const dynamic = "force-dynamic"` kullanır (kanıt: `src/app/api/products/route.ts` line 9, `src/app/api/search/route.ts`)

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts`

### 2.9 Build & Environment
- **Archive klasörü exclude** - `archive/**` klasörü TypeScript ve ESLint tarafından ignore edilir, build'e dahil edilmez (kanıt: `tsconfig.json` line 34, `eslint.config.mjs` line 16)
- **Timezone Europe/Istanbul** - Tüm script'ler `TZ=Europe/Istanbul` ile çalışır (kanıt: `package.json` scripts, `next.config.ts` line 3)
- **Environment variable loading** - `.env.local` öncelikli, sonra `.env` (kanıt: `src/db/connection.ts` lines 6-7, `scripts/woo-import.ts`)

**Evidence:** `tsconfig.json`, `eslint.config.mjs`, `package.json`, `next.config.ts`, `src/db/connection.ts`

### 2.10 Toast & Feedback
- **Sonner zorunlu** - Toast notification'lar için, `Toaster` component'i `layout.tsx` içinde (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
- **Toast position top-center** - `position="top-center"` sabit (kanıt: `src/app/layout.tsx` line 82)

**Evidence:** `package.json`, `src/app/layout.tsx`

---

## 3. Allowed Changes

### 3.1 Routing
- **Yeni route eklemek serbest** - `src/app/` altında yeni route klasörleri oluşturulabilir, App Router pattern'i takip edilmeli (örn: `src/app/yeni-sayfa/page.tsx`)
- **Route groups kullanılabilir** - `(group)` pattern'i ile route organizasyonu yapılabilir
- **Loading/error/not-found.tsx eklemek serbest** - Route segment'lerine `loading.tsx`, `error.tsx`, `not-found.tsx` eklenebilir (kanıt: `src/app/urun/[slug]/loading.tsx`, `src/app/[slug]/loading.tsx`)

**Evidence:** `src/app/` structure, `src/app/urun/[slug]/loading.tsx`

### 3.2 Components
- **Yeni component eklemek serbest** - `src/components/` altında yeni component'ler oluşturulabilir, klasör organizasyonu korunmalı (örn: `src/components/product/`, `src/components/catalog/`)
- **Client Component oluşturmak serbest** - Gerekli durumlarda `"use client"` direktifi ile Client Component oluşturulabilir (kanıt: `src/components/cart/cart-provider.tsx`, `src/components/catalog/load-more-grid.tsx`)
- **shadcn/ui component eklemek serbest** - `npx shadcn@latest add [component]` ile yeni UI component'leri eklenebilir, `components.json` config'e uygun olmalı

**Evidence:** `src/components/` structure, `components.json`

### 3.3 Database
- **Schema genişletmek serbest** - `src/db/schema.ts` içine yeni tablolar/kolonlar eklenebilir, migration ile (kanıt: `src/db/schema.ts`, `drizzle/` migrations)
- **Query fonksiyonları eklemek serbest** - `src/db/queries/` altında yeni query fonksiyonları eklenebilir (kanıt: `src/db/queries/` directory)

**Evidence:** `src/db/schema.ts`, `src/db/queries/`

### 3.4 API
- **Yeni API route eklemek serbest** - `src/app/api/` altında yeni route handler'lar oluşturulabilir, `route.ts` pattern'i ile (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Server Action eklemek serbest** - `src/actions/` altında yeni Server Action'lar eklenebilir, Zod validation ile (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/app/api/`, `src/actions/`

### 3.5 Styling
- **Tailwind utility class'ları kullanmak serbest** - Component'lerde Tailwind class'ları kullanılabilir, design token'lar (`--primary`, `--background`, vb.) kullanılmalı
- **Custom CSS utility eklemek serbest** - `src/app/globals.css` içinde `@layer utilities` altında yeni utility class'lar eklenebilir (kanıt: `src/app/globals.css` lines 134-144)

**Evidence:** `src/app/globals.css`, `tailwind.config.ts`

### 3.6 Features
- **Yeni feature eklemek serbest** - Yeni e-ticaret özellikleri eklenebilir (örn: yeni payment method, yeni filter option), mevcut pattern'lere uygun olmalı
- **Client-side state eklemek serbest** - `useState`, `useEffect` gibi React hook'ları Client Component'lerde kullanılabilir (kanıt: `src/components/catalog/load-more-grid.tsx`)

**Evidence:** `src/components/catalog/load-more-grid.tsx`

---

## 4. Forbidden Changes

### 4.1 Framework & Routing
- **Pages Router'a geçiş yasak** - `pages/` klasörü oluşturulmamalı, App Router dışına çıkılmamalı
- **Mevcut route path'lerini değiştirmek yasak** - `/urun/[slug]`, `/account/*`, `/checkout`, `/cart` gibi mevcut route'lar değiştirilemez
- **Route handler pattern'ini değiştirmek yasak** - `route.ts` pattern'i değiştirilemez, eski `pages/api/*` pattern'i kullanılamaz

**Evidence:** `src/app/` structure, `src/app/api/` structure

### 4.2 Rendering Model
- **Server/Client boundary'yi bozmak yasak** - Server Component'lerden function/Date/class instance prop geçirilemez, serializable olmayan veri geçirilemez
- **Gereksiz Client Component oluşturmak yasak** - Server Component yeterliyse Client Component oluşturulmamalı, `"use client"` sadece gerekli durumlarda
- **Provider'ları başka yere taşımak yasak** - `layout.tsx` dışında provider açılmamalı, provider hiyerarşisi değiştirilemez

**Evidence:** `src/app/layout.tsx`, `src/app/page.tsx`

### 4.3 Database & ORM
- **Prisma veya başka ORM eklemek yasak** - Drizzle ORM dışında ORM kullanılamaz
- **Direct SQL query yazmak yasak** - `pg` driver'ı direkt kullanılmamalı, Drizzle ORM üzerinden query yazılmalı (exception: migration script'leri)
- **Connection pool oluşturmak yasak** - `src/db/connection.ts` dışında yeni connection pool oluşturulmamalı

**Evidence:** `package.json`, `src/db/connection.ts`, `README.md`

### 4.4 Authentication
- **NextAuth.js v4 pattern'leri kullanmak yasak** - Eski v4 API'si kullanılamaz, sadece v5 (Auth.js) pattern'leri
- **Başka auth library eklemek yasak** - NextAuth.js dışında auth library kullanılamaz (örn: Clerk, Supabase Auth)

**Evidence:** `package.json`, `src/auth.ts`

### 4.5 Styling & Design System
- **Design token'ları değiştirmek yasak** - `src/app/globals.css` içindeki CSS custom properties (`--primary`, `--background`, vb.) değiştirilemez
- **shadcn/ui style'ı değiştirmek yasak** - `components.json` içindeki `style: "new-york"` değiştirilemez
- **Tailwind config'i köklü değiştirmek yasak** - `tailwind.config.ts` içindeki `content` path'leri ve `theme.extend` değiştirilemez (küçük extension'lar serbest)
- **CSS-in-JS library eklemek yasak** - styled-components, emotion gibi CSS-in-JS library'leri eklenemez, Tailwind CSS kullanılmalı

**Evidence:** `src/app/globals.css`, `components.json`, `tailwind.config.ts`, `package.json`

### 4.6 State Management
- **External state library eklemek yasak** - Redux, Zustand, Jotai, Recoil gibi state library'leri eklenemez, Context API kullanılmalı
- **Provider hiyerarşisini değiştirmek yasak** - `layout.tsx` içindeki provider sırası değiştirilemez

**Evidence:** `src/app/layout.tsx`, `package.json`

### 4.7 Forms & Validation
- **Zod dışında validation library kullanmak yasak** - Yup, Joi gibi validation library'leri kullanılamaz, Zod zorunlu
- **React Hook Form dışında form library kullanmak yasak** - Formik, React Final Form gibi form library'leri kullanılamaz

**Evidence:** `package.json`, `src/actions/checkout.ts`

### 4.8 API & Data Fetching
- **Offset-based pagination kullanmak yasak** - `/api/products` endpoint'i cursor-based pagination kullanır, offset pattern'i kullanılamaz
- **API contract'ı bozmak yasak** - Mevcut API endpoint'lerinin response format'ı değiştirilemez (geriye dönük uyumluluk)
- **Fetch wrapper oluşturmak yasak** - Native `fetch` API kullanılmalı, axios/got gibi HTTP client library'leri eklenemez (exception: 3rd party API entegrasyonları)

**Evidence:** `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`

### 4.9 Build & Environment
- **Archive klasörünü build'e dahil etmek yasak** - `archive/**` klasörü TypeScript ve ESLint tarafından ignore edilir, bu ignore kaldırılamaz
- **Timezone'i değiştirmek yasak** - `TZ=Europe/Istanbul` sabit, script'lerde değiştirilemez

**Evidence:** `tsconfig.json`, `eslint.config.mjs`, `package.json`

### 4.10 Toast & Feedback
- **Sonner dışında toast library kullanmak yasak** - react-hot-toast, react-toastify gibi toast library'leri kullanılamaz
- **Toast position'ı değiştirmek yasak** - `position="top-center"` sabit

**Evidence:** `package.json`, `src/app/layout.tsx`

---

## 5. App Router & Rendering Model

### 5.1 Server Components (Default)
- **Varsayılan rendering strategy** - Tüm `page.tsx`, `layout.tsx` dosyaları Server Component (kanıt: `src/app/page.tsx`, `src/app/layout.tsx`)
- **Direct database queries** - Server Component'lerde Drizzle ORM ile direkt veritabanı sorguları yapılabilir (kanıt: `src/app/page.tsx` lines 11-15)
- **Async component'ler** - Server Component'ler `async` olabilir, `await` kullanılabilir (kanıt: `src/app/page.tsx` line 7)

**Evidence:** `src/app/page.tsx`, `src/app/layout.tsx`

### 5.2 Client Components (Explicit)
- **"use client" direktifi zorunlu** - Client Component'ler `"use client"` ile işaretlenmeli (kanıt: `src/components/cart/cart-provider.tsx` line 1, `src/components/catalog/load-more-grid.tsx` line 1)
- **Kullanım alanları:**
  - State management (useState, useReducer)
  - Event handlers (onClick, onChange)
  - Browser API'leri (localStorage, window)
  - React Context Provider'lar
  - Framer Motion animasyonları
- **Provider'lar Client Component** - Theme, Cart, Favorites, Search provider'ları Client Component (kanıt: `src/components/theme/theme-provider.tsx`, `src/components/cart/cart-provider.tsx`)

**Evidence:** `src/components/cart/cart-provider.tsx`, `src/components/catalog/load-more-grid.tsx`, `src/components/theme/theme-provider.tsx`

### 5.3 Suspense & Loading States
- **Loading.tsx pattern** - Route segment'lerde `loading.tsx` dosyası ile loading state gösterilebilir (kanıt: `src/app/urun/[slug]/loading.tsx`, `src/app/[slug]/loading.tsx`)
- **Suspense boundaries** - `not-found.tsx` içinde Suspense kullanılabilir (kanıt: `src/app/not-found.tsx` lines 24-28)
- **Search page Suspense** - `src/app/search/page.tsx` içinde Suspense ile async component wrap edilmiş (kanıt: `src/app/search/page.tsx` lines 154-162)

**Evidence:** `src/app/urun/[slug]/loading.tsx`, `src/app/not-found.tsx`, `src/app/search/page.tsx`

### 5.4 Error Handling
- **not-found.tsx mevcut** - Root level `not-found.tsx` var (kanıt: `src/app/not-found.tsx`)
- **Error boundary yok** - Root level `error.tsx` yok (Unknown: error boundary pattern'i kullanılmıyor)
- **API route error handling** - Try-catch blokları ile error handling yapılıyor (kanıt: `src/app/api/search/route.ts` lines 98-106)

**Evidence:** `src/app/not-found.tsx`, `src/app/api/search/route.ts`

---

## 6. Data Layer & API Boundaries (Frontend Perspective)

### 6.1 Data Fetching Patterns
- **Server Components: Direct DB queries** - Server Component'lerde Drizzle ORM ile direkt veritabanı sorguları (kanıt: `src/app/page.tsx` lines 11-15)
- **Client Components: Fetch API** - Client Component'lerde `/api/*` route'larına fetch ile istek atılıyor (kanıt: `src/components/catalog/load-more-grid.tsx` lines 54-78)
- **Server Actions** - Form submit'ler ve mutation'lar `src/actions/` içinde Server Action olarak (kanıt: `src/actions/checkout.ts`, `src/actions/address.ts`)

**Evidence:** `src/app/page.tsx`, `src/components/catalog/load-more-grid.tsx`, `src/actions/checkout.ts`

### 6.2 API Routes
- **Route handler pattern** - `src/app/api/*/route.ts` pattern'i (kanıt: `src/app/api/products/route.ts`, `src/app/api/search/route.ts`)
- **Dynamic routes** - `src/app/api/products/[slug]/route.ts` gibi dynamic segment'ler (kanıt: `src/app/api/products/[slug]/route.ts`)
- **Force-dynamic default** - API route'lar `export const dynamic = "force-dynamic"` kullanır (kanıt: `src/app/api/products/route.ts` line 9, `src/app/api/search/route.ts`)

**Evidence:** `src/app/api/products/route.ts`, `src/app/api/search/route.ts`, `src/app/api/products/[slug]/route.ts`

### 6.3 Environment Variables
- **DATABASE_URL** - PostgreSQL connection string (kanıt: `src/db/connection.ts` line 10, `README.md` lines 73-75)
- **AUTH_SECRET** - NextAuth.js secret (kanıt: `src/auth.ts` line 17, `README.md` line 76)
- **AUTH_URL** - NextAuth.js base URL (production) (kanıt: `README.md` line 78)
- **WOO_BASE_URL, WOO_CONSUMER_KEY, WOO_CONSUMER_SECRET** - WooCommerce import script için (kanıt: `README.md` lines 80-82, `scripts/woo-import.ts`)
- **WOO_IMPORT_MODE, WOO_IMPORT_LIMIT** - Import mode ve limit (kanıt: `README.md` lines 144-156)
- **WOO_AUTH_MODE** - WooCommerce auth mode (basic/query) (kanıt: `README.md` line 168)
- **WOO_PRODUCT_STATUS** - Product status filter (default: publish) (kanıt: `README.md` line 164)

**Evidence:** `src/db/connection.ts`, `src/auth.ts`, `README.md`, `scripts/woo-import.ts`

### 6.4 Fetch Wrapper
- **Native fetch kullanılıyor** - Custom fetch wrapper yok, native `fetch` API kullanılıyor (kanıt: `src/components/catalog/load-more-grid.tsx` line 78)
- **Base URL yok** - Relative URL'ler kullanılıyor (`/api/products`), base URL env variable'ı yok

**Evidence:** `src/components/catalog/load-more-grid.tsx`

---

## 7. State, Forms, Validation

### 7.1 State Management
- **Context API zorunlu** - Redux, Zustand gibi external state library'leri yok (kanıt: `package.json` - state library yok, `src/components/cart/cart-provider.tsx`)
- **Provider'lar:**
  - `CartProvider` - Sepet state'i, localStorage persistence (kanıt: `src/components/cart/cart-provider.tsx`)
  - `FavoritesProvider` - Favoriler state'i (kanıt: `src/components/favorites/favorites-provider.tsx`)
  - `SearchProvider` - Arama state'i (kanıt: `src/components/search/search-provider.tsx`)
  - `AuthProvider` - Auth state wrapper (kanıt: `src/components/auth/auth-provider.tsx`)
  - `ThemeProvider` - Theme state (next-themes) (kanıt: `src/components/theme/theme-provider.tsx`)
  - `HeaderProvider` - Header state (kanıt: `src/components/layout/header-context.tsx`)

**Evidence:** `src/components/cart/cart-provider.tsx`, `src/components/favorites/favorites-provider.tsx`, `package.json`

### 7.2 Forms
- **React Hook Form zorunlu** - Form library olarak (kanıt: `package.json` react-hook-form@7.69.0, `src/components/auth/login-form.tsx`)
- **Form pattern:** Client Component'te form, Server Action'a submit (kanıt: `src/components/auth/login-form.tsx`, `src/actions/checkout.ts`)

**Evidence:** `package.json`, `src/components/auth/login-form.tsx`, `src/actions/checkout.ts`

### 7.3 Validation
- **Zod zorunlu** - Validation library olarak (kanıt: `package.json` zod@4.2.1, `src/actions/checkout.ts` lines 7-18)
- **Server Action validation** - Server Action'larda Zod schema ile validate ediliyor (kanıt: `src/actions/checkout.ts` lines 27-28, `src/actions/address.ts` lines 33-34)
- **@hookform/resolvers** - React Hook Form + Zod entegrasyonu (kanıt: `package.json` @hookform/resolvers@5.2.2)

**Evidence:** `package.json`, `src/actions/checkout.ts`, `src/actions/address.ts`

---

## 8. Styling & Design System Integration

### 8.1 Tailwind CSS
- **Tailwind CSS v4** - PostCSS plugin ile (kanıt: `package.json` tailwindcss@4, `postcss.config.mjs`)
- **Content paths** - `tailwind.config.ts` içinde `src/pages/**`, `src/components/**`, `src/app/**` (kanıt: `tailwind.config.ts` lines 4-8)
- **Theme extension** - Font family extension var (Geist Sans, Geist Mono) (kanıt: `tailwind.config.ts` lines 11-14)

**Evidence:** `package.json`, `tailwind.config.ts`, `postcss.config.mjs`

### 8.2 shadcn/ui
- **New York style** - `components.json` içinde `style: "new-york"` (kanıt: `components.json` line 3)
- **RSC enabled** - `rsc: true` (kanıt: `components.json` line 4)
- **CSS variables** - `cssVariables: true` (kanıt: `components.json` line 10)
- **Icon library: Lucide** - `iconLibrary: "lucide"` (kanıt: `components.json` line 13)
- **Path aliases** - `@/components`, `@/lib/utils`, `@/components/ui` (kanıt: `components.json` lines 15-19)

**Evidence:** `components.json`, `package.json` (lucide-react@0.562.0)

### 8.3 Design Tokens
- **CSS custom properties** - `src/app/globals.css` içinde `:root` ve `.dark` class'ları altında token'lar (kanıt: `src/app/globals.css` lines 12-79)
- **Primary color: #ff2357** - Sabit hex değer (kanıt: `src/app/globals.css` lines 20, 54)
- **OKLCH color space** - Çoğu renk OKLCH formatında (kanıt: `src/app/globals.css` lines 14-78)
- **Radius: 0.65rem** - Border radius token (kanıt: `src/app/globals.css` line 13)
- **@theme directive** - Tailwind v4 `@theme` directive ile token mapping (kanıt: `src/app/globals.css` lines 95-132)

**Evidence:** `src/app/globals.css`

### 8.4 Toast System
- **Sonner zorunlu** - Toast notification library (kanıt: `package.json` sonner@2.0.7, `src/app/layout.tsx` line 82)
- **Position: top-center** - `position="top-center"` sabit (kanıt: `src/app/layout.tsx` line 82)
- **Rich colors** - `richColors` prop aktif (kanıt: `src/app/layout.tsx` line 82)

**Evidence:** `package.json`, `src/app/layout.tsx`

### 8.5 Animations
- **Framer Motion** - Animation library (kanıt: `package.json` framer-motion@12.23.26)
- **tw-animate-css** - Tailwind animation utilities (kanıt: `package.json` tw-animate-css@1.4.0, `src/app/globals.css` line 2)

**Evidence:** `package.json`, `src/app/globals.css`

---

## 9. Performance & Caching Rules

### 9.1 Rendering Strategy
- **Server Components default** - Performans için Server Component tercih ediliyor (kanıt: `src/app/page.tsx` Server Component)
- **Force-dynamic API routes** - API route'lar `export const dynamic = "force-dynamic"` kullanır, cache yok (kanıt: `src/app/api/products/route.ts` lines 9-10)

**Evidence:** `src/app/page.tsx`, `src/app/api/products/route.ts`

### 9.2 Caching
- **API route cache: no-store** - `/api/products` response header'ında `Cache-Control: no-store` (kanıt: `src/app/api/products/route.ts` line 148)
- **Revalidate: 0** - `/api/products` route'unda `export const revalidate = 0` (kanıt: `src/app/api/products/route.ts` line 10)
- **Image optimization** - Next.js Image component, `next.config.ts` içinde remotePatterns (kanıt: `next.config.ts` lines 6-22)

**Evidence:** `src/app/api/products/route.ts`, `next.config.ts`

### 9.3 Pagination
- **Cursor-based pagination** - Infinite scroll pattern, cursor ile pagination (kanıt: `src/app/api/products/route.ts` lines 37-44, `src/components/catalog/load-more-grid.tsx`)
- **Limit clamping** - API route'unda limit 1-50 arası clamp ediliyor (kanıt: `src/app/api/products/route.ts` lines 29-35)

**Evidence:** `src/app/api/products/route.ts`, `src/components/catalog/load-more-grid.tsx`

### 9.4 Code Splitting
- **Unknown** - Dynamic import pattern'i kullanılıyor mu bilinmiyor (codebase search sonuçsuz)

**Evidence:** Unknown

---

## 10. Error Handling & Observability

### 10.1 Error Boundaries
- **not-found.tsx mevcut** - Root level `not-found.tsx` var, Suspense ile wrap edilmiş (kanıt: `src/app/not-found.tsx`)
- **error.tsx yok** - Root level `error.tsx` yok, error boundary pattern'i kullanılmıyor

**Evidence:** `src/app/not-found.tsx`, codebase search (error.tsx bulunamadı)

### 10.2 API Error Handling
- **Try-catch pattern** - API route'larında try-catch blokları ile error handling (kanıt: `src/app/api/search/route.ts` lines 98-106, `src/app/api/auth/signup/route.ts` lines 51-57)
- **Error response format** - JSON error response, status code ile (kanıt: `src/app/api/products/[slug]/route.ts` lines 46, 52)

**Evidence:** `src/app/api/search/route.ts`, `src/app/api/auth/signup/route.ts`, `src/app/api/products/[slug]/route.ts`

### 10.3 Client Error Handling
- **Error state management** - Client Component'lerde `useState` ile error state yönetiliyor (kanıt: `src/components/catalog/load-more-grid.tsx` lines 44, 107, `src/components/auth/login-form.tsx` lines 13, 28)
- **AbortController** - Fetch request'lerinde AbortController ile cancel edilebiliyor (kanıt: `src/components/product/product-detail-page.tsx` lines 61, 76-120)

**Evidence:** `src/components/catalog/load-more-grid.tsx`, `src/components/auth/login-form.tsx`, `src/components/product/product-detail-page.tsx`

### 10.4 Logging & Monitoring
- **Console.error** - API route'larında `console.error` ile logging (kanıt: `src/app/api/search/route.ts` line 99, `src/app/api/auth/signup/route.ts` line 52)
- **Monitoring service yok** - Sentry, LogRocket gibi monitoring service'leri yok (Unknown: codebase search sonuçsuz)

**Evidence:** `src/app/api/search/route.ts`, `src/app/api/auth/signup/route.ts`, codebase search (monitoring service bulunamadı)

---

## 11. Security & Dependency Policy

### 11.1 Authentication
- **Argon2 password hashing** - Şifre hash'leme için Argon2id kullanılıyor (kanıt: `package.json` argon2@0.44.0, `src/app/api/auth/signup/route.ts` line 36)
- **NextAuth.js v5** - Auth.js v5 API'si, credentials provider (kanıt: `package.json` next-auth@5.0.0-beta.25, `src/auth.ts`)

**Evidence:** `package.json`, `src/auth.ts`, `src/app/api/auth/signup/route.ts`

### 11.2 Dependency Updates
- **Patch-level upgrade policy** - Assumption: Patch-level (x.x.PATCH) güncellemeler güvenlik yamaları için yapılmalı
- **Minor/Major upgrade SOP** - Assumption: Test edilmeli, breaking change kontrolü yapılmalı
- **Next.js version lock** - Next.js 16.1.1 kullanılıyor, major version upgrade dikkatli yapılmalı (kanıt: `package.json` next@16.1.1)

**Evidence:** `package.json`, Assumption

### 11.3 Environment Variables
- **Secret management** - `.env.local` ve `.env` dosyaları gitignore'da (assumption: `.gitignore` dosyası kontrol edilmedi)
- **AUTH_SECRET zorunlu** - Production için AUTH_SECRET gerekli (kanıt: `src/auth.ts` line 17)

**Evidence:** `src/auth.ts`, `src/db/connection.ts`, Assumption

### 11.4 Input Validation
- **Zod schema validation** - Server Action'larda ve API route'larında Zod ile input validation (kanıt: `src/actions/checkout.ts` lines 7-18, `src/actions/address.ts` lines 13-24)

**Evidence:** `src/actions/checkout.ts`, `src/actions/address.ts`

---

## 12. Repo Structure Conventions

### 12.1 Directory Structure
```
src/
├── app/                    # Next.js App Router routes
│   ├── [slug]/             # Dynamic routes
│   ├── api/                # API route handlers
│   └── ...                 # Other routes
├── components/             # React components
│   ├── ui/                 # shadcn/ui components
│   ├── cart/               # Cart-related components
│   ├── catalog/            # Product catalog components
│   └── ...                 # Other component categories
├── db/                     # Database layer
│   ├── connection.ts       # Drizzle DB instance
│   ├── queries/            # Query functions
│   └── schema.ts           # Drizzle schema
├── actions/                # Server Actions
├── lib/                    # Utility functions
├── hooks/                  # React hooks
├── types/                  # TypeScript types
└── config/                 # App configuration
```

**Evidence:** `src/` directory structure

### 12.2 Naming Conventions
- **Component files: PascalCase** - `ProductCard.tsx`, `CartProvider.tsx` (kanıt: `src/components/catalog/product-card.tsx`, `src/components/cart/cart-provider.tsx`)
- **Route files: lowercase** - `page.tsx`, `layout.tsx`, `loading.tsx`, `route.ts` (kanıt: `src/app/page.tsx`, `src/app/layout.tsx`)
- **Utility files: kebab-case veya camelCase** - `format.ts`, `utils.ts`, `cart-store.ts` (kanıt: `src/lib/format.ts`, `src/lib/utils.ts`, `src/components/cart/cart-store.ts`)

**Evidence:** `src/components/`, `src/app/`, `src/lib/`

### 12.3 Import Patterns
- **Path aliases** - `@/components`, `@/lib`, `@/hooks` (kanıt: `tsconfig.json` lines 22-24, `src/app/layout.tsx` imports)
- **Relative imports yok** - Path alias kullanılıyor, relative import (`../../`) kullanılmıyor (assumption: codebase'de relative import pattern'i görülmedi)

**Evidence:** `tsconfig.json`, `src/app/layout.tsx`, Assumption

### 12.4 Barrel Exports
- **Unknown** - Barrel export (`index.ts`) pattern'i kullanılıyor mu bilinmiyor (codebase search sonuçsuz)

**Evidence:** Unknown

---

## 13. Definition of Done (DoD)

### 13.1 Code Quality
- **Lint check** - `npm run lint` hatasız geçmeli (kanıt: `package.json` lint script)
- **TypeScript check** - `tsc --noEmit` hatasız geçmeli (assumption: TypeScript strict mode aktif)
- **Build success** - `npm run build` başarılı olmalı (kanıt: `package.json` build script)

**Evidence:** `package.json`, `tsconfig.json` (strict: true)

### 13.2 Functionality
- **Server Component pattern** - Yeni sayfalar Server Component olmalı (gerekliyse Client Component)
- **Error handling** - API route'lar ve Server Action'larda try-catch ile error handling
- **Validation** - Form submit'ler ve API input'ları Zod ile validate edilmeli

**Evidence:** `src/app/page.tsx`, `src/app/api/search/route.ts`, `src/actions/checkout.ts`

### 13.3 Styling
- **Design tokens kullanımı** - Tailwind class'ları design token'ları kullanmalı (`bg-primary`, `text-foreground`, vb.)
- **Responsive design** - Mobile-first yaklaşım, breakpoint'ler doğru kullanılmalı

**Evidence:** `src/app/globals.css`, Assumption (mobile-first pattern görüldü)

### 13.4 Testing
- **Unknown** - Test framework kurulu değil, test dosyası yok (kanıt: `package.json` - test dependency yok, codebase search - test file bulunamadı)

**Evidence:** `package.json`, codebase search

---

## 14. Open Risks / Gaps

### 14.1 Testing
- **Test framework yok** - Unit test, integration test, E2E test yok (kanıt: `package.json` - test dependency yok)
- **Test coverage yok** - Test coverage metriği yok

**Evidence:** `package.json`, codebase search

### 14.2 Error Handling
- **Global error boundary yok** - Root level `error.tsx` yok, error boundary pattern'i kullanılmıyor
- **Error logging standardize edilmemiş** - `console.error` kullanılıyor, structured logging yok

**Evidence:** `src/app/` (error.tsx bulunamadı), `src/app/api/search/route.ts`

### 14.3 Monitoring & Observability
- **Analytics yok** - Google Analytics, Plausible gibi analytics tool'ları yok (Unknown: codebase search sonuçsuz)
- **Performance monitoring yok** - Web Vitals tracking, performance monitoring service yok (Unknown)
- **Error tracking yok** - Sentry, LogRocket gibi error tracking service'leri yok (Unknown)

**Evidence:** Unknown (codebase search sonuçsuz)

### 14.4 Environment Configuration
- **Secret management belirsiz** - `.env*` dosyaları gitignore'da (assumption), production secret management stratejisi belirsiz
- **Environment variable dokümantasyonu eksik** - Tüm env variable'lar `README.md`'de dokümante edilmemiş (kanıt: `README.md` sadece bazı env variable'ları listeliyor)

**Evidence:** `README.md`, Assumption

### 14.5 Performance
- **Caching strategy belirsiz** - API route'lar force-dynamic, ISR/SSG pattern'i kullanılmıyor (kanıt: `src/app/api/products/route.ts` lines 9-10)
- **Image optimization** - Next.js Image component kullanılıyor, CDN kullanımı belirsiz (Unknown)

**Evidence:** `src/app/api/products/route.ts`, `next.config.ts`, Unknown

### 14.6 Documentation
- **API endpoint dokümantasyonu yok** - API endpoint'leri OpenAPI/Swagger ile dokümante edilmemiş
- **Component API dokümantasyonu yok** - Component prop'ları ve kullanım örnekleri dokümante edilmemiş

**Evidence:** Unknown (API/component docs bulunamadı)

---

## 15. Evidence Index

1. **package.json** - Dependencies, scripts, project name (`package.json`)
2. **next.config.ts** - Next.js config, image optimization, timezone (`next.config.ts`)
3. **tsconfig.json** - TypeScript config, paths, exclude (`tsconfig.json` line 34 - archive exclude)
4. **eslint.config.mjs** - ESLint config, archive ignore (`eslint.config.mjs` line 16)
5. **tailwind.config.ts** - Tailwind config, content paths (`tailwind.config.ts`)
6. **postcss.config.mjs** - PostCSS config, Tailwind v4 plugin (`postcss.config.mjs`)
7. **components.json** - shadcn/ui config, New York style (`components.json`)
8. **src/app/layout.tsx** - Root layout, provider hierarchy (`src/app/layout.tsx` lines 59-87)
9. **src/app/page.tsx** - Home page, Server Component pattern (`src/app/page.tsx`)
10. **src/app/globals.css** - Design tokens, CSS custom properties (`src/app/globals.css` lines 12-79)
11. **src/db/schema.ts** - Drizzle schema, table definitions (`src/db/schema.ts`)
12. **src/db/connection.ts** - DB connection, env loading (`src/db/connection.ts`)
13. **src/auth.ts** - NextAuth.js v5 config, credentials provider (`src/auth.ts`)
14. **src/components/cart/cart-provider.tsx** - Context API pattern, Client Component (`src/components/cart/cart-provider.tsx`)
15. **src/components/theme/theme-provider.tsx** - Theme provider, next-themes wrapper (`src/components/theme/theme-provider.tsx`)
16. **src/app/api/products/route.ts** - API route pattern, cursor pagination (`src/app/api/products/route.ts`)
17. **src/components/catalog/load-more-grid.tsx** - Client Component, fetch pattern (`src/components/catalog/load-more-grid.tsx`)
18. **src/actions/checkout.ts** - Server Action pattern, Zod validation (`src/actions/checkout.ts`)
19. **src/app/not-found.tsx** - Error handling, Suspense (`src/app/not-found.tsx`)
20. **src/app/urun/[slug]/loading.tsx** - Loading state pattern (`src/app/urun/[slug]/loading.tsx`)
21. **README.md** - Setup instructions, env variables (`README.md` lines 72-84, 185)
22. **src/components/auth/login-form.tsx** - Form pattern, React Hook Form (`src/components/auth/login-form.tsx`)
23. **src/app/api/search/route.ts** - API error handling (`src/app/api/search/route.ts` lines 98-106)
24. **src/components/product/product-detail-page.tsx** - AbortController pattern (`src/components/product/product-detail-page.tsx` lines 61, 76-120)

---

**Not:** Bu doküman, repo'nun mevcut durumuna göre oluşturulmuştur. Yeni değişiklikler yapıldığında bu doküman güncellenmelidir.

